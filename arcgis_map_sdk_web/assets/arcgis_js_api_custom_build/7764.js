"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[7764],{97622:(t,e,i)=>{i.d(e,{Z:()=>m});var n=i(36663),s=(i(91957),i(8400)),o=i(41151),a=i(16068),r=i(82064),l=i(81977),c=i(69236),d=(i(7753),i(40266)),u=i(7283),p=i(67666);let h=class extends((0,r.eC)(o.j)){constructor(t){super(t),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.n.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],h.prototype,"startPoint",void 0),(0,n._)([(0,l.Cb)({type:p.Z,json:{write:!0}})],h.prototype,"endPoint",void 0),(0,n._)([(0,l.Cb)({type:s.V,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"measureType",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.p)((t=>a.BV.normalize((0,u.q9)(t),0,!0)))],h.prototype,"orientation",void 0),h=(0,n._)([(0,d.j)("esri.analysis.LengthDimension")],h);const m=h},8400:(t,e,i)=>{var n;i.d(e,{V:()=>s,n:()=>n}),function(t){t.Horizontal="horizontal",t.Vertical="vertical",t.Direct="direct"}(n||(n={}));const s=[n.Horizontal,n.Vertical,n.Direct]},60573:(t,e,i)=>{i.d(e,{p:()=>c});var n=i(36663),s=i(23148),o=i(61681),a=i(64189),r=i(81977),l=(i(7283),i(7753),i(40266));const c=t=>{let e=class extends((0,a.v)(t)){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(t){this._userInteractive=t}get updating(){return!1}get visible(){return!(0,o.pC)(this.parent)||this.parent.visible&&!this.parent.suspended}set visible(t){this._overrideIfSome("visible",t)}forceInteractiveForViewModel(){return this._interactiveViewModelCount++,(0,s.kB)((()=>this._interactiveViewModelCount--))}};return(0,n._)([(0,r.Cb)({readOnly:!0})],e.prototype,"type",void 0),(0,n._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"analysis",void 0),(0,n._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"parent",void 0),(0,n._)([(0,r.Cb)({constructOnly:!0})],e.prototype,"view",void 0),(0,n._)([(0,r.Cb)({type:Boolean})],e.prototype,"interactive",null),(0,n._)([(0,r.Cb)()],e.prototype,"_userInteractive",void 0),(0,n._)([(0,r.Cb)({readOnly:!0})],e.prototype,"updating",null),(0,n._)([(0,r.Cb)()],e.prototype,"visible",null),(0,n._)([(0,r.Cb)()],e.prototype,"_interactiveViewModelCount",void 0),e=(0,n._)([(0,l.j)("esri.views.3d.analysis.AnalysisView3D")],e),e}},77764:(t,e,i)=>{i.r(e),i.d(e,{default:()=>ii});var n,s=i(36663),o=i(53443),a=i(41831),r=i(13802),l=i(61681),c=i(76868),d=i(81977),u=(i(7283),i(7753),i(40266)),p=i(60573),h=i(8400),m=i(44584),_=i(17321),f=i(18327),g=i(19431),y=i(39405),v=i(24455),S=i(39100),C=i(6766),b=i(8909),w=i(19546),M=i(68817),P=i(48358),x=i(45043),T=i(60033),D=i(92810);function R(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:o}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:o}}function O({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,offset:i,measureType:n,orientation:s},o,a=null){if((0,l.Wi)(t)||(0,l.Wi)(e))return null;const r=H((0,l.pC)(a)?a.directSegment:new T.y,{elevationAlignedStartPoint:t,elevationAlignedEndPoint:e},o),c=(0,l.pC)(a)?a.primaryOffsetAxis:(0,b.c)();V(c,{measureType:n,elevationAlignedStartPoint:t,elevationAlignedEndPoint:e,directSegment:r,orientation:s,renderCoordsHelper:o});const d=(0,l.pC)(a)?a.dimensionSegment:new T.y;return L({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e})&&n===h.n.Vertical?((0,C.c)(d.startRenderSpace,r.startRenderSpace),(0,C.c)(d.endRenderSpace,r.endRenderSpace)):E(d,{offsetAxis:c,offset:i,relativeToSegment:r,renderCoordsHelper:o}),{directSegment:r,dimensionSegment:d,primaryOffsetAxis:c,spatialReference:o.spatialReference}}function z(t,e,i,s){return e===n.Start?((0,C.c)(t.startRenderSpace,i.startRenderSpace),(0,C.c)(t.endRenderSpace,s.startRenderSpace)):((0,C.c)(t.startRenderSpace,i.endRenderSpace),(0,C.c)(t.endRenderSpace,s.endRenderSpace)),t}function A(t,e,i,n){switch(e){case h.n.Direct:return H(t,i,n);case h.n.Horizontal:case h.n.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,dimension:a,geometry:r}=i;let l;a.measureType===h.n.Direct?(l=function(t,e){const i=t.directSegment.eval(.5,M.WM.get()),n=e.worldUpAtPosition(i,M.WM.get()),s=t.dimensionSegment.eval(.5,M.WM.get()),o=(0,C.w)(M.WM.get(),s,i);return!(0,C.F)(o,b.Z)&&(0,C.e)(o,n)>0}(r,n)===s.z>o.z,e===h.n.Horizontal&&(l=!l)):l=!function(t){const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=t.directSegment;return(0,C.E)(n,e)<(0,C.E)(s,i)}(r);const[c,d]=l?[s,o]:[o,s],u=(0,x.WG)(d,k);return e===h.n.Horizontal?u.z=c.z:(u.x=c.x,u.y=c.y),n.toRenderCoords(c,t.startRenderSpace),n.toRenderCoords(u,t.endRenderSpace),t}}}function H(t,e,i){return i.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),i.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}!function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(n||(n={}));const k=(0,P.Tx)(0,0,0,null);const I=new T.y;function V(t,e){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:o,endRenderSpace:a},directSegment:r,renderCoordsHelper:c}=e,d=r.eval(.5,M.WM.get()),u=c.worldUpAtPosition(d,M.WM.get()),p=c.worldBasisAtPosition(d,w.R.Y,M.WM.get());switch(i){case h.n.Horizontal:(0,C.c)(t,u);break;case h.n.Vertical:(0,C.e)(o,u)<(0,C.e)(a,u)?(0,C.w)(t,a,o):(0,C.w)(t,o,a),(0,C.f)(t,t,u),(0,C.f)(t,t,u);break;case h.n.Direct:{const i=(0,l.Pt)(e.orientation,0);if(L({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,v.d)(W,-(0,g.Vl)(i),u),(0,C.m)(t,p,W);else{const e=(0,C.w)(M.WM.get(),a,o),n=(0,C.f)(M.WM.get(),e,u);(0,C.f)(n,n,e),(0,v.d)(W,(0,g.Vl)(i),e),(0,C.m)(t,n,W)}break}}return(0,C.F)(t,b.Z)?(0,C.c)(t,p):(0,C.n)(t,t)}const W=(0,S.c)();function L({elevationAlignedStartPoint:t,elevationAlignedEndPoint:e}){return(0,l.pC)(t)&&(0,l.pC)(e)&&t.x===e.x&&t.y===e.y}function E(t,e){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:s,endRenderSpace:o},relativeToSegment:a,renderCoordsHelper:r}=e,l=n/r.unitInMeters,[c,d]=function(t,e,i,n=0){const s=(0,C.e)(e,i),o=(0,C.e)(t,i),a=Math.abs(s-o)+n;return s>o?[a,n]:[n,a]}(s,o,i,l);return(0,C.z)(t.startRenderSpace,a.startRenderSpace,i,c),(0,C.z)(t.endRenderSpace,a.endRenderSpace,i,d),t}function Z(t,e,i){const n=e.directSegment.eval(.5,M.WM.get());return i.worldUpAtPosition(n,t)}function j(t,e){const{startRenderSpace:i,endRenderSpace:n}=e.directSegment;return(0,C.w)(t,n,i)}function F(t,e,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=e.dimensionSegment;return i.invert?(0,C.w)(t,n,s):(0,C.w)(t,s,n)}function G(t,e){const i=t.directSegment.eval(.5,M.WM.get());return e.headingAtPosition(i,t.primaryOffsetAxis)}const Y=(0,b.c)();function X(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;if((0,l.Wi)(e)||(0,l.Wi)(i))return!1;const n=(0,D.Z1)(e,i);return(0,l.pC)(n)&&(0,y.nn)(n,"meters").value>U}const U=1e5;function B(t){return(0,l.pC)(t.geometry)}let q=class extends o.Z{constructor(t){super(t),this._handles=new m.Z}initialize(){const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles(t.on("change",(({added:t,removed:e})=>{for(const t of e)this._removeComputation(t);for(const e of t)this._addComputation(e)})))}destroy(){this._handles=(0,l.SC)(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,f.R)(this.view)}_addComputation(t){this._handles.has(t)||this._handles.add((0,c.YP)((()=>R(t)),(e=>{const{measureType:i}=e;if(X(e)&&i!==h.n.Direct){const e=Math.round((0,_.En)(U,"meters","kilometers"));return r.Z.getLogger(this.declaredClass).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const n=O(e,this.view.renderCoordsHelper,t.geometry);t.geometry=n,t.result.length=function(t,e,i){if((0,l.Wi)(t))return null;const n=t.dimensionSegment.startRenderSpace,s=t.dimensionSegment.endRenderSpace,o=(0,D.FN)(n,s,t.spatialReference);if((0,l.Wi)(o))return null;const a=e===h.n.Vertical?(0,_.ov)(o.value,o.unit,i):(0,_.iS)(o.value,o.unit,i);return(0,y.nn)(o,a)}(n,i,this._defaultUnit)}),c.tX),t)}_removeComputation(t){this._handles.remove(t)}};(0,s._)([(0,d.Cb)({constructOnly:!0})],q.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],q.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],q.prototype,"analysis",null),(0,s._)([(0,d.Cb)()],q.prototype,"_defaultUnit",null),q=(0,s._)([(0,u.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],q);var N=i(18234),$=i(23148),J=i(30936),Q=(i(91957),i(16068)),K=i(95550),tt=i(69430);const et={main:new J.Z([255,127,0])};class it{constructor(){this.color=et.main,this.opacity=.5,this.radius=5}}class nt{constructor(){this.color=new J.Z([127,127,127]),this.opacity=.5,this.radius=5}}class st{constructor(){this.lineSizeFraction=.8}}class ot{constructor(){this.color=et.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}}class at{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}class rt{constructor(){this.lineSizeFraction=.25}}class lt{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}}class ct{constructor(){this.color=new J.Z([255,127,0,.5])}}const dt=new class{constructor(){this.pointManipulators=new it,this.offsetManipulator=new ot,this.orientationManipulator=new at,this.markers=new st,this.labels=new lt,this.offsetLine=new rt,this.constraint=new ct,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new nt,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};var ut=i(46707),pt=i(74390),ht=i(88698),mt=i(81536),_t=i(6411),ft=i(6087),gt=i(76478),yt=i(91258),vt=i(67666);class St{constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}manipulatorName(t){return Object.keys(this).find((e=>this.hasOwnProperty(e)&&t===this[e]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(t){for(const e of h.V)t(this.manipulatorForMeasureType(e),e)}manipulatorForMeasureType(t){switch(t){case h.n.Direct:return this.direct;case h.n.Horizontal:return this.horizontal;case h.n.Vertical:return this.vertical}}}function Ct(t,{lineSizePt:e,material:i}){const{calloutOffsetPx:n,calloutOpacity:s,calloutWidth:o,discScale:a,focusMultiplier:r}=dt.orientationManipulator;return{calloutLength:.25*_t._Z*dt.markers.lineSizeFraction*(0,K.F2)(e)+n,calloutOpacity:s,calloutWidth:o,customStateMask:Wt,discScale:a,focusMultiplier:r,material:i,metadata:t}}function bt(t,e){return(0,pt.Ju)(t,Ct(e.metadata,e))}function wt(t,e){(0,pt.Bz)(t,Ct(t.metadata,e))}function Mt(t,{computation:e,view:i}){return[(0,gt.Xd)(t,((t,n,s)=>{Pt({cancel:s,computation:e,settingHeading:!1,steps:n,view:i})})),t.events.on("immediate-click",(t=>{!function(t,e,i){const{dimension:n,geometry:s}=e;if(90===n.orientation||270===n.orientation)return n.orientation=0,void t.stopPropagation();if((0,l.Wi)(s))return;const{renderCoordsHelper:o}=i,a=O({...R(e),orientation:90},o),r=O({...R(e),orientation:270},o);if((0,l.Wi)(a)||(0,l.Wi)(r))return;const c=G(a,o),d=G(r,o),u=Dt(s,i),p=Q.BV.shortestSignedDiff(u,c),h=Q.BV.shortestSignedDiff(u,d);n.orientation=Math.abs(p)<Math.abs(h)?90:270,t.stopPropagation()}(t,e,i)}))]}function Pt(t){const{cancel:e,computation:i,settingHeading:n,steps:s,view:o}=t;if(!B(i))return;const{renderCoordsHelper:a}=o,{dimension:r,geometry:c}=i,d=(0,b.c)(),u=At((0,b.c)(),c,c.directSegment,a),p=Ht(M.WM.get(),{forHeading:n,geometry:c,renderCoordsHelper:a}),h=(0,tt.Yq)(u,p,(0,tt.Ue)()),m=(0,l.Pt)(r.orientation,n?()=>G(c,o.renderCoordsHelper):0);s.next((0,mt._N)(o,h)).next((t=>{"start"===t.action&&(0,C.c)(d,t.renderStart);const e=(0,tt.mJ)(h),i=(0,pt.Gd)(d,t.renderEnd,u,e);let s=m-(0,g.BV)(i);n||(s=function(t){const e=Q.BV.normalize(t)%90;return e<dt.orientationSnapThresholdDegrees?t-e:90-e<dt.orientationSnapThresholdDegrees?t+(90-e):t}(s)),r.orientation=s})),e.next((0,gt.di)(r,["orientation"]))}function xt(t,{computation:e,manipulatorMeasureType:i,view:n}){let s=h.n.Direct,o=0,a=0;return[t.events.on("grab-changed",(r=>{if("start"!==r.action||!B(e))return;const{dimension:l,geometry:c}=e;s=l.measureType,o=l.offset,a=l.orientation;const d=(0,C.c)(M.WM.get(),t.renderLocation);l.measureType=i,l.offset=function(t,e,i,n){const{directSegment:s}=i,o=V(M.WM.get(),{measureType:e,directSegment:s,renderCoordsHelper:n}),a=E(I,{offsetAxis:o,offset:0,relativeToSegment:s,renderCoordsHelper:n}).eval(.5,M.WM.get()),r=(0,C.w)(M.WM.get(),t,a);return(0,C.e)(r,o)*n.unitInMeters}(d,i,c,n.renderCoordsHelper),l.orientation=0})),(0,gt.Xd)(t,((t,r,l)=>{if(!B(e))return;const{geometry:c,dimension:d}=e,{renderCoordsHelper:u}=n,p=A(jt,i,e,u),h=V(M.WM.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:u}),m=(0,mt.J4)(t);r.next(m).next(Tt(n,d,p,h)),l.next(m).next((t=>(d.measureType=s,d.offset=o,d.orientation=a,t)))}))]}function Tt(t,e,i,n){const s=(0,C.b)(M.WM.get(),i.endRenderSpace,i.startRenderSpace);(0,C.f)(s,s,n);const o=(0,tt.Yq)(i.startRenderSpace,s,(0,tt.Ue)()),a=(0,tt.Yq)(i.startRenderSpace,n,(0,tt.Ue)()),r=e.offset;let l,c=0;const d=new gt.hM;return d.next((0,mt._N)(t,o)).next((i=>{"start"===i.action&&(c=(0,tt.jH)(a,i.renderStart));const n=((0,tt.jH)(a,i.renderEnd)-c)*t.renderCoordsHelper.unitInMeters;e.offset=r+n,l=i})),t=>(d.execute(t),l)}function Dt(t,e){const{directSegment:i}=t,{renderCoordsHelper:n}=e,s=Z(M.WM.get(),t,n),o=j(M.WM.get(),t),a=(0,C.f)(M.WM.get(),o,s),{viewForward:r}=e.state.camera;(0,C.e)(a,r)>0&&(0,C.g)(a,a,-1);const l=i.eval(.5,M.WM.get());return n.headingAtPosition(l,a)}function Rt(t,e,i,{forHeading:n}){const{dimension:s,geometry:o}=e,{primaryOffsetAxis:a}=o,r=(0,C.g)(Ot,a,s.offset>=0?1:-1),l=Ht(zt,{forHeading:n,geometry:o,renderCoordsHelper:i});(0,C.f)(l,l,r);const c=(0,pt.Aq)(r,l,b.Z,Zt);t.modelTransform=c,t.renderLocation=At(Lt,o,o.dimensionSegment,i)}const Ot=(0,b.c)(),zt=(0,b.c)();function At(t,e,i,n){const{startRenderSpace:s,endRenderSpace:o}=i,a=function(t,e){const i=j(kt,t),n=Z(It,t,e);return(0,C.e)(i,n)>0}(e,n)?s:o;return(0,C.c)(t,a)}function Ht(t,{forHeading:e,geometry:i,renderCoordsHelper:n}){return e?Z(t,i,n):F(t,i,{invert:!0})}const kt=(0,b.c)(),It=(0,b.c)();function Vt(t){return(0,K.F2)(t)+dt.offsetManipulator.focusedLinePaddingPx}const Wt=yt.jg.Custom1,Lt=(0,b.c)(),Et=(0,b.c)(),Zt=(0,S.c)(),jt=new T.y;var Ft,Gt=i(97622),Yt=i(53280),Xt=i(67134),Ut=i(81506),Bt=i(78668);i(39994);function qt(t,e,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,unconstrainedGeometry:a,view:r}=i,{dimension:c,previousConstraint:d,preConstraintProperties:u}=t;if((0,l.Wi)(s)||(0,l.Wi)(o))return;const p=()=>{"startPoint"in e?c.startPoint=e.startPoint:"endPoint"in e&&(c.endPoint=e.endPoint)};if((0,l.Wi)(n))p(),(0,l.pC)(d)&&(0,l.pC)(u)&&(c.measureType=u.measureType,c.orientation=u.orientation);else switch(c.measureType=h.n.Direct,n){case Ft.Horizontal:if(n!==d&&(c.orientation=0),"startPoint"in e){const t=e.startPoint;(0,l.pC)(t)&&(t.z=o.z),c.startPoint=t}else if("endPoint"in e){const t=e.endPoint;(0,l.pC)(t)&&(t.z=s.z),c.endPoint=t}break;case Ft.Vertical:if(n!==d&&(c.orientation=Dt(a,r)),"startPoint"in e){const t=e.startPoint;(0,l.pC)(t)&&(t.x=o.x,t.y=o.y),c.startPoint=t}else if("endPoint"in e){const t=e.endPoint;(0,l.pC)(t)&&(t.x=s.x,t.y=s.y),c.endPoint=t}break;case Ft.Direct:n!==d&&(0,l.pC)(u)&&(c.orientation=u.orientation),p()}t.previousConstraint=n,t.unconstrainedGeometry=a}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"}(Ft||(Ft={}));var Nt=i(28401),$t=i(56264),Jt=i(37926),Qt=i(92144),Kt=i(7358),te=i(79591),ee=i(66962),ie=i(65392),ne=i(64594),se=i(4703),oe=i(62177),ae=i(66581),re=i(88878),le=i(50639),ce=i(8593);var de=i(97958),ue=i(22225);const pe=new Map;function he(t){if(!pe.has(t)){const e=function(t,e){const i=new ce.Z({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:e?.distance??le.c.distance,touchSensitivityMultiplier:e?.touchSensitivityMultiplier??le.c.touchSensitivityMultiplier});return{...(0,c.YP)((()=>t.map?.allLayers?.toArray()??[]),(t=>{i.featureSources=new a.Z(t.map((t=>new re.Z({layer:t,enabled:!0}))))}),c.nn),options:i}}(t,{distance:10}),i=function(t,e){return new ue.N({view:t,options:e,snappingEnginesFactory:(e,i)=>[new de.U({view:t,spatialReference:t.spatialReference,options:i})]})}(t,e.options);pe.set(t,{referenceCount:0,snappingManager:i,remove:()=>{e.remove(),i.destroy()}})}const e=pe.get(t);e.referenceCount++;const i=(0,$.kB)((()=>function(t,e){e.referenceCount--,e.referenceCount>0||(0,ae.Y)((()=>{0===e.referenceCount&&(e.remove(),pe.delete(t))}))}(t,e)));return{snappingManager:e.snappingManager,...i}}var me=i(73080),_e=i(73464),fe=i(98028),ge=i(22519);let ye=class extends Yt.r{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new m.Z,this._getSnappingContext=(0,Ut.H)((t=>new me.N({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new oe.c(new se.XE("point",(0,ne.Y6)(!0,!1,this.view.spatialReference))),visualizer:new $t._}))),this._snappingManagerResult=he(t.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=ve(),this._focusedOffsetManipulatorMaterial=ve(),this._thinOffsetManipulatorMaterial=ve(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,ee.z5)(2)}),this._constraintSnappingIndicator=new Jt.r({view:t.view,attached:!0,width:1,color:J.Z.toUnitRGBA(dt.constraint.color),renderOccluded:Kt.yD.OccludeAndTransparent,stipplePattern:(0,ee.z5)(5)});const e=J.Z.toUnitRGBA(dt.disabledPointIndicator.color);e[3]*=dt.disabledPointIndicator.opacity,this._stagedStartIndicator=new Qt.j({view:t.view,attached:!1,color:e,size:2*dt.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:Kt.yD.OccludeAndTransparent})}initialize(){this._snappingOperation=new fe.y({view:this.view}),this._orientationManipulatorTexture=(0,Nt.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new te.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:Kt.yD.Opaque});const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles([t.on("after-add",(t=>this._addComputation(t.item))),t.on("after-remove",(t=>this._removeComputation(t.item)))]),this.addHandles([(0,c.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:t,stagedComputation:e})=>{if((0,l.Wi)(e)||(0,l.Wi)(t))return;const i=(0,x.WG)(t,new vt.Z);this._applyPointUpdate(e,{endPoint:i})}),c.Z_),(0,c.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((t,e)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=t;if(i===e?.stagedDimension&&s===e?.firstGrabbedManipulator){for(const i of[n,e?.selectedComputation])if((0,l.pC)(i)){const e=this._computationManipulators.get(i);this._updateManipulators(i,e,t)}}else for(const[e,i]of this._computationManipulators)this._updateManipulators(e,i,t)}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(t=>{this._updateManipulatorStyle(t)}),c.nn),(0,c.YP)((()=>this.view.state.camera),(()=>{(0,l.pC)(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.YP)((()=>(0,l.yw)(this._stagedComputation,(t=>{const e=t.elevationAlignedStartPoint,i=(0,b.c)();return(0,l.pC)(e)&&this.view.renderCoordsHelper.toRenderCoords(e,i)?i:null}))),(t=>{(0,l.pC)(t)?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,ge.Ob)(this,(()=>{const t=this._activeComputation,e=this._stagedComputation;if((0,l.Wi)(t)||(0,l.pC)(e)){const t=(0,l.Pt)(this.view.inputManager.latestPointerType,"mouse"),e=this._getSnappingContext(t);this.updatingHandles.addPromise((0,Bt.R8)(this._snappingOperation.resnap(this._snappingManager,e)))}if((0,l.pC)(t)){const{start:e,end:i}=this._computationManipulators.get(t);if(e.grabbing||i.grabbing){!function(t,e,{constraint:i,view:n}){const{unconstrainedGeometry:s}=t;if((0,l.Wi)(s))return;const{renderCoordsHelper:o,spatialReference:a}=n,{startRenderSpace:r,endRenderSpace:c}=s.directSegment,d=o.fromRenderCoords(r,new vt.Z,a),u=o.fromRenderCoords(c,new vt.Z,a);let p;p="start"===e?{startPoint:d}:{endPoint:u},qt(t,p,{constraint:i,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:s,view:n})}(t,e.grabbing?"start":"end",{constraint:this._computeConstraint(t),view:this.view})}}}))}destroy(){this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if((0,l.pC)(this._stagedComputation))return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&(0,l.pC)(t)?t:null}get _stagedComputation(){const t=this._stagedDimension,e=this.analysisViewData.computations.at(-1);return(0,l.Wi)(t)||(0,l.Wi)(e)||e.dimension!==t?null:e}get _constraintHandles(){return[(0,c.gx)((()=>this.analysisViewData.selectedComputation),(t=>{t.previousConstraint=this._computeConstraint(t)}),{...c.tX,equals:Xt.fS}),(0,c.YP)((()=>{const t=this._activeComputation;if((0,l.Wi)(t))return null;const{measureType:e,orientation:i}=t.dimension;return{measureType:e,orientation:i,computation:t}}),((t,e)=>{if((0,l.pC)(t)&&(0,l.Wi)(e)){const{measureType:e,orientation:i,computation:n}=t;switch(n.previousConstraint){case Ft.Horizontal:n.preConstraintProperties={measureType:h.n.Horizontal,orientation:0};break;case Ft.Vertical:n.preConstraintProperties={measureType:h.n.Vertical,orientation:0};break;case Ft.Direct:n.preConstraintProperties={measureType:h.n.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:e,orientation:i}}}(0,l.Wi)(t)&&(0,l.pC)(e)&&(e.computation.preConstraintProperties=null)}),c.Z_)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[(0,c.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:e,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(t),(0,l.Wi)(i))n.attached=!1;else if(i===e)n.attached=!0;else{const{start:e,end:s}=this._computationManipulators.get(i),o=()=>{n.attached=e.grabbing||s.grabbing};o(),this.addHandles([e.events.on("grab-changed",o),s.events.on("grab-changed",o)],t)}})),(0,c.YP)((()=>{const t=this._activeComputation;return(0,l.pC)(t)?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(({geometry:t,constraint:e})=>{const i=this._constraintSnappingIndicator;(0,l.pC)(t)&&(0,l.pC)(e)&&e!==Ft.Direct?(i.visible=!0,i.setGeometryFromSegment(t.directSegment)):i.visible=!1}))]}removeStaged(){return!!(0,l.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if((0,l.Wi)(e)){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove({mapPoint:t,pointerType:e}){if("touch"===e)return;const i=this._getSnappingContext(e);this.updatingHandles.addPromise((0,Bt.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}onManipulatorSelectionChanged(){(0,l.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:t,pointerType:e}){let i=t;if("mouse"===e){const n=this._getSnappingContext(e);i=this._snappingManager.update({point:t,context:n})}const n=new Gt.Z({startPoint:(0,x.WG)(i,new vt.Z),endPoint:null,measureType:h.n.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:t,pointerType:e}){const i=this._stagedComputation;if((0,l.Wi)(i))return;let n=t;if("mouse"===e){const i=this._getSnappingContext(e);n=this._snappingManager.update({point:t,context:i})}const s=(0,x.WG)(n,new vt.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(t){if(this._computationManipulators.has(t))return;const e=this._setupPointManipulator(t,{isStart:!0}),i=this._setupPointManipulator(t,{isStart:!1}),n=this._setupOffsetManipulator(t),s=this._setupHeadingManipulator(t),o=this._setupRotationManipulator(t),a=this._setupMeasureTypeManipulator(t,h.n.Direct),r=this._setupMeasureTypeManipulator(t,h.n.Horizontal),l=this._setupMeasureTypeManipulator(t,h.n.Vertical),c=new St({start:e,end:i,offset:n,heading:s,rotation:o,direct:a,horizontal:r,vertical:l});this._setupComputationToManipulatorsSync(t,c),this._computationManipulators.set(t,c),this.manipulators.addMany(c.values())}_removeComputation(t){const e=this._computationManipulators.get(t);if(!(0,l.Wi)(e)){this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of e.values())this.manipulators.remove(t)}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([(0,c.YP)((()=>t.geometry),(()=>this._updateManipulators(t,e)),{...c.tX,equals:Xt.fS})],t)}_setupPointManipulator(t,e){const{view:i}=this,{dimension:n}=t,s=function(t,e){const i=(0,pt.aD)(t,J.Z.toUnitRGB(dt.pointManipulators.color),dt.pointManipulators.opacity,Wt);return i.available=!1,i.grabCursor="crosshair",i.radius=dt.pointManipulators.radius,i.metadata=e.metadata,i.collisionPriority=1,i}(i,{metadata:n}),o=function(t,{isStart:e,createSnappingPipelineStep:i,dimension:n,onUpdate:s,view:o}){const a=e?"startPoint":"endPoint",r=(0,gt.Xd)(t,((t,e,r,l)=>{const c=(0,mt.J4)(t),{snappingStep:d,cancelSnapping:u}=i(l);r=r.next(c).next((0,gt.di)(n,[a,"measureType","orientation"])).next(u),e.next(c).next((0,mt.gv)(o)).next(...d).next((t=>{const e=(0,x.WG)(t.mapEnd,new vt.Z);s("startPoint"===a?{startPoint:e}:{endPoint:e})}))}));return[r]}(s,{isStart:e.isStart,createSnappingPipelineStep:t=>(0,_e.W)({snappingContext:this._getSnappingContext(t),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles}),dimension:n,onUpdate:e=>this._applyPointUpdate(t,e),view:i});return this._computationHandles.add(o,t),s}_setupOffsetManipulator(t){const{view:e}=this,i=function(t,e){const i=[(0,b.f)(-.5,0,0),(0,b.f)(.5,0,0)],{lengthFraction:n}=dt.offsetManipulator,s=(0,ft.rh)(e.unfocusedMaterial,i.map((t=>(0,C.g)((0,b.c)(),t,n)))),o=s.instantiate({material:e.focusedMaterial});return new ut.Z({view:t,renderObjects:[new ht.r(s,yt.Q9.Unfocused|yt.Q9.Selected|Wt),new ht.r(o,yt.Q9.Focused|Wt)],collisionType:{type:"line",paths:[i]},radius:Vt(e.lineSizePt)/2,metadata:e.metadata,available:!1,...pt.X9})}(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),n=function(t,{computation:e,view:i}){return[(0,gt.Xd)(t,((t,n,s)=>{if(!B(e)||!t.selected)return;const{geometry:o,dimension:a}=e,r=(0,mt.J4)(t);n.next(r).next(Tt(i,a,o.dimensionSegment,o.primaryOffsetAxis)),s.next(r).next((0,gt.di)(a,["offset"]))}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=bt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=function(t,{computation:e,view:i}){return[(0,gt.Xd)(t,((t,n,s)=>{Pt({cancel:s,computation:e,settingHeading:!0,steps:n,view:i})}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupRotationManipulator(t){const{view:e}=this,i=bt(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=Mt(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,n=function(t,e){const i=[(0,b.f)(-.5,0,0),(0,b.f)(.5,0,0)],{lengthFraction:n}=dt.offsetManipulator,s=(0,ft.rh)(e.thinOffsetManipulatorMaterial,i),o=(0,ft.rh)(e.unfocusedMaterial,i.map((t=>(0,C.g)((0,b.c)(),t,n)))),a=o.instantiate({material:e.focusedMaterial});return new ut.Z({view:t,renderObjects:[new ht.r(o,yt.Q9.Unfocused|Wt),new ht.r(a,yt.Q9.Focused|Wt),new ht.r(s,Wt)],collisionType:{type:"line",paths:[i]},radius:Vt(e.lineSizePt)/2,available:!1,metadata:e.metadata,...pt.X9})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),s=xt(n,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(s,t),n}_updateManipulators(t,e,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:o}=i,{start:a,end:r,offset:c,heading:d,rotation:u}=e,p=s===t,m=B(t),{dimension:_}=t;for(const t of e.values()){const e=m&&(0,l.Wi)(n)&&((0,l.Wi)(o)||t===o);t===c?(t.available=e,t.selected=p):t.available=e&&p}if(!m)return;(0,l.pC)(this._computeConstraint(t))?e.forEachMeasureTypeManipulator((t=>t.available=!1)):e.manipulatorForMeasureType(_.measureType).available=!1;for(const t of[d,u])_.measureType===h.n.Direct&&0!==_.offset||(t.available=!1);L(t)?u.available=!1:d.available=!1;const{geometry:f}=t;a.renderLocation=f.directSegment.startRenderSpace,r.renderLocation=f.directSegment.endRenderSpace;const{renderCoordsHelper:g}=this.view;(function(t,e,i){const{dimensionSegment:n,primaryOffsetAxis:s}=e,o=F(Lt,e),a=(0,C.k)(o,b.Z)?(0,v.i)(Zt):(0,pt.Aq)(o,s,b.Z,Zt),r=Math.max((0,C.l)(o),dt.offsetManipulator.minLengthMeters/i.unitInMeters);(0,v.k)(a,a,(0,C.s)(Lt,r,r,r)),t.modelTransform=a,t.renderLocation=n.eval(.5,Lt)})(c,f,g),d.available&&function(t,e,i){Rt(t,e,i,{forHeading:!0})}(d,t,g),u.available&&function(t,e,i){Rt(t,e,i,{forHeading:!1})}(u,t,g),e.forEachMeasureTypeManipulator(((e,i)=>{e.available&&function(t,e,i,n){const{geometry:s}=e,o=A(jt,i,e,n),a=V(Lt,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),r=(0,C.w)(Et,o.endRenderSpace,o.startRenderSpace),l=(0,pt.Aq)(r,a,b.Z,Zt),c=(0,C.l)(r);(0,v.k)(l,l,(0,C.s)(Et,c,c,c)),t.modelTransform=l,t.renderLocation=o.eval(.5,Et)}(e,t,i,g)}))}_updateManipulatorStyle(t){const e=function(t){return(0,K.F2)(t)+dt.offsetManipulator.linePaddingPx}(t),i=Vt(t),n={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:t,heading:e,rotation:s}of this._computationManipulators.values())t.radius=i/2,wt(e,n),wt(s,n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(t,e){const{view:i}=this,n=R(t);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const s=O(n,i.renderCoordsHelper);if((0,l.Wi)(s))return;const o=this._computeConstraint({...n,geometry:s});qt(t,e,{...n,constraint:o,unconstrainedGeometry:s,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if((0,l.Wi)(t.geometry))return;t.geometry.directSegment.eval(.5,Se);const e=this.view.state.camera.computeRenderPixelSizeAt(Se);t.dimension.offset=dt.initialOffsetPx*e}_computeConstraint(t){return function(t,e){if(X(t))return Ft.Direct;if(!t.enabled)return null;const{geometry:i}=t;if((0,l.Wi)(i)||(0,C.k)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{constraintThresholdPx:n}=dt,{camera:s}=e.state,o=Z(M.WM.get(),i,e.renderCoordsHelper),a=j(M.WM.get(),i),r=(0,C.g)(M.WM.get(),o,(0,C.e)(a,o)),c=(0,C.b)(M.WM.get(),a,r),d=(0,C.p)(c),u=(0,C.p)(r),{startRenderSpace:p,endRenderSpace:h}=i.directSegment,m=Math.max(s.computeRenderPixelSizeAt(p)*n,s.computeRenderPixelSizeAt(h)*n)**2;return d<m?Ft.Vertical:u<m?Ft.Horizontal:null}(function(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}(t,this._snappingManager.options),this.view)}get testInfo(){const t=t=>this.analysisViewData.computations.find((e=>e.dimension===t));return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=Kt.yD.Occlude,this.manipulators.forEach((({manipulator:t})=>{for(const{geometry:e}of t.renderObjects)e.material.setParameters({renderOccluded:Kt.yD.Occlude})}))},getManipulatorsForDimension:e=>this._computationManipulators.get(t(e)),getComputationForDimension:e=>t(e),getConstraintForDimension:e=>{const i=t(e);return(0,l.pC)(i)?this._computeConstraint(i):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function ve(){const{color:t,opacity:e}=dt.offsetManipulator;return new ie.U({color:[...J.Z.toUnitRGB(t),e],width:1,renderOccluded:Kt.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,s._)([(0,d.Cb)({constructOnly:!0})],ye.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],ye.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],ye.prototype,"manipulators",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],ye.prototype,"parentTool",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],ye.prototype,"view",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],ye.prototype,"updating",null),(0,s._)([(0,d.Cb)()],ye.prototype,"firstGrabbedManipulator",null),(0,s._)([(0,d.Cb)()],ye.prototype,"hasGrabbedManipulators",null),(0,s._)([(0,d.Cb)()],ye.prototype,"snappingOptions",null),(0,s._)([(0,d.Cb)()],ye.prototype,"_stagedDimension",void 0),(0,s._)([(0,d.Cb)()],ye.prototype,"_activeComputation",null),(0,s._)([(0,d.Cb)()],ye.prototype,"_stagedComputation",null),ye=(0,s._)([(0,u.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],ye);const Se=(0,b.c)();var Ce,be=i(8927),we=i(20757),Me=i(2523),Pe=i(41775),xe=i(38114);!function(t){t.Ready="ready",t.Creating="creating",t.Created="created"}(Ce||(Ce={}));let Te=class extends Me.f{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=dt.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,be.Z8)(this.view.state.viewingMode),this._intersector.options.store=we.eC.MIN,this._lengthDimensionSubTool=new ye({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,$.ed)(this._lengthDimensionSubTool),(0,$.kB)((()=>this._clearPointerMoveTimeout())),(0,c.YP)((()=>this.state),(t=>{t===Ce.Created&&this.finishToolCreation()}),c.tX),(0,c.gx)((()=>this.firstGrabbedManipulator),(t=>{this.selectedDimension=t.metadata}),c.tX),(0,c.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.tX)])}get state(){return this.analysis.dimensions.some((t=>"length"===t.type))?(0,l.pC)(this._activeSubTool)?Ce.Creating:Ce.Created:Ce.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":if(Pe.j.cancel===t.key){if((0,l.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void t.stopPropagation();this.active||(this.selectedDimension=null)}else Pe.j.delete.includes(t.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,l.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if((0,l.Wi)(this._activeSubTool))return;const e=this._intersectScreen(t);(0,l.Wi)(e)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),(0,l.Wi)(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const e=this._intersectScreen(t);(0,l.Wi)(e)||this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_deleteKeyHandler(){(0,l.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(t){const e=(0,xe.Sj)(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const i=this._intersector.results.min,n=M.WM.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){(0,l.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((t=>{t.manipulator.state|=Wt})),this._prevPointerMoveTimeout=N.m.setTimeout((()=>{this.manipulators.forEach((t=>{t.manipulator.state&=~Wt}))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:t=>{this._pointerMoveTimerMs=t,this._resetPointerMoveTimeout()}}}};(0,s._)([(0,d.Cb)({constructOnly:!0})],Te.prototype,"view",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Te.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Te.prototype,"state",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Te.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Te.prototype,"cursor",null),(0,s._)([(0,d.Cb)({constructOnly:!0})],Te.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)()],Te.prototype,"selectedDimension",null),(0,s._)([(0,d.Cb)()],Te.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,d.Cb)()],Te.prototype,"_activeSubTool",void 0),(0,s._)([(0,d.Cb)()],Te.prototype,"_lengthDimensionSubTool",void 0),Te=(0,s._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Te);i(87090);var De=i(1983),Re=i(10145),Oe=i(21961),ze=i(18916),Ae=i(10449),He=i(24370),ke=i(84982);class Ie extends Ae._{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._renderOccluded=Kt.yD.OccludeAndTransparent,this._width=1,this._color=(0,ze.f)(1,0,1,1),this._placement="end",this._textureId=null,this._material=e,this._hasExternalMaterial=(0,l.pC)(e),this.applyProps(t)}setGeometryFromSegment(t,e){const i=t.endRenderSpace;this.transform=(0,v.f)(Ve,i),this._normal=e;const{points:n}=t.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return(0,l.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,(0,l.pC)(this._material)&&this._material.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get normal(){return this._normal}set normal(t){this._normal=t,this.recreateGeometry()}get width(){return(0,l.pC)(this._material)?this._material.parameters.width:this._width}set width(t){this._width=t,(0,l.pC)(this._material)&&this._material.setParameters({width:t})}get color(){return(0,l.pC)(this._material)?this._material.parameters.color:this._color}set color(t){this._color=(0,ze.c)(t),(0,l.pC)(this._material)&&this._material.setParameters({color:this._color})}get placement(){return(0,l.pC)(this._material)?this._material.parameters.placement:this._placement}set placement(t){this._placement=t,(0,l.pC)(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return(0,l.pC)(this._material)?this._material.parameters.textureId:this._textureId}set textureId(t){this._textureId=t,(0,l.pC)(this._material)&&this._material.setParameters({textureId:t})}createExternalResources(){this._hasExternalMaterial||(this._material=new ke.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(t){for(const e of(0,He.c)(this.geometry,this.normal)){const i=(0,He.Y)((0,l.Wg)(this._material),e);t.addGeometry(i)}}forEachExternalMaterial(t){this._hasExternalMaterial||t((0,l.Wg)(this._material))}}const Ve=(0,S.c)();class We{set visible(t){for(const e of this._visualElements.values())e.attached=t}constructor(t){this.destroyed=!1,this._handles=new m.Z,this._messages=null,this._labelSegment=new T.y;const{analysis:e,computation:i,view:n,messages:s}=t;this.analysis=e,this.computation=i,this.view=n,this._messages=s;const o=t.visible,a={view:n,attached:o},{fontSize:r,textColor:d,textBackgroundColor:u}=e.style;this._visualElements=new je({marker:new Ie(a,t.markerMaterial),dimension:new Jt.r(a,t.dimensionLineMaterial),startOffset:new Jt.r(a,t.offsetLineMaterial),endOffset:new Jt.r(a,t.offsetLineMaterial),dimensionSmall:new Jt.r(a,t.smallDimensionLineMaterial),startOffsetSmall:new Jt.r(a,t.smallOffsetLineMaterial),endOffsetSmall:new Jt.r(a,t.smallOffsetLineMaterial),label:new Oe.Kc({view:n,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,K.F2)(r),textColor:d.clone(),backgroundColor:u.clone()})}),this._handles.add([(0,c.YP)((()=>i.geometry),(t=>{this.updateCameraDependentElements(n.state.camera,t,e.style),(0,l.pC)(i.geometry)&&this._updateLines(i.geometry)}),{...c.nn,equals:Xt.fS}),(0,c.YP)((()=>i.length),(t=>this._updateLabelContent(t)),c.nn)])}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const t of this._visualElements.values())t.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(t){const e=z(Le,n.Start,t.directSegment,t.dimensionSegment),i=z(Ee,n.End,t.directSegment,t.dimensionSegment),s=this._visualElements;s.marker.setGeometryFromSegment(t.dimensionSegment,t.primaryOffsetAxis),s.dimension.setGeometryFromSegment(t.dimensionSegment),s.startOffset.setGeometryFromSegment(e),s.endOffset.setGeometryFromSegment(i),s.dimensionSmall.setGeometryFromSegment(t.dimensionSegment),s.startOffsetSmall.setGeometryFromSegment(e),s.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(t,e,i){const n=this._visualElements;if((0,l.Wi)(e)){for(const t of n.values())t.visible=!1;return}const s=t.computeScreenPixelSizeAt(e.dimensionSegment.eval(.5,Ze)),o=function(t,e){return(0,C.p)(F(Y,t))/e**2}(e,s),a=o<((0,K.F2)(i.lineSize)*dt.smallScreenLengthLineSizeFactor)**2,r=!a;n.marker.visible=r,n.dimension.visible=r,n.startOffset.visible=r,n.endOffset.visible=r,n.dimensionSmall.visible=a,n.startOffsetSmall.visible=a,n.endOffsetSmall.visible=a;const c=(0,K.F2)(i.fontSize)*dt.labels.minScreenLengthFontSizeFactor,{label:d}=n;if(d.visible=o>=c**2,!d.visible)return;const{dimensionSegment:u,primaryOffsetAxis:p}=e,{offset:h}=this.computation.dimension,m=(Math.sign(h)>=0?1:-1)*function(t){return 1.5*(0,K.F2)(t.fontSize)+dt.labels.marginPx+(0,K.F2)(t.lineSize/2)}(i)*s;(function(t,e,i,n){(0,C.z)(t.startRenderSpace,e.startRenderSpace,i,n),(0,C.z)(t.endRenderSpace,e.endRenderSpace,i,n)})(this._labelSegment,u,p,m),d.updateLabelPosition()}updateLabelStyle(t){const{label:e}=this._visualElements;e.fontSize=(0,K.F2)(t.fontSize),e.textColor=t.textColor,e.backgroundColor=t.textBackgroundColor}updateUnitsMessages(t){this._messages=t;const{length:e}=this.computation;this._updateLabelContent(e)}_updateLabelContent(t){const{label:e}=this._visualElements;(0,l.Wi)(t)||(0,l.Wi)(this._messages)?e.text="":e.text=(0,Re.VG)(this._messages,t,t.unit)}}const Le=new T.y,Ee=new T.y,Ze=(0,b.c)();class je{constructor(t){this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Fe=i(39530);class Ge{constructor(t,e){this._textures=t,this._textureRepository=e,this._texturesByPrimitive=new Map}acquire(t){if(!this._texturesByPrimitive.has(t)){const e=(0,_t.uM)(this._textures,t),i=new Fe.T(this._textureRepository,e.texture.id);return this._texturesByPrimitive.set(t,{result:e,reference:i}),e.texture}return this._texturesByPrimitive.get(t).result.texture}destroy(){this._texturesByPrimitive.forEach((({result:t,reference:e})=>{e.dispose(),t.release()})),this._texturesByPrimitive.clear()}}var Ye=i(60997),Xe=i(8108),Ue=i(60720);let Be=class extends o.Z{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new ke.X({width:1,anchor:Ye.i5.Tip,color:De.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Kt.yD.OccludeAndTransparent}),this._dimensionLineMaterial=new ie.U({width:1,color:De.Z,renderOccluded:Kt.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new ie.U({width:1,color:De.Z,renderOccluded:Kt.yD.OccludeAndTransparent,stipplePattern:(0,ee.z5)(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new ie.U({width:1,color:De.Z,renderOccluded:Kt.yD.OccludeAndTransparent}),this._smallOffsetLineMaterial=new ie.U({width:1,color:De.Z,renderOccluded:Kt.yD.OccludeAndTransparent,stipplePattern:(0,ee.z5)(5),stippleScaleWithLineWidth:!0})}initialize(){const t=this.view.sharedSymbolResources?.textures;if((0,l.pC)(t)){const{textureRepository:e}=this.view._stage.renderView,i=new Ge(t,e),n=i.acquire("triangle");this.addHandles((0,$.kB)((()=>i.destroy()))),this._markerMaterial.setParameters({textureId:n.id})}for(const t of this._lineMaterials())this.view._stage.add(t),this.addHandles((0,$.kB)((()=>{this.view._stage.remove(t),t.dispose()})));const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles([e.on("change",(({added:t,removed:e})=>{for(const t of e)this._removeComputation(t);for(const e of t)this._addComputation(e)})),(0,c.YP)((()=>J.Z.toUnitRGBA(this.analysis.style.color)),(t=>{for(const e of this._lineMaterials())e.setParameters({color:t})}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(t=>{const e=(0,K.F2)(t);this._markerMaterial.setParameters({width:e*dt.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:e,markerParameters:this._markerMaterial.parameters});const i=Math.max(e*dt.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:i})}),c.tX),(0,c.YP)((()=>({camera:this.view.state.camera,style:qe(this.analysis)})),(({camera:t,style:e})=>{for(const[i,n]of this._dimensionVisualizations)n.updateCameraDependentElements(t,i.geometry,e),n.updateLabelStyle(e)})),(0,c.YP)((()=>this.visible),(t=>{for(const e of this._dimensionVisualizations.values())e.visible=t}))]),this.addHandles([(0,Xe.qe)((()=>this._updateMessageBundle())),(0,c.gx)((()=>!this.loadingMessages),(()=>{for(const t of this._dimensionVisualizations.values())t.updateUnitsMessages(this._messages)}),c.Z_)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach((t=>{t.destroy()})),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const t of this._lineMaterials())t.setParameters({renderOccluded:Kt.yD.Occlude})}}}_addComputation(t){this._dimensionVisualizations.has(t)||this._dimensionVisualizations.set(t,new We({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(t){const e=this._dimensionVisualizations.get(t);(0,l.Wi)(e)||(e.destroy(),this._dimensionVisualizations.delete(t))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,Ue.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function qe(t){const{fontSize:e,lineSize:i,textColor:n,textBackgroundColor:s}=t.style;return{fontSize:e,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,s._)([(0,d.Cb)({constructOnly:!0})],Be.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Be.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],Be.prototype,"analysis",null),(0,s._)([(0,d.Cb)()],Be.prototype,"visible",null),(0,s._)([(0,d.Cb)()],Be.prototype,"loadingMessages",void 0),Be=(0,s._)([(0,u.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Be);let Ne=class extends o.Z{constructor(t){super(t),this.dimension=null,this.length=null}};(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Ne.prototype,"dimension",void 0),(0,s._)([(0,d.Cb)()],Ne.prototype,"length",void 0),Ne=(0,s._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionResult")],Ne);const $e=Ne;let Je=class extends o.Z{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...i}=t;return{result:new $e({dimension:e}),...i}}initialize(){this.addHandles([(0,c.YP)((()=>this.dimension.startPoint),(t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t)),c.tX),(0,c.YP)((()=>this.dimension.endPoint),(t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t)),c.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Je.prototype,"result",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Je.prototype,"projectAndAlignPoint",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"dimension",null),(0,s._)([(0,d.Cb)()],Je.prototype,"length",null),(0,s._)([(0,d.Cb)()],Je.prototype,"geometry",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"unconstrainedGeometry",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"preConstraintProperties",void 0),(0,s._)([(0,d.Cb)()],Je.prototype,"previousConstraint",void 0),Je=(0,s._)([(0,u.j)("esri.views.3d.analysis.LengthDimensionComputation")],Je);var Qe=i(28376),Ke=i(76497);const ti=t=>{let e=class extends t{constructor(...t){super(...t),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new a.Z}createLengthDimensions(t){throw new Error("Method not implemented.")}};return(0,s._)([(0,d.Cb)({constructOnly:!0})],e.prototype,"view",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)()],e.prototype,"tool",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],e.prototype,"results",null),(0,s._)([(0,d.Cb)()],e.prototype,"selectedDimension",void 0),(0,s._)([(0,d.Cb)()],e.prototype,"interactive",void 0),(0,s._)([(0,d.Cb)()],e.prototype,"visible",void 0),e=(0,s._)([(0,u.j)("esri.views.analysis.DimensionAnalysisView")],e),e};let ei=class extends(ti((0,p.p)(o.Z))){constructor(t){super(t),this.type="dimension-view-3d",this.tool=null,this.computations=new a.Z,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if((0,l.Wi)(t))return null;const{spatialReference:e,elevationProvider:i}=this.view,n=(0,Qe.G)(t,e,i);return(0,l.Wi)(n)&&(0,Qe.e)(this.analysis,t.spatialReference,r.Z.getLogger(this.declaredClass)),n},this.addHandles([(0,Ke.Lp)(this,Te),(0,c.on)((()=>this.analysis.dimensions),"after-add",(t=>this._onDimensionAdd(t.item)),{onListenerAdd:t=>{for(const e of t)this._onDimensionAdd(e)},onListenerRemove:()=>{this._onDimensionsClear()}}),(0,c.on)((()=>this.analysis.dimensions),"after-remove",(t=>this._onDimensionRemove(t.item)))]),this._analysisVisualization=new Be({analysisViewData:this,view:this.view}),this._analysisController=new q({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.IM)(this._placementTask),this._analysisVisualization=(0,l.SC)(this._analysisVisualization),(0,Ke.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((t=>this._dimensionsToComputations.get(t).result))}get selectedComputation(){const{selectedDimension:t}=this;return(0,l.Wi)(t)?null:this._dimensionsToComputations.get(t)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(t){return this.selectedDimension=null,this._placementTask=(0,l.IM)(this._placementTask),this._placementTask=(0,Ke.Er)(this,t),this._placementTask.promise}_onDimensionAdd(t){const{computations:e,_dimensionsToComputations:i}=this;if(i.has(t))return;const n=new Je({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});e.add(n),i.set(t,n)}_onDimensionRemove(t){const{computations:e,_dimensionsToComputations:i}=this,n=e.findIndex((e=>e.dimension===t)),s=e.getItemAt(n);s.dimension===this.selectedDimension&&(this.selectedDimension=null),e.removeAt(n),i.delete(t),(0,l.SC)(s)}_onDimensionsClear(){this.computations.drain((t=>t.destroy())),this._dimensionsToComputations.clear()}};(0,s._)([(0,d.Cb)({readOnly:!0})],ei.prototype,"type",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"tool",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],ei.prototype,"results",null),(0,s._)([(0,d.Cb)({readOnly:!0})],ei.prototype,"computations",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"selectedDimension",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"selectedComputation",null),(0,s._)([(0,d.Cb)()],ei.prototype,"_analysisVisualization",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"_analysisController",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"_dimensionsToComputations",void 0),(0,s._)([(0,d.Cb)()],ei.prototype,"_placementTask",void 0),ei=(0,s._)([(0,u.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],ei);const ii=ei},21961:(t,e,i)=>{i.d(e,{Kc:()=>b,jB:()=>M});var n=i(30936),s=i(44584),o=i(61681),a=i(76868),r=i(95550),l=i(55709),c=i(6766),d=i(8909),u=i(76169),p=i(86),h=i(36663),m=i(53443),_=i(81977),f=(i(7283),i(7753),i(40266)),g=(i(56803),i(23569));i(22591);let y=class extends m.Z{get startPosition(){return[this.startX,this.startY]}set startPosition(t){this._set("startX",t[0]),this._set("startY",t[1])}get endPosition(){return[this.endX,this.endY]}set endPosition(t){this._set("endX",t[0]),this._set("endY",t[1])}constructor(t){super(t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=1,this.color=[0,0,0,.5],this.visible=!0}get _strokeStyle(){const t=this.color;return`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}get _lineCap(){return"round"}render(){const{height:t,left:e,top:i,width:n,x1:s,x2:o,y1:a,y2:r}=this._calculateCoordinates(v),l=`stroke: ${this._strokeStyle}; stroke-width: ${this.width}; stroke-linecap: ${this._lineCap};`;return(0,g.h)("div",{classes:{"esri-line-overlay-item":!0},styles:{left:e+"px",top:i+"px",width:n+"px",height:t+"px",visibility:this.visible?"visible":"hidden"}},[(0,g.h)("svg",{width:n,height:t},[(0,g.h)("line",{x1:s,y1:a,x2:o,y2:r,style:l})])])}renderCanvas(t){if(!this.visible)return;t.strokeStyle=this._strokeStyle,t.lineWidth=this.width,t.lineCap=this._lineCap;const e=this._calculateCoordinates(v);t.beginPath(),t.moveTo(e.left+e.x1,e.top+e.y1),t.lineTo(e.left+e.x2,e.top+e.y2),t.stroke()}_calculateCoordinates(t){const e=Math.min(this.startX,this.endX),i=Math.max(this.startX,this.endX),n=Math.min(this.startY,this.endY),s=Math.max(this.startY,this.endY),o=this.width;return t.left=e-o,t.top=n-o,t.width=i-e+2*o,t.height=Math.max(20,s-n+2*o),t.x1=this.startX-e+o,t.y1=this.startY-n+o,t.x2=this.endX-e+o,t.y2=this.endY-n+o,t}};(0,h._)([(0,_.Cb)()],y.prototype,"startX",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"startY",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"endX",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"endY",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"startPosition",null),(0,h._)([(0,_.Cb)()],y.prototype,"endPosition",null),(0,h._)([(0,_.Cb)()],y.prototype,"width",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"color",void 0),(0,h._)([(0,_.Cb)()],y.prototype,"visible",void 0),(0,h._)([(0,_.Cb)({readOnly:!0})],y.prototype,"_strokeStyle",null),y=(0,h._)([(0,f.j)("esri.views.overlay.LineOverlayItem")],y);const v={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0},S=y;var C=i(65771);class b extends u.l{constructor(t){super(t.view),this._handles=new s.Z,this._textItem=null,this._calloutItem=null,this._showCallout=!0,this._showText=!0,this._geometry=null,this._text="-",this._fontSize=14,this._backgroundColor=new n.Z([0,0,0,.6]),this._textColor=new n.Z([255,255,255]),this._distance=25,this._anchor="right",this.updatePositionOnCameraMove=!0,this.applyProps(t)}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.updateLabelPosition()}get textItem(){return this._textItem}get text(){return this._text}set text(t){this._text=t,this.attached&&(this._textItem.text=this._text)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.attached&&(this._textItem.fontSize=this._fontSize)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.attached&&(this._textItem.backgroundColor=this._backgroundColor)}get textColor(){return this._textColor}set textColor(t){this._textColor=t,this.attached&&(this._textItem.textColor=this._textColor)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.updateLabelPosition())}get anchor(){return this._anchor}set anchor(t){this._anchor!==t&&(this._anchor=t,this.updateLabelPosition())}overlaps(t){return!!this.attached&&this.textItem.visible&&t.textItem.visible&&!!this.view.overlay?.overlaps(this._textItem,t.textItem)}updateLabelPosition(){if(!this.attached)return;this._showText=!1,this._showCallout=!1;const{geometry:t,view:e,visible:i}=this;if((0,o.pC)(t)&&e._stage)switch(t.type){case"point":if(!this._computeLabelPositionFromPoint(t.point,H))break;if(t.callout){const i=e.state.camera,n=t.callout.distance;(0,l.j)(A,A,[0,t.callout.offset]),i.renderToScreen(A,H),(0,l.s)(O,0,1),(0,l.b)(O,O,n*i.pixelRatio),(0,l.j)(O,O,A),i.renderToScreen(O,k),this._showCallout=this._updatePosition(H,k)}else this._textItem.position=[H[0],H[1]],this._textItem.anchor="center";this._showText=!0;break;case"corner":if(!this._computeLabelPositionFromCorner(t,this._distance,H,k))break;this._showCallout=this._updatePosition(H,k),this._showText=!0;break;case"segment":{if(!this._computeLabelPositionFromSegment(t,this._distance,this._anchor,H,k))break;this._showText=!0;const e=this._updatePosition(H,k);this._showCallout=!1!==t.callout&&e,this._showCallout||(this._textItem.anchor="center")}}this.updateVisibility(i)}_computeLabelPositionFromPoint(t,e){const i=this.view.state.camera;return i.projectToRenderScreen(t,A),!(A[2]<0||A[2]>1||(i.renderToScreen(A,e),0))}_computeLabelPositionFromCorner(t,e,i,n){if(!t)return!1;const s=this.view.state.camera;return w(t.left,1,s,D),(0,l.n)(D,D),w(t.right,0,s,R),(0,l.j)(O,D,R),(0,l.n)(O,O),(0,l.f)(O,O),s.projectToRenderScreen(t.left.endRenderSpace,A),!(A[2]<0||A[2]>1||(s.renderToScreen(A,i),(0,l.b)(O,O,e*s.pixelRatio),(0,l.j)(O,O,A),s.renderToScreen(O,n),0))}_computeLabelPositionFromSegment(t,e,i,n,s){if(!t)return!1;const o=t.segment,a=this.view.state.camera;(0,p.CM)(o.startRenderSpace,o.endRenderSpace,a,D),(0,l.s)(O,-D[1],D[0]);let r=!1;switch(i){case"top":r=O[1]<0;break;case"bottom":r=O[1]>0;break;case"left":r=O[0]>0;break;case"right":r=O[0]<0}if(r&&(0,l.n)(O,O),0===(0,l.i)(O))switch(i){case"top":O[1]=1;break;case"bottom":O[1]=-1;break;case"left":O[0]=-1;break;case"right":O[0]=1}return o.eval(E[t.sampleLocation],z),a.projectToRenderScreen(z,A),!(A[2]<0||A[2]>1||(a.renderToScreen(A,n),(0,l.b)(O,O,e*a.pixelRatio),(0,l.j)(O,O,A),a.renderToScreen(O,s),0))}_updatePosition(t,e){if(e){const i=e[0]-t[0],n=e[1]-t[1];return this._textItem.position=[e[0],e[1]],this._textItem.anchor=Math.abs(i)>Math.abs(n)?i>0?"left":"right":n>0?"top":"bottom",this._calloutItem.startPosition=[t[0],t[1]],this._calloutItem.endPosition=[e[0],e[1]],!0}return this._textItem.position=[t[0],t[1]],this._textItem.anchor="center",!1}createResources(){this._textItem=new C.Z({visible:!0,text:this._text,fontSize:this._fontSize,backgroundColor:this._backgroundColor,textColor:this._textColor}),this._calloutItem=new S({visible:!0,width:2}),this.updateLabelPosition(),this.view.overlay?.items.addMany([this._textItem,this._calloutItem]),this.updatePositionOnCameraMove&&this._handles.add((0,a.YP)((()=>this.view.state.camera),(()=>this.updateLabelPosition())))}destroyResources(){this.view.overlay&&!this.view.overlay.destroyed&&this.view.overlay.items.removeMany([this._textItem,this._calloutItem]),this._handles.removeAll()}updateVisibility(t){this._textItem.visible=this._showText&&t,this._calloutItem.visible=this._showCallout&&t}}function w(t,e,i,n){t.eval(e,P,T),(0,c.a)(x,P,T),i.projectToRenderScreen(P,I),i.projectToRenderScreen(x,W),(0,l.a)(n,L,V),(0,l.f)(n,n)}function M(t){switch(t){case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"left":return"right"}}const P=(0,d.c)(),x=(0,d.c)(),T=(0,d.c)(),D=(0,r.gX)(),R=(0,r.gX)(),O=(0,r.gX)(),z=(0,d.c)(),A=(0,r.J$)(),H=(0,r.s1)(),k=(0,r.s1)(),I=(0,r.J$)(),V=I,W=(0,r.J$)(),L=W,E={start:0,center:.5,end:1}},60033:(t,e,i)=>{i.d(e,{u:()=>d,y:()=>c});var n=i(6766),s=i(8909),o=i(90472),a=i(61170),r=i(68817),l=i(35369);class c{constructor(t=(0,s.c)(),e=(0,s.c)()){this.startRenderSpace=t,this.endRenderSpace=e,this.type="euclidean"}eval(t,e,i){return(0,n.h)(e,this.startRenderSpace,this.endRenderSpace,t),i&&((0,n.b)(i,this.endRenderSpace,this.startRenderSpace),(0,n.n)(i,i)),e}createRenderGeometry(t,e){const i=[],s=[],o=(e,o)=>{const a=p;(0,n.b)(a,e,t),i.push([a[0],a[1],a[2]]),s.push([o[0],o[1],o[2]])},a=e.worldUpAtPosition(this.eval(.5,u),r.WM.get());return o(this.startRenderSpace,a),o(this.endRenderSpace,a),{points:i,normals:s}}static fromPositionAndVector(t,e,i=1){return(0,n.g)(u,e,i),(0,n.a)(u,t,u),new c((0,s.a)(t),(0,s.a)(u))}}class d{_projectIn(t,e){this._project?(0,o.SH)(t,this.renderSpatialReference,e,this._pcpf):(0,n.c)(e,t)}constructor(t,e,i){this.startRenderSpace=t,this.endRenderSpace=e,this.renderSpatialReference=i,this.type="geodesic",this._start=(0,s.c)(),this._end=(0,s.c)(),this._pcpf=(0,a.rS)(i),this._project=(0,o.Up)(i,this._pcpf),this._projectIn(t,this._start),this._projectIn(e,this._end)}eval(t,e,i){if(this._project)if(i){const s=p;(0,l.ek)(this._start,this._end,t,e,s),(0,n.a)(h,e,s),(0,o.SH)(e,this._pcpf,e,this.renderSpatialReference),(0,o.SH)(h,this._pcpf,h,this.renderSpatialReference),(0,n.b)(i,h,e),(0,n.n)(i,i)}else(0,l.ZA)(this._start,this._end,t,e),(0,o.SH)(e,this._pcpf,e,this.renderSpatialReference);else(0,n.h)(e,this._start,this._end,t),i&&((0,n.b)(i,this._end,this._start),(0,n.n)(i,i));return e}createRenderGeometry(t,e){const i=[],s=[],o=(e,o)=>{const a=h;(0,n.b)(a,e,t),i.push([a[0],a[1],a[2]]),s.push([o[0],o[1],o[2]])};for(let t=0;t<128;++t){const i=t/127,n=u,s=p;this.eval(i,n),e.worldUpAtPosition(n,s),o(n,s)}return{points:i,normals:s}}}const u=(0,s.c)(),p=(0,s.c)(),h=(0,s.c)()},39530:(t,e,i)=>{i.d(e,{T:()=>o});var n=i(61681),s=i(78668);class o{constructor(t,e){this._textureRep=t,this.loadPromise=null,this._disposed=!1;const i=this._textureRep.acquire(e);(0,s.y8)(i)?(i.then((t=>{this._disposed?(0,n.RY)(t):this._textureRef=t})),this.loadPromise=i):this._textureRef=i}dispose(){this._textureRef=(0,n.RY)(this._textureRef),this._disposed=!0}get glTexture(){return(0,n.pC)(this._textureRef)?this._textureRef.glTexture:null}}},76497:(t,e,i)=>{i.d(e,{Er:()=>r,Lp:()=>l,Yq:()=>c});var n=i(67979),s=i(61681),o=i(78668),a=i(76868);function r(t,e){t.interactive=!0;const{tool:i,view:r}=t;r.activeTool=i;let l=(0,o.fu)(e,(()=>{r.activeTool===i&&(r.activeTool=null)}));return(0,n.vr)((async t=>{await(0,a.N1)((()=>(0,s.Wi)(i)||!i.active),t),l=(0,s.hw)(l)}),e)}function l(t,e){return(0,a.YP)((()=>t.interactive),(()=>function(t,e){t.interactive?function(t,e){c(t);const{view:i,analysis:n}=t,s=new e({view:i,analysis:n,analysisViewData:t});t.tool=s,i.tools.add(s)}(t,e):c(t)}(t,e)),a.tX)}function c(t){const{view:e,tool:i}=t;(0,s.Wi)(i)||(e.tools.remove(i),t.tool=null)}},2523:(t,e,i)=>{i.d(e,{f:()=>l});var n=i(36663),s=i(76868),o=i(81977),a=(i(7283),i(7753),i(40266)),r=i(68610);let l=class extends r.m{constructor(t){super(t)}initialize(){this.addHandles((0,s.YP)((()=>this.analysisViewData.visible),(t=>this.visible=t),s.tX))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};(0,n._)([(0,o.Cb)({constructOnly:!0})],l.prototype,"analysis",void 0),(0,n._)([(0,o.Cb)()],l.prototype,"analysisViewData",void 0),l=(0,n._)([(0,a.j)("esri.views.interactive.AnalysisToolBase")],l)},92810:(t,e,i)=>{i.d(e,{Cr:()=>b,FN:()=>S,Sx:()=>m,Z1:()=>f,_e:()=>y,g1:()=>v,qS:()=>h,qj:()=>C,xI:()=>g});var n,s,o=i(61681),a=i(39405),r=i(17321),l=i(6766),c=i(8909),d=i(90472),u=i(35925),p=i(89976);function h(t){return _(t,n.Direct)}function m(t){return _(t,n.Horizontal)}function _(t,e){const{hasZ:i,spatialReference:s}=t,l=(0,p.m)(s);let c=0;const d=(0,r.j5)(l);if((0,o.Wi)(d))return null;const u=e===n.Direct?S:C;for(const e of t.paths){if(e.length<2)continue;const t=e.length-1;for(let n=0;n<t;++n){const t=e[n];M[0]=t[0],M[1]=t[1],M[2]=i?t[2]:0;const a=e[n+1];P[0]=a[0],P[1]=a[1],P[2]=i?a[2]:0;const r=u(M,P,s);if((0,o.Wi)(r))return null;c+=r.value}}return(0,a.yG)(c,d)}function f(t,e){const{spatialReference:i}=t;return(0,u.fS)(i,e.spatialReference)?(M[0]=t.x,M[1]=t.y,M[2]=t.hasZ?t.z:0,P[0]=e.x,P[1]=e.y,P[2]=e.hasZ?e.z:0,S(M,P,i)):null}function g(t,e){const{spatialReference:i}=t;return(0,u.fS)(i,e.spatialReference)?(M[0]=t.x,M[1]=t.y,M[2]=t.hasZ?t.z:0,P[0]=e.x,P[1]=e.y,P[2]=e.hasZ?e.z:0,C(M,P,i)):null}function y(t,e){const{spatialReference:i}=t;return(0,u.fS)(i,e.spatialReference)?(M[0]=t.x,M[1]=t.y,M[2]=t.hasZ?t.z:0,P[0]=e.x,P[1]=e.y,P[2]=e.hasZ?e.z:0,b(M,P,i)):null}function v(t){return M[0]=t.x,M[1]=t.y,M[2]=t.hasZ?t.z:0,function(t,e){const i=(0,r.y)(e);return(0,o.pC)(i)?(0,a.yG)(t[2],i):null}(M,t.spatialReference)}function S(t,e,i){const s=w(t,e,i,n.Direct);return(0,o.pC)(s)?(0,a.yG)(s.direct,s.unit):null}function C(t,e,i){const s=w(t,e,i,n.Horizontal);return(0,o.pC)(s)?(0,a.yG)(s.horizontal,s.unit):null}function b(t,e,i){const s=w(t,e,i,n.Vertical);return(0,o.pC)(s)?(0,a.yG)(s.verticalSigned,s.unit):null}function w(t,e,i,s){const a=(0,p.m)(i),c=(0,r.j5)(a);if((0,o.Wi)(c))return null;const u=e[2]-t[2];if(s===n.Vertical)return{verticalSigned:u,unit:c};if(!(0,d.SH)(t,i,x,a)||!(0,d.SH)(e,i,T,a))return null;if(s===n.Direct)return{direct:(0,l.i)(T,x),unit:c};if((0,l.s)(D,t[0],t[1],e[2]),!(0,d.SH)(D,i,D,a))return null;const h=(0,l.i)(D,T);return s===n.Horizontal?{horizontal:h,unit:c}:{direct:(0,l.i)(T,x),horizontal:h,vertical:Math.abs(u),unit:c}}(s=n||(n={}))[s.Direct=0]="Direct",s[s.Horizontal=1]="Horizontal",s[s.Vertical=2]="Vertical";const M=(0,c.c)(),P=(0,c.c)(),x=(0,c.c)(),T=(0,c.c)(),D=(0,c.c)()}}]);