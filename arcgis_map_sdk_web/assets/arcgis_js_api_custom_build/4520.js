"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[4520],{24065:(e,t,r)=>{r.d(t,{R:()=>c});var s=r(36663),i=r(53443),a=r(53280),l=r(61681),o=r(84684),n=r(81977),y=(r(7283),r(7753),r(40266)),p=r(51599),h=r(21586),m=r(93698);const u={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let c=class extends((0,a.p)(i.Z)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,h.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(u[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const r=(0,h.f)(this.floors,t),s=(0,o._)(r,t.definitionExpression);return(0,l.pC)(s)&&(e[t.id]=s),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,r=t=>{const s=this.scale,i=0===s,a=0===t.minScale||s<=t.minScale,l=0===t.maxScale||s>=t.maxScale;t.visible&&(i||a&&l)&&(t.sublayers?t.sublayers.forEach(r):e.unshift(t))};t&&t.forEach(r);const s=this._get("visibleSublayers");return!s||s.length!==e.length||s.some(((t,r)=>e[r]!==t))?e:s}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"dynamicLayers",null),(0,s._)([(0,n.Cb)()],c.prototype,"floors",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"hasDynamicLayers",null),(0,s._)([(0,n.Cb)()],c.prototype,"layer",null),(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"layers",null),(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"layerDefs",null),(0,s._)([(0,n.Cb)({type:Number})],c.prototype,"scale",void 0),(0,s._)([(0,n.Cb)(p.qG)],c.prototype,"timeExtent",void 0),(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"version",null),(0,s._)([(0,n.Cb)({readOnly:!0})],c.prototype,"visibleSublayers",null),c=(0,s._)([(0,y.j)("esri.layers.mixins.ExportImageParameters")],c)},34520:(e,t,r)=>{r.r(t),r.d(t,{default:()=>p});var s=r(36663),i=(r(13802),r(7283),r(7753),r(70375),r(39994),r(40266)),a=r(78306),l=r(82512),o=r(7608),n=r(99621);let y=class extends((0,l.Z)(a.Z)){constructor(){super(...arguments),this.type="map-image-3d"}initialize(){this.updatingHandles.add((()=>this.exportImageVersion),(()=>this.updatingHandles.addPromise(this.refreshDebounced()))),this._popupHighlightHelper=new o.VF({createFetchPopupFeaturesQueryGeometry:(e,t)=>(0,n.K)(e,t,this.view),layerView:this,updatingHandles:this.updatingHandles})}destroy(){this._popupHighlightHelper?.destroy()}fetchPopupFeatures(e,t){return this._popupHighlightHelper.fetchPopupFeatures(e,t)}getFetchOptions(){return{timeExtent:this.timeExtent}}};y=(0,s._)([(0,i.j)("esri.views.3d.layers.MapImageLayerView3D")],y);const p=y},82512:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(36663),i=r(81977),a=(r(7283),r(7753),r(40266)),l=r(51599),o=r(24065);const n=e=>{let t=class extends e{initialize(){this.exportImageParameters=new o.R({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return(0,s._)([(0,i.Cb)()],t.prototype,"exportImageParameters",void 0),(0,s._)([(0,i.Cb)({readOnly:!0})],t.prototype,"floors",null),(0,s._)([(0,i.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,s._)([(0,i.Cb)()],t.prototype,"layer",void 0),(0,s._)([(0,i.Cb)()],t.prototype,"suspended",void 0),(0,s._)([(0,i.Cb)(l.qG)],t.prototype,"timeExtent",void 0),t=(0,s._)([(0,a.j)("esri.views.layers.MapImageLayerView")],t),t}}}]);