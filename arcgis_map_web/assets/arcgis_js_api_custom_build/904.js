"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[904],{52093:(e,t,i)=>{i.d(t,{S:()=>c,b:()=>d});var a=i(84614),s=i(63371),n=i(24603),r=i(23410),o=i(3961),l=i(21414);function d(e){const t=new o.kG;t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:d,attributes:c,varyings:u}=t;return(0,a.Sv)(i,e),c.add(l.T.POSITION,"vec3"),c.add(l.T.UV0,"vec2"),u.add("vUV","vec2"),i.code.add(r.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),d.uniforms.add([new s.N("backgroundColor",(e=>e.backgroundColor)),new s.N("gridColor",(e=>e.gridColor)),new n.p("gridWidth",(e=>e.gridWidth))]),d.code.add(r.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}))},2556:(e,t,i)=>{i.d(t,{Z:()=>H});var a=i(36663),s=i(80085),n=i(80020),r=(i(86004),i(45510),i(16192),i(71297),i(878),i(22836),i(50172),i(72043),i(72506),i(54021)),o=i(66341),l=i(70375),d=i(25709),c=i(68309),u=i(13802),h=i(61681),p=i(64189),y=i(81977),g=(i(7753),i(7283),i(79438)),f=i(34248),_=i(40266),v=i(91772),w=i(14685),b=i(12926),m=i(96698),C=i(31484),D=i(51599),P=i(89076),M=i(28790),A=i(17095),V=i(40909),T=i(97304),E=i(14626),S=i(10171),I=i(74710),O=i(78565),L=i(59439);const W="esri.layers.buildingSublayers.BuildingComponentSublayer",R=u.Z.getLogger(W),k=(0,P.v)();let x=class extends(c.Z.LoadableMixin((0,p.v)(m.Z))){constructor(e){super(e),this.type="building-component",this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode="show",this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType="3d-object"}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl?.path}/sublayers/${this.id}`,query:this.layer.parsedUrl?.query}:{path:""}}get fieldsIndex(){return new M.Z(this.fields)}readAssociatedLayer(e,t){const i=this.layer.associatedFeatureServiceItem,a=t.associatedLayerID;return(0,h.pC)(i)&&"number"==typeof a?new b.default({portalItem:i,layerId:a}):null}get objectIdField(){if(null!=this.fields)for(const e of this.fields)if("oid"===e.type)return e.name;return null}get displayField(){return(0,h.pC)(this.associatedLayer)?this.associatedLayer.displayField:void 0}get apiKey(){return this.layer.apiKey}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){const t=(0,h.pC)(e)?e.signal:null,i=this._fetchService(t).then((()=>{this.indexInfo=(0,V.T)(this.parsedUrl.path,this.rootNode,this.nodePages,this.apiKey,R,t)}));return this.addResolvingPromise(i),Promise.resolve(this)}createPopupTemplate(e){return(0,S.eZ)(this,e)}async _fetchService(e){const t=(await(0,o.default)(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e})).data;this.read(t,{origin:"service",url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){const i=this.getFeatureType(t?.feature)?.domains?.[e];return i&&"inherited"!==i.type?i:this.getField(e)?.domain??null}getFeatureType(e){return e&&(0,h.pC)(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return(0,h.pC)(this.associatedLayer)?this.associatedLayer.types??[]:[]}get typeIdField(){return(0,h.pC)(this.associatedLayer)?this.associatedLayer.typeIdField:null}get geometryType(){return"3d-object"===this.layerType?"mesh":"point"}get profile(){return"3d-object"===this.layerType?"mesh-pyramids":"points"}get capabilities(){const e=(0,h.pC)(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:C.C,{query:t,data:{supportsZ:i,supportsM:a,isVersioned:s}}=e;return{query:t,data:{supportsZ:i,supportsM:a,isVersioned:s}}}createQuery(){const e=new E.Z;return"mesh"!==this.geometryType&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryExtent(e||this.createQuery(),t)))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatureCount(e||this.createQuery(),t)))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryFeatures(e||this.createQuery(),t))).then((e=>{if(e?.features)for(const t of e.features)t.layer=this.layer,t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then((i=>i.queryObjectIds(e||this.createQuery(),t)))}async queryCachedAttributes(e,t){const i=(0,A.Lk)(this.fieldsIndex,await(0,L.e)(this,(0,L.V)(this)));return(0,O.xe)(this.parsedUrl.path,this.attributeStorageInfo,e,t,i)}async queryCachedFeature(e,t){const i=await this.queryCachedAttributes(e,[t]);if(!i||0===i.length)throw new l.Z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const a=new s.Z;return a.attributes=i[0],a.layer=this,a.sourceLayer=this,a}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:(0,h.pC)(this.associatedLayer)}}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return(0,h.pC)(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),(0,h.Wi)(this.associatedLayer))throw new l.Z("buildingscenelayer:query-not-available","BuildingSceneLayer component layer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new l.Z("buildingscenelayer:query-not-available","BuildingSceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}};(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"parsedUrl",null),(0,a._)([(0,y.Cb)({type:T.U4,readOnly:!0})],x.prototype,"nodePages",void 0),(0,a._)([(0,y.Cb)({type:[T.QI],readOnly:!0})],x.prototype,"materialDefinitions",void 0),(0,a._)([(0,y.Cb)({type:[T.Yh],readOnly:!0})],x.prototype,"textureSetDefinitions",void 0),(0,a._)([(0,y.Cb)({type:[T.H3],readOnly:!0})],x.prototype,"geometryDefinitions",void 0),(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"serviceUpdateTimeStamp",void 0),(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"store",void 0),(0,a._)([(0,y.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],x.prototype,"rootNode",void 0),(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"attributeStorageInfo",void 0),(0,a._)([(0,y.Cb)(k.fields)],x.prototype,"fields",void 0),(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"fieldsIndex",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:b.default})],x.prototype,"associatedLayer",void 0),(0,a._)([(0,f.r)("service","associatedLayer",["associatedLayerID"])],x.prototype,"readAssociatedLayer",null),(0,a._)([(0,y.Cb)(k.outFields)],x.prototype,"outFields",void 0),(0,a._)([(0,y.Cb)({type:String,readOnly:!0})],x.prototype,"objectIdField",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:String,json:{read:!1}})],x.prototype,"displayField",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:String})],x.prototype,"apiKey",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:v.Z})],x.prototype,"fullExtent",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:w.Z})],x.prototype,"spatialReference",null),(0,a._)([(0,y.Cb)({readOnly:!0})],x.prototype,"version",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:I.Z})],x.prototype,"elevationInfo",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:Number})],x.prototype,"minScale",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:Number})],x.prototype,"maxScale",null),(0,a._)([(0,y.Cb)({readOnly:!0,type:Number})],x.prototype,"effectiveScaleRange",null),(0,a._)([(0,y.Cb)({type:["hide","show"],json:{write:!0}})],x.prototype,"listMode",void 0),(0,a._)([(0,y.Cb)({types:r.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],x.prototype,"renderer",void 0),(0,a._)([(0,y.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],x.prototype,"definitionExpression",void 0),(0,a._)([(0,y.Cb)(D.C_)],x.prototype,"popupEnabled",void 0),(0,a._)([(0,y.Cb)({type:n.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],x.prototype,"popupTemplate",void 0),(0,a._)([(0,y.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],x.prototype,"normalReferenceFrame",void 0),(0,a._)([(0,y.Cb)({readOnly:!0,json:{read:!1}})],x.prototype,"defaultPopupTemplate",null),(0,a._)([(0,y.Cb)()],x.prototype,"types",null),(0,a._)([(0,y.Cb)()],x.prototype,"typeIdField",null),(0,a._)([(0,y.Cb)({json:{write:!1}}),(0,g.J)(new d.X({"3DObject":"3d-object",Point:"point"}))],x.prototype,"layerType",void 0),(0,a._)([(0,y.Cb)()],x.prototype,"geometryType",null),(0,a._)([(0,y.Cb)()],x.prototype,"profile",null),(0,a._)([(0,y.Cb)({readOnly:!0,json:{read:!1}})],x.prototype,"capabilities",null),x=(0,a._)([(0,_.j)(W)],x);const H=x},96698:(e,t,i)=>{i.d(t,{Z:()=>h});var a=i(36663),s=i(86618),n=i(15842),r=i(81977),o=(i(7753),i(7283)),l=i(34248),d=i(40266),c=i(51599);let u=class extends((0,s.IG)(n.w)){constructor(e){super(e),this.title="",this.id=-1,this.modelName=null,this.isEmpty=null,this.visible=!0,this.opacity=1}readTitle(e,t){return"string"==typeof t.alias?t.alias:"string"==typeof t.name?t.name:""}readIdOnlyOnce(e){return-1!==this.id?this.id:"number"==typeof e?e:-1}};(0,a._)([(0,r.Cb)({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],u.prototype,"title",void 0),(0,a._)([(0,l.r)("service","title",["alias","name"])],u.prototype,"readTitle",null),(0,a._)([(0,r.Cb)()],u.prototype,"layer",void 0),(0,a._)([(0,r.Cb)({type:o.z8,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],u.prototype,"id",void 0),(0,a._)([(0,l.r)("service","id")],u.prototype,"readIdOnlyOnce",null),(0,a._)([(0,r.Cb)((0,c.Lx)(String))],u.prototype,"modelName",void 0),(0,a._)([(0,r.Cb)((0,c.Lx)(Boolean))],u.prototype,"isEmpty",void 0),(0,a._)([(0,r.Cb)({type:Boolean,json:{name:"visibility",write:!0}})],u.prototype,"visible",void 0),(0,a._)([(0,r.Cb)({type:Number,json:{write:!0}})],u.prototype,"opacity",void 0),u=(0,a._)([(0,d.j)("esri.layers.buildingSublayers.BuildingSublayer")],u);const h=u},28401:(e,t,i)=>{i.d(t,{O:()=>o,s:()=>l});const a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",s="data:image/png;base64,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";var n=i(44101);const r={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function o(e){return e.fromData(a,(()=>new n.x(a,r)))}function l(e){return e.fromData(s,(()=>new n.x(s,r)))}},30904:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Nt});var a=i(36663),s=i(53443),n=i(61681),r=i(81977),o=(i(7753),i(7283)),l=i(40266),d=i(60573),c=(i(91957),i(41151)),u=i(16068),h=i(82064),p=i(69236),y=i(42557),g=i(67666);let f=class extends((0,c.J)(h.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,n._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,a._)([(0,r.Cb)({readOnly:!0,json:{read:!1,write:!0}})],f.prototype,"type",void 0),(0,a._)([(0,r.Cb)({type:g.Z}),(0,y.B)()],f.prototype,"position",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,y.B)(),(0,p.p)((e=>u.BV.normalize((0,o.q9)(e),0,!0)))],f.prototype,"heading",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,y.B)(),(0,p.p)((e=>u.BV.normalize((0,o.q9)(e),0,!0)))],f.prototype,"tilt",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,y.B)()],f.prototype,"width",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,y.B)()],f.prototype,"height",void 0),f=(0,a._)([(0,l.j)("esri.analysis.SlicePlane")],f);const _=f;var v=i(44584),w=i(13802),b=i(76868),m=i(96739),C=i(38481),D=i(2556),P=i(39994),M=i(19431),A=i(95550),V=i(24455),T=i(39100),E=i(10663),S=i(6766),I=i(8909),O=i(90472),L=i(19546),W=i(69430),R=i(97537),k=i(5700),x=i(68817),H=i(1983);const N=(0,P.Z)("mac")?"Meta":"Control",G="Shift",z=Math.cos((0,M.Vl)(45)),U=Math.cos((0,M.Vl)(5)),F=(0,I.f)(1,.5,0),Q=(0,H.b)([...F,.7]),j=[0,0,0,.04],B=(0,H.b)([...F,.5]),Z=(0,H.f)(1,1,1,1),q=(0,H.f)(1,.8,.6,1),Y=(0,H.f)(1,.93,.86,1),K=(0,H.b)([...F,1]),X=(0,H.b)([...F,1]),J=22.5,$=(0,H.b)([...F,1]);var ee=i(28376),te=i(46707),ie=i(74390),ae=i(37926),se=i(88589),ne=i(10449),re=i(6087),oe=i(7358),le=i(35031),de=i(67197),ce=i(5079),ue=i(46378),he=i(89339),pe=i(25584),ye=i(23410),ge=i(9969),fe=i(52756),_e=i(5474),ve=i(95194),we=i(52093),be=i(91907),me=i(17346);class Ce extends ye.K{constructor(){super(...arguments),this.backgroundColor=(0,H.f)(1,0,0,.5),this.gridColor=(0,H.f)(0,1,0,.5),this.gridWidth=4}}class De extends fe.A{initializeProgram(e){return new ve.$(e.rctx,De.shader.get().build(this.configuration),_e.i)}initializePipeline(){return(0,me.sm)({blending:(0,me.wK)(be.zi.ONE,be.zi.ONE,be.zi.ONE_MINUS_SRC_ALPHA,be.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:be.wb.LESS},colorWrite:me.BK})}}De.shader=new ge.J(we.S,(()=>i.e(2953).then(i.bind(i,98552))));class Pe extends oe.F5{constructor(e){super(e,new Ae),this._configuration=new de.m}intersect(e,t,i,a,s,n,r){return(0,pe.Bw)(e,t,a,s,n,void 0,r)}createBufferWriter(){return new he.G_(he.W1)}requiresSlot(e,t){return t===le.H.Color&&e===ue.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}createGLMaterial(e){return new Me(e)}getConfiguration(){return this._configuration}}class Me extends ce.Z{constructor(e){super(e),this.ensureTechnique(De,null)}beginSlot(){return(0,n.Wg)(this.technique)}}class Ae extends Ce{constructor(){super(...arguments),this.renderOccluded=oe.yD.Occlude}}class Ve extends ne._{constructor(e){super(e),this._material=null,this._renderOccluded=oe.yD.OccludeAndTransparent,this._gridWidth=1,this._gridColor=(0,H.f)(1,0,0,1),this._backgroundColor=(0,H.f)(1,0,0,1),this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(e){(0,se.c)(this._gridColor,e),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){(0,se.c)(this._backgroundColor,e),this._updateMaterial()}createExternalResources(){this._material=new Pe(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(e){(0,n.pC)(this._material)&&e(this._material)}createGeometries(e){if((0,n.pC)(this._material)){const t=(0,re.g7)();e.addGeometry(t,this._material)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}_updateMaterial(){(0,n.pC)(this._material)&&this._material.setParameters(this._materialParameters)}}var Te,Ee,Se=i(10822),Ie=i(40460),Oe=i(70984),Le=i(84891),We=i(9434),Re=i(65392),ke=i(91258);i(91772);function xe(e,t,i,a,s,n,r,o){return function(e,t,i,a,s,n){const r=(0,S.e)(e,t),o=x.WM.get(),l=x.WM.get();switch(a===st.HORIZONTAL_OR_VERTICAL?Math.abs(r)>z?st.HORIZONTAL:st.VERTICAL:a){case st.VERTICAL:{const a=Math.abs(r)<=U?e:i.viewUp;(0,S.f)(o,a,t),(0,S.c)(l,t);break}case st.HORIZONTAL:(0,S.f)(o,i.viewUp,t),(0,S.f)(l,t,o);break;case st.TILTED:{const a=Math.abs(r)<=U?t:i.viewUp;(0,S.f)(o,a,e),(0,S.f)(l,e,o);break}}const d=(0,S.f)(x.WM.get(),o,l);(0,S.e)(d,i.viewForward)>0&&(0,S.g)(l,l,-1),(0,S.n)(s,o),(0,S.n)(n,l)}(t,r.worldUpAtPosition(e,x.WM.get()),s,n,o.basis1,o.basis2),(0,S.g)(o.basis1,o.basis1,i),(0,S.g)(o.basis2,o.basis2,a),(0,S.c)(o.origin,e),(0,W.my)(o.basis2,o.basis1,o.origin,o.plane),o}function He(e,t){return(0,ie.Aq)(e.basis1,e.basis2,e.origin,t)}function Ne(e,t,i,a){const s=t.worldUpAtPosition(e.origin,x.WM.get()),n=x.WM.get();switch(i){case at.HEADING:(0,S.c)(n,s);break;case at.TILT:(0,S.c)(n,e.basis1)}return(0,W.Yq)(e.origin,n,a)}function Ge(e,t,i,a){const s=ze(i,Te.NEGATIVE_X),n=x.MP.get();(0,V.o)(n,t,s.edge*Math.PI/2);const r=(0,S.n)(x.WM.get(),s.basis);let o=(0,S.g)(x.WM.get(),r,s.direction*a.computeScreenPixelSizeAt(s.position)*40);(0,S.a)(o,o,s.position);const l=a.projectToRenderScreen(o,(0,A.Wv)(x.WM.get())),d=function(e,t){const[i,a,s,n]=e.viewport,r=Math.min(s,n)/16;let o=!0;return t[0]<i+r?(t[0]=i+r,o=!1):t[0]>i+s-r&&(t[0]=i+s-r,o=!1),t[1]<a+r?(t[1]=a+r,o=!1):t[1]>a+n-r&&(t[1]=a+n-r,o=!1),o}(a,l);(0,Ie.Bh)(a,l,rt),(0,S.n)(rt.direction,rt.direction);const c=x.WM.get();!d&&(0,m.i)(i,rt,c)&&(o=c),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=(0,I.a)(o),d?e.state|=nt:e.state&=~nt}function ze(e,t){switch(t){case Te.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,S.a)(x.WM.get(),e.origin,e.basis1),edge:t};case Te.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,S.a)(x.WM.get(),e.origin,e.basis2),edge:t};case Te.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,S.b)(x.WM.get(),e.origin,e.basis1),edge:t};case Te.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,S.b)(x.WM.get(),e.origin,e.basis2),edge:t}}}function Ue(e,t,i){const a=i.projectToRenderScreen((0,S.a)(x.WM.get(),e,t),(0,A.Wv)(x.WM.get())),s=i.projectToRenderScreen((0,S.b)(x.WM.get(),e,t),(0,A.Wv)(x.WM.get()));return(0,S.p)((0,S.b)(a,a,s))}function Fe(e){const t=(0,S.l)(e.basis1),i=(0,S.l)(e.basis2);return.3*Math.min(t,i)}function Qe(e){return Fe(e)}function je(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Be(e,t=ct.CENTER_ON_ARROW){const i=t===ct.CENTER_ON_CALLOUT?40:0,a=[(0,I.f)(i,0,-24),(0,I.f)(i,0,24)],s=function(e,t){const i=(0,S.b)((0,I.c)(),e[e.length-1],e[e.length-2]);if((0,S.n)(i,i),(0,S.g)(i,i,J),(0,S.a)(i,i,e[e.length-1]),t){const t=(0,S.b)((0,I.c)(),e[0],e[1]);return(0,S.n)(t,t),(0,S.g)(t,t,J),(0,S.a)(t,t,e[0]),[t,...e,i]}return[...e,i]}(a,!0),r=(e,t)=>function(e,t,i){const a=a=>{const s=(a?t:e).slice(0),r=(0,S.b)(x.WM.get(),s[0],s[1]);(0,S.n)(r,r);const o=(0,S.b)(x.WM.get(),s[s.length-1],s[s.length-2]);if((0,S.n)(o,o),i.padding>0){const e=(0,S.g)((0,I.c)(),o,-i.padding);if(s[s.length-1]=(0,S.a)(e,e,s[s.length-1]),i.bothEnds){const e=(0,S.g)((0,I.c)(),r,-i.padding);s[0]=(0,S.a)(e,e,s[0])}}const l=a?i.tipFocusMultiplier:1,d=i.tipLength*(i.focusTipLength?l:1),c=i.tipRadius*l,u=(0,V.i)(x.MP.get());if(i.padding>0){const e=d/4,t=(0,S.s)(x.WM.get(),0,e,0),a=1+i.padding/e;(0,V.v)(u,u,t),(0,V.k)(u,u,(0,S.s)(x.WM.get(),a,a,a)),(0,V.v)(u,u,(0,S.g)(t,t,-1/a))}const h=(0,V.i)((0,T.c)()),p=(0,I.f)(0,1,0),y=(0,V.D)((0,T.c)(),(0,E.r)(x.vD.get(),p,o));y[12]=s[s.length-1][0],y[13]=s[s.length-1][1],y[14]=s[s.length-1][2],(0,V.m)(y,y,u);const g=[{part:"tube",geometry:Xe(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,s),transform:h}];let f,_;if((0,n.pC)(i.flat)?f=(0,re.DA)(d,c,c,i.flat.thickness):(f=(0,re.QL)(d,c,24,!1,!1,!0),_=(0,re.QL)(d,c,24,!1,!0,!1)),g.push({part:"tip",geometry:f,transform:y}),_&&g.push({part:"cap",geometry:_,transform:y}),i.bothEnds){const e=(0,V.D)((0,T.c)(),(0,E.r)(x.vD.get(),p,r));e[12]=s[0][0],e[13]=s[0][1],e[14]=s[0][2],(0,V.m)(e,e,u),g.push({part:"tip",geometry:f,transform:e}),_&&g.push({part:"cap",geometry:_,transform:e})}return g};return{normal:a(!1),focused:a(!0)}}(a,a,{tubeRadius:3,tipRadius:11,tipLength:J,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),o=r(0,!1),l=r(2.25,!0),d=new Le.E({color:Z,cullFace:Oe.Vr.Back,renderOccluded:oe.yD.Opaque}),c=new Le.E({color:q,cullFace:Oe.Vr.Back,renderOccluded:oe.yD.Opaque}),u=new Le.E({color:Y,cullFace:Oe.Vr.Back,renderOccluded:oe.yD.Opaque}),h=new Le.E({color:X,transparent:!0,writeDepth:!1,cullFace:Oe.Vr.Front,renderOccluded:oe.yD.Transparent}),p=(0,re.rh)([[i,0,0],[i-40,0,0]]),y=(0,re.rh)([[i,0,0],[i-40,0,0]]),g=new We.Y({color:K,renderOccluded:oe.yD.OccludeAndTransparent});return new te.Z({view:e,renderObjects:[...o.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?d:"cap"===e?c:u,transform:i,stateMask:ke.Q9.Unfocused|it}))),...l.normal.map((({geometry:e,transform:t})=>({geometry:e,material:h,transform:t,stateMask:ke.Q9.Unfocused|it}))),{geometry:p,material:g,stateMask:ke.Q9.Unfocused|it|nt},...o.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?d:"cap"===e?c:u,transform:i,stateMask:ke.Q9.Focused|it}))),...l.focused.map((({geometry:e,transform:t})=>({geometry:e,material:h,transform:t,stateMask:ke.Q9.Focused|it}))),{geometry:y,material:g,stateMask:ke.Q9.Focused|it|nt}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[s]},collisionPriority:1,radius:11,state:it})}function Ze(e,t){const i=(0,ie.Ju)(e,{customStateMask:it,texture:t});return i.state=it,i}function qe(e){return new ae.r({view:e,attached:!1,color:Q,width:1,writeDepthEnabled:!1,renderOccluded:oe.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function Ye(e){return new Ve({view:e,attached:!1,backgroundColor:[...j],gridColor:B,gridWidth:4,renderOccluded:oe.yD.OccludeAndTransparent})}function Ke(e,t){const i=je(t),a=i?[(0,I.f)(1,0,0),(0,I.f)(0,0,0),(0,I.f)(0,1,0)]:[(0,I.f)(1,0,0),(0,I.f)(-1,0,0)],s=(0,re.rh)(a),n=$,r=i?4:1,o=2*r,l=e=>e>1?(e=>new Re.U({color:n,width:e,renderOccluded:oe.yD.OccludeAndTransparent}))(e):new We.Y({color:n,renderOccluded:oe.yD.OccludeAndTransparent}),d=[{geometry:s,material:l(r),stateMask:ke.Q9.Unfocused|lt},{geometry:s,material:l(o),stateMask:ke.Q9.Focused|lt},{geometry:s,material:l(1),stateMask:dt}],c=new te.Z({view:e,renderObjects:d,collisionType:{type:"line",paths:[a]},radius:i?6:4,...ie.X9});return c.state=lt,c}function Xe(e,t,i){const a=[];if((0,n.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const s=i/t*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}}return(0,re.x2)(a,i,[],[],!1)}function Je(e,t,i,a=new _){if((0,n.Wi)(e))return null;const{renderCoordsHelper:s}=t,r=s.fromRenderCoords(e.origin,t.spatialReference);if((0,n.Wi)(r))return null;const o=(0,O.fM)(r,i);if((0,n.Wi)(o))return null;a.position=o;const l=2*(0,S.l)(e.basis1),d=2*(0,S.l)(e.basis2),c=Se.Z.renderUnitScaleFactor(t.spatialReference,i);a.width=l*c,a.height=d*c;const u=s.worldUpAtPosition(e.origin,x.WM.get());return a.tilt=(0,M.BV)($e(e,u)),a.heading=s.headingAtPosition(e.origin,e.basis1)-90,a}function $e(e,t){return(0,k.cp)(t,e.basis2,e.basis1)+ot}function et(e,t){if((0,n.Wi)(e)||(0,n.Wi)(e.position))return null;const i=(0,ee.G)(e.position,t.spatialReference,t.elevationProvider);if((0,n.Wi)(i))return null;const a=Se.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),s=e.width*a,r=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:s,renderHeight:r}}function tt(e,t,i,a=(0,m.a)()){if((0,n.Wi)(e))return null;const s=function(e,t,i,a,s,n,r=(0,m.a)()){return n.toRenderCoords(e,r.origin)?(n.worldBasisAtPosition(r.origin,L.R.X,r.basis1),n.worldBasisAtPosition(r.origin,L.R.Y,r.basis2),(0,W.my)(r.basis2,r.basis1,r.origin,r.plane),(0,m.r)(r,-(0,M.Vl)(t),(0,m.n)(r),r),(0,m.r)(r,(0,M.Vl)(i),r.basis1,r),(0,S.g)(r.basis1,r.basis1,a/2),(0,S.g)(r.basis2,r.basis2,s/2),(0,m.u)(r),r):(w.Z.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return!i.tiltEnabled&&(0,n.pC)(s)&&function(e,t,i){const a=t.worldUpAtPosition(e.origin,x.WM.get()),s=e.basis1,n=$e(e,a),r=Math.round(n/ot)*ot;(0,m.r)(e,r-n,s,i)}(s,t.renderCoordsHelper,s),s}(Ee=Te||(Te={}))[Ee.POSITIVE_X=0]="POSITIVE_X",Ee[Ee.POSITIVE_Y=1]="POSITIVE_Y",Ee[Ee.NEGATIVE_X=2]="NEGATIVE_X",Ee[Ee.NEGATIVE_Y=3]="NEGATIVE_Y";const it=ke.jg.Custom1;var at,st;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(at||(at={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(st||(st={}));const nt=ke.jg.Custom2,rt=(0,R.Ue)(),ot=Math.PI/2,lt=ke.jg.Custom1,dt=ke.jg.Custom2;var ct;function ut(e){const t="building-scene-3d"===e.type?e:null;return(0,n.pC)(t)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(ct||(ct={}));var ht=i(27755);const pt="esri.views.3d.analysis.Slice.SliceController",yt=w.Z.getLogger(pt);let gt=class extends s.Z{constructor(e){super(e),this._handles=new v.Z,this._internalChange=!1,this._currentSlicePlane=null}initialize(){this._handles.add(this.analysis.excludedLayers.on("before-add",(e=>{const t=e.item;null!=t&&(t instanceof C.Z||t instanceof D.Z)?t instanceof C.Z&&function(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,ht.Bg)(e.type),!1}}(t)?(yt.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.analysis.excludedLayers.includes(t)&&e.preventDefault():(yt.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))),function(e,t){ft.has(e)||ft.set(e,{all:[],activeController:null}),ft.get(e).all.push(t)}(this.view,this),this._handles.add([(0,b.YP)((()=>this.analysisViewData.plane),(()=>{this._internalChange||this._updateSlicePlaneFromBoundedPlane(),this._updateLayerViews()}),{sync:!0}),(0,b.YP)((()=>this.analysis.excludeGroundSurface),(()=>this._updateLayerViews()),{sync:!0}),this.analysis.excludedLayers.on("change",(()=>this._updateLayerViews())),(0,b.YP)((()=>[this.analysisViewData.active,this.analysisViewData.visible]),(()=>{this._updateActiveController(),this._updateViewSlicePlane()}),{sync:!0}),(0,b.YP)((()=>this._allLayerAndSubLayerViews),(()=>this._updateLayerViews()))]),this._handles.add([(0,b.YP)((()=>this.analysis.shape),(()=>{this._internalChange||(this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}destroy(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function(e,t){if(!ft.has(e))throw new Error("view expected in global slice register");const i=ft.get(e),a=i.all.lastIndexOf(t);if(-1===a)throw new Error("controller expected in global slice register");i.all.splice(a,1),0===i.all.length&&ft.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null)}get _allLayerAndSubLayerViews(){const e=this.view.allLayerViews.items;return e.concat(e.filter(ut).flatMap((({sublayerViews:e})=>e.items)))}_updateBoundedPlaneFromSlicePlane(){const e=this.analysis.shape,t=this._currentSlicePlane;if((0,n.Wi)(t)&&(0,n.Wi)(e)||(0,n.pC)(t)&&(0,n.pC)(e)&&e.equals(t))return;let i=null,a=null;if((0,n.pC)(e)&&(0,n.pC)(e.position)){const t=e.position.spatialReference,s=et(e,this.view);(0,n.Wi)(s)&&(0,ee.e)(this.analysis,t,yt),i=tt(s,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,m.a)()),(0,n.pC)(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}_updateSlicePlaneFromBoundedPlane(){const e=Je(this.analysisViewData.plane,this.view,this.view.spatialReference,new _);let t=null;(0,n.pC)(e)&&(t={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=e,this._internalChange=!1,this._updateViewSlicePlane()}_updateActiveController(){if(_t)return;const e=vt(this.view);if(this.analysisViewData.active)(0,n.pC)(e.activeController)&&e.activeController!==this?(_t=!0,e.activeController.analysisViewData.active=!1,_t=!1):(0,n.pC)(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if((0,n.pC)(e.activeController)&&e.activeController!==this)return;(0,n.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}_updateViewSlicePlane(){!function(e){const t=vt(e).activeController;(0,n.pC)(t)&&(0,n.pC)(t.analysisViewData.plane)&&t.analysisViewData.visible?e.slicePlane=t.analysisViewData.plane:e.slicePlane=null}(this.view)}_updateLayerViews(){const e=(0,n.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[],i=e=>{"layers"in e?e.layers.forEach(i):t.push(e)};this.analysis.excludedLayers.forEach(i),this.view.allLayerViews.forEach((i=>{i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&!t.includes(i.layer)),"sublayerViews"in i&&i.sublayerViews.forEach((i=>{i.slicePlaneEnabled=e&&!t.includes(i.sublayer)})))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}};(0,a._)([(0,r.Cb)()],gt.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],gt.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],gt.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)()],gt.prototype,"_allLayerAndSubLayerViews",null),gt=(0,a._)([(0,l.j)(pt)],gt);const ft=new Map;let _t=!1;function vt(e){return ft.get(e)}var wt,bt=i(18234),mt=i(17262),Ct=i(28401),Dt=i(81536),Pt=i(8927),Mt=i(20757),At=i(53203),Vt=i(34108),Tt=i(38114);let Et=wt=class extends At.f{constructor(e){super(e),this._clock=bt.m,this._previewPlaneOpacity=1,this.removeIncompleteOnCancel=!1,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this._handles=new v.Z,this._viewHandles=new v.Z,this._frameTask=null,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null,this._previewPlaneGridVisualElement=null,this._previewPlaneOutlineVisualElement=null,this._startPlane=(0,m.a)(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=(0,A.vW)(),this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=(0,Pt.Z8)(e.view.state.viewingMode),this._intersector.options.store=Mt.eC.MIN}initialize(){if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=(0,Ct.O)(this.view.toolViewManager.textures),this._rotateTiltImage=(0,Ct.s)(this.view.toolViewManager.textures);const e=e=>{this._updateManipulatorsInteractive(e),e.grabbing||((0,n.pC)(this.analysisViewData.plane)&&(0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=Be(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(t=>{this._onShiftGrab(t),e(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=Ze(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(t=>{this._onRotateHeadingGrab(t),e(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=Ze(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(t=>{this._onRotateTiltGrab(t),e(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((t,i)=>{const a=Ke(this.view,t);return a.events.on("grab-changed",(t=>{this._onResizeGrab(t,i),e(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=Ye(this.view),this._previewPlaneOutlineVisualElement=qe(this.view),this._previewPlaneOutlineVisualElement.width=2,this._handles.add((0,b.YP)((()=>this.analysisViewData.plane),(()=>this._updateManipulators()),b.Z_));const t=(0,b.YP)((()=>this.state),(e=>{"sliced"===e&&this.finishToolCreation()}),b.tX);this._handles.add([t,(0,b.YP)((()=>this.view.state.camera),(()=>this._onCameraChange()))])}destroy(){this._rotateHeadingImage=(0,n.RY)(this._rotateHeadingImage),this._rotateTiltImage=(0,n.RY)(this._rotateTiltImage),this._handles=(0,n.SC)(this._handles),this._viewHandles=(0,n.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,n.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,n.SC)(this._previewPlaneGridVisualElement)}get state(){const e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get cursor(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,n.pC)(this._creatingPointerId)?"grabbing":null}set analysis(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,n.pC)(e)&&"resize"===e.type,this._updateMaterials()}get _isPlacingSlicePlane(){return!this.inputState&&!this.analysisViewData.plane&&this.active}get _creatingPointerId(){return(0,n.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){(0,n.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}exitExcludeLayerMode(){(0,n.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}onDeactivate(){this._set("layersMode","none"),this._updatePreviewPlane(null)}onShow(){this._updateVisibility(!0)}onHide(){this._updateVisibility(!1)}_updateVisibility(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!It(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!It(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!It(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this.analysisViewData.editable=this.internallyEditable}_onPointerDrag(e){const t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,n.pC)(t)&&"shift"===t.type){const i=(0,Tt.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,Tt.vT)(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){if(e.pointerId===this._creatingPointerId&&(0,n.pC)(this.analysisViewData.plane)){const t=(0,Tt.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){const t=(0,Tt.vT)(e),i=(0,m.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,m.c)(i,this._startPlane),this.analysis.shape=Je(i,this.view,this.view.spatialReference,new _),"pointer-drag"===e.type){const a=this._calculatePickRay(t);this.inputState=St(a,e.pointerId,i.origin,i)}return!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created||(this.view.hitTest((0,Tt.vT)(e)).then((e=>{if(e.results.length){const t=e.results[0],i="graphic"===t?.type&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.analysis.excludedLayers.push(e)}}else e.ground.layer?this.analysis.excludedLayers.push(e.ground.layer):this.analysis.excludeGroundSurface=!0})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),0))}_onKeyDown(e){return(e.key===G||e.key===N)&&(this._activeKeyModifiers[e.key]=!0,(0,n.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==G&&e.key!==N||!this._activeKeyModifiers[e.key]||(delete this._activeKeyModifiers[e.key],(0,n.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),0))}_onShiftGrab(e){if("start"!==e.action||(0,n.Wi)(this.analysisViewData.plane))return;const t=this._calculatePickRay(e.screenPoint);(0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState=St(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}_createShiftDragPipeline(e){return(0,Vt.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,n.Wi)(a)||"shift"!==a.type)return;const s=(0,n.pC)(this.analysisViewData.plane)?(0,m.c)(this.analysisViewData.plane,(0,m.a)()):null;t.next((0,Dt._N)(this.view,a.shiftPlane)).next(this._shiftDragAdjustSensitivity(a)).next(this._shiftDragUpdatePlane(a)),i.next((()=>{(0,n.pC)(s)&&this._updateBoundedPlane(s)}))}))}_shiftDragAdjustSensitivity(e){return t=>{if((0,n.Wi)(this.analysisViewData.plane))return null;const i=Math.min((1-Math.abs((0,S.e)((0,m.n)(this.analysisViewData.plane),t.ray.direction)/(0,S.l)(t.ray.direction)))/.001,1),a=-(0,W.jH)(this._startPlane.plane,t.renderEnd),s=-(0,W.jH)(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-i)+a*i-s,t}}_shiftDragUpdatePlane(e){return()=>{if((0,n.Wi)(this.analysisViewData.plane))return;const t=(0,S.c)(x.WM.get(),this._startPlane.origin),i=(0,S.c)(x.WM.get(),(0,m.n)(this._startPlane));(0,S.g)(i,i,-e.depth),(0,S.a)(i,i,t);const a=(0,m.f)(i,this.analysisViewData.plane.basis1,this.analysisViewData.plane.basis2,(0,m.a)());this._updateBoundedPlane(a)}}_onRotateHeadingGrab(e){if("start"!==e.action||(0,n.Wi)(this.analysisViewData.plane))return;const t=Ne(this.analysisViewData.plane,this.view.renderCoordsHelper,at.HEADING,(0,W.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,I.c)();(0,W.BR)(t,i,a)&&((0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateHeadingDragPipeline(e){return(0,Vt.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,n.Wi)(a)||"rotate"!==a.type)return;const s=(0,n.pC)(this.analysisViewData.plane)?(0,m.c)(this.analysisViewData.plane,(0,m.a)()):null;t.next((0,Dt._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{(0,n.pC)(s)&&this._updateBoundedPlane(s)}))}))}_onRotateTiltGrab(e){if("start"!==e.action||(0,n.Wi)(this.analysisViewData.plane))return;const t=Ne(this.analysisViewData.plane,this.view.renderCoordsHelper,at.TILT,(0,W.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,I.c)();(0,W.BR)(t,i,a)&&((0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}_createRotateTiltDragPipeline(e){return(0,Vt.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,n.Wi)(a)||"rotate"!==a.type)return;const s=(0,n.pC)(this.analysisViewData.plane)?(0,m.c)(this.analysisViewData.plane,(0,m.a)()):null;t.next((0,Dt._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdatePlaneFromRotate()),i.next((()=>{(0,n.pC)(s)&&this._updateBoundedPlane(s)}))}))}_rotateDragRenderPlaneToRotate(e){return t=>{if((0,n.Wi)(this.analysisViewData.plane))return null;const i=(0,W.mJ)(e.rotatePlane),a=(0,ie.Gd)(e.startPoint,t.renderEnd,this.analysisViewData.plane.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if((0,n.Wi)(this.analysisViewData.plane))return;const t=(0,V.d)(x.MP.get(),e.rotateAngle,e.rotateAxis);if((0,n.Wi)(t))return;const i=(0,S.m)(x.WM.get(),this._startPlane.basis1,t),a=(0,S.m)(x.WM.get(),this._startPlane.basis2,t),s=(0,m.f)(this.analysisViewData.plane.origin,i,a,(0,m.a)());this._updateBoundedPlane(s)}}_onResizeGrab(e,t){if("start"!==e.action||(0,n.Wi)(this.analysisViewData.plane))return;const i=this._calculatePickRay(e.screenPoint),a=x.WM.get();(0,W.BR)(this.analysisViewData.plane.plane,i,a)&&((0,m.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,I.a)(a)})}_createResizeDragPipeline(e){return(0,Vt.Xd)(e,((e,t,i)=>{const a=this.inputState;if((0,n.Wi)(a)||"resize"!==a.type||(0,n.Wi)(this.analysisViewData.plane))return;const s=(0,m.c)(this.analysisViewData.plane,(0,m.a)());t.next((0,Dt._N)(this.view,this.analysisViewData.plane.plane)).next(this._resizeDragUpdatePlane(a)),i.next((()=>{this._updateBoundedPlane(s)}))}))}_resizeDragUpdatePlane(e){return t=>{if((0,n.Wi)(this.analysisViewData.plane))return;const i=function(e,t,i,a,s,n){const r=(0,S.c)(x.WM.get(),s.origin);(0,S.a)(r,r,(0,S.g)(x.WM.get(),s.basis1,e.direction[0]<0?1:-1)),(0,S.a)(r,r,(0,S.g)(x.WM.get(),s.basis2,e.direction[1]<0?1:-1));const o=(0,S.l)(s.basis1),l=(0,S.l)(s.basis2),d=(0,S.b)(x.WM.get(),i,r),c=(0,S.b)(x.WM.get(),t,r);let u=0,h=0;if(je(e)){const t=Qe(s),i=Qe(n);u=o-.5*e.direction[0]*(0,S.e)(s.basis1,c)/o,h=l-.5*e.direction[1]*(0,S.e)(s.basis2,c)/l;const a=i/t;u*=a,h*=a}const p=u+.5*e.direction[0]*(0,S.e)(s.basis1,d)/o,y=h+.5*e.direction[1]*(0,S.e)(s.basis2,d)/l,g=(0,S.g)(x.WM.get(),s.basis1,p/o),f=(0,S.g)(x.WM.get(),s.basis2,y/l);(p<=0||Ue(n.origin,g,a)<=1600)&&(0,S.c)(g,n.basis1),(y<=0||Ue(n.origin,f,a)<=1600)&&(0,S.c)(f,n.basis2);const _=(0,S.c)(x.WM.get(),r);return(0,S.a)(_,_,(0,S.g)(x.WM.get(),g,e.direction[0]<0?-1:1)),(0,S.a)(_,_,(0,S.g)(x.WM.get(),f,e.direction[1]<0?-1:1)),(0,m.f)(_,g,f,n)}(this._resizeHandles[e.activeHandleIdx],e.startPoint,t.renderEnd,this.view.state.camera,this._startPlane,(0,m.c)(this.analysisViewData.plane));this._updateBoundedPlane(i)}}_updateBoundedPlane(e){const t=this.analysisViewData;if(!(0,n.pC)(t))throw new Error("valid internal object expected");t.plane=e}_updatePreviewPlane(e,t={}){let i=this._previewPlane;if(this._previewPlane=null,(0,n.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){const a=(0,n.pC)(i)?i:(0,m.a)();if(i=(0,n.pC)(i)?(0,m.c)(i,Ot):null,this._pickPlane(e,!0,t,a)){const e=.95;let t=!1;(0,n.pC)(i)&&(t=(0,S.e)(i.plane,a.plane)<e||(0,S.e)((0,S.n)(x.WM.get(),i.basis1),(0,S.n)(x.WM.get(),a.basis1))<e),t&&(this._previewPlaneOpacity=0),this._previewPlane=a}}(0,n.pC)(this._previewPlane)&&(0,n.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,mt.A)({update:({deltaTime:e})=>{this._previewPlaneOpacity=Math.min(this._previewPlaneOpacity+e/300,1),this._updateManipulators(),1===this._previewPlaneOpacity&&this._removeFrameTask()}}):(0,n.Wi)(this._previewPlane)&&(0,n.pC)(this._frameTask)?this._removeFrameTask():(0,n.pC)(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){this._frameTask=(0,n.hw)(this._frameTask)}_calculatePickRay(e){const t=(0,R.Ue)(),i=(0,A.md)(e,Lt);return(0,Ie.u4)(this.view.state.camera,i,t),(0,S.n)(t.direction,t.direction),t}_pickMinResult(e){const t=(0,A.md)(e,x.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const s=this._pickMinResult(e),n=x.WM.get();if(!s.getIntersectionPoint(n))return!1;const r=s.getTransformedNormal(x.WM.get()),o=this.view.state.camera;(0,S.e)(r,o.viewForward)>0&&(0,S.g)(r,r,-1);const l=function(e,t){return.4*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}(n,o),d=(t?1:-1)*l*.02,c=(0,S.g)(x.WM.get(),r,d);(0,S.a)(c,c,n);const u=this.analysis.tiltEnabled?st.TILTED:st.HORIZONTAL_OR_VERTICAL;return xe(c,r,l,l,o,i[G]?st.VERTICAL:i[N]?st.HORIZONTAL:u,this.view.renderCoordsHelper,a),!0}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,n.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=it,this.rotateHeadingManipulator.state|=it,this.rotateTiltManipulator.state|=it,this._prevPointerMoveTimeout=this._clock.setTimeout((()=>{this.shiftManipulator.state&=~it,this.rotateHeadingManipulator.state&=~it,this.rotateTiltManipulator.state&=~it}),this._pointerMoveTimerMs)}_updateManipulators(){if(wt.disableEngineLayers)return;let e=null,t=!1;if((0,n.pC)(this.analysisViewData.plane))e=this.analysisViewData.plane,t=!1;else{if(!(0,n.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);e=this._previewPlane,t=!0}const i=He(e,x.MP.get());t?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((e=>e.available=!1)),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((e=>e.available=!0)),Ge(this.shiftManipulator,i,e,this.view.state.camera),function(e,t,i,a){const s=a.worldUpAtPosition(i.origin,x.WM.get()),n=ze(i,Te.POSITIVE_X),r=(0,V.b)(x.MP.get(),n.edge*Math.PI/2);(0,V.r)(r,r,-$e(i,s)),(0,V.m)(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=n.position}(this.rotateHeadingManipulator,i,e,this.view.renderCoordsHelper),function(e,t,i){const a=ze(i,Te.POSITIVE_Y),s=(0,V.b)(x.MP.get(),a.edge*Math.PI/2);(0,V.r)(s,s,ot),(0,V.m)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}(this.rotateTiltManipulator,i,e),this.resizeManipulators.forEach(((t,a)=>function(e,t,i,a){const s=(0,S.l)(a.basis1),n=(0,S.l)(a.basis2),r=Fe(a),o=Qe(a),l=(0,S.s)(x.WM.get(),0,0,0);(0,S.a)(l,(0,S.g)(x.WM.get(),a.basis1,t.direction[0]),(0,S.g)(x.WM.get(),a.basis2,t.direction[1])),(0,S.a)(l,a.origin,l);let d=0,c=1;if(je(t))1===t.direction[0]&&-1===t.direction[1]?d=ot:1===t.direction[0]&&1===t.direction[1]?d=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(d=3*Math.PI/2),c=o;else{const e=0!==t.direction[0]?1:2;d=1===e?ot:0,c=(1===e?n:s)-r}const u=(0,V.b)(x.MP.get(),d);(0,V.k)(u,u,(0,S.s)(x.WM.get(),c,c,c)),(0,V.m)(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=l}(t,this._resizeHandles[a],i,e))),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);const a=(0,S.s)(x.WM.get(),(0,S.l)(e.basis1),(0,S.l)(e.basis2),1),s=(0,V.C)(x.MP.get(),a),r=(0,V.m)(s,i,s);this._previewPlaneOutlineVisualElement.transform=r,this._previewPlaneGridVisualElement.transform=r,this._updateMaterials()}_updateMaterials(){const e=[Q[0],Q[1],Q[2],Q[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;const t=[j[0],j[1],j[2],j[3]*this._previewPlaneOpacity];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}_updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))}testData(){return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:e=>{this._pointerMoveTimerMs=e}}}};function St(e,t,i,a){const s=function(e,t,i,a){const s=(0,S.f)(x.WM.get(),t,i);return(0,S.f)(s,s,t),(0,W.Yq)(e,s,a)}(i,(0,m.n)(a),e.direction,(0,W.Ue)()),n=(0,I.c)();return(0,W.BR)(s,e,n)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:s,depth:0,startPoint:n}:null}function It(e){return"mouse"!==e.pointerType||0===e.button}Et.disableEngineLayers=!1,(0,a._)([(0,r.Cb)()],Et.prototype,"_clock",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Et.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],Et.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Et.prototype,"state",null),(0,a._)([(0,r.Cb)({readOnly:!0})],Et.prototype,"cursor",null),(0,a._)([(0,r.Cb)()],Et.prototype,"analysis",null),(0,a._)([(0,r.Cb)()],Et.prototype,"removeIncompleteOnCancel",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Et.prototype,"layersMode",void 0),(0,a._)([(0,r.Cb)({value:null})],Et.prototype,"inputState",null),(0,a._)([(0,r.Cb)()],Et.prototype,"_isPlacingSlicePlane",null),(0,a._)([(0,r.Cb)()],Et.prototype,"_creatingPointerId",null),Et=wt=(0,a._)([(0,l.j)("esri.views.3d.analysis.Slice.SliceTool")],Et);const Ot=(0,m.a)(),Lt=(0,A.s1)(),Wt=Et;var Rt=i(66962);let kt=class extends s.Z{constructor(e){super(e),this._handles=new v.Z,this._gridVisualElement=null,this._outlineVisualElement=null,this.showGrid=!1,this.preview=!0}initialize(){const e=this.analysisViewData;if((0,n.Wi)(e))throw new Error("expected internal object to be valid");this._gridVisualElement=Ye(this.view),this._outlineVisualElement=qe(this.view),this._handles.add([(0,b.YP)((()=>({visible:(0,n.pC)(e.plane)&&this.analysisViewData.visible,active:this.analysisViewData.active,preview:this.preview,showGrid:this.showGrid})),(e=>this._updateMaterials(e)),b.tX),(0,b.YP)((()=>e.plane),(e=>this._updatePlane(e)),b.tX)],"internal")}destroy(){this._handles.destroy(),this._gridVisualElement=(0,n.SC)(this._gridVisualElement),this._outlineVisualElement=(0,n.SC)(this._outlineVisualElement),this.set("view",null)}_updatePlane(e){if((0,n.Wi)(e))return;this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;const t=(0,S.s)(x.WM.get(),(0,S.l)(e.basis1),(0,S.l)(e.basis2),1),i=(0,V.C)(x.MP.get(),t),a=He(e,x.MP.get()),s=(0,V.m)(i,a,i);this._outlineVisualElement.transform=s,this._gridVisualElement.transform=s}_updateMaterials({visible:e,active:t,preview:i,showGrid:a}){this._outlineVisualElement.color=Q,this._outlineVisualElement.width=i?2:1,this._outlineVisualElement.stipplePattern=t?null:(0,Rt.z5)(5),this._gridVisualElement.backgroundColor=j,this._gridVisualElement.gridColor=a?B:H.Z,this._gridVisualElement.visible=e,this._outlineVisualElement.visible=e}};(0,a._)([(0,r.Cb)()],kt.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],kt.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],kt.prototype,"analysisViewData",void 0),(0,a._)([(0,r.Cb)()],kt.prototype,"showGrid",void 0),(0,a._)([(0,r.Cb)()],kt.prototype,"preview",void 0),kt=(0,a._)([(0,l.j)("esri.views.3d.analysis.Slice.SliceVisualization")],kt);var xt=i(76497);let Ht=class extends((0,d.p)(s.Z)){constructor(e){super(e),this.type="slice-view-3d",this.analysis=null,this.tool=null,this.analysisVisualization=null,this.analysisController=null,this.plane=null,this.active=!0}initialize(){this.analysisVisualization=new kt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new gt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,xt.Lp)(this,Wt))}destroy(){(0,xt.Yq)(this),this.analysisVisualization=(0,n.SC)(this.analysisVisualization),this.analysisController=(0,n.SC)(this.analysisController)}get showGrid(){return this.analysisVisualization?.showGrid??!1}set showGrid(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}get editable(){return!this.analysisVisualization.preview}set editable(e){this.analysisVisualization.preview=!e}get testData(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,n.Wg)(this.tool)}}};(0,a._)([(0,r.Cb)({readOnly:!0})],Ht.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ht.prototype,"analysis",void 0),(0,a._)([(0,r.Cb)()],Ht.prototype,"tool",void 0),(0,a._)([(0,r.Cb)()],Ht.prototype,"plane",void 0),(0,a._)([(0,r.Cb)()],Ht.prototype,"active",void 0),(0,a._)([(0,r.Cb)()],Ht.prototype,"showGrid",null),(0,a._)([(0,r.Cb)()],Ht.prototype,"editable",null),Ht=(0,a._)([(0,l.j)("esri.views.3d.analysis.SliceAnalysisView3D")],Ht);const Nt=Ht},81536:(e,t,i)=>{i.d(t,{J4:()=>f,_N:()=>y,gv:()=>_});var a,s=i(61681),n=i(95550),r=(i(6766),i(8909)),o=(i(90472),i(69430)),l=i(97537),d=(i(5700),i(68817)),c=(i(83772),i(40460)),u=i(8927),h=i(20757),p=i(5073);i(34108);function y(e,t){return g(e,(()=>t))}function g(e,t){const i=(0,r.c)(),a=(0,r.c)();let l=!1;return r=>{const u=t(r);if("start"===r.action){const t=(0,n.md)(r.screenStart,(0,n.c$)(d.qW.get())),a=(0,c.u4)(e.state.camera,t,v);(0,s.pC)(a)&&(l=(0,o.BR)(u,a,i))}if(!l)return null;const h=(0,n.md)(r.screenEnd,(0,n.c$)(d.qW.get())),p=(0,c.u4)(e.state.camera,h,v);return(0,s.Wi)(p)?null:(0,o.BR)(u,p,a)?{...r,renderStart:i,renderEnd:a,plane:u,ray:p}:null}}function f(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,s.pC)(t)&&(t.remove(),t=null)}return i}}function _(e,t=null){const i=(0,u.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=h.eC.MIN,i.options.hud=!1;const o=(0,n.s1)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,r.c)(),c=(0,s.Pt)(t,e.spatialReference),y=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(p.cy):l.exclude.delete(p.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,n.md)(t,o),i,l);const s=i.results.min;let r;if(s.getIntersectionPoint(d))r=s.intersector===h.q7.TERRAIN?a.GROUND:a.OTHER;else{if(!i.results.ground.getIntersectionPoint(d))return null;r=a.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,c),surfaceType:r}};let g;return e=>{if("start"===e.action){const t=y(e.screenStart);g=(0,s.pC)(t)?t.location:null}if((0,s.Wi)(g))return null;const t=y(e.screenEnd);return(0,s.pC)(t)&&(0,s.pC)(t.location)?{...e,mapStart:g,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(a||(a={}));(0,r.c)(),(0,r.c)();const v=(0,l.Ue)()}}]);