"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[3185],{71200:(e,t,a)=>{a.d(t,{k3:()=>s,s5:()=>n,vX:()=>o});Number.POSITIVE_INFINITY,Math.PI;const i=1/Math.LN2;function r(e,t){return(e%=t)>=0?e:e+t}function n(e){return r(.7111111111111111*e,256)}function s(e){return Math.log(e)*i}function o(e,t,a){return e>=t&&e<=a||e>=a&&e<=t}},29316:(e,t,a)=>{a.d(t,{Z:()=>i});class i{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,a){}drawMany(e,t,a){for(const i of t)i.visible&&this.draw(e,i,a)}}},10929:(e,t,a)=>{a.d(t,{J:()=>g});var i=a(19431),r=a(61681),n=a(19710),s=a(18916),o=a(14266),l=a(38716),c=a(8530),f=a(29316),u=a(78951),d=a(91907),p=a(29620);class g extends f.Z{constructor(){super(...arguments),this._color=(0,s.f)(1,0,0,1),this._patternMatrix=(0,n.c)(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(e,t){const{context:a,painter:n,styleLayerUID:s,requestRender:f,allowDelayedRender:u}=e;this._loadWGLResources(e);const p=e.displayLevel,g=e.styleLayer,m=g.backgroundMaterial,_=n.vectorTilesMaterialManager,y=g.getPaintValue("background-color",p),M=g.getPaintValue("background-opacity",p),h=g.getPaintValue("background-pattern",p),v=void 0!==h,E=y[3]*M,U=1|window.devicePixelRatio,P=e.spriteMosaic;let x,T;const I=U>o.a?2:1,w=e.drawPhase===l.jx.HITTEST,R=this._programOptions;R.id=w,R.pattern=v;const D=_.getMaterialProgram(a,m,R);if(u&&(0,r.pC)(f)&&!D.isCompiled)f();else{if(a.bindVAO(this._vao),a.useProgram(D),v){const e=P.getMosaicItemPosition(h,!0);if((0,r.pC)(e)){const{tl:t,br:i,page:n}=e;x=i[0]-t[0],T=i[1]-t[1];const s=P.getPageSize(n);(0,r.pC)(s)&&(P.bind(a,d.cw.LINEAR,n,o.V4),D.setUniform4f("u_tlbr",t[0],t[1],i[0],i[1]),D.setUniform2fv("u_mosaicSize",s),D.setUniform1i("u_texture",o.V4))}D.setUniform1f("u_opacity",M)}else this._color[0]=E*y[0],this._color[1]=E*y[1],this._color[2]=E*y[2],this._color[3]=E,D.setUniform4fv("u_color",this._color);if(D.setUniform1f("u_depth",g.z||0),w){const e=(0,c.Au)(s+1);D.setUniform4fv("u_id",e)}for(const e of t){if(D.setUniform1f("u_coord_range",e.rangeX),D.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),v){const t=Math.max(2**(Math.round(p)-e.key.level),1),a=I*e.width*t,r=a/(0,i.fp)(x),n=a/(0,i.fp)(T);this._patternMatrix[0]=r,this._patternMatrix[4]=n,D.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}a.setStencilFunction(d.wb.EQUAL,0,255),a.drawArrays(d.MX.TRIANGLE_STRIP,0,4)}}}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:a}=e,i=a.backgroundMaterial,r=new Int8Array([0,0,1,0,0,1,1,1]),n=u.f.createVertex(t,d.l1.STATIC_DRAW,r),s=new p.U(t,i.getAttributeLocations(),i.getLayoutInfo(),{geometry:n});this._vao=s}}},92677:(e,t,a)=>{a.d(t,{j:()=>c});var i=a(61681),r=a(93712),n=a(38716),s=a(8530),o=a(29316),l=a(91907);class c extends o.Z{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:o,requiredLevel:c,state:f,drawPhase:u,painter:d,spriteMosaic:p,styleLayerUID:g,requestRender:m,allowDelayedRender:_}=e;if(!t.some((e=>e.layerData.get(g)?.circleIndexCount??!1)))return;const y=e.styleLayer,M=y.circleMaterial,h=d.vectorTilesMaterialManager,v=y.getPaintValue("circle-translate",o),E=y.getPaintValue("circle-translate-anchor",o),U=u===n.jx.HITTEST,P=this._programOptions;P.id=U;const x=h.getMaterialProgram(a,M,P);if(_&&(0,i.pC)(m)&&!x.isCompiled)return void m();a.useProgram(x),x.setUniformMatrix3fv("u_displayMat3",E===r.fD.VIEWPORT?f.displayMat3:f.displayViewMat3),x.setUniform2fv("u_circleTranslation",v),x.setUniform1f("u_depth",y.z),x.setUniform1f("u_antialiasingWidth",1.2);let T=-1;if(U){const e=(0,s.Au)(g+1);x.setUniform4fv("u_id",e)}for(const e of t){if(!e.layerData.has(g))continue;e.key.level!==T&&(T=e.key.level,M.setDataUniforms(x,o,y,T,p));const t=e.layerData.get(g);if(!t.circleIndexCount)continue;t.prepareForRendering(a);const r=t.circleVertexArrayObject;(0,i.Wi)(r)||(a.bindVAO(r),x.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),c!==e.key.level?a.setStencilFunction(l.wb.EQUAL,e.stencilRef,255):a.setStencilFunction(l.wb.GREATER,255,255),a.drawElements(l.MX.TRIANGLES,t.circleIndexCount,l.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}}},28035:(e,t,a)=>{a.d(t,{R:()=>u});var i=a(61681),r=a(93712),n=a(14266),s=a(38716),o=a(8530),l=a(29316),c=a(91907);const f=1/65536;class u extends l.Z{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:a,drawPhase:i,renderPass:r,spriteMosaic:n,styleLayerUID:l}=e;let c=!1;for(const e of t)if(e.layerData.has(l)){const t=e.layerData.get(l);if(t.fillIndexCount>0||t.outlineIndexCount>0){c=!0;break}}if(!c)return;const f=e.styleLayer,u=f.getPaintProperty("fill-pattern"),d=void 0!==u,p=d&&u.isDataDriven;let g;if(d&&!p){const e=u.getValue(a);g=n.getMosaicItemPosition(e,!0)}const m=!d&&f.getPaintValue("fill-antialias",a);let _,y=!0,M=1;if(!d){const e=f.getPaintProperty("fill-color"),t=f.getPaintProperty("fill-opacity");if(!e?.isDataDriven&&!t?.isDataDriven){const e=f.getPaintValue("fill-color",a);M=f.getPaintValue("fill-opacity",a)*e[3],M>=1&&(y=!1)}}if(y&&"opaque"===r)return;i===s.jx.HITTEST&&(_=(0,o.Au)(l+1));const h=f.getPaintValue("fill-translate",a),v=f.getPaintValue("fill-translate-anchor",a);(y||"translucent"!==r)&&this._drawFill(e,l,f,t,h,v,d,g,p,_);const E=!f.hasDataDrivenOutlineColor&&f.outlineUsesFillColor&&M<1;m&&"opaque"!==r&&!E&&this._drawOutline(e,l,f,t,h,v,_)}_drawFill(e,t,a,o,l,u,d,p,g,m){if(d&&!g&&(0,i.Wi)(p))return;const{context:_,displayLevel:y,state:M,drawPhase:h,painter:v,pixelRatio:E,spriteMosaic:U,requestRender:P,allowDelayedRender:x}=e,T=a.fillMaterial,I=v.vectorTilesMaterialManager,w=E>n.a?2:1,R=h===s.jx.HITTEST,D=this._fillProgramOptions;D.id=R,D.pattern=d;const S=I.getMaterialProgram(_,T,D);if(x&&(0,i.pC)(P)&&!S.isCompiled)return void P();if(_.useProgram(S),(0,i.pC)(p)){const{page:e}=p,t=U.getPageSize(e);(0,i.pC)(t)&&(U.bind(_,c.cw.LINEAR,e,n.V4),S.setUniform2fv("u_mosaicSize",t),S.setUniform1i("u_texture",n.V4))}S.setUniformMatrix3fv("u_displayMat3",u===r.fD.VIEWPORT?M.displayMat3:M.displayViewMat3),S.setUniform2fv("u_fillTranslation",l),S.setUniform1f("u_depth",a.z+f),R&&S.setUniform4fv("u_id",m);let V=-1;for(const e of o){if(!e.layerData.has(t))continue;e.key.level!==V&&(V=e.key.level,T.setDataUniforms(S,y,a,V,U));const r=e.layerData.get(t);if(!r.fillIndexCount)continue;r.prepareForRendering(_);const s=r.fillVertexArrayObject;if(!(0,i.Wi)(s)){if(_.bindVAO(s),S.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),_.setStencilFunction(c.wb.EQUAL,e.stencilRef,255),d){const t=Math.max(2**(Math.round(y)-e.key.level),1),a=e.rangeX/(w*e.width*t);S.setUniform1f("u_patternFactor",a)}if(g){const e=r.patternMap;if(!e)continue;for(const[t,a]of e){const e=U.getPageSize(t);(0,i.pC)(e)&&(U.bind(_,c.cw.LINEAR,t,n.V4),S.setUniform2fv("u_mosaicSize",e),S.setUniform1i("u_texture",n.V4),_.drawElements(c.MX.TRIANGLES,a[1],c.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else _.drawElements(c.MX.TRIANGLES,r.fillIndexCount,c.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.fillIndexStart);e.triangleCount+=r.fillIndexCount/3}}}_drawOutline(e,t,a,n,o,l,u){const{context:d,displayLevel:p,state:g,drawPhase:m,painter:_,pixelRatio:y,spriteMosaic:M,requestRender:h,allowDelayedRender:v}=e,E=a.outlineMaterial,U=_.vectorTilesMaterialManager,P=.75/y,x=m===s.jx.HITTEST,T=this._outlineProgramOptions;T.id=x;const I=U.getMaterialProgram(d,E,T);if(v&&(0,i.pC)(h)&&!I.isCompiled)return void h();d.useProgram(I),I.setUniformMatrix3fv("u_displayMat3",l===r.fD.VIEWPORT?g.displayMat3:g.displayViewMat3),I.setUniform2fv("u_fillTranslation",o),I.setUniform1f("u_depth",a.z+f),I.setUniform1f("u_outline_width",P),x&&I.setUniform4fv("u_id",u);let w=-1;for(const e of n){if(!e.layerData.has(t))continue;e.key.level!==w&&(w=e.key.level,E.setDataUniforms(I,p,a,w,M));const r=e.layerData.get(t);if(r.prepareForRendering(d),!r.outlineIndexCount)continue;const n=r.outlineVertexArrayObject;(0,i.Wi)(n)||(d.bindVAO(n),I.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),d.setStencilFunction(c.wb.EQUAL,e.stencilRef,255),d.drawElements(c.MX.TRIANGLES,r.outlineIndexCount,c.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.outlineIndexStart),e.triangleCount+=r.outlineIndexCount/3)}}}},87190:(e,t,a)=>{a.d(t,{z:()=>f});var i=a(61681),r=a(93712),n=a(14266),s=a(38716),o=a(8530),l=a(29316),c=a(91907);class f extends l.Z{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,t){const{context:a,displayLevel:l,state:f,drawPhase:u,painter:d,pixelRatio:p,spriteMosaic:g,styleLayerUID:m,requestRender:_,allowDelayedRender:y}=e;if(!t.some((e=>e.layerData.get(m)?.lineIndexCount??!1)))return;const M=e.styleLayer,h=M.lineMaterial,v=d.vectorTilesMaterialManager,E=M.getPaintValue("line-translate",l),U=M.getPaintValue("line-translate-anchor",l),P=M.getPaintProperty("line-pattern"),x=void 0!==P,T=x&&P.isDataDriven;let I,w;if(x&&!T){const e=P.getValue(l);I=g.getMosaicItemPosition(e)}let R=!1;if(!x){const e=M.getPaintProperty("line-dasharray");if(w=void 0!==e,R=w&&e.isDataDriven,w&&!R){const t=e.getValue(l),a=M.getDashKey(t,M.getLayoutValue("line-cap",l));I=g.getMosaicItemPosition(a)}}const D=1/p,S=u===s.jx.HITTEST,V=this._programOptions;V.id=S,V.pattern=x,V.sdf=w;const A=v.getMaterialProgram(a,h,V);if(y&&(0,i.pC)(_)&&!A.isCompiled)return void _();if(a.useProgram(A),A.setUniformMatrix3fv("u_displayViewMat3",f.displayViewMat3),A.setUniformMatrix3fv("u_displayMat3",U===r.fD.VIEWPORT?f.displayMat3:f.displayViewMat3),A.setUniform2fv("u_lineTranslation",E),A.setUniform1f("u_depth",M.z),A.setUniform1f("u_antialiasing",D),S){const e=(0,o.Au)(m+1);A.setUniform4fv("u_id",e)}if(I&&(0,i.pC)(I)){const{page:e}=I,t=g.getPageSize(e);(0,i.pC)(t)&&(g.bind(a,c.cw.LINEAR,e,n.V4),A.setUniform2fv("u_mosaicSize",t),A.setUniform1i("u_texture",n.V4))}let L=-1;for(const e of t){if(!e.layerData.has(m))continue;e.key.level!==L&&(L=e.key.level,h.setDataUniforms(A,l,M,L,g));const t=2**(l-L)/p;A.setUniform1f("u_zoomFactor",t);const r=e.layerData.get(m);if(!r.lineIndexCount)continue;r.prepareForRendering(a);const s=r.lineVertexArrayObject;if(!(0,i.Wi)(s)){if(a.bindVAO(s),A.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),a.setStencilFunction(c.wb.EQUAL,e.stencilRef,255),T||R){const e=r.patternMap;if(!e)continue;for(const[t,r]of e){const e=g.getPageSize(t);(0,i.pC)(e)&&(g.bind(a,c.cw.LINEAR,t,n.V4),A.setUniform2fv("u_mosaicSize",e),A.setUniform1i("u_texture",n.V4),a.drawElements(c.MX.TRIANGLES,r[1],c.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]))}}else a.drawElements(c.MX.TRIANGLES,r.lineIndexCount,c.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);e.triangleCount+=r.lineIndexCount/3}}}}},96049:(e,t,a)=>{a.d(t,{e:()=>p});var i=a(61681),r=a(55542),n=a(2509),s=a(93712),o=a(14266),l=a(38716),c=a(71200),f=a(8530),u=a(29316),d=a(91907);class p extends u.Z{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=(0,r.c)()}dispose(){}drawMany(e,t){const{drawPhase:a,styleLayerUID:i}=e,r=e.styleLayer;let n;a===l.jx.HITTEST&&(n=(0,f.Au)(i+1)),this._drawIcons(e,r,t,n),this._drawText(e,r,t,n)}_drawIcons(e,t,a,r){const{context:f,displayLevel:u,drawPhase:d,painter:p,spriteMosaic:g,state:m,styleLayerUID:_,requestRender:y,allowDelayedRender:M}=e,h=t.iconMaterial,v=p.vectorTilesMaterialManager;let E,U=!1;for(const e of a)if(e.layerData.has(_)&&(E=e.layerData.get(_),E.iconPerPageElementsMap.size>0)){U=!0;break}if(!U)return;const P=t.getPaintValue("icon-translate",u),x=t.getPaintValue("icon-translate-anchor",u);let T=t.getLayoutValue("icon-rotation-alignment",u);T===s.aF.AUTO&&(T=t.getLayoutValue("symbol-placement",u)===s.R.POINT?s.aF.VIEWPORT:s.aF.MAP);const I=T===s.aF.MAP,w=t.getLayoutValue("icon-keep-upright",u)&&I,R=E.isIconSDF,D=d===l.jx.HITTEST,S=this._iconProgramOptions;S.id=D,S.sdf=R;const V=v.getMaterialProgram(f,h,S);if(M&&(0,i.pC)(y)&&!V.isCompiled)return void y();f.useProgram(V),V.setUniformMatrix3fv("u_displayViewMat3",T===s.aF.MAP?m.displayViewMat3:m.displayMat3),V.setUniformMatrix3fv("u_displayMat3",x===s.fD.VIEWPORT?m.displayMat3:m.displayViewMat3),V.setUniform2fv("u_iconTranslation",P),V.setUniform1f("u_depth",t.z),V.setUniform1f("u_mapRotation",(0,c.s5)(m.rotation)),V.setUniform1f("u_keepUpright",w?1:0),V.setUniform1f("u_level",10*u),V.setUniform1i("u_texture",o.V4),V.setUniform1f("u_fadeDuration",n.nN/1e3),D&&V.setUniform4fv("u_id",r);let A=-1;for(const r of a){if(!r.layerData.has(_))continue;if(r.key.level!==A&&(A=r.key.level,h.setDataUniforms(V,u,t,A,g)),E=r.layerData.get(_),0===E.iconPerPageElementsMap.size)continue;E.prepareForRendering(f),E.updateOpacityInfo();const a=E.iconVertexArrayObject;if(!(0,i.Wi)(a)){f.bindVAO(a),V.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs),V.setUniform1f("u_time",(performance.now()-E.lastOpacityUpdate)/1e3);for(const[t,a]of E.iconPerPageElementsMap)this._renderIconRange(e,V,a,t,r)}}}_renderIconRange(e,t,a,i,r){const{context:n,spriteMosaic:s}=e;this._spritesTextureSize[0]=s.getWidth(i)/4,this._spritesTextureSize[1]=s.getHeight(i)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),s.bind(n,d.cw.LINEAR,i,o.V4),n.setStencilTestEnabled(!0),n.setStencilFunction(d.wb.GREATER,255,255),n.setStencilWriteMask(0),n.drawElements(d.MX.TRIANGLES,a[1],d.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]),r.triangleCount+=a[1]/3}_drawText(e,t,a,f){const{context:u,displayLevel:p,drawPhase:g,glyphMosaic:m,painter:_,pixelRatio:y,spriteMosaic:M,state:h,styleLayerUID:v,requestRender:E,allowDelayedRender:U}=e,P=t.textMaterial,x=_.vectorTilesMaterialManager;let T,I=!1;for(const e of a)if(e.layerData.has(v)&&(T=e.layerData.get(v),T.glyphPerPageElementsMap.size>0)){I=!0;break}if(!I)return;const w=t.getPaintProperty("text-opacity");if(w&&!w.isDataDriven&&0===w.getValue(p))return;const R=t.getPaintProperty("text-color"),D=!R||R.isDataDriven||R.getValue(p)[3]>0,S=t.getPaintProperty("text-halo-width"),V=t.getPaintProperty("text-halo-color"),A=(!S||S.isDataDriven||S.getValue(p)>0)&&(!V||V.isDataDriven||V.getValue(p)[3]>0);if(!D&&!A)return;let L=t.getLayoutValue("text-rotation-alignment",p);L===s.aF.AUTO&&(L=t.getLayoutValue("symbol-placement",p)===s.R.POINT?s.aF.VIEWPORT:s.aF.MAP);const N=L===s.aF.MAP,C=t.getLayoutValue("text-keep-upright",p)&&N,b=g===l.jx.HITTEST,O=.8*3/y;this._glyphTextureSize||(this._glyphTextureSize=(0,r.f)(m.width/4,m.height/4));const k=t.getPaintValue("text-translate",p),F=t.getPaintValue("text-translate-anchor",p),z=this._sdfProgramOptions;z.id=b;const G=x.getMaterialProgram(u,P,z);if(U&&(0,i.pC)(E)&&!G.isCompiled)return void E();u.useProgram(G),G.setUniformMatrix3fv("u_displayViewMat3",L===s.aF.MAP?h.displayViewMat3:h.displayMat3),G.setUniformMatrix3fv("u_displayMat3",F===s.fD.VIEWPORT?h.displayMat3:h.displayViewMat3),G.setUniform2fv("u_textTranslation",k),G.setUniform1f("u_depth",t.z+152587890625e-16),G.setUniform2fv("u_mosaicSize",this._glyphTextureSize),G.setUniform1f("u_mapRotation",(0,c.s5)(h.rotation)),G.setUniform1f("u_keepUpright",C?1:0),G.setUniform1f("u_level",10*p),G.setUniform1i("u_texture",o.CU),G.setUniform1f("u_antialiasingWidth",O),G.setUniform1f("u_fadeDuration",n.nN/1e3),b&&G.setUniform4fv("u_id",f);let W=-1;for(const e of a){if(!e.layerData.has(v))continue;if(e.key.level!==W&&(W=e.key.level,P.setDataUniforms(G,p,t,W,M)),T=e.layerData.get(v),0===T.glyphPerPageElementsMap.size)continue;T.prepareForRendering(u),T.updateOpacityInfo();const a=T.textVertexArrayObject;if((0,i.Wi)(a))continue;u.bindVAO(a),G.setUniformMatrix3fv("u_dvsMat3",e.transforms.dvs),u.setStencilTestEnabled(!0),u.setStencilFunction(d.wb.GREATER,255,255),u.setStencilWriteMask(0);const r=(performance.now()-T.lastOpacityUpdate)/1e3;G.setUniform1f("u_time",r),T.glyphPerPageElementsMap.forEach(((t,a)=>{this._renderGlyphRange(u,t,a,m,G,A,D,e)}))}}_renderGlyphRange(e,t,a,i,r,n,s,l){i.bind(e,d.cw.LINEAR,a,o.CU),n&&(r.setUniform1f("u_halo",1),e.drawElements(d.MX.TRIANGLES,t[1],d.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3),s&&(r.setUniform1f("u_halo",0),e.drawElements(d.MX.TRIANGLES,t[1],d.g.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),l.triangleCount+=t[1]/3)}}},78311:(e,t,a)=>{a.d(t,{B:()=>i});class i{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const a=this._read(e);if(!a)throw new Error(`cannot find shader file ${e}`);const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let r=i.exec(a);const n=[];for(;null!=r;)n.push({path:r[1],start:r.index,length:r[0].length}),r=i.exec(a);let s=0,o="";return n.forEach((e=>{o+=a.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length})),o+=a.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}}}}]);