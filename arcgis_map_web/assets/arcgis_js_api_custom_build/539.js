"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[539],{59468:(t,e,i)=>{function a(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function n(t,e){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,i=0;for(let a=0;a<t.length;a++){const n=t[a].size;"number"==typeof n&&(e+=n,i++)}return e/i}(t.stops):e}function s(t,e){if(!e)return t;const i=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:i,minSize:a}=e;return(n(i,t)+n(a,t))/2}));let a=0;const s=i.length;if(0===s)return t;for(let t=0;t<s;t++)a+=i[t];const o=Math.floor(a/s);return Math.max(o,t)}function o(t){const e=t&&t.renderer,i="touch"===(t&&t.event&&t.event.pointerType)?9:6;if(!e)return i;const n="visualVariables"in e?s(i,e.visualVariables):i;if("simple"===e.type)return a(n,e.symbol);if("unique-value"===e.type){let t=n;return e.uniqueValueInfos?.forEach((e=>{t=a(t,e.symbol)})),t}if("class-breaks"===e.type){let t=n;return e.classBreakInfos.forEach((e=>{t=a(t,e.symbol)})),t}return"dot-density"===e.type||e.type,n}i.d(e,{k:()=>o})},40539:(t,e,i)=>{i.r(e),i.d(e,{DrawGraphicTool3D:()=>j,ExtentTransformTool:()=>Ai,GraphicMoveTool:()=>ve,GraphicReshapeTool:()=>Ye,GraphicTransformTool:()=>ui});var a=i(36663),n=i(23148),s=i(61681),o=i(76868),r=i(81977),l=i(7753),p=(i(7283),i(40266)),h=i(6766),c=i(8909),d=i(83772),u=i(74710),g=i(95550),_=(i(13802),i(70375),i(39994)),m=i(53443),v=i(67979),y=i(78668),f=i(10145),b=i(17321),M=i(55709),S=i(69666),x=i(38028),C=i(60720),w=i(65771),E=i(54682);const O={default:15,far:25};let A=class extends m.Z{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=(0,v.vr)((async t=>{const e=await(0,C.ME)("esri/core/t9n/Units");(0,y.k_)(t),this._messagesUnits=e})),e=()=>(0,s.yw)(this.context,(t=>t.editGeometryOperations));this.addHandles([(0,o.YP)((()=>[(0,s.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((t=>(0,o.on)(e,t,(()=>this._update())))),(0,n.kB)((()=>t.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,s.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((t=>t.label.text))}}get _edgeDistancePixels(){return O[this.edgeDistance]}_update(){this._nextLabelIndex=0;const t=this.context;if((0,s.Wi)(t))return void this._destroyUnusedLabels();const{components:e,geometry:i,coordinateHelper:a}=t.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const n=e.length;for(let o=0;o<n;++o){const r=[];if(e[o].iterateVertices((t=>{r.push(a.toXYZ(t.pos))})),0===o&&(0,s.pC)(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],p=r[r.length-1];"polygon"===i.type&&r.length>2&&!(0,h.F)(l,p)&&r.push(l);const c=1===n&&!(0,x.bu)(r,!1,!1);let d=D,u=R;this.toScreenPointArray(t,l,d);for(let e=1;e<r.length;++e){const i=r[e-1],a=r[e];this.toScreenPointArray(t,a,u),this._addLabel(t,i,d,a,u,c),[d,u]=[u,d]}}this._destroyUnusedLabels()}_addLabel(t,e,i,a,n,o){const{label:r}=this._getOrCreateLabel(t);if(!this.visible||(0,M.k)(i,n)<3025)return void(r.visible=!1);const l=(0,s.pC)(t.graphicState)?t.graphicState.isDraped?"on-the-ground":"absolute-height":(0,d.VW)(t.editGeometryOperations.data.geometry,t.elevationInfo),{spatialReference:p}=t.editGeometryOperations.data,h=(0,E.MU)(e,a,p,l),c=this._messagesUnits,u=(0,b.RG)(t.view);r.text=(0,s.pC)(c)&&(0,s.pC)(h)?(0,f.N9)(c,h,u):"",r.visible=!0;const g=n[0]-i[0],_=n[1]-i[1];o?(0,M.s)(T,-_,g):(0,M.s)(T,_,-g),(0,M.f)(T,T),(0,M.b)(T,T,this._edgeDistancePixels),(0,M.l)(G,i,n,.5),(0,M.j)(G,G,T),r.position=[G[0],G[1]],Math.abs(T[0])>Math.abs(T[1])?r.anchor=T[0]>0?"left":"right":r.anchor=-T[1]<0?"top":"bottom"}_getOrCreateLabel(t){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const e=new w.Z({fontSize:10,anchor:"center"});t.view.overlay.items.add(e);const i={label:e};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){(0,s.yw)(this.context,(e=>e.view.overlay.items.remove(t))),t.destroy()}};(0,a._)([(0,r.Cb)()],A.prototype,"context",void 0),(0,a._)([(0,r.Cb)()],A.prototype,"stagedVertex",void 0),(0,a._)([(0,r.Cb)()],A.prototype,"visible",void 0),(0,a._)([(0,r.Cb)()],A.prototype,"edgeDistance",void 0),(0,a._)([(0,r.Cb)()],A.prototype,"updating",null),(0,a._)([(0,r.Cb)()],A.prototype,"_messagesUnits",void 0),(0,a._)([(0,r.Cb)()],A.prototype,"_edgeDistancePixels",null),A=(0,a._)([(0,p.j)("esri.views.interactive")],A);const T=(0,S.a)(),G=(0,S.a)(),D=(0,g.s1)(),R=(0,g.s1)();var P=i(86);let I=class extends A{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:e,editGeometryOperations:i},a,n=(0,g.s1)()){const{spatialReference:s}=i.data.coordinateHelper;return(0,P.RS)(a,s,e,t,L),t.state.camera.projectToScreen(L,n),n}};I=(0,a._)([(0,p.j)("esri.views.3d.interactive.SegmentLabels3D")],I);const L=(0,c.c)();var V=i(56264),z=i(13540),X=i(56885),W=i(15230),Z=i(92144),k=i(63669),N=i(29642),Y=i(75354),H=i(7358),U=i(86493),F=i(84703),B=i(15991);let j=class extends U.T{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new u.Z({mode:t,offset:e})}normalizeCtorArgs(t){if(!t.elevationInfo){const e=t.hasZ??!0;return{...t,elevationInfo:(0,d.mF)(e)}}return t}initializeGraphic(t){const e=this._createGraphicState=new Y.F({graphic:t});return(0,n.AL)([this.view.maskOccludee(t),this.view.trackGraphicState(e),(0,o.YP)((()=>({element:this._outlineVisualElement,isDraped:e.isDraped})),(({element:t,isDraped:e})=>{(0,s.yw)(t,(t=>t.isDraped=e))}),o.nn)])}makeDrawOperation(){const{geometryType:t}=this,e="circle"!==t&&"rectangle"!==t;return new F.w({view:this.view,manipulators:this.manipulators,geometryType:(0,U.I)(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new B.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new B.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new V._,segmentLabels:e?new I:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,s.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,d.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(t){const{view:e}=this;return(0,s.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],this._updateVerticalLineVisualElement(t),null):(this._activeVertexVisualElement=new Z.j({view:e,spatialReference:e.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:z.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=z.Xd.colorToVec4(z.Xd.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new X.V({view:e,extensionType:z.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:H.yD.OccludeAndTransparent}),z.Xd.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,n.kB)((()=>{this._activeVertexVisualElement=(0,s.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,s.SC)(this._verticalLineVisualElement)})))}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if((0,s.Wi)(e))return;const{renderCoordsHelper:i,spatialReference:a,elevationProvider:n}=this.view;(0,h.s)(q,t[0],t[1],t[2]),Q.setFromElevationInfo(this.elevationInfo),q[2]=(0,k.w7)(q,n,Q,i),i.toRenderCoords(q,a,q)?(e.setStartEndFromWorldDownAtLocation(q),e.attached=!0):e.attached=!1}onOutlineChanged(t){if((0,s.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const e=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new W.k({view:this.view,geometry:t,elevationInfo:e,isDraped:(0,s.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,d.Zz)(this.hasZ,e),attached:!1}),z.Xd.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),z.Xd.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,n.kB)((()=>{this._outlineVisualElement=(0,s.SC)(this._outlineVisualElement)}))}onRegularVerticesChanged(t){return(0,s.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new Z.j({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:z.Xd.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,n.kB)((()=>{this._verticesVisualElement=(0,s.SC)(this._verticesVisualElement)})))}};(0,a._)([(0,r.Cb)({constructOnly:!0})],j.prototype,"elevationInfo",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],j.prototype,"geometryType",void 0),(0,a._)([(0,r.Cb)()],j.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],j.prototype,"view",void 0),j=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],j);const Q=new N.o,q=(0,c.c)();var J,$,K=i(41831),tt=i(31355),et=i(53280),it=i(39405),at=i(48358),nt=i(74390),st=i(4506),ot=i(41652),rt=i(19431),lt=i(46707);!function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"}(J||(J={})),function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"}($||($={}));class pt{constructor(){this.grabbingState=J.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=J.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator(((t,e)=>{if(e===$.TRANSLATE_Z&&(this.zManipulator=t),t instanceof lt.Z&&(t.selected&&(0===this.numSelected&&(this.firstSelected=t),this.numSelected++),(0,s.Wi)(this.firstGrabbedXY)&&t.grabbing&&e===$.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=J.ANY,e){case $.TRANSLATE_Z:this.grabbingState|=J.Z;break;case $.TRANSLATE_XY:this.grabbingState|=J.XY}}))}}var ht=i(40199);function ct(t){const{view:e,graphic:i}=t,a=new Y.F({graphic:i}),s=function(t,e){const{view:i,graphic:a}=t,s=new W.k({view:i,geometry:gt(a)?a.geometry:null,elevationInfo:(0,d.RL)(a),attached:!1});z.Xd.visualElements.lineGraphics.shadowStyle.apply(s);const r=()=>{s.attached=e.displaying};z.Xd.visualElements.lineGraphics.outline.apply(s);const l=[(0,o.YP)((()=>e.displaying),r),(0,o.YP)((()=>e.isDraped),(t=>{s.isDraped=t})),e.on("changed",(()=>s.geometry=gt(a)?a.geometry:null)),(0,n.ed)(s)];return r(),{visualElement:s,remove:()=>(0,n.AL)(l).remove()}}(t,a),r=[s,dt(t,s.visualElement,a),e.maskOccludee(i),e.trackGraphicState(a)];return{visualElement:s.visualElement,remove:()=>(0,n.AL)(r).remove()}}function dt(t,e,i){const{graphic:a,view:r}=t,l=[],p=(0,d.RL)(a),h="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,c=new pt,u=new X.V({view:r,extensionType:z.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:H.yD.OccludeAndTransparent});z.Xd.visualElements.pointGraphics.shadowStyle.apply(u);const g=(0,rt.Vl)(z.Xd.visualElements.heightPlaneAngleCutoff),_=new ht.W({view:r,attached:!1,angleCutoff:g});z.Xd.visualElements.heightPlane.apply(_);let m=1,v=1;const y=()=>{if(c.update(t),!i.displaying||h&&(i.isDraped||!gt(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,u.attached=!1,void(_.attached=!1);e.laserlineEnabled=!0;{const t=c.grabbingState&J.XY?z.Xd.visualElements.laserlineAlphaMultiplier:1;t!==m&&(m=t,z.Xd.visualElements.lineGraphics.shadowStyle.apply(e,t),z.Xd.visualElements.pointGraphics.shadowStyle.apply(u,t))}{const t=c.grabbingState&J.Z?z.Xd.visualElements.laserlineAlphaMultiplier:1;t!==v&&(v=t,z.Xd.visualElements.heightPlane.apply(_,t))}(function(t,e){const i=1===e.numSelected?e.firstSelected:e.numSelected>1&&(0,s.pC)(e.firstGrabbedXY)?e.firstGrabbedXY:null;(0,s.pC)(i)?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1})(u,c),ut(t,e,_,c)};z.Xd.visualElements.zVerticalLine.apply(u),l.push(i.on("changed",y),(0,o.YP)((()=>i.displaying),y),e.events.on("attachment-origin-changed",y),(0,n.ed)(u),(0,n.ed)(_));const f=[],b=()=>{(0,n.AL)(f).remove(),f.length=0,t.forEachManipulator((t=>f.push(t.events.on("grab-changed",y)))),t.forEachManipulator((t=>f.push(t.events.on("select-changed",y)))),y()};return b(),l.push(t.onManipulatorsChanged(b),(0,n.iU)((()=>(0,n.AL)(f)))),(0,n.AL)(l)}function ut(t,e,i,a){if(a.numSelected>0){(0,h.s)(_t,0,0,0);let e=0;t.forEachManipulator(((t,i)=>{i===$.TRANSLATE_XY&&t.selected&&t instanceof lt.Z&&((0,h.a)(_t,_t,t.renderLocation),e++)})),e>0?(i.heightManifoldTarget=(0,h.g)(_t,_t,1/e),i.attached=!0):i.attached=!1}else{const a=e.attachmentOrigin;(0,s.pC)(a)&&t.view.renderCoordsHelper.toRenderCoords(a,_t)?(i.heightManifoldTarget=_t,i.attached=!0):i.attached=!1}}function gt(t){return(0,s.pC)(t.geometry)&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)}const _t=(0,c.c)();var mt=i(90472),vt=i(37116),yt=i(24568),ft=i(26653);function bt(t){const{view:e,graphic:i}=t,a=new Y.F({graphic:i}),r=[],l=function(t,e,i){const{view:a,graphic:r}=t,l=new ft.L({view:a,geometry:Mt(r),elevationInfo:(0,d.RL)(r),attached:!1});return function(t,e,i,a){const r=()=>e.attached=i.displaying;(function(t,e,i,a){const{view:o,graphic:r}=t;let l=null;const p=t=>{(0,s.pC)(l)&&(l.remove(),l=null),i.isDraped&&(0,s.pC)(t)&&(l=function(t,e,i){const a=t.elevationProvider.spatialReference;(0,mt.KC)(e,St,a);const n=St[0],s=St[1];return t.elevationProvider.on("elevation-change",(t=>{(0,yt.jE)(t.extent,n,s)&&i()}))}(o,t,(()=>{e.geometry=t})))},h=()=>{const t=Mt(r);p(t),e.geometry=t};a.push(i.on("changed",h),(0,n.iU)((()=>l))),h()})(t,e,i,a),z.Xd.visualElements.pointGraphics.outline.apply(e),a.push((0,o.YP)((()=>i.displaying),r,o.nn))}(t,l,e,i),i.push((0,n.ed)(l)),l}(t,a,r);return function(t,e,i,a){const{view:r,graphic:l}=t,p=new X.V({view:r,extensionType:z.Xd.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:H.yD.OccludeAndTransparent});z.Xd.visualElements.zVerticalLine.apply(p);const c=new ht.W({view:r,intersectsLineInfinite:!0,attached:!1});z.Xd.visualElements.pointGraphics.shadowStyle.apply(c);const u=(0,rt.Vl)(z.Xd.visualElements.heightPlaneAngleCutoff),g=new ht.W({view:r,attached:!1,angleCutoff:u});z.Xd.visualElements.heightPlane.apply(g);const _=(0,d.RL)(t.graphic),m=N.o.fromElevationInfo(_),v="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,y=new pt;let f=1,b=1;const M=()=>{y.update(t);const i=Mt(l),n=v&&(e.isDraped||(0,s.Wi)(i)||!i.hasZ);let o=!0;if(!n&&(0,s.pC)(i)){const t=(0,k.w7)(i,r.elevationProvider,m,r.renderCoordsHelper);(0,h.s)(St,i.x,i.y,t),(0,mt.SH)(St,i.spatialReference,St,r.renderCoordsHelper.spatialReference),p.setStartEndFromWorldDownAtLocation(St),c.intersectsWorldUpAtLocation=St}else o=!1;const d=y.grabbingState&J.Z?z.Xd.visualElements.laserlineAlphaMultiplier:1;d!==f&&(f=d,z.Xd.visualElements.heightPlane.apply(g,d));const u=(0,vt.cS)(xt);!n&&e.displaying&&a.calculateMapBounds(u)&&(0,mt.SH)((0,vt.KE)(u,St),r.spatialReference,St,r.renderCoordsHelper.spatialReference)?(g.heightManifoldTarget=St,g.attached=!0):g.attached=!1;const _=y.grabbingState&J.XY?z.Xd.visualElements.laserlineAlphaMultiplier:1;_!==b&&(b=_,z.Xd.visualElements.pointGraphics.shadowStyle.apply(c,_));const M=o&&e.displaying&&!n;c.attached=M,p.attached=M};i.push((0,o.YP)((()=>[e.displaying,e.isDraped]),M),e.on("changed",M)),t.forEachManipulator((t=>{i.push(t.events.on("grab-changed",M))})),i.push((0,n.ed)(c)),i.push((0,n.ed)(p)),i.push((0,n.ed)(g)),M()}(t,a,r,l),r.push(e.trackGraphicState(a)),{visualElement:l,remove(){(0,n.AL)(r).remove()}}}function Mt(t){const e=t.geometry;return(0,s.Wi)(e)?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const St=(0,c.c)(),xt=(0,vt.Ue)();function Ct(t){switch((0,s.Wg)(t.graphic.geometry).type){case"point":case"mesh":return bt(t);case"polygon":case"polyline":return ct(t);default:return null}}const wt=[1,.5,0],Et=70,Ot=Math.ceil(Et/3*2),At=160,Tt=5*Math.PI/12,Gt=1*Math.PI/3;var Dt=i(44584);class Rt{constructor(){this._available=!0}set location(t){this._forEachManipulator3D((e=>e.location=t))}set elevationAlignedLocation(t){this._forEachManipulator3D((e=>e.elevationAlignedLocation=t))}set elevationInfo(t){this._forEachManipulator3D((e=>e.elevationInfo=t))}get renderLocation(){let t;return this._forEachManipulator3D((e=>{t||(t=e.renderLocation)})),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D((e=>e.available=t))}get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}_forEachManipulator3D(t){this.forEachManipulator(((e,i)=>{e instanceof lt.Z&&t(e,i)}))}}var Pt=i(30936),It=i(24455),Lt=i(39100),Vt=i(68817),zt=i(81536),Xt=i(76478);function Wt(t,e,i,a){const n=t.graphic,s=(t,i)=>e({action:t,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((t,e,i)=>{const o=e.next((t=>("start"===t.action&&s("start",t),t))).next((0,Xt.a9)(n,a)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&s("update",t);break;case"end":s("end",t)}return t}));return i.next((0,Xt.bD)(n)).next((()=>{s("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function Zt(t){if((0,s.Wi)(t)||"polyline"!==t.type&&"polygon"!==t.type)return 0;const e=("polyline"===t.type?t.paths:t.rings)[0];if(!e||e.length<2)return 0;const i=e[0],a=e[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function kt(t){if((0,s.Wi)(t)||(0,s.Wi)(t.axis))return 1;const{mapStart:e,mapEnd:i,axis:a}=t,n=[i.x-e.x,i.y-e.y];return n[0]*a[0]+n[1]*a[1]>0?1:-1}var Nt=i(70984),Yt=i(6087),Ht=i(84891),Ut=i(91258);class Ft extends Rt{constructor(t){super(),this._handles=new Dt.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Et,this._updateAfterDrag=!1,this.events=new tt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._handles=(0,s.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:e}of this._arrowManipulatorInfos)t(e,$.TRANSLATE_XY)}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,d.RL)(a),o=(0,s.Wg)(a.geometry).spatialReference;return Wt(e,i,(e=>this.createDragPipeline(((i,a,n,s,o)=>e(i,t(i,a,n,s,o),n)),n,o,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){return(0,n.AL)(this._arrowManipulatorInfos.map((({manipulator:n},s)=>(0,Xt.Xd)(n,((n,o,r,l,p)=>{const h=o.next((t=>({...t,manipulatorType:$.TRANSLATE_XY}))).next((0,Xt.kY)(this._view,n.elevationAlignedLocation)).next((0,zt.G)(this._view,n.elevationAlignedLocation,e,i,a)).next((0,Xt.M2)(n.location,this.angle+(s+1)*Math.PI*.5)).next((0,Xt.zh)());t(n,h,r,l,p)})))))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:e},i){const a=this._radius/Et,n=54*a,s=n*Math.sqrt(3)/2,o=(0,Yt.DA)(s,n/2,n/2,.02);(0,Yt.mx)(o,(0,It.f)(Vt.MP.get(),(0,h.s)(Vt.WM.get(),0,-s/3,0))),t.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:Ut.Q9.Focused},{geometry:o,material:this._transparentMaterial,stateMask:Ut.Q9.Unfocused}],t.radius=s/3*2*1.2;const r=(0,It.b)(Vt.MP.get(),i*Math.PI/2),l=(0,It.f)(Vt.MP.get(),(0,h.s)(Vt.WM.get(),0,100*a,0));(0,It.m)(e,r,l)}_createManipulators(){for(let t=0;t<4;t++){const e=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(e)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,e=(0,It.d)(Vt.MP.get(),t,(0,c.f)(0,0,1));if((0,s.Wi)(e))return;const i=(0,It.C)(Vt.MP.get(),(0,h.s)(Vt.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,It.m)(Vt.MP.get(),i,e);for(const t of this._arrowManipulatorInfos){const e=(0,It.m)(Vt.MP.get(),a,t.transform);t.manipulator.modelTransform=e}}_createArrowManipulator(t){const e=new lt.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,c.f)(0,0,1)}}),i={manipulator:e,transform:(0,Lt.c)()};return this._updateArrowManipulator(i,t),this._handles.add(e.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(t=1){const e=Pt.Z.toUnitRGBA(z.O9.main);return e[3]*=t,new Ht.E({color:e,transparent:1!==t,cullFace:Nt.Vr.Back,renderOccluded:H.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:t})=>t))}}}class Bt{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new Xt.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,s.pC)(this._lastDragEvent)){const e=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if((0,s.pC)(i)){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?i:e,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=t}_snap(t){const e=(0,s.pC)(this._view)?this._view.toMap(t,{exclude:[]}):null;return(0,s.pC)(e)&&(0,s.pC)(this._view)&&(e.z=(0,d.Ou)(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){return this._view=t,this._elevationInfo=e,this._lastDragEvent=null,t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const e=this._snap(t.screenEnd);return(0,s.pC)(e)?{action:t.action,mapStart:t.mapStart,mapEnd:e,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}}}}class jt extends Rt{constructor(t){super(),this._snapToScene=new Bt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Et,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,$.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,d.RL)(a),o=(0,s.Wg)(a.geometry).spatialReference;return Wt(e,i,(e=>this.createDragPipeline(((i,a,n,s,o)=>e(i,t(i,a,n,s,o),n)),n,o,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const n=this._view;return(0,Xt.Xd)(this._manipulator,((s,o,r,l,p)=>{const h=o.next((0,Xt.kY)(n,s.elevationAlignedLocation)).next((0,zt.G)(n,s.elevationAlignedLocation,e,i,a)).next(this._snapToScene.createDragEventPipelineStep(n,e),this._snapToScene.next).next((t=>({...t,manipulatorType:$.TRANSLATE_XY}))).next((0,Xt.zh)());t(s,h,r,l,p)}))}_updateManipulatorTransform(){const t=(0,It.C)(Vt.MP.get(),(0,h.s)(Vt.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new lt.Z({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,c.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=(0,Yt.nb)(.02,1,128,(0,c.f)(0,0,1),(0,c.f)(0,0,0)),e=(0,It.C)((0,Lt.c)(),(0,c.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:t,material:this._discMaterial,transform:e,stateMask:Ut.Q9.Focused},{geometry:t,material:this._discMaterialTransparent,transform:e,stateMask:Ut.Q9.Unfocused}],this._manipulator.radius=this._radius/Et*80}_createMaterial(t=1){const e=Pt.Z.toUnitRGBA(z.O9.main);return e[3]*=t,new Ht.E({color:e,transparent:1!==t,cullFace:Nt.Vr.Back,renderOccluded:H.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}var Qt=i(39043);class qt extends Rt{constructor(t){super(),this._radius=Et,this.events=new tt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,$.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const a=(0,s.Wg)(e.graphic.geometry).spatialReference;return Wt(e,i,(e=>this.createDragPipeline(((i,a,n,s,o)=>e(i,t(i,a,n,s,o),n)),a)),this._view.state.viewingMode)}createDragPipeline(t,e){const i=this._view;return(0,Xt.Xd)(this._manipulator,((a,n,s,o,r)=>{const l=n.next((t=>({...t,manipulatorType:$.TRANSLATE_Z}))).next((0,zt.Sp)(i,a.renderLocation,e)).next((0,Xt.zh)());t(a,l,s,o,r)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/Et,e=z.Xd.zManipulator.height*t,i=z.Xd.zManipulator.coneHeight*t,a=z.Xd.zManipulator.coneWidth*t,n=z.Xd.zManipulator.width*t,s=[(0,c.f)(0,0,0),(0,c.f)(0,0,e)],o=(0,Yt.PD)(s,n/2,16,!1),r=(0,Yt.QL)(i,a/2,16,!1),l=[(0,c.f)(0,0,0),(0,c.f)(0,0,e+i)],p=(t=>{const i=(0,Lt.c)();if((0,It.v)(i,i,[0,0,e]),(0,It.r)(i,i,Math.PI/2),t){const e=1+2*t/a;(0,It.k)(i,i,[e,e,e])}return i})(0),h=(t,e)=>{const i=(0,Qt._j)(z.Xd.zManipulator.color,e);return[i.r/255,i.g/255,i.b/255,z.Xd.zManipulator.color.a*t]},d=(0,nt.EA)(h(1,.25),H.yD.Occlude),u=(0,nt.EA)(h(1,0),H.yD.Occlude),g=(0,nt.EA)(h(.7,0),z.Xd.zManipulator.renderOccluded),_=(0,nt.EA)(h(.85,0),z.Xd.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:r,transform:p,material:d,stateMask:Ut.Q9.Unfocused},{geometry:o,material:d,stateMask:Ut.Q9.Unfocused},{geometry:r,transform:p,material:u,stateMask:Ut.Q9.Focused},{geometry:o,material:u,stateMask:Ut.Q9.Focused},{geometry:r,transform:p,material:g,stateMask:Ut.Q9.Unfocused},{geometry:o,material:g,stateMask:Ut.Q9.Unfocused},{geometry:r,transform:p,material:_,stateMask:Ut.Q9.Focused},{geometry:o,material:_,stateMask:Ut.Q9.Focused}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const t=new lt.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e=this._view.state.camera,i=Jt;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,h.j)(e.eye,i),n=e.computeRenderPixelSizeAtDist(a),s=(0,h.b)($t,i,e.eye);(0,h.n)(s,s);const o=Kt;this._view.renderCoordsHelper.worldUpAtPosition(Jt,o);const r=Math.abs((0,h.e)(s,o)),l=(0,h.f)($t,s,o),p=(0,h.f)($t,l,o),c=(0,rt.uZ)(r,.01,1),d=1-Math.sqrt(1-c*c)/c/e.fullWidth,u=this._radius/Et,g=z.Xd.zManipulator.width*u;(0,h.g)(p,(0,h.n)(p,p),(1/d-1)*a+n*g),t[12]-=$t[0],t[13]-=$t[1],t[14]-=$t[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Jt=(0,c.c)(),$t=(0,c.c)(),Kt=(0,c.c)();class te extends Rt{constructor(t){super(),this._handles=new Dt.Z,this._interactive=!0;const{tool:e,view:i,snapToScene:a,radius:n}=t;this._view=i,this.xyManipulation=new jt({tool:e,view:i,snapToScene:a,radius:n}),this.xyAxisManipulation=new Ft({tool:e,view:i,radius:n}),this.zManipulation=new qt({tool:e,view:i,radius:n}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((t=>{this._handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,e,i){return(0,n.AL)([this.xyManipulation.createGraphicDragPipeline(((e,i,a,n,s)=>t(ie.XY,e,i,a,n,s)),e,i),this.xyAxisManipulation.createGraphicDragPipeline(((e,i,a,n,s)=>t(ie.XY_AXIS,e,i,a,n,s)),e,i),this.zManipulation.createGraphicDragPipeline(((e,i,a,n,s)=>t(ie.Z,e,i,a,n,s)),e,i)])}createDragPipeline(t,e,i,a){return(0,n.AL)([this.xyManipulation.createDragPipeline(((e,i,a,n,s)=>t(ie.XY,e,i,a,n,s)),e,i,a),this.xyAxisManipulation.createDragPipeline(((e,i,a,n,s)=>t(ie.XY_AXIS,e,i,a,n,s)),e,i,a),this.zManipulation.createDragPipeline(((e,i,a,n,s)=>t(ie.Z,e,i,a,n,s)),i)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator((e=>t(e,$.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((e=>t(e,$.TRANSLATE_XY))),this.zManipulation.forEachManipulator((e=>t(e,$.TRANSLATE_Z)))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator((t=>t.focused))||this.xyAxisManipulation.someManipulator((t=>t.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,e=this.xyManipulation;if((0,_.Z)("esri-mobile"))return;const i=[];e.forEachManipulator((t=>i.push(t))),t.forEachManipulator((t=>i.push(t)));const a=()=>{const e=[];this._xyAxisVisible||t.forEachManipulator((t=>e.push(t.disableDisplay()))),this._handles.remove(ee),this._handles.add(e,ee)};for(const t of i)this._handles.add(t.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,o.gx)((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator((e=>{e.interactive=!t&&this._interactive||e.grabbing}))}static radiusForSymbol(t){const e=(0,s.pC)(t)&&"point-3d"===t.type&&t.symbolLayers;return e&&e.length>0&&e.some((t=>"icon"===t.type))?Ot:Et}}const ee="disable-xy-axis-display";var ie;!function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"}(ie||(ie={}));var ae=i(4641);class ne extends Rt{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,$.TRANSLATE_XY)}createGraphicDragPipeline(t){return Wt(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const e=this._view,i=this._graphicState.graphic,a=(0,s.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,Xt.Xd)(this._manipulator,((n,s,o,r,l)=>{const p=s.next((0,zt._y)(l,e,i,a)).next((0,Xt.AN)()).next((0,Xt.zh)());t(n,p,o,r,l)}))}_createManipulator(){const t=this._view,e=this._graphicState.graphic;this._manipulator=new ae.L({graphic:e,view:t,selectable:!0,cursor:"move"})}}var se=i(84123),oe=i(68610),re=i(62177),le=i(35329),pe=i(73080),he=i(73464),ce=i(18913),de=i(60389),ue=i(92810);class ge{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class _e{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move"}}class me{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let ve=class extends((0,et.p)(tt.Z.EventedMixin(oe.m))){constructor(t){super(t),this.graphics=new K.Z,this.enableZ=!0,this.tooltipOptions=new le.Z,this.type="move-3d",this._snappingPipeline=new he.n,this._tooltip=null}initialize(){const{graphics:t,view:e}=this;this.addHandles([t.on("change",(()=>this._refreshManipulators())),(0,o.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new ce.u({view:e}):(0,s.SC)(this._tooltip)}),o.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,s.SC)(this._tooltip),this._moveManipulation=(0,s.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>(0,se.P)(t)===st.e.SUPPORTED)).map((t=>new ye(t)));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this._updateMoveManipulation(t))}_createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new ne({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(({action:t})=>{const{tooltipOptions:e,_tooltip:i}=this;(0,s.Wi)(i)||("start"===t?i.info=new de.$E({tooltipOptions:e}):i.clear())}))]))),this.handles.add(e.manipulationXY.createDragPipeline(((e,i,a,n)=>this._buildDragEventPipeline(t,ie.XY,e,i,a,n))))}this._createMoveManipulation(t)}_createMoveManipulation(t){const e=new te({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?te.radiusForSymbol(t[0].graphic.symbol):Et});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(i=>{e.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=e=>i=>{this.handles.add(i.events.on("focus-changed",(({action:i})=>{const a=this._tooltip;(0,s.Wi)(a)||("focus"===i?this._updateMoveTooltip(t,e):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(ie.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(ie.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(ie.Z));const a=()=>this._updateMoveManipulation(t);for(const e of t)this.handles.add([e.state.on("changed",a),(0,o.YP)((()=>e.state.displaying),a)]);const n=t[t.length-1];this.handles.add(n.state.on("changed",(()=>this._updateMoveManipulationAngle(n)))),this.handles.add(e.createDragPipeline(((e,i,a,n,s)=>this._buildDragEventPipeline(t,e,i,a,n,s)),(0,d.RL)(n.graphic),(0,s.Wg)(n.graphic.geometry).spatialReference,n.graphic)),this._updateMoveManipulationAngle(n)}_createVisualElements(t){for(const e of t){const i=e.graphic,a=Ct({view:this.view,graphic:i,forEachManipulator:t=>{e.manipulationXY.forEachManipulator(t),this._moveManipulation.forEachManipulator(t)},onManipulatorsChanged:()=>(0,n.kB)()});(0,s.Wi)(a)||(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof W.k&&this.handles.add([e.geometryRepresentation.events.on("attachment-origin-changed",(()=>{e.state.isDraped||this._updateMoveManipulation(t)})),(0,o.YP)((()=>e.state.isDraped),(()=>this._updateMoveManipulation(t)))]),this.handles.add(a))}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=Zt(t.graphic.geometry)}_updateMoveManipulation(t){const e=(0,at.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;for(const n of t){if(!n.state.displaying)continue;const t=n.state.graphic;this.enableZ&&(0,ot.c)(t)&&(a=!0);const o=n.geometryRepresentation instanceof W.k&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:(0,nt.du)(this.view,t);(0,s.pC)(o)&&(e.x+=o.x,e.y+=o.y,e.z+=o.z,i++)}i>0?(e.x/=i,e.y/=i,e.z/=i,n.location=e,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1}_buildDragEventPipeline(t,e,i,a,n,s){const o=[],r=[];let l=null,p=null;const h=()=>{for(const t of o)t.dragging=!1;o.length=0,r.length=0,l=null,p=null,this._moveManipulation.interactive=!0};if(n=n.next((t=>p(t))).next((()=>{if(this.emit("graphic-move-stop",new me(r)),this.destroyed)return null;h()})),1===t.length&&e===ie.XY){const e=t[0].graphic;a=this._buildSnappingPipelineSteps(e,(0,d.RL)(e),a,n,s)}return a.next((e=>{if("start"===e.action){o.length=0,r.length=0;for(const e of t)e.dragging||!e.manipulationXY.hasManipulator(i)&&e.manipulationXY.grabbing||(o.push(e),r.push(e.graphic),e.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,l=(0,Xt.oq)(r,this.view.state.viewingMode),p=(0,Xt.QY)(r),this.emit("graphic-move-start",new ge(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>l(t))).next((i=>(this._updateMoveTooltip(t,e,i),i))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,n=i.y-e.y;if(this.emit("graphic-move",new _e(a,n,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new me(r)),this.destroyed)return null;h()}}))}_updateMoveTooltip(t,e,i){const{tooltipOptions:a,_tooltip:n}=this;if((0,s.Wi)(n))return;n.clear();const o=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(e){case ie.XY:n.info=new de.$E({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,((t,e)=>(0,E.GQ)(t,e,o)));break;case ie.XY_AXIS:n.info=new de.in({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,((t,e)=>{const a=(0,E.GQ)(t,e,o);return(0,it.bA)(a,kt(i))}));break;case ie.Z:n.info=new de.QW({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,ue._e)}}_updateMoveTooltipDistance(t,e,i){if((0,s.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=(0,s.pC)(o)?o:it.yP}}_buildSnappingPipelineSteps(t,e,i,a,n){const o=t.geometry;if((0,s.Wi)(o)||"point"!==o.type&&"mesh"!==o.type)return i;const r=("point"===o.type?o:o.anchor).clone(),l=new pe.N({elevationInfo:e,pointer:n,editGeometryOperations:re.c.fromGeometry(r,this.view.state.viewingMode),visualizer:new V._,excludeFeature:t}),p=this.snappingManager;return i.next((e=>(r.z=(0,d.vQ)(this.view,r,(0,d.RL)(t),{mode:"absolute-height",offset:0}),{...e,snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:p,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],ve.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],ve.prototype,"graphics",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],ve.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:le.Z})],ve.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ve.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)()],ve.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],ve.prototype,"updating",null),ve=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],ve);class ye{constructor(t){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Y.F({graphic:t})}get graphic(){return this.state.graphic}}var fe=i(38950),be=i(90819),Me=i(69430),Se=i(59672),xe=i(77571);function Ce(t,e,i){const a="on-the-ground"===i.mode?xe.v.XY:xe.v.XYZ;return new xe.A(t,a,e,0)}function we(t,e,i){const a=(0,c.c)();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const n=Ee(t,e,(0,Me.mJ)(i.plane)),o=Ee(t,e,i.edgeDirection);if((0,s.Wi)(n)||(0,s.Wi)(o))return null;const r=(0,h.f)((0,c.c)(),n,o);return(0,Me.Yq)(a,r,(0,Me.Ue)())}function Ee(t,e,i){const a=(0,at.Tx)(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),n=(0,c.c)(),s=(0,c.c)();return t.renderCoordsHelper.toRenderCoords(e,n)&&t.renderCoordsHelper.toRenderCoords(a,s)?(0,h.r)(s,n,s):null}var Oe=i(51986),Ae=i(26817),Te=i(54079);let Ge=class extends Te.h{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=it.yP,this.area=null,this.totalLength=null}};(0,a._)([(0,r.Cb)()],Ge.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],Ge.prototype,"distance",void 0),(0,a._)([(0,r.Cb)()],Ge.prototype,"area",void 0),(0,a._)([(0,r.Cb)()],Ge.prototype,"totalLength",void 0),Ge=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Ge);var De=i(34541),Re=i(956);let Pe=class extends(tt.Z.EventedMixin(et.r)){constructor(t){super(t),this._vertexManipulatorMaterial=(0,nt.EA)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.vertex.color),z.Xd.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,nt.qJ)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.vertex.outlineColor),z.Xd.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,nt.qJ)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.vertex.hoverOutlineColor),z.Xd.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,nt.EA)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.edge.color),z.Xd.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,nt.qJ)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.edge.outlineColor),z.Xd.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,nt.EA)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.edgeOffset.color),z.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,nt.EA)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.edgeOffset.hoverColor),z.Xd.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,nt.EA)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.selected.color),z.Xd.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,nt.qJ)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.selected.outlineColor),z.Xd.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,nt.qJ)(z.Xd.colorToVec4(z.Xd.reshapeManipulators.selected.hoverOutlineColor),z.Xd.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new Dt.Z,this._manipulatorInfos=[],this._editGeometryOperations=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=We.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new he.n,this._snappingPipelineHandle=new he.n,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:t,view:e}=this,i=this._graphicState=new Y.F({graphic:t});this._tooltip=new ce.u({view:e}),this.addHandles([(0,o.YP)((()=>i.displaying),(t=>{for(const e of this._manipulatorInfos)e.manipulator.available=t})),(0,o.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(({labels:t,enabled:e,edgeOffsetEnabled:i})=>{(0,s.pC)(t)&&(t.visible=e,t.edgeDistance=i?"far":"default")}),o.nn),(0,o.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),o.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,s.SC)(this._segmentLabels),this._tooltip=(0,s.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return(0,s.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const t=this._manipulatorInfos.filter((t=>t.manipulator.selected&&"vertex"===t.type));this._removeVertices(t)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,s.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,s.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(){if((0,s.Wi)(this._editGeometryOperations))return;const t=(0,d.RL)(this.graphic);for(const e of this._editGeometryOperations.data.components){for(const i of e.vertices)this._createVertexOrEdgeManipulator(i,t);for(const i of e.edges)this._createVertexOrEdgeManipulator(i,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return(0,s.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,s.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,s.Wi)(this._editGeometryOperations))return null;const t=this._editGeometryOperations.redo();return(0,s.pC)(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if((0,s.Wi)(this._editGeometryOperations))return null;this.emit("undo");const t=this._editGeometryOperations.undo();return(0,s.pC)(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._removeManipulators(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(t=this.inputGeometry){this._removeManipulators(),this._tooltip.clear(),(0,s.Wi)(t)||((0,s.SC)(this._editGeometryOperations),this._editGeometryOperations=re.c.fromGeometry(t,this.view.state.viewingMode),this._createManipulators(),(0,s.SC)(this._segmentLabels),this._segmentLabels=new I({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,d.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(t,e){if("end"===e.action)return e;let i=0;const a=[],n=this._manipulatorInfos.some((t=>"vertex"===t.type&&t.manipulator.selected)),s=t===Ze.SELECTED_OR_ALL&&n;for(const t of this._manipulatorInfos)"vertex"===t.type&&(t.manipulator.grabbing||s&&!t.manipulator.selected||a.push(t),i++);if(0===a.length)return e;if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(We.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(We.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){let t=0;for(const e of this._manipulatorInfos)"vertex"===e.type&&e.manipulator.selected&&t++;return t>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(We.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const n=[];for(const e of this._manipulatorInfos)"vertex"===e.type&&(e.manipulator.selected&&!e.manipulator.grabbing||e===t.info)&&n.push(e);this._moveVertices(n,t,Ae.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case We.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case We.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case We.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case We.MOVING:switch(this._reshapeEventState){case We.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case We.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case We.RESHAPING:switch(this._reshapeEventState){case We.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case We.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulation(){const{tool:t,view:e}=this,i=this._graphicState;if(this._graphicMoveManipulation=new ne({tool:t,view:e,graphicState:i}),this.enableMoveGraphic){let t=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,i,a)=>{i.next((t=>this._trackNumDragging(t))).next((e=>("start"===e.action&&(t=(0,s.Wg)(this._editGeometryOperations).createUndoGroup()),e))).next((t=>this._perGraphicManipulatorDragAction(Ze.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(ie.XY,t),t))).next((e=>{"end"===e.action&&(this._tooltip.clear(),t=(0,s.hw)(t))})),a.next((()=>this._onDragCancel(!0,(()=>t=(0,s.hw)(t)))))}))),this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(t,!1))))}else this._graphicMoveManipulation.forEachManipulator((t=>{t.grabbable=!1,t.cursor=null}));this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(t.events.on("immediate-click",(t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})))))}_createMoveManipulation(t){const{graphic:e,handles:i,tool:a,view:n}=this,r=this._graphicState;this._moveManipulation=new te({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&(0,ot.c)(e),snapToScene:!1,radius:te.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>i.add([t.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(t)||this._manipulatorInfos.some((t=>t.manipulator.selected))||this.emit("immediate-click",{...i,graphic:e}),i.stopPropagation()})),this._watchAndUpdateGrabState(t,!1)])));const l=t=>e=>{i.add(e.events.on("focus-changed",(({action:e})=>{"focus"===e&&this._tooltipOptions.enabled?this._updateTranslateTooltip(t):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(l(ie.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(l(ie.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(l(ie.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const p=(0,s.Wg)(e.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,n,o,r,l)=>(r=r.next((t=>(this._onDragCancel(),t))),o.next((t=>this._trackNumDragging(t))).next((t=>{const e=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));return t.manipulatorType===$.TRANSLATE_XY&&1===e.length?{...t,info:e[0],snapOrigin:e[0].handle.pos}:t})).next((0,Xt.BS)(this.view,t,e)).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:t=>!!t.info,cancel:r,snappingManager:a.snappingManager,snappingContext:new pe.N({editGeometryOperations:(0,s.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:l,excludeFeature:e,visualizer:new V._}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipelineHandle.next).next((0,Xt.AN)()).next((t=>this._perGraphicManipulatorDragAction(Ze.SELECTED_OR_ALL,t))).next((t=>(this._updateTranslateTooltip(i,t),t))))),t,p,e),(0,o.YP)((()=>r.displaying),(()=>{this._updateMoveManipulationPosition()}),o.nn),r.on("changed",(()=>this._updateMoveManipulationPosition())),(0,o.YP)((()=>r.isDraped),(t=>{this._updateMoveManipulationPosition();const e="align-move-manipulation";t?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):i.remove(e)}),o.nn)])}_createVisualElements(){const{graphic:t,view:e}=this,i=Ct({view:e,graphic:t,forEachManipulator:t=>{if(!this.destroyed){this._graphicMoveManipulation.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);for(const e of this._manipulatorInfos)t(e.manipulator,$.TRANSLATE_XY)}},onManipulatorsChanged:t=>this.on("manipulators-changed",t)});(0,s.pC)(i)&&(this._outlineVisualElement=i.visualElement instanceof W.k?i.visualElement:null),(0,s.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t,e=(0,d.RL)(this.graphic)){const i=z.Xd.reshapeManipulators.edgeOffset,a=i.size/2,o=a+i.collisionPadding;if((0,s.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,s.Wi)(this._edgeOffsetManipulatorGeometryOutside)){const t=a/o,e=t*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=(0,Yt.DA)(e,t/2,t/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=(0,Yt.DA)(-e,t/2,t/2,i.height,-i.offset)}const r=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:Ut.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Ut.Q9.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:Ut.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Ut.Q9.Focused}],l=new lt.Z({view:this.view,renderObjects:r,elevationInfo:"on-the-ground"!==e.mode||(0,Se.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,c.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),p=new lt.Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),h={manipulator:l,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:p,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(h,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(h);const u=[];for(const t of[h.handle.leftVertex,h.handle.rightVertex]){const e=this._getManipulatorInfoFromHandle(t);(0,s.pC)(e)&&u.push(e.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(h))))}h.locationUpdateHandle=(0,n.AL)(u),this._manipulatorHandles.add(h.locationUpdateHandle,l),this._manipulatorHandles.add([this._watchAndUpdateGrabState(l,!0),this._watchAndUpdateGrabState(p,!0)],l),this._manipulatorHandles.add((0,Xt.Xd)(l,this._createEdgeOffsetPipeline(h,e)),l),this._manipulatorHandles.add((0,Xt.Xd)(p,((t,i,a,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(h,e)(t,i,a);else if(this.enableMoveGraphic){const n=this.graphic,o=(0,s.pC)(n.geometry)?n.geometry.spatialReference:null;i.next((t=>this._trackNumDragging(t))).next((0,Xt.kY)(this.view,t.elevationAlignedLocation)).next((0,zt.G)(this.view,t.elevationAlignedLocation,e,o,n)).next((0,Xt.zh)()).next((0,Xt.AN)()).next((t=>this._perGraphicManipulatorDragAction(Ze.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(ie.XY,t),t))).next((t=>{"end"===t.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!t.metadata.deleting)))}})),l);const g=t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()};return this._manipulatorHandles.add([l.events.on("immediate-click",g),p.events.on("immediate-click",g),l.events.on("focus-changed",(({action:t})=>{const e=this._tooltipOptions;if("focus"===t&&e.enabled){const t=this._tooltip.info=new Ge({tooltipOptions:e});this._updateTooltipAreaOrTotalLength(t)}else this._tooltip.clear()}))],l),this._manipulatorInfos.push(h),this.manipulators.add(l),this.manipulators.add(p),this.emit("manipulators-changed"),h}_autoHideEdgeOffsetManipulator(t,e){const i=t.manipulator,a=t.edgeManipulator,o=()=>{t.visibilityHandle=(0,s.hw)(t.visibilityHandle);const o=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex),l=(0,s.pC)(o)&&(0,s.pC)(r)&&function(t,e,i){const a=i.projectToRenderScreen(t,(0,g.J$)()),n=i.projectToRenderScreen(e,(0,g.J$)());return(0,s.pC)(a)&&(0,s.pC)(n)?(0,h.p)((0,h.b)(a,a,n)):0}(o.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,t.visibilityHandle=(0,n.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",o),a.events.on("focus-changed",o),{remove:()=>{(0,s.hw)(t.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],i),o()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const{coordinateHelper:e}=(0,s.Wg)(this._editGeometryOperations).data,i=we(this.view,t.manipulator.elevationAlignedLocation,Ce(e,t.handle,(0,s.Wg)(t.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex),n=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if((0,s.Wi)(a)||(0,s.Wi)(n))return;const o=a.manipulator.renderLocation,r=n.manipulator.renderLocation,l=(0,s.pC)(i)?function(t,e,i){const a=(0,Me.mJ)(t),n=(0,h.r)((0,c.c)(),e,i),s=(0,h.f)((0,c.c)(),n,a),o=(0,h.f)((0,c.c)(),n,s);return(0,Lt.f)(n[0],n[1],n[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1)}(i,o,r):Lt.I;t.manipulator.modelTransform=l,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=l;const p=(0,h.l)((0,h.b)(Ve,o,r))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-p,0,0],[p,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,n)=>{this._clearSelection();const{step:o,cleanup:r}=this._initializeEdgeOffset(t,e);a.next((t=>this._trackNumDragging(t))).next((0,Xt.kY)(this.view,i.elevationAlignedLocation)).next(o).next((0,zt.bB)(this.view)).next((0,zt.zP)(this.view,(0,s.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,Xt.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next((t=>{"end"===t.action&&r()})),n.next((()=>{i.metadata.deleting||(r(),this._onDragCancel())}))}}_initializeEdgeOffset(t,e){const i=(0,s.Wg)(this._editGeometryOperations),a=Ce(i.data.coordinateHelper,t.handle,e),r=i.createUndoGroup(),l=we(this.view,t.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);(0,s.pC)(e)&&this._splitEdgeManipulator(e,1)}if(a.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);(0,s.pC)(e)&&this._splitEdgeManipulator(e,0)}const p=()=>new be.Z({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),h=new W.k({view:this.view,isDraped:this._graphicState.isDraped,geometry:p(),elevationInfo:t.elevationInfo,width:z.Xd.visualElements.lineGraphics.outline.width,color:z.Xd.colorToVec4(z.O9.main),attached:!0});let c;const d=()=>{this._cleanEdgeOffsetCollapsedEdges(t),c=(0,s.hw)(c)},u=this.on("undo",d);return c=(0,n.AL)([(0,n.ed)(h),(0,o.YP)((()=>this._graphicState.isDraped),(t=>h.isDraped=t)),this._graphicState.on("changed",(()=>h.geometry=p())),r,u]),{step:t=>(0,s.Wi)(a)||(0,s.Wi)(l)?(d(),null):{...t,operation:a,plane:l},cleanup:d}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||(0,s.Wi)(e.operation))return e;this._updateEventState(We.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=e;return(i||a||n)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return t=>{const{operation:e,mapEnd:i}=t;return(0,s.Wi)(e)||(0,s.Wi)(i)?t:("start"===t.action&&e.selectArrowFromStartPoint(i),{...t,signedDistance:e.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return t=>{const{mapEnd:e,signedDistance:i,operation:a}=t,n=this._tooltip,o=this._tooltipOptions;if(!o.enabled||(0,s.Wi)(i))return n.clear(),t;let r=n.info;((0,s.Wi)(r)||"reshape-edge-offset"!==r.type)&&(r=n.info=new Ge({tooltipOptions:o}));const{coordinateHelper:l}=(0,s.Wg)(this._editGeometryOperations).data;return r.distance="end"===t.action?it.yP:function(t,e,i,a,n){if(t){const t=n.toXYZ(n.pointToVector(i)),o=(0,Me.nF)(a,t,Vt.WM.get()),r=(0,Re.FB)(o,t,n.spatialReference);if((0,s.pC)(r))return(0,it.yG)(r.value*Math.sign(e),r.unit)}return(0,it.yG)(e*(0,b.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,e,a.plane,l),this._updateTooltipAreaOrTotalLength(r),t}}_cleanEdgeOffsetCollapsedEdges(t){const e=t.handle.leftVertex.leftEdge?.leftVertex,i=t.handle.leftVertex,a=t.handle.rightVertex.rightEdge?.rightVertex,n=t.handle.rightVertex,o=(0,s.Wg)(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&o.distance(e.pos,i.pos)<ze){const t=this._getManipulatorInfoFromHandle(i);(0,s.pC)(t)&&r.push(t)}if(o.distance(i.pos,n.pos)<ze||a&&o.distance(a.pos,n.pos)<ze){const t=this._getManipulatorInfoFromHandle(n);(0,s.pC)(t)&&r.push(t)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t,e=(0,d.RL)(this.graphic)){if("edge"===t.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if((0,s.Wi)(this._vertexManipulatorGeometry)||(0,s.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(z.Xd.reshapeManipulators.vertex);this._vertexManipulatorGeometry=(0,Yt.PI)(t,16,16),this._vertexManipulatorOutlineGeometry=(0,Yt.PI)(e,16,16)}if((0,s.Wi)(this._edgeManipulatorGeometry)||(0,s.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(z.Xd.reshapeManipulators.edge);this._edgeManipulatorGeometry=(0,Yt.PI)(t,16,16),this._edgeManipulatorOutlineGeometry=(0,Yt.PI)(e,16,16)}const i=(0,s.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Xe.Vertex|Ut.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:Xe.Vertex|Ut.Q9.Unfocused|Ut.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Xe.Vertex|Ut.Q9.Focused|Ut.Q9.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:Ut.Q9.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:Ut.Q9.Selected|Ut.Q9.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:Ut.Q9.Selected|Ut.Q9.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Xe.Edge|Ut.Q9.Focused|Ut.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Xe.Edge|Ut.Q9.Focused|Ut.Q9.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:Xe.Edge|Ut.Q9.Unfocused|Ut.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:Xe.Edge|Ut.Q9.Unfocused|Ut.Q9.Unselected});const a=new lt.Z({view:this.view,renderObjects:i,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible),metadata:{deleting:!1}});this._setTypeSpecificManipulatorSettings(a,t,e);const o="edge"===t.type?{manipulator:a,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(o),this.manipulators.add(a),this._updateManipulatorPosition(o),"edge"===o.type){const t=[];for(const e of[o.handle.leftVertex,o.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(e);(0,s.pC)(i)&&t.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(o))))}o.locationUpdateHandle=(0,n.AL)(t),this._manipulatorHandles.add(o.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const r=(0,Xt.Xd)(a,((t,i,a,n)=>{let r=null;a=a.next((e=>(this._onDragCancel(!t.metadata.deleting,(()=>r=(0,s.hw)(r))),e))),i.next((t=>this._trackNumDragging(t))).next((t=>{if("start"===t.action&&(r=(0,s.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===o.type){const e=this._splitEdgeManipulator(o);return{...t,info:e,snapOrigin:e.handle.pos}}return{...t,info:o,snapOrigin:o.handle.pos}})).next((0,Xt.kY)(this.view,t.elevationAlignedLocation)).next((0,zt.VG)(this.view,this.graphic,t.elevationAlignedLocation,t.location.spatialReference,this.graphic)).next((0,Xt.BS)(this.view,e,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new pe.N({editGeometryOperations:(0,s.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:n,excludeFeature:this.graphic,visualizer:new V._}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipeline.next).next((0,Xt.AN)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(r=(0,s.hw)(r)),this._updateTranslateVertexTooltip(t,ie.XY,e)}))}));return this._manipulatorHandles.add([r,a.events.on("immediate-click",(t=>this._manipulatorClickCallback(t,o))),a.events.on("select-changed",(()=>{o.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),a.events.on("focus-changed",(({action:t})=>{"focus"===t&&"edge"!==o.type?this._updateTranslateVertexTooltip(a,ie.XY):this._tooltip.clear()}))],a),this.emit("manipulators-changed"),o}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(t=!0,e){switch(this._numDragging--,t&&(this.undo(),this.outputGeometry=(0,s.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,s.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case We.NONE:break;case We.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case We.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(We.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){switch(e.type){case"vertex":t.state=Xe.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2,t.radius=z.Xd.reshapeManipulators.vertex.size/2+z.Xd.reshapeManipulators.vertex.collisionPadding,t.elevationInfo=i,t.interactive=(0,s.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":t.state=Xe.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1,t.radius=z.Xd.reshapeManipulators.edge.size/2+z.Xd.reshapeManipulators.edge.collisionPadding,t.elevationInfo="on-the-ground"!==i.mode||(0,Se.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",(i=>this._onGrabStateChanged(t,e,i.action,i.pointerType)))}_onGrabStateChanged(t,e,i,a="mouse"){if("start"===i)e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(We.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((t=>{t.manipulator.interactive=t.manipulator.grabbing||!this._numGrabbing&&(0,s.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in t&&(t.edgeManipulator.interactive=t.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((t=>{t.interactive=t.grabbing||!this._numGrabbing})))}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){(0,s.Wi)(t)||(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),(0,l.e$)(this._manipulatorInfos,t),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t)for(const e of this._manipulatorInfos)if(t===e.handle)return e;return null}_updateManipulatorPosition(t){if((0,s.Wi)(t))return;const e=(0,s.Wg)(this._editGeometryOperations);if("vertex"===t.type)t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,Le),t.manipulator.grabbing&&(0,s.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if("edge"===t.type){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if((0,s.Wi)(i)||(0,s.Wi)(a))return;const n=i.manipulator,o=a.manipulator;if((0,s.pC)(t.manipulator.elevationInfo)&&"on-the-ground"===t.manipulator.elevationInfo.mode){const i=n.location,a=o.location,s=.5,r=i.x+s*(a.x-i.x),l=i.y+s*(a.y-i.y),p=i.hasZ&&a.hasZ?0:void 0;t.manipulator.location=(0,at.Tx)(r,l,p,e.data.spatialReference)}else(0,h.h)(Ve,n.renderLocation,o.renderLocation,.5),t.manipulator.renderLocation=Ve}}_splitEdgeManipulator(t,e=.5){const i=(0,s.Wg)(this._editGeometryOperations),a=(0,s.Wg)(i.splitEdge(t.handle,e).createdVertex);t.locationUpdateHandle.remove(),t.locationUpdateHandle=void 0;const n=(0,d.RL)(this.graphic);let o;this.enableEdgeOffset?(this._removeManipulator(t),o=this._createVertexOrEdgeManipulator(a)):(o=t,o.handle=a,o.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(o),this.enableEdgeOffset||this._updateTranslateVertexTooltip(o.manipulator,ie.XY),this._updateSelection(t.manipulator);const r=this._updateEventState(We.RESHAPING),l=i.data.coordinateHelper.vectorToArray(o.handle.pos),p=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:p,vertexIndex:(0,s.Wg)(a.index)}],added:l}),r&&this._updateEventState(We.NONE),o}_updateMoveManipulationPosition(){const t=(0,h.s)(Ve,0,0,0);let e=0,i=!1,a=null,n=null;for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected?(e++,(0,h.a)(t,t,o.manipulator.renderLocation),(0,s.Wi)(a)||o.selectedIndex>a.selectedIndex?(n=a,a=o):((0,s.Wi)(n)||o.selectedIndex>n.selectedIndex)&&(n=o)):i=!0);if(0!==e){const t=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.zManipulation.available=t&&this.enableZVertex&&(0,ot.c)(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t&&1!==e}else{const t=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t,this._moveManipulation.zManipulation.available=t&&this.enableZShape&&(0,ot.c)(this.graphic)}if(0!==e){let t=0;if((0,s.pC)(a)){const e=a.handle.pos,i=(0,s.pC)(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,o=(0,s.Wi)(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&o?this._moveManipulation.xyAxisManipulation.available=!1:i?t=Ie(i,e):o&&(t=Ie(e,o))}this._moveManipulation.angle=t,this._moveManipulation.radius=Ot}else this._moveManipulation.angle=Zt((0,s.Wg)(this.graphic.geometry)),this._moveManipulation.radius=te.radiusForSymbol(this.graphic.symbol);0!==e&&i?((0,h.g)(t,t,1/e),Le.spatialReference=(0,s.Wg)(this._editGeometryOperations).data.spatialReference,Le.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,Le),this._moveManipulation.elevationAlignedLocation=Le):(0,s.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,s.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,nt.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(t){const e=[],i=(0,s.Wg)(this._editGeometryOperations);for(const a of t)if("vertex"===a.type&&i.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const t=(0,s.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);t&&this._createVertexOrEdgeManipulator(t)}if(e.length>0){const t=e.map((t=>{const e=i.data.components.indexOf(t.component);return{coordinates:i.data.coordinateHelper.vectorToArray(t.pos),componentIndex:e,vertexIndex:(0,s.Wg)(t.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(We.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:t.map((t=>t.coordinates)),vertices:t}),this.destroyed)return;if(a&&(this._updateEventState(We.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e,i=("start"===e.action?Ae.O.NEW_STEP:Ae.O.ACCUMULATE_STEPS)){const a=(0,s.Wg)(this._editGeometryOperations);a.moveVertices(t.map((t=>t.handle)),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const e of t)this._updateManipulatorPosition(e)}_offsetEdge(t,e){if((0,s.Wi)(e.operation)||(0,s.Wi)(e.signedDistance))return;const i=(0,s.Wg)(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),"vertex"===e.type&&(e.manipulator.selected=!e.manipulator.selected,t.button===Oe.t.Right&&this._removeVertices([e])),"edge"===e.type&&t.button===Oe.t.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){const i=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,t,e):this._updateTranslateGraphicTooltip(t,e)}_updateTranslateGraphicTooltip(t,e){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case ie.XY:this._tooltip.info=new de.$E({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,e)=>(0,E.GQ)(t,e,a)));break;case ie.XY_AXIS:this._tooltip.info=new de.in({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,i)=>{const n=(0,E.GQ)(t,i,a);return(0,it.bA)(n,kt(e))}));break;case ie.Z:this._tooltip.info=new de.QW({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,ue._e)}}_updateTranslateVertexTooltip(t,e,i){const a=this._tooltipOptions;if(!a.enabled)return;let n;const o=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case ie.XY:n=new de.nk({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((t,e)=>(0,E.GQ)(t,e,o))),this._updateTooltipAreaOrTotalLength(n);break;case ie.XY_AXIS:n=new de.c1({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((t,e)=>{const a=(0,E.GQ)(t,e,o);return(0,it.bA)(a,kt(i))})),this._updateTooltipAreaOrTotalLength(n);break;case ie.Z:n=new de.j({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,ue._e)}const r=(0,ue.g1)(t.elevationAlignedLocation);(0,s.pC)(r)&&(n.elevation={mode:"absolute-height",...r}),this._tooltip.info=n}_updateTranslateTooltipDistance(t,e,i){if((0,s.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=(0,s.pC)(o)?o:it.yP}}_updateTooltipAreaOrTotalLength(t){const{geometry:e}=this.graphic;if((0,s.Wi)(e))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";t.area="polygon"===e.type?(0,De.k)(e,i):null,t.totalLength="polyline"===e.type?(0,E.Ul)(e,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Ie(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}(0,a._)([(0,r.Cb)()],Pe.prototype,"_segmentLabels",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Pe.prototype,"tool",void 0),(0,a._)([(0,r.Cb)()],Pe.prototype,"_tooltip",void 0),(0,a._)([(0,r.Cb)()],Pe.prototype,"inputGeometry",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"outputGeometry",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Pe.prototype,"updating",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"manipulators",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"view",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"graphic",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"enableZShape",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"enableZVertex",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"enableMoveGraphic",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"enableMidpoints",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"enableEdgeOffset",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"_labelOptions",null),(0,a._)([(0,r.Cb)()],Pe.prototype,"_tooltipOptions",null),Pe=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Pe);const Le=(0,at.Tx)(0,0,null,null),Ve=(0,c.c)(),ze=1e-6;var Xe,We,Ze,ke;(ke=Xe||(Xe={})).Vertex=Ut.jg.Custom1,ke.Edge=Ut.jg.Custom2,function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(We||(We={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ze||(Ze={}));var Ne=i(41386);let Ye=class extends(tt.Z.EventedMixin(oe.m)){constructor(t){super(t),this._handles=new Dt.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Ne.Z,this.tooltipOptions=new le.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new Pe({tool:this});this.addHandles([t.on("reshape",(t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)})),t.on("move",(t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)})),t.on("vertex-add",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)})),t.on("vertex-remove",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)})),t.on("immediate-click",(t=>this.emit("immediate-click",t))),this.view.on("pointer-down",["Shift"],(t=>{t.stopPropagation()})),(0,o.YP)((()=>this.graphic),(()=>this._updateGraphic()),o.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,s.SC)(this._handles),this._reshapeOperation=(0,s.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const t=(0,fe.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,s.pC)(t)?t.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,fe.P)(this.graphic)!==st.e.SUPPORTED)return;const t=(0,o.YP)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),o.Z_);this._handles.add(t,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0,this.graphic.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){(0,s.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){(0,s.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,s.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){(0,s.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,s.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(t){"key-down"!==t.type||"Delete"!==t.key&&"Backspace"!==t.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,a._)([(0,r.Cb)()],Ye.prototype,"_reshapeOperation",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Ye.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableZShape",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableZVertex",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableMoveGraphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableMidpoints",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ye.prototype,"enableEdgeOffset",void 0),(0,a._)([(0,r.Cb)()],Ye.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:Ne.Z})],Ye.prototype,"labelOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:le.Z})],Ye.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Ye.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)()],Ye.prototype,"updating",null),(0,a._)([(0,r.Cb)()],Ye.prototype,"automaticManipulatorSelection",void 0),Ye=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Ye);var He=i(67666),Ue=i(65684),Fe=i(16068),Be=i(17262),je=i(1983),Qe=i(97537);let qe=class extends Te.h{constructor(t){super(t),this.type="transform-rotate",this.rotationType="geographic"}};(0,a._)([(0,r.Cb)()],qe.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],qe.prototype,"rotation",void 0),(0,a._)([(0,r.Cb)()],qe.prototype,"rotationPrecision",void 0),(0,a._)([(0,r.Cb)()],qe.prototype,"orientation",void 0),(0,a._)([(0,r.Cb)()],qe.prototype,"orientationPrecision",void 0),(0,a._)([(0,r.Cb)()],qe.prototype,"rotationType",void 0),qe=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],qe);let Je=class extends Te.h{constructor(t){super(t),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,a._)([(0,r.Cb)()],Je.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],Je.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],Je.prototype,"size",void 0),(0,a._)([(0,r.Cb)()],Je.prototype,"sizeUnit",void 0),(0,a._)([(0,r.Cb)()],Je.prototype,"sizePrecision",void 0),Je=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Je);let $e=class extends Te.h{constructor(t){super(t),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var Ke,ti;(0,a._)([(0,r.Cb)()],$e.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"orientation",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"orientationEnabled",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"orientationPrecision",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"rotationType",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"size",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"sizeUnit",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"sizeEnabled",void 0),(0,a._)([(0,r.Cb)()],$e.prototype,"sizePrecision",void 0),$e=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],$e),function(t){t.ScaleIn=Ut.jg.Custom2,t.ScaleOut=Ut.jg.Custom3,t.RotateLeft=Ut.jg.Custom4,t.RotateRight=Ut.jg.Custom5,t.Unlocked=Ut.jg.Custom7,t.DelayedFocused=Ut.jg.Custom8,t.TouchInput=Ut.jg.Custom12}(Ke||(Ke={}));class ei{constructor({adapter:t,tooltipOptions:e,mode:i,tool:a}){this._mode=null,this._handles=new Dt.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new tt.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,s.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=a,this._mode=i,this._adapter=t,this._tooltipOptions=e,this._tooltip=new ce.u({view:a.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,o.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),o.nn))}get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}destroy(){(0,s.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,s.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,s.SC)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=(0,Be.A)({update:({deltaTime:e})=>{t.update(e)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){(0,s.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,s.SC)(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,$.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const e=this.tool.graphicState.graphic,i=(0,Xt.Xd)(t,((t,i,a)=>{this._scaleRotateDragData=null;const n=this._adapter.startInteraction(),o={mode:"none",origin:(0,c.a)(t.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=o,this._updateDragState();const r=Vt.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,r),i.next((0,zt._N)(this.tool.view,(0,Me.Yq)(t.renderLocation,r,(0,Me.Ue)()))).next((t=>{const i=(0,Me.mJ)(t.plane),a=(0,nt.Gd)(t.renderStart,t.renderEnd,o.origin,i),r=Fe.Q4.shortestSignedDiff(o.angle,a);o.angleDir=(0,rt.uZ)(o.angleDir+r,-.3,.3),o.angle=a;const l=function(t,e){const i=(0,h.b)(Vt.WM.get(),e.renderStart,t.origin),a=(0,h.b)(Vt.WM.get(),e.renderEnd,t.origin),n=(0,h.l)(i),s=(0,h.l)(a);return 0===n?0:s/n}(o,t),p=l-this._adapter.scale;if(o.scaleDir=(0,rt.uZ)(o.scaleDir+p,-.2,.2),this._onScaleChanged(),"none"===o.mode){const i=this._mode||function(t,e,i,a){const{renderStart:n,renderEnd:s}=t,o=ii(n,a,Vt.WM.get()),r=ii(s,a,Vt.WM.get());if((0,h.d)(o,r)<100)return null;const l=(0,h.b)(Vt.WM.get(),n,i),p=(0,h.f)(Vt.WM.get(),l,(0,Me.mJ)(e)),c=n,d=(0,h.a)(Vt.WM.get(),c,p),u=ii(i,a,Vt.WM.get()),g=o,_=ii(d,a,Vt.WM.get()),m=(0,h.b)(Vt.WM.get(),_,g),v=(0,h.b)(Vt.WM.get(),o,u),y=(0,Qe.re)(g,m),f=(0,Qe.re)(u,v);return(0,Qe.Jk)(y,r)<(0,Qe.Jk)(f,r)?"rotate":"scale"}(t,t.plane,o.origin,this.tool.view.state.camera);if((0,s.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:e,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:e,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}o.mode=i}}switch(o.mode){case"rotate":n.state.angle=o.initialAngle+a;break;case"scale":n.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),t.action){case"start":case"update":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:e,angle:(0,rt.BV)(o.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:e,xScale:l,yScale:l})}break;case"end":switch(o.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:(0,rt.BV)(o.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:l,yScale:l})}}return"end"===t.action&&(this.startAnimation(ai(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),n.done()),t})).next(this._updateTooltipPipelineStep(o)),a.next((()=>{if(n.cancel(),(0,s.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:1,yScale:1})}this.startAnimation(ai(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,t.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function(t,e){let i=0,a=null;const n=()=>!1;return{start:()=>{a=t.getFocused,t.getFocused=n,i=0,e()},update:t=>(i+=t,!a()||i>200?ti.STOP:ti.CONTINUE),destroy:()=>{t.getFocused=a,e()}}}(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState()})),t.events.on("immediate-click",(t=>{t.stopPropagation()})),(0,o.YP)((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),o.nn)])}_updateTooltipPipelineStep(t){return e=>{const i=this._tooltipOptions;if(!i.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const a=this._tooltip,n=this._tooltipOptions.visualVariables,o=(0,s.pC)(n)?n.size:null,r=(0,s.pC)(n)?n.rotation:null;switch(t.mode){case"scale":a.info=new Je({tooltipOptions:i,scale:{value:this._adapter.scale},size:(0,it.yG)((0,s.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,s.pC)(o)?o.unit:null,sizePrecision:(0,s.pC)(o)?ni(o.valueType):null});break;case"rotate":{const t=(0,s.pC)(r)?ni(r.valueType):null,e=(0,s.pC)(r)?r.rotationType:"geographic";a.info=new qe({tooltipOptions:i,rotation:(0,it.GJ)((0,s.Pt)(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:t,orientation:(0,it.GJ)(-this._adapter.angle,"radians","geographic"),orientationPrecision:t,rotationType:e})}}return e}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=(0,s.pC)(t)?t.rotation:null,i=(0,s.pC)(t)?t.size:null;this._tooltip.info=new $e({tooltipOptions:this._tooltipOptions,orientation:(0,it.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,s.pC)(e)?ni(e.valueType):null,rotationType:(0,s.pC)(e)?e.rotationType:"geographic",size:(0,it.yG)((0,s.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,s.pC)(i)?i.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,s.pC)(i)?ni(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Ke.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Ke.Unlocked,!((0,s.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,s.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Ke.ScaleIn|Ke.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Ke.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Ke.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Ke.RotateLeft|Ke.RotateRight,!1),this._ringManipulator.updateStateEnabled(Ke.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Ke.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Ke.ScaleIn|Ke.ScaleOut|Ke.RotateLeft|Ke.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,It.d)(Vt.MP.get(),this._adapter.angle,(0,c.f)(0,0,1));if((0,s.Wi)(t))return;const e=this.getScale(),i=(0,It.C)(Vt.MP.get(),(0,h.s)(Vt.WM.get(),e,e,e));this._ringManipulator.modelTransform=(0,It.m)(Vt.MP.get(),i,t)}_createRingManipulator(){const t=(t,e,i)=>{const a=[],n=Math.ceil(128*(e-t)/(2*Math.PI));for(let s=0;s<n+1;s++){const o=t+s*(e-t)/n;a.push((0,c.f)(i*Math.cos(o),i*Math.sin(o),0))}return a},e=e=>t(0,2*Math.PI,e),i=(t,e)=>(0,Yt.x2)((t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]])(e),t,[],[],!1),a=e(At),n=i(a,24),s={left:[],right:[]},o=[];for(let e=0;e<2;e++){const a=e*Math.PI-Math.PI/4,n=Math.PI/2-Tt,r=a+n,l=a+Math.PI/2-n,p=t(r,l,190),h=i(p,9);o.push(p),o.push(t(r,l,201)),s.left.push(h),s.right.push(h);for(let t=0;t<2;t++){const e=0===t,i=(0,Lt.c)();if(e){(0,It.k)(i,i,[1,-1,1]),(0,It.e)(i,i,-r,[0,0,1]);const t=Math.round(.2*(p.length-1));i[12]=p[t][0],i[13]=p[t][1],i[14]=p[t][2]}else{(0,It.e)(i,i,l,[0,0,1]);const t=Math.round(.8*(p.length-1));i[12]=p[t][0],i[13]=p[t][1],i[14]=p[t][2]}const a=(0,Yt.DA)(60,0,23,.5);(0,Yt.mx)(a,i),(e?s.left:s.right).push(a)}}const r=[];for(let e=0;e<2;e++){const a=e*Math.PI-Math.PI/4,n=Math.PI/2-Gt,s=a+n,o=a+Math.PI/2-n,l=t(s,o,213);r.push(i(l,9))}const l=e(190),p=e(213),h=i(l,9),u=i(p,9),g=e(130),_=e(107),m=i(g,9),v=i(_,9),y=this._createMaterial(),f=this._createMaterial(.66),b=this._createMaterial(.5),M=this._createMaterial(.33);let S=[{geometry:n,material:y,stateMask:Ke.DelayedFocused},{geometry:n,material:b,stateMask:Ut.Q9.None}];this._mode&&"scale"!==this._mode||(S=S.concat([{geometry:r,material:y,stateMask:Ke.DelayedFocused|Ke.Unlocked},{geometry:h,material:f,stateMask:Ke.DelayedFocused|Ke.ScaleIn},{geometry:u,material:M,stateMask:Ke.DelayedFocused|Ke.ScaleIn},{geometry:m,material:f,stateMask:Ke.DelayedFocused|Ke.ScaleOut},{geometry:v,material:M,stateMask:Ke.DelayedFocused|Ke.ScaleOut}])),this._mode&&"rotate"!==this._mode||(S=S.concat([{geometry:s.right,material:y,stateMask:Ke.DelayedFocused|Ke.Unlocked},{geometry:s.left,material:y,stateMask:Ke.DelayedFocused|Ke.RotateLeft},{geometry:s.right,material:y,stateMask:Ke.DelayedFocused|Ke.RotateRight}]));const x=[a,...o];return new lt.Z({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,d.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:(0,c.f)(0,0,1)}})}_createMaterial(t=1){const e=(0,je.b)([...wt,t]);return new Ht.E({color:e,transparent:1!==t,cullFace:Nt.Vr.Back,renderOccluded:H.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function ii(t,e,i){return e.projectToScreen(t,si),(0,h.s)(i,si[0],si[1],0)}function ai(t,e){let i=null,a=1;const n=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=n,e()},update:t=>(a+=((a+1)/2-a)*Math.min(3*t,1),e(),Math.abs(a-1)<.01?ti.STOP:ti.CONTINUE),destroy:()=>{t.getScale=i,e()}}}function ni(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(ti||(ti={}));const si=(0,g.s1)();var oi=i(34218);function ri(t){return(0,s.pC)(t.geometry)&&"mesh"===t.geometry.type?function(t){return(0,s.pC)(t.transform)?function(t,e){let i=e.clone(),a=null;return{undo:e=>{a=(0,s.pC)(t.transform)?t.transform.clone():null,t.transform=i,e.notifyGeometryChanged()},redo:e=>{i=(0,s.pC)(t.transform)?t.transform.clone():null,t.transform=a,e.notifyGeometryChanged()}}}(t,t.transform):function(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}(t)}(t.geometry):function(t){let e=t.geometry,i=s.YP;return{undo(t){i=t.geometry,t.geometry=e},redo(t){e=t.geometry,t.geometry=i}}}(t)}let li=class extends et.r{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([(0,o.gx)((()=>(0,s.pC)(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(({interactionState:t})=>{this._updateMeshRotation(t)}),o.Z_),(0,o.gx)((()=>(0,s.pC)(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(({interactionState:t})=>{this._updateMeshSize(t)}),o.Z_)])}get angle(){const t=this.geometry.transform;if((0,s.Wi)(t))return 0;const e=(0,oi.ZZ)(t.rotation)[2];return Math.abs(e)>.999999?(0,rt.Vl)((0,oi.EU)(t.rotation))*Math.sign(e):0}get scale(){return(0,s.pC)(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new pi({angle:this.angle});this._interactionState=t;const e=()=>this._interactionState=null;return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return ri(this.graphic)}_updateMeshRotation(t){const e=this.geometry.anchor,i=this.viewingMode===Ue.JY.Global,{angle:a,previousAngle:n}=t;this.geometry.rotate(0,0,(0,rt.BV)(a-n),{origin:e,geographic:i}),t.previousAngle=a,(0,s.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const e=this.geometry.anchor,i=this.viewingMode===Ue.JY.Global,{scale:a,previousScale:n}=t;this.geometry.scale(a/n,{origin:e,geographic:i}),t.previousScale=a,(0,s.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,a._)([(0,r.Cb)({constructOnly:!0})],li.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],li.prototype,"geometry",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],li.prototype,"viewingMode",void 0),(0,a._)([(0,r.Cb)()],li.prototype,"angle",null),(0,a._)([(0,r.Cb)()],li.prototype,"scale",null),(0,a._)([(0,r.Cb)()],li.prototype,"_interactionState",void 0),li=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],li);let pi=class extends m.Z{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,a._)([(0,r.Cb)()],pi.prototype,"angle",void 0),(0,a._)([(0,r.Cb)()],pi.prototype,"initialAngle",void 0),(0,a._)([(0,r.Cb)()],pi.prototype,"previousAngle",void 0),(0,a._)([(0,r.Cb)()],pi.prototype,"previousScale",void 0),(0,a._)([(0,r.Cb)()],pi.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],pi.prototype,"state",null),pi=(0,a._)([(0,p.j)("InteractionState")],pi);let hi=class extends et.r{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,o.gx)((()=>(0,s.pC)(this._interactionState)?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),o.Z_))}get angle(){return(0,s.pC)(this._interactionState)?this._interactionState.angle:(0,s.pC)(this._orientationReferenceSymbolLayer)?function(t){return-(0,rt.Vl)(t)}(this._orientationReferenceSymbolLayer.heading):0}get scale(){return(0,s.pC)(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,s.pC)(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if((0,s.Wi)(t))return null;const e=this.findLayerView(),i=this._graphicSymbol;if((0,s.Wi)(e)||(0,s.Wi)(i)||"point-3d"!==i.type)return null;const a=e.getSymbolLayerSize(i,t);if("size"in a&&(0,s.pC)(a.size))return a.size;const n=this.sizeAxis;return"width"in a&&(0,s.pC)(a.width)&&((0,s.Wi)(n)||"width"===n||"all"===n||"width-and-depth"===n)?a.width:"depth"in a&&(0,s.pC)(t.depth)&&((0,s.Wi)(n)||"depth"===n||"all"===n||"width-and-depth"===n)?a.depth:"height"in a&&(0,s.pC)(t.height)&&((0,s.Wi)(n)||"height"===n||"all"===n)?a.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return(0,s.Wi)(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return(0,s.Wi)(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&(0,s.pC)(t.heading)))}get _graphicSymbol(){return(0,s.pC)(this.graphic)&&(0,s.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if((0,s.pC)(this._interactionState)||(0,s.Wi)(t)||(0,s.Wi)(e))return ci;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),a=t.clone(),n=this.angle,o=new di({originalSymbol:a,angle:n,initialSizes:i});this._interactionState=o;const r=()=>this._interactionState=null;return{state:o,done:r,cancel:()=>{this._graphicSymbol=a,r()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol({scale:t,angle:e,originalSymbol:i,initialSizes:a}){const n=this._graphicSymbol;if((0,s.Wi)(n)||"point-3d"!==n.type)return;const o=n.clone(),r=-(0,rt.BV)(e-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(i,o,((e,i,n)=>{const o=(0,s.Pt)(e.heading,0)+r;i.heading!==o&&(i.heading=o,l=!0);const p=a[n];if((0,s.pC)(p)&&"width"in p){p.width=this.sizeFilter(p.width),p.height=this.sizeFilter(p.height),p.depth=this.sizeFilter(p.depth);const e=p.width*t;i.width!==e&&(i.width=e,l=!0);const a=p.depth*t;i.depth!==a&&(i.depth=a,l=!0);const n=p.height*t;i.height!==n&&(i.height=n,l=!0)}})),l&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,a)=>{const n=e.symbolLayers.getItemAt(a);"object"===t.type&&"object"===n.type&&i(t,n,a)}))}};(0,a._)([(0,r.Cb)()],hi.prototype,"angle",null),(0,a._)([(0,r.Cb)()],hi.prototype,"scale",null),(0,a._)([(0,r.Cb)()],hi.prototype,"relativeAngle",null),(0,a._)([(0,r.Cb)()],hi.prototype,"initialAngle",null),(0,a._)([(0,r.Cb)()],hi.prototype,"size",null),(0,a._)([(0,r.Cb)()],hi.prototype,"sizeAxis",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],hi.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)()],hi.prototype,"_interactionState",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],hi.prototype,"findLayerView",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],hi.prototype,"sizeFilter",void 0),(0,a._)([(0,r.Cb)()],hi.prototype,"_sizeReferenceSymbolLayer",null),(0,a._)([(0,r.Cb)()],hi.prototype,"_orientationReferenceSymbolLayer",null),(0,a._)([(0,r.Cb)()],hi.prototype,"_graphicSymbol",null),hi=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],hi);const ci={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let di=class extends m.Z{constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}}};(0,a._)([(0,r.Cb)()],di.prototype,"originalSymbol",void 0),(0,a._)([(0,r.Cb)()],di.prototype,"angle",void 0),(0,a._)([(0,r.Cb)()],di.prototype,"initialAngle",void 0),(0,a._)([(0,r.Cb)()],di.prototype,"initialSizes",void 0),(0,a._)([(0,r.Cb)()],di.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],di.prototype,"state",null),di=(0,a._)([(0,p.j)("InteractionState")],di);let ui=class extends((0,et.p)(tt.Z.EventedMixin(oe.m))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new le.Z,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new he.n,this._tooltip=null}initialize(){const{graphic:t,view:e}=this;this.graphicState=new Y.F({graphic:t}),this.addHandles((0,o.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new ce.u({view:e}):(0,s.SC)(this._tooltip)}),o.tX)),this._moveManipulation=new te({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&(0,ot.c)(t),radius:te.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const i=t=>e=>{this.handles.add(e.events.on("focus-changed",(({action:e})=>{const i=this._tooltip;(0,s.Wi)(i)||("focus"===e?this._updateMoveTooltip(t):i.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(ie.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(ie.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(ie.Z)),this._moveManipulation.elevationInfo=(0,d.RL)(t);const a=t.geometry;if(this._moveManipulation.createGraphicDragPipeline(((i,n,o,r,l)=>((0,s.pC)(a)&&i===ie.XY&&(o=o.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new pe.N({elevationInfo:(0,d.RL)(t),pointer:l,editGeometryOperations:re.c.fromGeometry(new He.Z({spatialReference:a.spatialReference}),e.state.viewingMode),visualizer:new V._,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:r,useZ:!1}),this._snappingPipeline.next)),o.next((t=>(this._updateMoveTooltip(i,t),t))))),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:n}=t,s={graphic:i,dxScreen:a,dyScreen:n};switch(e){case"start":this.emit("graphic-translate-start",s),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",s);break;case"end":this.emit("graphic-translate-stop",s)}})),this._moveManipulation.angle=(0,s.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,o.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new ei({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([Ct({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,n.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,o.YP)((()=>e.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof lt.Z&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,s.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,s.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,s.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,s.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,s.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new li({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new hi({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:(0,s.pC)(this.tooltipOptions.visualVariables)&&(0,s.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),(0,s.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return(0,o.YP)((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&(0,ot.c)(this.graphic)}))}_createGeometryUndoRecord(){return ri(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,(0,s.pC)(this._scaleRotate)&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,(0,s.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){(0,s.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,s.Wi)(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t}_updateMoveAngle(){this.view.state.viewingMode===Ue.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){(0,nt.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if((0,s.Wi)(a))return;a.clear();const n=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case ie.XY:a.info=new de.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>(0,E.GQ)(t,e,n)));break;case ie.XY_AXIS:a.info=new de.in({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=(0,E.GQ)(t,i,n);return(0,it.bA)(a,kt(e))}));break;case ie.Z:a.info=new de.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,ue._e)}}_updateMoveTooltipDistance(t,e,i){if((0,s.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,o=i(a,n);t.distance=(0,s.pC)(o)?o:it.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,s.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],ui.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],ui.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],ui.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)()],ui.prototype,"enableRotation",void 0),(0,a._)([(0,r.Cb)()],ui.prototype,"enableScaling",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:le.Z})],ui.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)()],ui.prototype,"graphicState",void 0),(0,a._)([(0,r.Cb)({value:!1})],ui.prototype,"snapToScene",null),(0,a._)([(0,r.Cb)({constructOnly:!0})],ui.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],ui.prototype,"type",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],ui.prototype,"updating",null),ui=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ui);var gi=i(96739),_i=i(22711),mi=i(28401);class vi{constructor(){this._lastDragEvent=null,this.next=new Xt.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,s.pC)(this._lastDragEvent)){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this.next.execute(e)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const e=(0,_i.J0)(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}var yi=i(40460),fi=i(28835),bi=i(15328),Mi=i(15772),Si=i(47472);function xi(t,e){return wi(t,e,!1)}function Ci(t,e){return wi(t,e,!0)}function wi(t,e,i){if(t instanceof fi.y){if(t.operation instanceof bi.z)return function(t,e,i=!1){const a=i?-1:1,n=(0,c.f)(a*t.dx,a*t.dy,a*t.dz);(0,h.a)(e.origin,e.origin,n)}(t.operation,e,i),!0;if(t.operation instanceof Mi.S)return function(t,e,i=!1){const a=i?-t.angle:t.angle;(0,h.I)(e.basis1,e.basis1,c.Z,a),(0,h.I)(e.basis2,e.basis2,c.Z,a)}(t.operation,e,i),!0;if(t.operation instanceof Si.q)return function(t,e,i=!1){const a=i?1/t.factor1:t.factor1,n=i?1/t.factor2:t.factor2;(0,h.g)(e.basis1,e.basis1,a),(0,h.g)(e.basis2,e.basis2,n),(0,M.u)(e.origin,e.origin,t.origin,t.axis1,a),(0,M.u)(e.origin,e.origin,t.origin,t.axis2,n)}(t.operation,e,i),!0}return!1}function Ei(t,e,i,a){const n=Vt.WM.get();(0,h.b)(n,(0,h.b)(n,t.origin,t.basis1),t.basis2);const o=Vt.WM.get();(0,h.z)(o,n,t.basis1,2);const r=Vt.WM.get();(0,h.z)(r,o,t.basis2,2);const l=Vt.WM.get();(0,h.z)(l,n,t.basis2,2),n[2]=o[2]=r[2]=l[2]=e;const p=a?"on-the-ground":"absolute-height",c=(0,it.Fp)((0,E.bZ)(n,o,i,p),(0,E.bZ)(l,r,i,p)),d=(0,it.Fp)((0,E.bZ)(o,r,i,p),(0,E.bZ)(n,l,i,p));return(0,s.Wi)(d)||(0,s.Wi)(c)?null:[c,d]}var Oi=i(69744);let Ai=class extends(tt.Z.EventedMixin(oe.m)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new le.Z,this._preserveAspectRatio=new vi,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new Dt.Z,this._moveZManipulator=null,this._resizeManipulators=null,this._rotateManipulator=null,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,gi.a)(),this._mapBoundsStart=(0,gi.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,gi.a)(),this._displayBoundsStart=(0,gi.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,S.a)(),this._endScale=(0,S.a)()}initialize(){const{view:t,graphic:e,manipulators:i,_handles:a}=this,r=this._graphicState=new Y.F({graphic:e}),l=e.geometry;this._editGeometryOperations=re.c.fromGeometry(l,t.state.viewingMode),this._graphicMoveManipulation=new ne({tool:this,view:t,graphicState:r}),this._moveZManipulator=(0,_i.Pt)(t,_i.lX.CENTER_ON_CALLOUT),this._moveZManipulator.state|=_i.Df,a.add([this._createMoveXYGraphicDragPipeline(),(0,o.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,$.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=(0,_i.vw)(t,e);return a.add([(0,o.YP)((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,$.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=(0,mi.O)(t.toolViewManager.textures),this._rotateManipulator=(0,nt.Ju)(t,{texture:this._rotateManipulatorTexture.texture}),a.add([(0,o.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,$.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const p=Ct({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,n.kB)()});(0,s.pC)(p)&&(this._outlineVisualElement=p.visualElement instanceof W.k?p.visualElement:null),(0,s.pC)(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),a.add(p),a.add([r.on("changed",(()=>this._onGeometryChanged())),(0,o.YP)((()=>r.displaying),(()=>this._updateAllManipulatorAvailability())),(0,o.YP)((()=>r.isDraped),(()=>this._graphicDrapedChanged()),o.nn),t.trackGraphicState(r)]);const h=t.pointsOfInterest;h&&a.add((0,o.YP)((()=>h.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));this._forEachManipulator((t=>{a.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((t,i)=>{a.add(t.events.on("immediate-click",(t=>{i===$.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new ce.u({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{(0,M.s)(this._startScale,t.xScale,t.yScale),(0,M.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{(0,M.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{(0,M.s)(this._startScale,0,0),(0,M.s)(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,s.Pt)(this._moveXYTooltipInfo,(()=>new de.$E({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo=(0,s.Pt)(this._moveZTooltipInfo,(()=>new de.QW({tooltipOptions:this.tooltipOptions}))),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=(0,ue.Cr)(e,i,this.view.spatialReference);if((0,s.Wi)(a))return null;t.distance=a}else t.distance=(0,it.yG)(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo=(0,s.Pt)(this._rotateTooltipInfo,(()=>new Oi.c({tooltipOptions:this.tooltipOptions})));return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if((0,s.Wi)(t))return null;const e=this._scaleTooltipInfo=(0,s.Pt)(this._scaleTooltipInfo,(()=>new Oi.p({tooltipOptions:this.tooltipOptions}))),i=Ei(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return(0,s.Wi)(i)?null:(e.xSize=i[0],e.ySize=i[1],(0,s.pC)(this._sizeStart)&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(Ti),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{(0,s.pC)(this._attachmentOrigin)&&(0,yt.jE)(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),Ti)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof lt.Z){const a=this._graphicState.displaying,n=this.enableZ&&(0,ot.c)(this.graphic);switch(e){case $.ROTATE:t.available=a&&this.enableRotation;break;case $.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||n),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?_i.Sc:_i.vc;break;case $.TRANSLATE_Z:t.available=a&&n;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,$.SCALE))),t(this._rotateManipulator,$.ROTATE),t(this._moveZManipulator,$.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return(0,s.Pt)((0,b.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=(0,M.a)(Vt.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,M.f)(a,a);const n=(0,s.Pt)((0,nt.du)(this.view,this.graphic),(()=>t.extent.center));let o=Di*this.view.pixelSizeAt(n);const r=this.view.spatialReference,l=t.spatialReference;r.equals(l)||(o*=(0,b.c9)(r)/(0,b.c9)(l)),function(t,e,i,a){a||(a=(0,gi.a)());const n=(0,M.s)(Vt.qW.get(),t[1],-t[0]),s=(0,M.s)(Vt.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=(0,M.s)(Vt.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),r=Vt.qW.get();e.components.forEach((e=>e.vertices.forEach((e=>{const i=e.pos;(0,M.s)(r,(0,M.h)(t,i),(0,M.h)(n,i)),(0,M.y)(s,s,r),(0,M.z)(o,o,r)}))));const l=1e-6,p=(0,M.s)(Vt.qW.get(),o[0]-s[0]<l?i/2:0,o[1]-s[1]<l?i/2:0);(0,M.a)(s,s,p),(0,M.j)(o,o,p),(0,M.b)(a.basis1,t,(o[0]-s[0])/2),(0,M.b)(a.basis2,n,(o[1]-s[1])/2),(0,M.s)(a.origin,s[0]*t[0]+s[1]*n[0],s[0]*t[1]+s[1]*n[1]),(0,M.j)(a.origin,a.origin,a.basis1),(0,M.j)(a.origin,a.origin,a.basis2)}(a,e,o,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos);i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const t=this.graphic.geometry;if((0,s.Wi)(t))return;const e=(0,s.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,s.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:(0,nt.du)(this.view,this.graphic);this._attachmentOrigin=(0,s.Pt)(e,t.extent.center);const i=(0,s.pC)(e)?e.z:(0,k.w7)(this._mapBounds.origin,this.view.elevationProvider,N.o.fromElevationInfo((0,d.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,gi.c)(this._mapBounds);a.origin[2]=i,function(t,e,i,a=0,n){n||(n=(0,gi.a)()),e.toRenderCoords(t.origin,i,n.origin);const s=Vt.WM.get();(0,h.a)(s,t.origin,t.basis1),(0,h.a)(s,s,t.basis2),e.toRenderCoords(s,i,s);const o=Vt.WM.get();(0,h.a)(o,t.origin,t.basis1),(0,h.b)(o,o,t.basis2),e.toRenderCoords(o,i,o);const r=Vt.WM.get();(0,h.b)(r,t.origin,t.basis1),(0,h.b)(r,r,t.basis2),e.toRenderCoords(r,i,r);const l=Vt.WM.get();(0,h.b)(l,t.origin,t.basis1),(0,h.a)(l,l,t.basis2),e.toRenderCoords(l,i,l);const p=(0,h.h)(Vt.WM.get(),s,o,.5);(0,h.b)(p,p,n.origin);const c=(0,h.h)(Vt.WM.get(),r,l,.5);(0,h.b)(c,n.origin,c),(0,h.h)(n.basis1,p,c,.5);const d=(0,h.h)(Vt.WM.get(),l,s,.5);(0,h.b)(d,d,n.origin);const u=(0,h.h)(Vt.WM.get(),o,r,.5);(0,h.b)(u,n.origin,u),(0,h.h)(n.basis2,d,u,.5);const g=(0,h.f)(Vt.WM.get(),n.basis1,n.basis2),_=(0,h.f)(g,g,n.basis1);(0,h.n)(_,_),(0,h.g)(n.basis2,_,(0,h.e)(n.basis2,_)),(0,h.g)(n.basis1,n.basis1,1+a/(0,h.l)(n.basis1)),(0,h.g)(n.basis2,n.basis2,1+a/(0,h.l)(n.basis2)),(0,gi.u)(n)}(a,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent.center;return Gi*this.view.pixelSizeAt(e)}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,ie.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return(0,Xt.Xd)(this._moveZManipulator,((i,a,n)=>{const s=(0,c.a)(i.renderLocation),o=a.next((0,zt.Sp)(t,s,e)).next((0,Xt.zh)());this._applyGraphicMoveSteps(o,n,ie.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next((0,Xt.AN)()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||t.mapEnd.z-t.mapStart.z)&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){(0,gi.c)(this._displayBounds,this._displayBoundsStart),(0,gi.c)(this._mapBounds,this._mapBoundsStart),(0,s.Wi)(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=Ei(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return t=>{if((0,s.Wi)(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const t of this._editGeometryOperations.data.components)e.push(...t.vertices);const i="start"===t.action?Ae.O.NEW_STEP:Ae.O.ACCUMULATE_STEPS;return xi(this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===ie.XY||e===ie.XY_AXIS){const e=(0,E.GQ)(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,s.pC)(e)&&(0,s.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab(t){if("start"!==t.action)return;const e=this._calculatePickRay(t.screenPoint);(0,Me.BR)(this._displayBounds.plane,e,Vt.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return(0,Xt.Xd)(t,((t,i,a)=>{(0,s.Wi)(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next((0,zt._N)(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,n=this._displayBoundsMarginStart,s=(0,h.c)(Vt.WM.get(),e.origin);(0,h.z)(s,s,e.basis1,-i[0]),(0,h.z)(s,s,e.basis2,-i[1]);const o=(0,h.b)(Vt.WM.get(),t.renderEnd,s),r=(0,h.b)(Vt.WM.get(),t.renderStart,s),l=(0,_i.J0)(t.handle),p=(0,_i.Lw)(e),c=(0,_i.Lw)(this._displayBounds)/p,d=(t,e)=>{if(0===t)return 1;let i=(0,h.l)(e),s=.5*t*(0,h.e)(e,o)/i;const p=s<0?-1:1;l&&(s+=(i-.5*t*(0,h.e)(e,r)/i)*p*c);const d=i<1.5*n?1:Ri;return i=Math.max(i-n,Ri),p>0&&(s-=a),p*Math.max(p*(s/i),d)};return{...t,factor1:d(i[0],e.basis1),factor2:d(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=(0,h.c)((0,c.c)(),this._mapBoundsStart.origin);(0,h.z)(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),(0,h.z)(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=(0,M.s)((0,S.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,M.f)(i,i);const a=[];for(const t of this._editGeometryOperations.data.components)a.push(...t.vertices);const n="start"===t.action?Ae.O.NEW_STEP:Ae.O.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,n,fi.w.REPLACE);return(0,gi.c)(this._mapBoundsStart,this._mapBounds),xi(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab(t){if("start"!==t.action)return;const e=(0,_i.Rd)(this._displayBounds,this.view.renderCoordsHelper,_i.aZ.HEADING,(0,Me.Ue)()),i=this._calculatePickRay(t.screenPoint);(0,Me.BR)(e,i,Vt.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:e})}_createRotateDragPipeline(t){return(0,Xt.Xd)(t,((t,e,i)=>{const a=this.inputState;(0,s.Wi)(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next((0,zt._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:(0,rt.BV)(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{(0,s.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=(0,Me.mJ)(t.rotatePlane),a=(0,nt.Gd)(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=(0,h.c)((0,c.c)(),this._mapBoundsStart.origin),i=[];for(const t of this._editGeometryOperations.data.components)i.push(...t.vertices);const a="start"===t.action?Ae.O.NEW_STEP:Ae.O.ACCUMULATE_STEPS,n=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,fi.w.REPLACE);return(0,gi.c)(this._mapBoundsStart,this._mapBounds),xi(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=(0,Qe.Ue)(),i=(0,g.md)(t);return(0,yi.u4)(this.view.state.camera,i,e),(0,h.n)(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=(0,_i.zY)(this._displayBounds,Vt.MP.get());(0,_i.A5)(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{(0,_i.EC)(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:(0,h.b)(Vt.WM.get(),i.origin,i.basis1),edge:2},n=Vt.MP.get();(0,It.o)(n,e,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,t.modelTransform=n,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;(0,s.Wi)(t)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Ci(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if((0,s.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ci((0,s.Wg)(t),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,xi((0,s.Wg)(t),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ai.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ai.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],Ai.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)()],Ai.prototype,"enableRotation",void 0),(0,a._)([(0,r.Cb)()],Ai.prototype,"enableScaling",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:le.Z})],Ai.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)()],Ai.prototype,"preserveAspectRatio",null),(0,a._)([(0,r.Cb)()],Ai.prototype,"grabbing",void 0),(0,a._)([(0,r.Cb)()],Ai.prototype,"inputState",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Ai.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],Ai.prototype,"_moveUnit",null),Ai=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ai);const Ti="draped-elevation-changes",Gi=10,Di=80,Ri=1e-6},41652:(t,e,i)=>{i.d(e,{c:()=>s,t:()=>o});var a=i(61681),n=i(83772);function s(t,e=(0,n.RL)(t)){return"on-the-ground"!==e.mode&&!((0,a.Wi)(t.geometry)||!t.geometry.hasZ)}function o(t,e){let i=null;const n=t.events.on("grab-changed",(n=>{(0,a.pC)(i)&&(i.remove(),i=null),"start"===n.action?(i=t.disableDisplay(),e&&e(n)):e&&e(n)}));return{remove(){(0,a.pC)(i)&&i.remove(),n.remove()}}}},15230:(t,e,i)=>{i.d(e,{k:()=>I});var a=i(31355),n=i(61681),s=i(6766),o=i(8909),r=i(88589),l=i(18916),p=i(90472),h=i(37116),c=i(48358),d=i(83772),u=i(74710),g=i(36663),_=i(53443),m=i(86618),v=i(81977),y=(i(7753),i(7283),i(40266)),f=i(43977),b=i(70984),M=i(79341);class S{constructor(t){this._resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,n.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(t){t!==this._attached&&(this._attached=t,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,n.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,n.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const t=this._resourceFactory.createResources(),e=new x({view:this._resourceFactory.view}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new x({view:this._resourceFactory.view}),external:t,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(e)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,n.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const t=this._resourceFactory.view.basemapTerrain?.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,n.Wi)(this._resources)||(0,n.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,M.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,n.Wi)(this._resources)||(0,n.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,M.T.UPDATE),this._resources.geometriesAdded=!0)}}let x=class extends((0,m.IG)(_.Z)){constructor(t){super(t),this.drapeSourceType=f.L.Features,this.updatePolicy=b.jq.SYNC}};(0,g._)([(0,v.Cb)({constructOnly:!0})],x.prototype,"view",void 0),(0,g._)([(0,v.Cb)({readOnly:!0})],x.prototype,"drapeSourceType",void 0),x=(0,g._)([(0,y.j)("DrapedVisualElementLayerView")],x);var C=i(40199),w=i(7426),E=i(29642),O=i(24370),A=i(41942),T=i(36620),G=i(7358),D=i(96047),R=i(21414),P=i(65392);class I{constructor(t){this.view=null,this._attachmentOrigin=(0,c.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new a.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,l.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,l.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=G.yD.OccludeAndTransparentStencil,this._resources=new w.O({view:t.view,createResources:t=>this._createResources(t),recreateGeometry:(t,e)=>(t.geometries.length=0,this._recreateGeometry(e,t.material,t.geometries),t.geometries)}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this._drapedResources=new S({view:t.view,createResources:()=>this._createDrapedResources(),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}});let e=!0;this._laserline=new C.W({view:t.view});for(const i in t)i in this?"attached"===i?e=t[i]:this[i]=t[i]:console.error("Cannot set unknown property",i);this.attached=e}destroy(){this._resources.destroy(),this._drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(t){t!==this._isDraped&&(this._isDraped=t,this._updateAttached(this.attached),this._laserline.attached=this._laserlineAttached)}get _laserlineAttached(){return this.attached&&this.visible&&(0,n.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this._resources.visible}set visible(t){this._resources.visible=t,this._drapedResources.visible=t,this._laserline.attached=this._laserlineAttached}get attached(){return this._resources.attached||this._drapedResources.attached}set attached(t){this._updateAttached(t)}_updateAttached(t){this._resources.attached=!this.isDraped&&t,this._drapedResources.attached=this.isDraped&&t,this._laserline.attached=this._laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._resources.recreateGeometry(),this._drapedResources.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,r.g)(t,this._color)||((0,r.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,r.g)(t,this._innerColor)||((0,r.c)(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const e=(0,n.pC)(t)!==(0,n.pC)(this._stipplePattern);this._stipplePattern=t,e?this._resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&(0,r.g)(t,this._stippleOffColor)||(this._stippleOffColor=t?(0,l.a)(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this._resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,(0,n.pC)(t)&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=(0,n.pC)(this._resources.resources)?this._resources.resources.geometries:null;if(!t||0===t.length)return null;(0,s.s)(z,0,0,0);let e=0;for(const i of t){const t=i.vertexAttributes.get(R.T.POSITION),a=i.indices.get(R.T.POSITION),o=(0,n.Wg)(this._resources.resources).material.isClosed(t.data,a);(0,T.qZ)(t,a,o,V)&&((0,s.a)(z,z,V),e++)}return 0===e?null:((0,s.g)(z,z,1/e),this.view.renderCoordsHelper.fromRenderCoords(z,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,n.pC)(this._resources.resources)&&this._resources.resources.material.setParameters(this._materialParameters),(0,n.pC)(this._drapedResources.resources)&&this._drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return(0,n.pC)(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===G.yD.OccludeAndTransparentStencil?G.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,e,i){const a=this._createRenderGeometries();for(const n of a)t.addGeometry(n,e),i.push(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(t){const e=new P.U(this._materialParameters),i=[];return this._recreateGeometry(t,e,i),{material:e,geometries:i,forEach:t=>{t(e),i.forEach(t)}}}_createDrapedResources(){const t=new P.U(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const e=this.geometry;if((0,n.Wi)(e)||(0,n.Wi)(this.view.basemapTerrain.spatialReference))return[];const i=(0,A.r)(e,this.view.basemapTerrain.spatialReference),a=[];for(const{position:e}of i.lines){const i={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:e},removeDuplicateStartEnd:this._isClosed},n=new D.z((0,O.YU)(i),t),s=(0,h.cS)(L);(0,h.G1)(s,e),(0,r.s)(n.boundingSphere,.5*(s[0]+s[3]),.5*(s[1]+s[4]),0,.5*Math.sqrt((s[3]-s[0])*(s[3]-s[0])+(s[4]-s[1])*(s[4]-s[1]))),a.push(n)}return a}calculateMapBounds(t){if((0,n.Wi)(this._resources.resources))return!1;const e=this.view.renderCoordsHelper;for(const i of this._resources.resources.geometries){const a=i.vertexAttributes.get(R.T.POSITION),n=new Float64Array(a.data.length);(0,p.CM)(a.data,e.spatialReference,0,n,this.view.spatialReference,0,a.data.length/3),(0,h.G1)(t,n)}return!0}_createRenderGeometries(){const t=this.geometry;if((0,n.Wi)(t))return[];const e=(0,A.V)(t,this.view.elevationProvider,this.view.renderCoordsHelper,E.o.fromElevationInfo(this.elevationInfo??new u.Z({mode:(0,d.VW)(t,null)}))),i=[],a=[];for(const{position:t,mapPosition:n}of e.lines){const e={attributeData:{position:t,mapPosition:n},removeDuplicateStartEnd:this._isClosed};i.push((0,O.YU)(e)),a.push(t)}return this._laserline.pathVerticalPlane=a,i}}const L=(0,h.Ue)(),V=(0,o.c)(),z=(0,o.c)()},75354:(t,e,i)=>{i.d(e,{F:()=>r});var a=i(36663),n=i(31355),s=i(81977),o=(i(7753),i(7283),i(40266));let r=class extends n.Z.EventedAccessor{constructor(t){super(t),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,s.Cb)({constructOnly:!0})],r.prototype,"graphic",void 0),(0,a._)([(0,s.Cb)()],r.prototype,"tracking",void 0),(0,a._)([(0,s.Cb)()],r.prototype,"displaying",void 0),(0,a._)([(0,s.Cb)()],r.prototype,"isDraped",void 0),r=(0,a._)([(0,o.j)("esri.views.3d.layers.graphics.GraphicState")],r)},4641:(t,e,i)=>{i.d(e,{L:()=>f});var a=i(36663),n=i(53443),s=i(31355),o=i(61681),r=i(76868),l=i(95550),p=i(81977),h=(i(7753),i(7283),i(40266)),c=i(55709),d=i(6766),u=i(8909),g=i(90472),_=i(83772),m=i(5310),v=i(74710),y=i(99621);let f=class extends n.Z{constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new s.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const t="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,e=(0,_.vu)(this.graphic),i=t?t.offset:0;return new v.Z({mode:e,offset:i})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const i=e.geometry;if((0,o.Wi)(i))return null;const a=this._get("focusedSymbol"),n=(0,o.pC)(a)?a:e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,i,n):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),(0,o.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,o.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,r.YP)((()=>this.graphic?.symbol),(t=>{(0,o.pC)(t)&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&(0,o.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),r.Z_)}detachSymbolChanged(){(0,o.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,o.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,a){if(a=a||(0,m.js)(i),(0,o.Wi)(a))return null;let n=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,y.D)(e,i,t)?1:null;if((0,o.Wi)(n)||!n.originalPoint.equals(i)){const e=i,s=t.spatialReference;if((0,g.Up)(e.spatialReference,s)){const t=(0,g.iV)(e,s);n={originalPoint:e.clone(),mapPoint:t,radiusPx:(0,l.F2)(a.size)},this._circleCollisionCache=n}}if((0,o.pC)(n)){const i=(0,l.md)(e,M),s=t.toScreen(n.mapPoint),o=n.radiusPx,r=s.x+(0,l.F2)(a.xoffset),p=s.y-(0,l.F2)(a.yoffset);return(0,c.k)(i,[r,p])<o*o?1:null}return null}_intersectDistance3D(t,e,i){const a=t.toMap(e,{include:[i]});return a&&(0,g.KC)(a,b,t.renderSpatialReference)?(0,d.i)(b,t.state.camera.eye):null}};(0,a._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"graphic",null),(0,a._)([(0,p.Cb)()],f.prototype,"elevationInfo",null),(0,a._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),(0,a._)([(0,p.Cb)({value:null})],f.prototype,"focusedSymbol",null),(0,a._)([(0,p.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,a._)([(0,p.Cb)()],f.prototype,"interactive",void 0),(0,a._)([(0,p.Cb)()],f.prototype,"selectable",void 0),(0,a._)([(0,p.Cb)()],f.prototype,"grabbable",void 0),(0,a._)([(0,p.Cb)({value:!1})],f.prototype,"grabbing",null),(0,a._)([(0,p.Cb)()],f.prototype,"dragging",void 0),(0,a._)([(0,p.Cb)()],f.prototype,"hovering",null),(0,a._)([(0,p.Cb)({value:!1})],f.prototype,"selected",null),(0,a._)([(0,p.Cb)()],f.prototype,"cursor",void 0),f=(0,a._)([(0,h.j)("esri.views.interactive.GraphicManipulator")],f);const b=(0,u.c)(),M=(0,l.s1)()},69744:(t,e,i)=>{i.d(e,{c:()=>l,p:()=>p});var a=i(36663),n=i(39405),s=i(81977),o=i(40266),r=i(54079);let l=class extends r.h{constructor(t){super(t),this.type="extent-rotate",this.angle=0}};(0,a._)([(0,s.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],l.prototype,"angle",void 0),l=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let p=class extends r.h{constructor(t){super(t),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=n.yP,this.ySize=n.yP}};(0,a._)([(0,s.Cb)()],p.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],p.prototype,"xScale",void 0),(0,a._)([(0,s.Cb)()],p.prototype,"yScale",void 0),(0,a._)([(0,s.Cb)()],p.prototype,"xSize",void 0),(0,a._)([(0,s.Cb)()],p.prototype,"ySize",void 0),p=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],p)},60389:(t,e,i)=>{i.d(e,{$E:()=>l,QW:()=>p,c1:()=>u,in:()=>h,j:()=>d,nk:()=>c});var a=i(36663),n=i(39405),s=i(81977),o=i(40266),r=i(54079);let l=class extends r.h{constructor(t){super(t),this.type="translate-graphic",this.distance=n.yP}};(0,a._)([(0,s.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],l.prototype,"distance",void 0),l=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let p=class extends r.h{constructor(t){super(t),this.type="translate-graphic-z",this.distance=n.yP}};(0,a._)([(0,s.Cb)()],p.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],p.prototype,"distance",void 0),p=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],p);let h=class extends r.h{constructor(t){super(t),this.type="translate-graphic-xy",this.distance=n.yP}};(0,a._)([(0,s.Cb)()],h.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],h.prototype,"distance",void 0),h=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],h);let c=class extends r.h{constructor(t){super(t),this.type="translate-vertex",this.distance=n.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,s.Cb)()],c.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],c.prototype,"distance",void 0),(0,a._)([(0,s.Cb)()],c.prototype,"elevation",void 0),(0,a._)([(0,s.Cb)()],c.prototype,"area",void 0),(0,a._)([(0,s.Cb)()],c.prototype,"totalLength",void 0),c=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],c);let d=class extends r.h{constructor(t){super(t),this.type="translate-vertex-z",this.distance=n.yP,this.elevation=null}};(0,a._)([(0,s.Cb)()],d.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],d.prototype,"distance",void 0),(0,a._)([(0,s.Cb)()],d.prototype,"elevation",void 0),d=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],d);let u=class extends r.h{constructor(t){super(t),this.type="translate-vertex-xy",this.distance=n.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,s.Cb)()],u.prototype,"type",void 0),(0,a._)([(0,s.Cb)()],u.prototype,"distance",void 0),(0,a._)([(0,s.Cb)()],u.prototype,"elevation",void 0),(0,a._)([(0,s.Cb)()],u.prototype,"area",void 0),(0,a._)([(0,s.Cb)()],u.prototype,"totalLength",void 0),u=(0,a._)([(0,o.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],u)},99621:(t,e,i)=>{i.d(e,{D:()=>l,K:()=>r});i(91957);var a=i(61681),n=i(17321),s=i(59468),o=i(91772);function r(t,e,i,s=new o.Z){let r;if("2d"===i.type)r=e*i.resolution;else if("3d"===i.type){const s=i.overlayPixelSizeInMapUnits(t),o=i.basemapSpatialReference;r=(0,a.pC)(o)&&!o.equals(i.spatialReference)?(0,n.c9)(o)/(0,n.c9)(i.spatialReference):e*s}const l=t.x-r,p=t.y-r,h=t.x+r,c=t.y+r,{spatialReference:d}=i;return s.xmin=Math.min(l,h),s.ymin=Math.min(p,c),s.xmax=Math.max(l,h),s.ymax=Math.max(p,c),s.spatialReference=d,s}function l(t,e,i){const n=i.toMap(t);return!(0,a.Wi)(n)&&r(n,(0,s.k)(),i,p).intersects(e)}const p=new o.Z}}]);