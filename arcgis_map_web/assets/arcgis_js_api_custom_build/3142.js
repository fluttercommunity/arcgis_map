"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[3142],{97622:(e,t,i)=>{i.d(t,{Z:()=>f});var n=i(36663),s=(i(91957),i(8400)),r=i(41151),o=i(16068),a=i(82064),l=i(81977),c=(i(7753),i(69236)),d=i(40266),h=i(7283),u=i(67666);let p=class extends((0,a.eC)(r.j)){constructor(e){super(e),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=s.n.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.Cb)({type:["length"],json:{write:{isRequired:!0}}})],p.prototype,"type",void 0),(0,n._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],p.prototype,"startPoint",void 0),(0,n._)([(0,l.Cb)({type:u.Z,json:{write:!0}})],p.prototype,"endPoint",void 0),(0,n._)([(0,l.Cb)({type:s.V,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"measureType",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"offset",void 0),(0,n._)([(0,l.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.p)((e=>o.BV.normalize((0,h.q9)(e),0,!0)))],p.prototype,"orientation",void 0),p=(0,n._)([(0,d.j)("esri.analysis.LengthDimension")],p);const f=p},8400:(e,t,i)=>{var n;i.d(t,{V:()=>s,n:()=>n}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(n||(n={}));const s=[n.Horizontal,n.Vertical,n.Direct]},73142:(e,t,i)=>{i.r(t),i.d(t,{default:()=>fs});var n,s=i(36663),r=i(53443),o=i(41831),a=i(13802),l=i(61681),c=i(76868),d=i(81977),h=(i(7753),i(7283),i(40266)),u=i(60573),p=i(8400),f=i(44584),g=i(17321),m=i(19431),_=i(39405),y=i(24455),v=i(39100),S=i(6766),w=i(8909),C=i(19546),P=i(68817),x=i(48358),b=i(45043),M=i(60033),E=i(90472),D=i(35925),A=i(89976);function T(e,t,i){const s=O(e,t,i,n.Direct);return(0,l.pC)(s)?(0,_.yG)(s.direct,s.unit):null}function O(e,t,i,s){const r=(0,A.m)(i),o=(0,g.j5)(r);if((0,l.Wi)(o))return null;const a=t[2]-e[2];if(s===n.Vertical)return{verticalSigned:a,unit:o};if(!(0,E.SH)(e,i,z,r)||!(0,E.SH)(t,i,H,r))return null;if(s===n.Direct)return{direct:(0,S.i)(H,z),unit:o};if((0,S.s)(Z,e[0],e[1],t[2]),!(0,E.SH)(Z,i,Z,r))return null;const c=(0,S.i)(Z,H);return s===n.Horizontal?{horizontal:c,unit:o}:{direct:(0,S.i)(H,z),horizontal:c,vertical:Math.abs(a),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(n||(n={}));const R=(0,w.c)(),L=(0,w.c)(),z=(0,w.c)(),H=(0,w.c)(),Z=(0,w.c)();function k(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:s,orientation:r}}=e;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i,offset:n,measureType:s,orientation:r}}function V({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,offset:i,measureType:n,orientation:s},r,o=null){if((0,l.Wi)(e)||(0,l.Wi)(t))return null;const a=F((0,l.pC)(o)?o.directSegment:new M.y,{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t},r),c=(0,l.pC)(o)?o.primaryOffsetAxis:(0,w.c)();Y(c,{measureType:n,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,directSegment:a,orientation:s,renderCoordsHelper:r});const d=(0,l.pC)(o)?o.dimensionSegment:new M.y;return q({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t})&&n===p.n.Vertical?((0,S.c)(d.startRenderSpace,a.startRenderSpace),(0,S.c)(d.endRenderSpace,a.endRenderSpace)):U(d,{offsetAxis:c,offset:i,relativeToSegment:a,renderCoordsHelper:r}),{directSegment:a,dimensionSegment:d,primaryOffsetAxis:c,spatialReference:r.spatialReference}}function I(e,t,i,n){return t===G.Start?((0,S.c)(e.startRenderSpace,i.startRenderSpace),(0,S.c)(e.endRenderSpace,n.startRenderSpace)):((0,S.c)(e.startRenderSpace,i.endRenderSpace),(0,S.c)(e.endRenderSpace,n.endRenderSpace)),e}var G;function W(e,t,i,n){switch(t){case p.n.Direct:return F(e,i,n);case p.n.Horizontal:case p.n.Vertical:{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,dimension:o,geometry:a}=i;let l;o.measureType===p.n.Direct?(l=function(e,t){const i=e.directSegment.eval(.5,P.WM.get()),n=t.worldUpAtPosition(i,P.WM.get()),s=e.dimensionSegment.eval(.5,P.WM.get()),r=(0,S.y)(P.WM.get(),s,i);return!(0,S.F)(r,w.Z)&&(0,S.e)(r,n)>0}(a,n)===s.z>r.z,t===p.n.Horizontal&&(l=!l)):l=!function(e){const{startRenderSpace:t,endRenderSpace:i}=e.dimensionSegment,{startRenderSpace:n,endRenderSpace:s}=e.directSegment;return(0,S.E)(n,t)<(0,S.E)(s,i)}(a);const[c,d]=l?[s,r]:[r,s],h=(0,b.WG)(d,N);return t===p.n.Horizontal?h.z=c.z:(h.x=c.x,h.y=c.y),n.toRenderCoords(c,e.startRenderSpace),n.toRenderCoords(h,e.endRenderSpace),e}}}function F(e,t,i){return i.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),i.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(G||(G={}));const N=(0,x.Tx)(0,0,0,null);const j=new M.y;function Y(e,t){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:s,directSegment:{startRenderSpace:r,endRenderSpace:o},directSegment:a,renderCoordsHelper:c}=t,d=a.eval(.5,P.WM.get()),h=c.worldUpAtPosition(d,P.WM.get()),u=c.worldBasisAtPosition(d,C.R.Y,P.WM.get());switch(i){case p.n.Horizontal:(0,S.c)(e,h);break;case p.n.Vertical:(0,S.e)(r,h)<(0,S.e)(o,h)?(0,S.y)(e,o,r):(0,S.y)(e,r,o),(0,S.f)(e,e,h),(0,S.f)(e,e,h);break;case p.n.Direct:{const i=(0,l.Pt)(t.orientation,0);if(q({elevationAlignedStartPoint:n,elevationAlignedEndPoint:s}))(0,y.d)(X,-(0,m.Vl)(i),h),(0,S.m)(e,u,X);else{const t=(0,S.y)(P.WM.get(),o,r),n=(0,S.f)(P.WM.get(),t,h);(0,S.f)(n,n,t),(0,y.d)(X,(0,m.Vl)(i),t),(0,S.m)(e,n,X)}break}}return(0,S.F)(e,w.Z)?(0,S.c)(e,u):(0,S.n)(e,e)}const X=(0,v.c)();function q({elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}){return(0,l.pC)(e)&&(0,l.pC)(t)&&e.x===t.x&&e.y===t.y}function U(e,t){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:s,endRenderSpace:r},relativeToSegment:o,renderCoordsHelper:a}=t,l=n/a.unitInMeters,[c,d]=function(e,t,i,n=0){const s=(0,S.e)(t,i),r=(0,S.e)(e,i),o=Math.abs(s-r)+n;return s>r?[o,n]:[n,o]}(s,r,i,l);return(0,S.z)(e.startRenderSpace,o.startRenderSpace,i,c),(0,S.z)(e.endRenderSpace,o.endRenderSpace,i,d),e}function B(e,t,i){const n=t.directSegment.eval(.5,P.WM.get());return i.worldUpAtPosition(n,e)}function Q(e,t){const{startRenderSpace:i,endRenderSpace:n}=t.directSegment;return(0,S.y)(e,n,i)}function J(e,t,i={invert:!1}){const{startRenderSpace:n,endRenderSpace:s}=t.dimensionSegment;return i.invert?(0,S.y)(e,n,s):(0,S.y)(e,s,n)}function K(e,t){const i=e.directSegment.eval(.5,P.WM.get());return t.headingAtPosition(i,e.primaryOffsetAxis)}const $=(0,w.c)();function ee(e){const{elevationAlignedStartPoint:t,elevationAlignedEndPoint:i}=e;if((0,l.Wi)(t)||(0,l.Wi)(i))return!1;const n=function(e,t){const{spatialReference:i}=e;return(0,D.fS)(i,t.spatialReference)?(R[0]=e.x,R[1]=e.y,R[2]=e.hasZ?e.z:0,L[0]=t.x,L[1]=t.y,L[2]=t.hasZ?t.z:0,T(R,L,i)):null}(t,i);return(0,l.pC)(n)&&(0,_.nn)(n,"meters").value>te}const te=1e5;function ie(e){return(0,l.pC)(e.geometry)}let ne=class extends r.Z{constructor(e){super(e),this._handles=new f.Z}initialize(){const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles(e.on("change",(({added:e,removed:t})=>{for(const e of t)this._removeComputation(e);for(const t of e)this._addComputation(t)})))}destroy(){this._handles=(0,l.SC)(this._handles)}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.RG)(this.view)}_addComputation(e){this._handles.has(e)||this._handles.add((0,c.YP)((()=>k(e)),(t=>{const{measureType:i}=t;if(ee(t)&&i!==p.n.Direct){const t=Math.round((0,g.En)(te,"meters","kilometers"));return a.Z.getLogger(this.declaredClass).warnOnce(`A ${i} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${t} km. Update the measureType of the affected dimension to "direct" to display it.`),void(e.geometry=null)}const n=V(t,this.view.renderCoordsHelper,e.geometry);e.geometry=n,e.result.length=function(e,t,i){if((0,l.Wi)(e))return null;const n=T(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if((0,l.Wi)(n))return null;const s=t===p.n.Vertical?(0,g.ov)(n.value,n.unit,i):(0,g.iS)(n.value,n.unit,i);return(0,_.nn)(n,s)}(n,i,this._defaultUnit)}),c.tX),e)}_removeComputation(e){this._handles.remove(e)}};(0,s._)([(0,d.Cb)({constructOnly:!0})],ne.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],ne.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],ne.prototype,"analysis",null),(0,s._)([(0,d.Cb)()],ne.prototype,"_defaultUnit",null),ne=(0,s._)([(0,h.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],ne);var se=i(18234),re=i(23148),oe=i(30936),ae=(i(91957),i(16068)),le=i(95550),ce=i(69430);const de={main:new oe.Z([255,127,0])};class he{constructor(){this.color=de.main,this.opacity=.5,this.radius=5}}class ue{constructor(){this.color=new oe.Z([127,127,127]),this.opacity=.5,this.radius=5}}class pe{constructor(){this.lineSizeFraction=.8}}class fe{constructor(){this.color=de.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1}}class ge{constructor(){this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2}}class me{constructor(){this.lineSizeFraction=.25}}class _e{constructor(){this.marginPx=20,this.minScreenLengthFontSizeFactor=5}}class ye{constructor(){this.color=new oe.Z([255,127,0,.5])}}const ve=new class{constructor(){this.pointManipulators=new he,this.offsetManipulator=new fe,this.orientationManipulator=new ge,this.markers=new pe,this.labels=new _e,this.offsetLine=new me,this.constraint=new ye,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new ue,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}};var Se=i(46707),we=i(74390),Ce=i(81536),Pe=i(6411),xe=i(6087),be=i(34108),Me=i(91258),Ee=i(67666);class De{constructor(e){this.start=e.start,this.end=e.end,this.offset=e.offset,this.heading=e.heading,this.rotation=e.rotation,this.direct=e.direct,this.horizontal=e.horizontal,this.vertical=e.vertical}manipulatorName(e){return Object.keys(this).find((t=>this.hasOwnProperty(t)&&e===this[t]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(e){for(const t of p.V)e(this.manipulatorForMeasureType(t),t)}manipulatorForMeasureType(e){switch(e){case p.n.Direct:return this.direct;case p.n.Horizontal:return this.horizontal;case p.n.Vertical:return this.vertical}}}function Ae(e,{lineSizePt:t,material:i}){const{calloutOffsetPx:n,calloutOpacity:s,calloutWidth:r,discScale:o,focusMultiplier:a}=ve.orientationManipulator;return{calloutLength:.25*Pe._Z*ve.markers.lineSizeFraction*(0,le.F2)(t)+n,calloutOpacity:s,calloutWidth:r,customStateMask:Xe,discScale:o,focusMultiplier:a,material:i,metadata:e}}function Te(e,t){return(0,we.Ju)(e,Ae(t.metadata,t))}function Oe(e,t){(0,we.Bz)(e,Ae(e.metadata,t))}function Re(e,{computation:t,view:i}){return[(0,be.Xd)(e,((e,n,s)=>{Le({cancel:s,computation:t,settingHeading:!1,steps:n,view:i})})),e.events.on("immediate-click",(e=>{!function(e,t,i){const{dimension:n,geometry:s}=t;if(90===n.orientation||270===n.orientation)return n.orientation=0,void e.stopPropagation();if((0,l.Wi)(s))return;const{renderCoordsHelper:r}=i,o=V({...k(t),orientation:90},r),a=V({...k(t),orientation:270},r);if((0,l.Wi)(o)||(0,l.Wi)(a))return;const c=K(o,r),d=K(a,r),h=Ze(s,i),u=ae.BV.shortestSignedDiff(h,c),p=ae.BV.shortestSignedDiff(h,d);n.orientation=Math.abs(u)<Math.abs(p)?90:270,e.stopPropagation()}(e,t,i)}))]}function Le(e){const{cancel:t,computation:i,settingHeading:n,steps:s,view:r}=e;if(!ie(i))return;const{renderCoordsHelper:o}=r,{dimension:a,geometry:c}=i,d=(0,w.c)(),h=We((0,w.c)(),c,c.directSegment,o),u=Fe(P.WM.get(),{forHeading:n,geometry:c,renderCoordsHelper:o}),p=(0,ce.Yq)(h,u,(0,ce.Ue)()),f=(0,l.Pt)(a.orientation,n?()=>K(c,r.renderCoordsHelper):0);s.next((0,Ce._N)(r,p)).next((e=>{"start"===e.action&&(0,S.c)(d,e.renderStart);const t=(0,ce.mJ)(p),i=(0,we.Gd)(d,e.renderEnd,h,t);let s=f-(0,m.BV)(i);n||(s=function(e){const t=ae.BV.normalize(e)%90;return t<ve.orientationSnapThresholdDegrees?e-t:90-t<ve.orientationSnapThresholdDegrees?e+(90-t):e}(s)),a.orientation=s})),t.next((0,be.di)(a,["orientation"]))}function ze(e,{computation:t,manipulatorMeasureType:i,view:n}){let s=p.n.Direct,r=0,o=0;return[e.events.on("grab-changed",(a=>{if("start"!==a.action||!ie(t))return;const{dimension:l,geometry:c}=t;s=l.measureType,r=l.offset,o=l.orientation;const d=(0,S.c)(P.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,i,n){const{directSegment:s}=i,r=Y(P.WM.get(),{measureType:t,directSegment:s,renderCoordsHelper:n}),o=U(j,{offsetAxis:r,offset:0,relativeToSegment:s,renderCoordsHelper:n}).eval(.5,P.WM.get()),a=(0,S.y)(P.WM.get(),e,o);return(0,S.e)(a,r)*n.unitInMeters}(d,i,c,n.renderCoordsHelper),l.orientation=0})),(0,be.Xd)(e,((e,a,l)=>{if(!ie(t))return;const{geometry:c,dimension:d}=t,{renderCoordsHelper:h}=n,u=W(Qe,i,t,h),p=Y(P.WM.get(),{measureType:i,directSegment:c.directSegment,renderCoordsHelper:h}),f=(0,Ce.J4)(e);a.next(f).next(He(n,d,u,p)),l.next(f).next((e=>(d.measureType=s,d.offset=r,d.orientation=o,e)))}))]}function He(e,t,i,n){const s=(0,S.b)(P.WM.get(),i.endRenderSpace,i.startRenderSpace);(0,S.f)(s,s,n);const r=(0,ce.Yq)(i.startRenderSpace,s,(0,ce.Ue)()),o=(0,ce.Yq)(i.startRenderSpace,n,(0,ce.Ue)()),a=t.offset;let l,c=0;const d=new be.hM;return d.next((0,Ce._N)(e,r)).next((i=>{"start"===i.action&&(c=(0,ce.jH)(o,i.renderStart));const n=((0,ce.jH)(o,i.renderEnd)-c)*e.renderCoordsHelper.unitInMeters;t.offset=a+n,l=i})),e=>(d.execute(e),l)}function Ze(e,t){const{directSegment:i}=e,{renderCoordsHelper:n}=t,s=B(P.WM.get(),e,n),r=Q(P.WM.get(),e),o=(0,S.f)(P.WM.get(),r,s),{viewForward:a}=t.state.camera;(0,S.e)(o,a)>0&&(0,S.g)(o,o,-1);const l=i.eval(.5,P.WM.get());return n.headingAtPosition(l,o)}function ke(e,t,i){const{dimensionSegment:n,primaryOffsetAxis:s}=t,r=J(qe,t),o=(0,S.k)(r,w.Z)?(0,y.i)(Be):(0,we.Aq)(r,s,w.Z,Be),a=Math.max((0,S.l)(r),ve.offsetManipulator.minLengthMeters/i.unitInMeters);(0,y.k)(o,o,(0,S.s)(qe,a,a,a)),e.modelTransform=o,e.renderLocation=n.eval(.5,qe)}function Ve(e,t,i,{forHeading:n}){const{dimension:s,geometry:r}=t,{primaryOffsetAxis:o}=r,a=(0,S.g)(Ie,o,s.offset>=0?1:-1),l=Fe(Ge,{forHeading:n,geometry:r,renderCoordsHelper:i});(0,S.f)(l,l,a);const c=(0,we.Aq)(a,l,w.Z,Be);e.modelTransform=c,e.renderLocation=We(qe,r,r.dimensionSegment,i)}const Ie=(0,w.c)(),Ge=(0,w.c)();function We(e,t,i,n){const{startRenderSpace:s,endRenderSpace:r}=i,o=function(e,t){const i=Q(Ne,e),n=B(je,e,t);return(0,S.e)(i,n)>0}(t,n)?s:r;return(0,S.c)(e,o)}function Fe(e,{forHeading:t,geometry:i,renderCoordsHelper:n}){return t?B(e,i,n):J(e,i,{invert:!0})}const Ne=(0,w.c)(),je=(0,w.c)();function Ye(e){return(0,le.F2)(e)+ve.offsetManipulator.focusedLinePaddingPx}const Xe=Me.jg.Custom1,qe=(0,w.c)(),Ue=(0,w.c)(),Be=(0,v.c)(),Qe=new M.y;var Je,Ke=i(97622),$e=i(53280),et=i(67134),tt=i(78668);i(39994);function it(e,t){if(ee(e))return Je.Direct;const{geometry:i}=e;if((0,l.Wi)(i)||(0,S.k)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{constraintThresholdPx:n}=ve,{camera:s}=t.state,r=B(P.WM.get(),i,t.renderCoordsHelper),o=Q(P.WM.get(),i),a=(0,S.g)(P.WM.get(),r,(0,S.e)(o,r)),c=(0,S.b)(P.WM.get(),o,a),d=(0,S.p)(c),h=(0,S.p)(a),{startRenderSpace:u,endRenderSpace:p}=i.directSegment,f=Math.max(s.computeRenderPixelSizeAt(u)*n,s.computeRenderPixelSizeAt(p)*n)**2;return d<f?Je.Vertical:h<f?Je.Horizontal:null}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(Je||(Je={}));var nt=i(28401),st=i(88589),rt=i(18916),ot=i(70740),at=i(59934),lt=i(56215),ct=i(97537),dt=i(40199),ht=i(10449),ut=i(7358),pt=i(21414),ft=i(65392);class gt extends ht._{constructor(e){super(e),this._ray=(0,ct.Ue)(),this._externalResources=null,this._handles=new f.Z,this._isWorldDown=!1,this._start=(0,w.c)(),this._end=(0,w.f)(1,0,0),this._width=1,this._color=(0,rt.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,rt.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=St.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ut.yD.OccludeAndTransparent,this._fadedExtensions=Ct,this.applyProps(e)}createExternalResources(){const e=new ft.U(this.materialParameters);this._handles.add((0,c.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()})));const t=new dt.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,l.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,l.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,w.c)(),(0,w.c)()],i=this.extensionType===St.FADED;i&&t.push((0,w.c)(),(0,w.c)());const n=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=(0,xe.rh)(t,null,n);e.addGeometry(s,(0,l.Wg)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),(0,l.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.b)(this._end,e,this._end),(0,ct.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.k)(this._start,e)||((0,S.c)(this._start,e),(0,ct.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.k)(this._end,e)||((0,S.c)(this._end,e),(0,ct.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,st.g)(e,this._color)||((0,st.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,st.g)(e,this._innerColor)||((0,st.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,l.pC)(e)!==(0,l.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,l.Wi)(e)||(0,l.Wi)(this._stippleOffColor)||!(0,st.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,l.pC)(e)?(0,rt.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,l.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,l.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,l.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,l.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,l.Pt)(e,Ct),this.recreateGeometry()}_updateMaterial(){(0,l.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,l.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===St.FADED?this._updateLineSegmentFinite(vt):this._updateLineSegmentInfinite(this._extensionType,vt);this._updateVertexAttributes(e,t),(0,l.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return(0,lt.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,ot.iL)(this._ray,mt),e){case St.LINE:mt.c0=-Number.MAX_VALUE;break;case St.RAY:case St.GROUND_RAY:{const e=this._ray.origin,t=(0,l.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,S.o)(mt.ray.direction,mt.ray.direction),this._extensionType===St.GROUND_RAY&&null!=t&&(mt.c1=Math.abs(i-t));break}}if(!(0,at.zq)(i.frustum,mt))return(0,lt.zk)(this._start,this._end,t);const n=(0,ot.Ws)(mt,_t),s=(0,ot.S$)(mt,yt);return(0,lt.zk)(n,s,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(pt.T.POSITION).data;if(this.extensionType===St.FADED){const e=(0,lt.KU)(t,-this.fadedExtensions.start,_t);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,lt.KU)(t,0,_t);i[3]=n[0],i[4]=n[1],i[5]=n[2];const s=(0,lt.KU)(t,1,_t);i[6]=s[0],i[7]=s[1],i[8]=s[2];const r=(0,lt.KU)(t,1+this.fadedExtensions.end,_t);i[9]=r[0],i[10]=r[1],i[11]=r[2]}else{const e=(0,lt.KU)(t,0,_t);i[0]=e[0],i[1]=e[1],i[2]=e[2];const n=(0,lt.KU)(t,1,_t);i[3]=n[0],i[4]=n[1],i[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const mt=(0,ot.Ue)(),_t=(0,w.c)(),yt=(0,w.c)(),vt=(0,lt.Ue)();var St;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(St||(St={}));const wt=1/3,Ct={start:wt,end:wt};var Pt=i(55709);class xt extends ht._{constructor(e){super(e),this._handles=new f.Z,this._location=(0,w.c)(),this._direction=(0,w.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,rt.f)(1,0,1,1),this._renderOccluded=ut.yD.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){(0,S.k)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.k)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,st.g)(e,this._color)||((0,st.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new ft.U(this.materialParameters);this._handles.add((0,c.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=(0,xe.rh)([(0,w.c)(),(0,w.c)()]),i=(0,xe.rh)([(0,w.c)(),(0,w.c)()]),n=(0,l.Wg)(this._externalResources).material;e.addGeometry(t,n),e.addGeometry(i,n),this._updateVertices(e)}forEachExternalMaterial(e){(0,l.pC)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){(0,l.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;(0,l.Wi)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,Mt),(0,S.a)(bt,this.location,this.direction),t.projectToScreen(bt,Et),(0,Pt.f)(Et,(0,Pt.a)(Et,Et,Mt)),this._updateVertexAttributes(t,e,0,Mt,Et,1),this._updateVertexAttributes(t,e,1,Mt,Et,-1)}_updateVertexAttributes(e,t,i,n,s,r){const o=t.geometryRecords[i],a=o.geometry.getMutableAttribute(pt.T.POSITION).data,l=(0,Pt.b)(Dt,(0,Pt.s)(Dt,s[1]*r,s[0]*-r),this.offset+this.width/2),c=(0,Pt.j)(At,(0,Pt.j)(At,(0,Pt.j)(At,n,(0,Pt.b)(At,s,this.length/2)),l),l),d=(0,Pt.j)(Tt,c,(0,Pt.b)(Tt,s,-this.length));e.unprojectFromScreen(c,bt),a[0]=bt[0],a[1]=bt[1],a[2]=bt[2],e.unprojectFromScreen(d,bt),a[3]=bt[0],a[4]=bt[1],a[5]=bt[2],t.geometryVertexAttrsUpdated(o)}}const bt=(0,w.c)(),Mt=(0,le.s1)(),Et=(0,le.s1)(),Dt=(0,le.s1)(),At=(0,le.s1)(),Tt=(0,le.s1)();var Ot=i(48562),Rt=i(83061),Lt=i(50639),zt=i(20999),Ht=i(22519),Zt=i(9650);class kt extends Zt.r{constructor(e,t,i=zt.B.ALL){super(t,i),this.intersectionPoint=e}equals(e){return e instanceof kt&&(0,Ht.Xv)(this.intersectionPoint,e.intersectionPoint)}}var Vt=i(65453);class It extends Zt.r{constructor(e,t,i,n=zt.B.ALL){super(i,n),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof It&&(0,Ht.Xv)(this.lineStart,e.lineStart)&&(0,Ht.Xv)(this.lineEnd,e.lineEnd)}}var Gt=i(82366);class Wt extends Zt.r{constructor(e,t,i,n,s=zt.B.ALL){super(n,s),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof Wt&&(0,Ht.Xv)(this.previousVertex,e.previousVertex)&&(0,Ht.Xv)(this.centerVertex,e.centerVertex)&&(0,Ht.Xv)(this.nextVertex,e.nextVertex)}}class Ft{draw(e,t){const i=this._getUniqueHints(e),n=[];for(const e of i)e instanceof kt&&n.push(this.visualizeIntersectionPoint(e,t)),e instanceof Vt.w&&n.push(this.visualizeLine(e,t)),e instanceof It&&n.push(this.visualizeParallelSign(e,t)),e instanceof Wt&&n.push(this.visualizeRightAngleQuad(e,t)),e instanceof Gt.n&&n.push(this.visualizePoint(e,t));return(0,re.AL)(n)}_getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const n of t)if(i.equals(n)){e=!1;break}e&&t.push(i)}return t}}var Nt=i(86);class jt extends Ft{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:n}=t;return(0,re.ed)(new Ot.L({view:n,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,l.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:oe.Z.toUnitRGBA(Lt.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:i,coordinateHelper:n}=t,s=this._alignPoint(e.point,e.domain,t);return(0,re.ed)(new Ot.L({view:i,primitive:"circle",geometry:n.vectorToPoint(s),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:oe.Z.toUnitRGBA(Lt.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:i,coordinateHelper:n}=t,s=this._alignPoint(e.lineStart,e.domain,t),r=this._alignPoint(e.lineEnd,e.domain,t);return(0,re.ed)(this._createLineSegmentHintFromMap(e.type,s,r,n,this._hintElevationInfo(e,t),i,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,coordinateHelper:n}=t,s=this._hintElevationInfo(e,t),r=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t),a=(0,Nt.$r)(r,n,s,i),l=(0,Nt.$r)(o,n,s,i),c=(0,S.h)(l,a,l,.5),d=new xt({view:i,attached:!1,offset:Lt.c.parallelLineHintOffset,length:Lt.c.parallelLineHintLength,width:Lt.c.parallelLineHintWidth,color:oe.Z.toUnitRGBA(Lt.c.orange),location:c,renderOccluded:ut.yD.Opaque});return d.setDirectionFromPoints(a,c),d.attached=!0,(0,re.ed)(d)}visualizeRightAngleQuad(e,t){const{view:i,coordinateHelper:n}=t,s=this._hintElevationInfo(e,t),r=this._alignPoint(e.previousVertex,e.domain,t),o=this._alignPoint(e.centerVertex,e.domain,t),a=this._alignPoint(e.nextVertex,e.domain,t);return(0,re.ed)(new Rt.R({view:i,attached:!0,color:oe.Z.toUnitRGBA(Lt.c.orange),renderOccluded:ut.yD.Transparent,outlineRenderOccluded:ut.yD.Opaque,outlineColor:oe.Z.toUnitRGBA(Lt.c.orange),outlineSize:Lt.c.rightAngleHintOutlineSize,size:Lt.c.rightAngleHintSize,geometry:{previous:(0,Nt.$r)(r,n,s,i),center:(0,Nt.$r)(o,n,s,i),next:(0,Nt.$r)(a,n,s,i)}}))}_createLineSegmentHintFromMap(e,t,i,n,s,r,o=!0,a=!0){const l=(0,w.c)(),c=(0,w.c)();return(0,Nt.By)(t,i,n,s,r,l,c),this._createLineSegmentHint(e,r,l,c,o,a)}_createLineSegmentHint(e,t,i,n,s=!0,r=!0){const o=new gt({view:t,extensionType:St.FADED,start:i,end:n,color:oe.Z.toUnitRGBA(Lt.c.orange),renderOccluded:ut.yD.Opaque});switch(e){case Ht.ze.TARGET:o.width=Lt.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:Lt.c.lineHintFadedExtensions};break;case Ht.ze.REFERENCE_EXTENSION:o.width=Lt.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case Ht.ze.REFERENCE:o.width=Lt.c.lineHintWidthReference,o.fadedExtensions={start:s?Lt.c.lineHintFadedExtensions:0,end:r?Lt.c.lineHintFadedExtensions:0}}return o.attached=!0,o}_alignPoint(e,t,i){const n=this._getSelfSnappingZ(t,i);if((0,l.Wi)(n))return e;const s=i.coordinateHelper,r=s.vectorToPoint(e,Yt);return r.z=n,s.pointToVector(r)}_hintElevationInfo(e,t){return(0,l.pC)(this._getSelfSnappingZ(e.domain,t))?(0,l.Wg)(t.selfSnappingZ).elevationInfo:(0,l.Pt)(e.elevationInfo,t.elevationInfo)}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===zt.B.SELF&&(0,l.pC)(t)?t.value:null}}const Yt=new Ee.Z;var Xt=i(37926),qt=i(39043),Ut=i(1983),Bt=i(66962);const Qt={main:new oe.Z([255,127,0]),selected:new oe.Z([255,255,255]),staged:new oe.Z([12,207,255]),outline:new oe.Z([0,0,0,.5]),selectedOutline:new oe.Z([255,255,255])},Jt=.3;function Kt(e,t){const i=e.clone();return i.a*=t,i}function $t(e,t){const i=e.clone(),n=(0,qt._Y)(i);n.s*=t;const s=(0,qt.xr)(n);return i.r=s.r,i.g=s.g,i.b=s.b,i}function ei(e,t){if(t)for(const i in t)e[i]=t[i]}class ti{constructor(e){this.color=Qt.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=ut.yD.Opaque,ei(this,e)}}class ii{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Qt.main,this.outlineColor=Qt.outline,this.renderOccluded=ut.yD.Opaque,this.hoverOutlineColor=Qt.selectedOutline,ei(this,e)}apply(e,t){const i=this[e];t.setParameters({color:ui(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class ni{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Kt(Qt.main,.5),this.hoverColor=Qt.main,this.renderOccluded=ut.yD.Transparent,this.minSquaredEdgeLength=900,ei(this,e)}apply(e,t){const i=this[e];t.setParameters({color:ui(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class si{constructor(e){this.vertex=new ii({color:Qt.main,outlineColor:Qt.outline}),this.edge=new ii({color:$t(Kt(Qt.main,2/3),.5),outlineColor:Kt(Qt.outline,.5),size:8,collisionPadding:8}),this.selected=new ii({color:Qt.selected,outlineColor:Qt.outline}),this.edgeOffset=new ni,ei(this,e)}}class ri{constructor(e){this.color=Qt.selected,this.width=1.5,this.stipplePattern=(0,Bt.z5)(5),this.stippleOffColor=Qt.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Qt.selected,this.renderOccluded=ut.yD.OccludeAndTransparent,ei(this,e)}apply(e){e.color=ui(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=ui(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=ui(this.innerColor),e.renderOccluded=this.renderOccluded}}class oi{constructor(e){this.color=Qt.selected,this.size=4,this.outlineSize=1,this.outlineColor=Qt.outline,this.shape="square",ei(this,e)}apply(e){e.color=ui(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=ui(this.outlineColor),e.primitive=this.shape}}class ai{constructor(e){this.innerColor=Qt.selected,this.innerWidth=1,this.glowColor=Qt.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Jt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Qt.main,ei(this,e)}apply(e,t=1){const i={glowColor:oe.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:oe.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class li{constructor(e){this.outline=new ri({color:Qt.outline,renderOccluded:ut.yD.OccludeAndTransparentStencil,stippleOffColor:Qt.selected,stipplePattern:(0,Bt.z5)(5),width:1.5,innerWidth:0}),this.staged=new ri({color:Qt.selected,renderOccluded:ut.yD.OccludeAndTransparentStencil,innerColor:Qt.staged,stippleOffColor:Qt.outline,stipplePattern:(0,Bt.z5)(5),width:1.5}),this.shadowStyle=new ai({globalAlpha:Jt,glowColor:Qt.main,glowFalloff:8,glowWidth:8,innerColor:Qt.selected,innerWidth:1}),ei(this,e)}}class ci{constructor(e){this.outline=new oi({color:Qt.selected,outlineColor:Qt.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ai({globalAlpha:Jt,glowColor:Qt.main,glowFalloff:1.5,glowWidth:6,innerColor:Qt.selected,innerWidth:1,radius:2}),ei(this,e)}}class di extends ri{constructor(e){super(),this.extensionType=St.GROUND_RAY,ei(this,e)}}class hi{constructor(e){this.lineGraphics=new li,this.pointGraphics=new ci,this.heightPlane=new ai({globalAlpha:Jt,glowColor:Qt.main,glowFalloff:8,glowWidth:8,innerColor:Qt.selected,innerWidth:1}),this.heightBox=new ai({globalAlpha:Jt,glowColor:Qt.main,glowFalloff:8,glowWidth:8,innerColor:Qt.selected,innerWidth:0,heightFillColor:Qt.main}),this.zVerticalLine=new di({color:Kt(Qt.main,.5),falloff:2,innerColor:Kt(Qt.selected,0),renderOccluded:ut.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:St.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,ei(this,e)}}function ui(e){return(0,Ut.b)(oe.Z.toUnitRGBA(e))}const pi=new class{constructor(e){this.visualElements=new hi,this.reshapeManipulators=new si,this.zManipulator=new ti,ei(this,e)}colorToVec4(e){return ui(e)}};var fi=i(29642),gi=i(63669);var mi=i(70984),_i=i(2070);class yi extends ht._{constructor(e){super(e),this.view=null,this._renderOccluded=ut.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=pi.colorToVec4(pi.reshapeManipulators.vertex.color),this._size=pi.reshapeManipulators.vertex.size,this._outlineColor=pi.colorToVec4(pi.reshapeManipulators.vertex.outlineColor),this._outlineSize=pi.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,st.g)(e,this._color)||((0,st.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,st.g)(e,this._outlineColor)||((0,st.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if((0,l.Wi)(e)||0===e.length)return[];const t=function(e,t,i,n,s){const r=new Float64Array(3*e.length),o=new Float64Array(r.length);e.forEach(((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));const a=(0,gi.rR)(r,t,0,o,0,r,0,r.length/3,i,n,s),l=null!=a;return{numVertices:e.length,position:r,mapPosition:o,projectionSuccess:l,sampledElevation:a}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,fi.o.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,s=t.position;for(let e=0;e<n;++e){const t=(0,S.s)(vi,s[3*e+0],s[3*e+1],s[3*e+2]),n=Si(.5,t),r=Si(.5,t);i.push({vertexGeometry:n,vertexOutlineGeometry:r})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of t)e.addGeometry(i,this._vertexMaterial),e.addGeometry(n,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new _i.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:mi.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new _i.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:mi.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}const vi=(0,w.c)();function Si(e,t){return(0,xe.PI)(e,16,16,{offset:t})}var wi=i(79591),Ci=i(64594),Pi=i(4703),xi=i(21739),bi=i(66581);let Mi=class extends r.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,s._)([(0,d.Cb)({constructOnly:!0})],Mi.prototype,"layer",void 0),(0,s._)([(0,d.Cb)()],Mi.prototype,"enabled",void 0),(0,s._)([(0,d.Cb)()],Mi.prototype,"updating",void 0),(0,s._)([(0,d.Cb)()],Mi.prototype,"availability",void 0),Mi=(0,s._)([(0,h.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],Mi);const Ei=Mi;let Di=class extends r.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new o.Z,this.distance=Lt.c.distance,this.touchSensitivityMultiplier=Lt.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,s._)([(0,d.Cb)()],Di.prototype,"enabled",void 0),(0,s._)([(0,d.Cb)()],Di.prototype,"enabledToggled",void 0),(0,s._)([(0,d.Cb)()],Di.prototype,"selfEnabled",void 0),(0,s._)([(0,d.Cb)()],Di.prototype,"featureEnabled",void 0),(0,s._)([(0,d.Cb)({type:o.Z.ofType(Ei)})],Di.prototype,"featureSources",void 0),(0,s._)([(0,d.Cb)()],Di.prototype,"distance",void 0),(0,s._)([(0,d.Cb)()],Di.prototype,"touchSensitivityMultiplier",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Di.prototype,"effectiveEnabled",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Di.prototype,"effectiveSelfEnabled",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Di.prototype,"effectiveFeatureEnabled",null),Di=(0,s._)([(0,h.j)("esri.views.interactive.snapping.SnappingOptions")],Di);const Ai=Di;var Ti,Oi=i(86114),Ri=i(17519),Li=i(83772),zi=i(45666),Hi=i(46455),Zi=i(7062),ki=i(72461);class Vi extends ki.j{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:n,otherVertex:s,otherVertexType:r,objectId:o,elevationInfo:a}){super(e,t,i,a,zt.B.SELF),this.previousVertex=n,this.otherVertex=s,this.otherVertexType=r,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===Ti.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Ti.CENTER?this.targetPoint:this.otherVertex,n=this.elevationInfo;return[new Vt.w(Ht.ze.TARGET,t,i,n,this.domain),new Vt.w(Ht.ze.REFERENCE,e,t,n,this.domain),new Wt(this.previousVertex,t,i,n,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Ti||(Ti={}));let Ii=class extends $e.r{constructor(e){super(e),this.options=null,this._domain=zt.B.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}get updating(){return(0,Oi.oE)(this.snappingSources,(({snappingSource:e})=>e.updating))||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,t=new Map;if((0,l.pC)(this.options)&&(0,l.pC)(this.options.featureSources))for(const i of this.options.featureSources.items){const n=i.layer.uid,s=e.get(n);if(s){e.delete(n),t.set(n,s);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const r=this._createSourceInfo(i);(0,l.pC)(r)&&t.set(n,r)}for(const[,t]of e)t.destroy();return t}initialize(){this.updatingHandles.add((()=>this.snappingSources),(()=>this.notifyChange("updating")),c.Z_),(0,l.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(e=>this._updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this._updateLayerView(e.layer,null)))])}_updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i,n){if(!(t&this._domain)||(0,l.Wi)(this.options)||!this.options.effectiveFeatureEnabled)return[];const s=[],r=this._computeScreeenSizeDistanceParameters(e,i),o={distance:r,point:e,coordinateHelper:i.coordinateHelper,types:this._types};for(const[,{snappingSource:e,layerView:t}]of this.snappingSources)!e.layerSource.enabled||(0,l.pC)(t)&&t.suspended||s.push(e.fetchCandidates(o,n).then((t=>t.filter((t=>!this._candidateIsExcluded(e,t,i.excludeFeature))))));const a=(await(0,tt.WW)(s)).flat();return this._addRightAngleCandidates(a,e,r,i),(0,tt.k_)(n),(0,Ht.lQ)(e,a,i.coordinateHelper),a}_addRightAngleCandidates(e,t,i,n){const s=(0,l.pC)(n.vertexHandle)?n.vertexHandle.rightEdge?.rightVertex?.pos:(0,l.pC)(n.editGeometryOperations)&&"polygon"===n.editGeometryOperations.data.type?(0,l.Wg)(n.editGeometryOperations.data.components[0]?.getFirstVertex())?.pos:null,r=(0,l.pC)(n.vertexHandle)?n.vertexHandle.leftEdge?.leftVertex?.pos:(0,l.pC)(n.editGeometryOperations)?(0,l.Wg)(n.editGeometryOperations.data.components[0]?.getLastVertex())?.pos:null,{view:o}=this,a=(0,Ht.Z_)(s,o,n),c=(0,Ht.Z_)(r,o,n),d=e.length;for(let s=0;s<d;s++)this._addRightAngleCandidate(e[s],c,t,i,n,e),this._addRightAngleCandidate(e[s],a,t,i,n,e)}_addRightAngleCandidate(e,t,i,n,s,r){const o=e instanceof Hi.L,a=o&&(0,Pt.o)(e.constraint.start,e.constraint.end);if((0,l.Wi)(t)||!o||a)return;const c=e.constraint.closestTo(t),d=(c[0]-i[0])/n.x,h=(c[1]-i[1])/n.y;if(d*d+h*h<=1){const i=s.coordinateHelper,n=new Vi({coordinateHelper:i,targetPoint:c,otherVertex:t,otherVertexType:Ti.NEXT,previousVertex:e.constraint.start,constraint:new zi.aU(i,t,c),objectId:e.objectId,elevationInfo:e.elevationInfo});r.push(n)}}_computeScreeenSizeDistanceParameters(e,t){let i=(0,l.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,l.Wi)(this.view)?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,n){const{coordinateHelper:s,elevationInfo:r}=n,{spatialReference:o}=s,a=s.hasZ()?Li.jG:r,l=s.toXYZ(e,Fi);l[2]=(0,Li.zx)(i,l,o,a,Li.jG),i.renderCoordsHelper.toRenderCoords(l,o,Ni);const c=i.state.camera.computeScreenPixelSizeAt(Ni),d=c*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,h=t*d,u=(0,Nt.Rs)(l,o,Li.jG,i),p=Wi(u,l,d,0,0,i,n),f=Wi(u,l,0,d,0,i,n),g=Wi(u,l,0,0,d,i,n);return{x:0===p?0:h/p,y:0===f?0:h/f,z:0===g?0:h/g,distance:c*t}}get _types(){return Ri.r.EDGE|Ri.r.VERTEX}_candidateIsExcluded(e,t,i){if((0,l.Wi)(i))return!1;const n=this._getCandidateObjectId(t);if((0,l.Wi)(n))return!1;const s=e.layerSource.layer;return"graphics"===s.type?i.uid===n:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===n}_getCandidateObjectId(e){return e instanceof Zi.a?e.objectId:null}_createSourceInfo(e){const t=this._createFeatureSnappingSourceType(e);if((0,l.Wi)(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=(0,l.pC)(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Gi(t.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;if((0,l.Wi)(t)||"3d"!==t.type)return null;const i=this._getSourceModule("scene");return(0,l.pC)(i.module)?{source:new i.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:i.loader}}_createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":case"oriented-imagery":{const t=this._getSourceModule("featureService");return(0,l.pC)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this._getSourceModule("featureCollection");return(0,l.pC)(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:t.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const t=this._getSourceModule("graphics");return(0,l.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const t=this._getSourceModule("notes");return(0,l.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:()=>(0,l.pC)(e.layer.sublayers)?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}_getSourceModule(e){const t=this._sourceModules[e];if((0,l.Wi)(t.loader)){const i=this._loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}_loadSourceModule(e){const t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(3477).then(i.bind(i,33477)));case"featureCollection":return t.addPromise(i.e(4821).then(i.bind(i,84821)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(6592),i.e(7431)]).then(i.bind(i,17431)));case"scene":return t.addPromise(i.e(5519).then(i.bind(i,15519)))}return null}};(0,s._)([(0,d.Cb)({constructOnly:!0})],Ii.prototype,"spatialReference",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Ii.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],Ii.prototype,"options",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Ii.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Ii.prototype,"snappingSources",null),Ii=(0,s._)([(0,h.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],Ii);class Gi{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new f.Z;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([(0,c.YP)((()=>e.updating),(t=>e.layerSource.updating=t),c.tX),(0,c.YP)((()=>e.availability),(t=>e.layerSource.availability=t),c.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function Wi(e,t,i,n,s,r,{coordinateHelper:o}){const a=(0,S.c)(ji,t);a[0]+=i,a[1]+=n,a[2]+=s;const l=(0,Nt.Rs)(a,o.spatialReference,Li.jG,r);return(0,Ht.fG)(l,e)}const Fi=(0,w.c)(),Ni=(0,w.c)(),ji=(0,w.c)();var Yi=i(31355);class Xi{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=Lt.c.shortLineThreshold*Lt.c.shortLineThreshold}snap(e,t){return(0,l.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,editGeometryOperations:n}){const s=n.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,Ht.Bb)((0,Nt.a7)(t,s,i,this.view),(0,Nt.a7)(e,s,i,this.view))>this.squaredShortLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class qi extends ki.j{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:n,elevationInfo:s}){super(e,n,new zi.jg(e,t,i),s,zt.B.SELF),this._referenceLineHint=new Vt.w(Ht.ze.REFERENCE_EXTENSION,t,i,s,this.domain)}get hints(){return[this._referenceLineHint,new Vt.w(Ht.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var Ui=i(6271),Bi=i(23440);class Qi extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=[];if(n<1)return s;const r=t.coordinateHelper,o=(0,Nt.a7)(e,r,Li.jG,this.view),{view:a}=this,l=i.edges[n-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,Ht._j)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,s)}c=c.leftVertex.leftEdge}while(c&&c!==l);return s}snapExistingVertex(e,t){const i=[],n=(0,l.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<2)return i;const{view:r}=this,{coordinateHelper:o}=t,a=(0,Nt.a7)(e,o,Li.jG,r),c=n.leftEdge,d=n.rightEdge;c&&d&&this.edgeExceedsShortLineThreshold(c,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal((0,Ht.Z_)(c.leftVertex.pos,r,t),(0,Ht.Z_)(d.rightVertex.pos,r,t),e,a,t,i);const h=s.edges[0];let u=h;do{if(u!==n.leftEdge&&u!==n.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const n=(0,Ht._j)(u,r,t);this._processCandidateProposal(n.left,n.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==h);return i}_processCandidateProposal(e,t,i,n,s,r){const{coordinateHelper:o,pointer:a}=s;o.toXYZ(e,Ji),o.toXYZ(t,Ki);const l=o.toXYZ(i,en),c=(0,Ui.ZE)(l,$i),d=o.fromXYZ(c);(0,Ht.Bb)(n,(0,Nt.a7)(d,o,Li.jG,this.view))<this.squaredProximityThreshold(a)&&r.push(new qi({coordinateHelper:o,lineStart:e,lineEnd:t,targetPoint:d,elevationInfo:o.hasZ()?Li.jG:null}))}}const Ji=(0,w.c)(),Ki=(0,w.c)(),$i={start:Ji,end:Ki,type:Bi.SP.LINE},en=(0,w.c)();var tn=i(69666);class nn extends ki.j{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:n,elevationInfo:s}){const r=e.toXYZ(i,sn),o=e.toXYZ(t.left,rn),a=e.toXYZ(t.right,on);(0,S.b)(r,(0,S.a)(r,r,a),o),super(e,n,new zi.jg(e,i,e.fromXYZ(r)),s,zt.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){const e=this.elevationInfo;return[new Vt.w(Ht.ze.TARGET,this.constraint.start,this.targetPoint,e,this.domain),new It(this.constraint.start,this.targetPoint,e,this.domain),...this._referenceLines.map((t=>new Vt.w(Ht.ze.REFERENCE,t.edge.left,t.edge.right,e,this.domain,t.fadeLeft,t.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0},{coordinateHelper:i}=this;this._referenceLines.forEach((n=>{i.equals(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),i.equals(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),i.equals(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),i.equals(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}const sn=(0,w.c)(),rn=(0,w.c)(),on=(0,w.c)();class an extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.edges.length,s=i.vertices.length,r=[];if(n<2)return r;const{view:o}=this,a=(0,Nt.a7)(e,t.coordinateHelper,Li.jG,o),l=(0,Ht.Z_)(i.vertices[s-1].pos,o,t),c=(0,Ht.Z_)(i.vertices[0].pos,o,t),d=i.edges[n-1];let h=d;do{if(this.edgeExceedsShortLineThreshold(h,t)){const i=(0,Ht._j)(h,o,t);this._checkEdgeForParalleLines(i,l,e,a,t,r),this._checkEdgeForParalleLines(i,c,e,a,t,r)}h=h.leftVertex.leftEdge}while(h&&h!==d);return r}snapExistingVertex(e,t){const i=[],n=(0,l.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<3)return i;const{view:r}=this,o=(0,Nt.a7)(e,t.coordinateHelper,Li.jG,r),a=n.leftEdge,c=n.rightEdge,d=s.vertices[0],h=(0,Ht.Z_)(d.pos,r,t),u=s.vertices.length,p=s.vertices[u-1],f=(0,Ht.Z_)(p.pos,r,t),g=s.edges[0];let m=g;do{if(m!==a&&m!==c&&this.edgeExceedsShortLineThreshold(m,t)){const s=(0,Ht._j)(m,r,t);a&&this._checkEdgeForParalleLines(s,(0,Ht.Z_)(a.leftVertex.pos,r,t),e,o,t,i),c&&this._checkEdgeForParalleLines(s,(0,Ht.Z_)(c.rightVertex.pos,r,t),e,o,t,i),n===d?this._checkEdgeForParalleLines(s,f,e,o,t,i):n===p&&this._checkEdgeForParalleLines(s,h,e,o,t,i)}m=m.rightVertex.rightEdge}while(m&&m!==g);return i}_checkEdgeForParalleLines(e,t,i,n,s,r){const o=e.left,a=e.right;if((0,Bi.k0)(ln,t,o,a),(0,Pt.k)(ln,t)<Lt.c.parallelLineThreshold)return;(0,Bi.k0)(ln,i,o,a,t);const{coordinateHelper:l,pointer:c}=s,d=l.fromXYZ(ln,l.getZ(i,0));if((0,Ht.Bb)(n,(0,Nt.a7)(d,l,Li.jG,this.view))<this.squaredProximityThreshold(c)){if(this._parallelToPreviousCandidate(e,r))return;r.push(new nn({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:d,elevationInfo:l.hasZ()?Li.jG:null}))}}_parallelToPreviousCandidate(e,t){const i=e.left,n=e.right;for(const s of t)if((0,Bi.k0)(ln,n,s.constraint.start,s.constraint.end,i),(0,Pt.k)(ln,n)<Lt.c.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}const ln=(0,tn.a)();class cn extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=i.vertices.length,s=[];if(n<2)return s;const{view:r}=this,o=(0,Nt.a7)(e,t.coordinateHelper,Li.jG,r),a=i.vertices[n-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,Ht.Z_)(a.pos,r,t),n=(0,Ht._j)(a.leftEdge,r,t);this._checkForSnappingCandidate(s,n,i,e,n.left,i,t,e,o)}const l=i.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const i=(0,Ht.Z_)(l.pos,r,t),n=(0,Ht._j)(l.rightEdge,r,t);this._checkForSnappingCandidate(s,n,i,e,n.right,i,t,e,o)}return s}snapExistingVertex(e,t){const i=[],n=(0,l.Wg)(t.vertexHandle),s=n.component,r=s.vertices.length;if(r<3)return i;const{view:o}=this,a=(0,Nt.a7)(e,t.coordinateHelper,Li.jG,o),c=n.leftEdge,d=n.rightEdge,h=s.vertices[0],u=s.vertices[r-1];if(!c){const n=h.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,Ht._j)(n,o,t),r=(0,Ht.Z_)(h.rightEdge.rightVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.right,r,t,e,a)}return i}if(!d){const n=u.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,Ht._j)(n,o,t),r=(0,Ht.Z_)(u.leftEdge.leftVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.left,r,t,e,a)}return i}if(c&&c.leftVertex.leftEdge){const n=c.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,Ht._j)(n,o,t),r=(0,Ht.Z_)(c.leftVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.left,r,t,e,a)}}if(d&&d.rightVertex.rightEdge){const n=d.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(n,t)){const s=(0,Ht._j)(n,o,t),r=(0,Ht.Z_)(d.rightVertex.pos,o,t);this._checkForSnappingCandidate(i,s,r,e,s.right,r,t,e,a)}}return i}_checkForSnappingCandidate(e,t,i,n,s,r,o,a,l){const{coordinateHelper:c,pointer:d}=o;(0,Pt.a)(dn,t.right,t.left);const h=(0,S.s)(pn,dn[1],-dn[0],0),u=(0,Pt.h)(h,(0,Pt.a)(dn,n,i))/(0,Pt.v)(h),p=c.fromXYZ((0,Pt.w)(dn,r,h,u),c.getZ(a,0));if((0,Ht.Bb)(l,(0,Nt.a7)(p,c,Li.jG,this.view))<this.squaredProximityThreshold(d)){const t=c.toXYZ(r,hn),i=(0,S.z)(un,t,h,Math.sign(u)),n=c.fromXYZ(i);e.push(new Vi({coordinateHelper:c,targetPoint:p,constraint:new zi.aU(c,r,n),previousVertex:s,otherVertex:r,otherVertexType:Ti.CENTER,elevationInfo:c.hasZ()?Li.jG:null}))}}}const dn=(0,tn.a)(),hn=(0,w.c)(),un=(0,w.c)(),pn=(0,w.c)();class fn extends ki.j{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:n,elevationInfo:s}){super(e,t,new zi.UL(e,e.arrayToVector((0,Pt.l)(gn,i,n,.5)),.5*(0,Pt.d)(i,n)),s,zt.B.SELF),this._p1=i,this._p2=n}get hints(){const e=this.elevationInfo;return[new Vt.w(Ht.ze.REFERENCE,this.targetPoint,this._p1,e,this.domain),new Vt.w(Ht.ze.REFERENCE,this.targetPoint,this._p2,e,this.domain),new Wt(this._p1,this.targetPoint,this._p2,e,this.domain)]}}const gn=(0,tn.a)();class mn extends Xi{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],n=[],s=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||s<2)return n;const{view:r}=this,o=i.vertices[0],a=i.vertices[s-1],l=(0,Ht.Z_)(o.pos,r,t),c=(0,Ht.Z_)(a.pos,r,t);return this._processCandidateProposal(l,c,e,t,n),n}snapExistingVertex(e,t){const i=[],n=(0,l.Wg)(t.vertexHandle),s=n.component;if(s.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===s.vertices.length-1))return i;const{view:r}=this,o=(0,Ht.Z_)(n.leftEdge.leftVertex.pos,r,t),a=(0,Ht.Z_)(n.rightEdge.rightVertex.pos,r,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,n,s){if(!this.exceedsShortLineThreshold(e,t,n))return;const r=(0,Pt.l)(_n,e,t,.5),o=.5*(0,Pt.d)(e,t),a=(0,Bi.xO)(yn,i,r,o),{coordinateHelper:l,pointer:c}=n,d=l.fromXYZ(a,l.getZ(i,0)),h=(0,Nt.a7)(i,l,Li.jG,this.view);(0,Ht.Bb)(h,(0,Nt.a7)(d,l,Li.jG,this.view))<this.squaredProximityThreshold(c)&&s.push(new fn({coordinateHelper:l,targetPoint:d,point1:e,point2:t,elevationInfo:l.hasZ()?Li.jG:null}))}}const _n=(0,tn.a)(),yn=(0,tn.a)();let vn=class extends r.Z{constructor(e){super(e),this.updating=!1,this._snappers=new o.Z,this._domain=zt.B.SELF}initialize(){this._snappers.push(new an(this.view,this.options),new Qi(this.view,this.options),new cn(this.view,this.options),new mn(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const t of this._snappers.items)for(const s of t.snap(e,i))n.push(s);return(0,Ht.lQ)(e,n,i.coordinateHelper),n}};function Sn(e,t){return[new vn({view:e,options:t}),new Ii({view:e,options:t,spatialReference:e.spatialReference})]}(0,s._)([(0,d.Cb)({readOnly:!0})],vn.prototype,"updating",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],vn.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],vn.prototype,"options",null),vn=(0,s._)([(0,h.j)("esri.views.interactive.snapping.SelfSnappingEngine")],vn);class wn extends ki.j{constructor(e,t,i,n,s){super(e,t,new zi.Bq(e,t,i.constraint,n.constraint),s,zt.B.ALL),this.first=i,this.second=n}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new kt(this.targetPoint,this.elevationInfo,this.domain)]}}let Cn=class extends(Yi.Z.EventedMixin($e.r)){constructor(e){super(e),this.options=new Ai,this.snappingEnginesFactory=Sn,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Pn.MAIN}initialize(){this.handles.add([(0,c.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),c.Z_),(0,c.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),c.Z_),(0,c.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(({viewReady:e,snappingEnginesFactory:t})=>this._recreateEngines(e,t)),c.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:n}=this;this._engines=t(i,n)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e){return function(e){return(0,l.pC)(e.scenePoint)}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if((0,l.Wi)(n))return t;const s=this._selectUpdateInput(e);if((0,l.Wi)(s))return t;const{coordinateHelper:{spatialReference:r}}=i,o=(0,E.iV)(this._convertPointElevation(s,i),r);if((0,l.Wi)(o))return t;const{view:a}=this,{coordinateHelper:c,elevationInfo:d,visualizer:h}=i,u=[],p=c.pointToVector(o),f=n.constraint.closestTo(p);if(!this._arePointsWithinScreenThreshold(p,f,i))return this._resetSnappingState(),t;n.targetPoint=f,u.push(...n.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=f,u.push(...e.hints);(0,l.pC)(h)&&this.handles.add(h.draw(u,{coordinateHelper:c,elevationInfo:bn(i),view:a,selfSnappingZ:i.selfSnappingZ}),xn);const g=c.vectorToDehydratedPoint(f);return this._convertPointElevation(g,i,Li.jG,d)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case Pn.MAIN:return e;case Pn.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Pn.MAIN}_removeVisualization(){this.handles.remove(xn)}async _snapSinglePoint({point:e,context:t,signal:i}){const{coordinateHelper:n}=t,{view:s}=this,r=this._convertPointElevation(e,t),o=n.pointToVector(r),a=await this._fetchCandidates(o,zt.B.ALL,t,i);return this._createSnapResult(o,Pn.MAIN,a,s,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:n}){const{view:s}=this,{coordinateHelper:r}=i,{spatialReference:o}=r;await(0,E.iQ)(t.spatialReference,o);const a=(0,E.iV)(this._convertPointElevation(t,i),o),l=r.pointToVector(a),c=await this._fetchCandidates(l,zt.B.FEATURE,i,n);if(c.length>0){const e=await this._fetchCandidates(l,zt.B.SELF,i,n);return this._createSnapResult(l,Pn.SCENE,[...c,...e],s,i,n)}const d=this._convertPointElevation(e,i),h=r.pointToVector(d),u=await this._fetchCandidates(h,zt.B.SELF,i,n);return this._createSnapResult(h,Pn.MAIN,u,s,i,n)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map((s=>s.fetchCandidates(e,t,i,n))))).flat()}_createSnapResult(e,t,i,n,s,r){return{get valid(){return!(0,tt.Hc)(r)},apply:()=>{const{elevationInfo:r,coordinateHelper:o}=s,{snappedPoint:a,hints:c}=this._processCandidates(e,t,i,s);return this._removeVisualization(),(0,l.pC)(s.visualizer)&&this.handles.add(s.visualizer.draw(c,{coordinateHelper:o,elevationInfo:bn(s),view:n,selfSnappingZ:s.selfSnappingZ}),xn),this._convertPointElevation(a,s,Li.jG,r)}}}_processCandidates(e,t,i,n){const{coordinateHelper:s}=n;if(i.length<1)return this.doneSnapping(),{snappedPoint:s.vectorToDehydratedPoint(e),hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,Ht.lQ)(e,i,s);const r=this._currentMainCandidate;if((0,l.pC)(r)){const s=this._findOldConstraintInNewCandidates(r,i);if(s>=0){if(!(i[s]instanceof wn))return this._intersectWithOtherCandidates(s,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,n))return this._updateSnappingCandidate(r,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_findOldConstraintInNewCandidates(e,t){return e instanceof wn?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,n,s){const{coordinateHelper:r}=s,o=t[e],a=[];for(let n=0;n<t.length;++n){if(n===e)continue;const s=t[n];for(const e of o.constraint.intersect(s.constraint)){const t=r.fromXYZ(e.closestTo(o.targetPoint),o.targetPoint[2]);a.push([new wn(r,t,o,s,s.elevationInfo),this._squaredScreenDistance(i,t,r)])}}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(a[0][0],n,t,s):this._updateSnappingCandidate(o,n,t,s)}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const s=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const t of i){if(e instanceof wn){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;t.constraint.check(s)&&(t.targetPoint=s,this._currentOtherActiveCandidates.push(t),r.push(...t.hints))}return{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(s),hints:r}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,Ht.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,Nt.a7)(e,t,Li.jG,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}_convertPointElevation(e,t,i=t.elevationInfo,n=Li.jG){const{view:s}=this;if(!((0,l.pC)(e)&&t.coordinateHelper.hasZ()&&(0,l.pC)(s)&&"3d"===s.type))return e;const r=(0,et.d9)(e);return r.z=(0,Li.vQ)(s,r,i,n),r}get test(){return{visualizationsActive:this.handles.has(xn),engines:this._engines}}};var Pn;(0,s._)([(0,d.Cb)({constructOnly:!0})],Cn.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],Cn.prototype,"options",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Cn.prototype,"updating",null),(0,s._)([(0,d.Cb)()],Cn.prototype,"snappingEnginesFactory",void 0),(0,s._)([(0,d.Cb)()],Cn.prototype,"_engines",void 0),(0,s._)([(0,d.Cb)()],Cn.prototype,"_squaredMouseProximityTreshold",null),(0,s._)([(0,d.Cb)()],Cn.prototype,"_squaredTouchProximityThreshold",null),Cn=(0,s._)([(0,h.j)("esri.views.interactive.snapping.SnappingManager")],Cn),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Pn||(Pn={}));const xn="visualization-handle";function bn({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Li.jG:t}const Mn=new Map;function En(e){if(!Mn.has(e)){const t=function(e,t){const i=new Ai({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:t?.distance??Lt.c.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??Lt.c.touchSensitivityMultiplier});return{...(0,c.YP)((()=>e.map?.allLayers?.toArray()??[]),(e=>{i.featureSources=new o.Z(e.map((e=>new Ei({layer:e,enabled:!0}))))}),c.nn),options:i}}(e,{distance:10}),i=function(e,t){return new Cn({view:e,options:t,snappingEnginesFactory:(t,i)=>[new Ii({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);Mn.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=Mn.get(e);t.referenceCount++;const i=(0,re.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,bi.Y)((()=>{0===t.referenceCount&&(t.remove(),Mn.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}class Dn{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}}var An=i(41109),Tn=i(22167);class On{constructor(){this.next=new be.hM}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:n,updatingHandles:s,useZ:r=!0}){if((0,l.Wi)(i))return e=>e;let o=null,a=null;const c=()=>{o=(0,l.IM)(o),i.doneSnapping(),(0,l.pC)(a)&&a.frameTask.remove(),a=null};t.next((e=>(c(),e))),this.next=new be.hM;const d=this._createSnapFunction(i,r);let h=null,u=null,p=null;return t=>{if(!e(t))return t;if("start"===t.action){const e=this._createFrameTask(i.view);if(a=this._createSnappingInfo(n,t,e),a.context.selfSnappingZ=null,!r&&(0,l.pC)(t.info)){const e=this._extractSelfSnappingZ(n.coordinateHelper,t.info.handle.component);(0,l.pC)(e)&&(a.context.selfSnappingZ={value:e,elevationInfo:n.elevationInfo})}}if((0,l.pC)(a)){const{context:e,originalScenePos:n,originalPos:c}=a,{mapEnd:f,mapStart:g,action:m,scenePoints:_}=t,y=this._updatePosition(c,this._computeMapDelta(f,g)),v=this._computeMapDelta(g,c),S={...t,action:"update"},w=a.context,C=this._updateScenePosition(n,_),P=i.update({point:y,scenePoint:C,context:e});if(p=P,this._applySnappedUpdate(f,P,v,r),h=y,u=C,"end"!==m){const{frameTask:e}=a;(0,l.Wi)(o)&&(o=new AbortController),s.addPromise((0,tt.R8)(d({frameTask:e,event:S,context:w,point:y,scenePoint:C,delta:v,lastPos:h,lastScenePos:u,lastUpdate:p},o.signal)))}}return"end"===t.action&&c(),t}}_createSnapFunction(e,t){return(0,tt.Ds)((async({frameTask:i,point:n,scenePoint:s,context:r,event:o,delta:a,lastPos:c,lastScenePos:d,lastUpdate:h},u)=>{const p=await i.schedule((()=>e.snap({point:n,scenePoint:s,context:r,signal:u})),u);if(p.valid){let s=await i.schedule((()=>p.apply()),u);n!==c&&(0,l.pC)(c)&&(s=e.update({point:c,scenePoint:d,context:r})),(0,An.k)(s,h)||(this._applySnappedUpdate(o.mapEnd,s,a,t),this.next.execute(o))}}))}_createFrameTask(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Tn.T8.SNAPPING):Tn.sq}_createSnappingInfo(e,t,i){return{context:new Dn({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:(0,l.pC)(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:(0,l.pC)(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:(0,l.pC)(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:i}}_updatePosition(e,[t,i,n]){const s=(0,b.WG)(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}_updateScenePosition(e,t){return(0,l.Wi)(e)||(0,l.Wi)(t)?null:this._updatePosition(e,this._computeMapDelta(t.sceneEnd,t.sceneStart))}_computeMapDelta(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}_applySnappedUpdate(e,t,[i,n,s],r){e.x=t.x+i,e.y=t.y+n,r&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}_extractSelfSnappingZ(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const t of i){const i=e.getZ(t.pos);if((0,l.pC)(n)&&Math.abs(i-n)>1e-6)return null;(0,l.Wi)(n)&&(n=i)}return n}}let Rn=class extends r.Z{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,tt.Ds)((async(e,t,i,n)=>{const s=await this._frameTask.schedule((()=>t.snap({...e,context:i,signal:n})),n);s.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&(0,l.pC)(this._snapPoints)&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,l.pC)(e)?e.registerTask(Tn.T8.SNAPPING):Tn.sq}destroy(){this._abortController=(0,l.IM)(this._abortController),this._frameTask=(0,l.hw)(this._frameTask)}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,(0,l.Wi)(this._abortController)&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}abort(){this._abortController=(0,l.IM)(this._abortController)}};(0,s._)([(0,d.Cb)({constructOnly:!0})],Rn.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],Rn.prototype,"stagedPoint",null),(0,s._)([(0,d.Cb)()],Rn.prototype,"constrainResult",void 0),(0,s._)([(0,d.Cb)()],Rn.prototype,"_stagedPoint",void 0),Rn=(0,s._)([(0,h.j)("esri.views.interactive.snapping.SnappingOperation")],Rn);let Ln=class extends $e.r{constructor(e){super(e),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new f.Z,this._snappingPipeline=new On,this._snappingManagerResult=En(e.view),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=zn(),this._focusedOffsetManipulatorMaterial=zn(),this._thinOffsetManipulatorMaterial=zn(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,Bt.z5)(2)}),this._constraintSnappingIndicator=new Xt.r({view:e.view,attached:!0,width:1,color:oe.Z.toUnitRGBA(ve.constraint.color),renderOccluded:ut.yD.OccludeAndTransparent,stipplePattern:(0,Bt.z5)(5)});const t=oe.Z.toUnitRGBA(ve.disabledPointIndicator.color);t[3]*=ve.disabledPointIndicator.opacity,this._stagedStartIndicator=new yi({view:e.view,attached:!1,color:t,size:2*ve.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:ut.yD.OccludeAndTransparent})}initialize(){this._snappingOperation=new Rn({view:this.view}),this._orientationManipulatorTexture=(0,nt.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new wi.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:ut.yD.Opaque});const{computations:e}=this.analysisViewData;for(const t of e)this._addComputation(t);this.addHandles([e.on("after-add",(e=>this._addComputation(e.item))),e.on("after-remove",(e=>this._removeComputation(e.item)))]),this.addHandles([(0,c.YP)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(({stagedPoint:e,stagedComputation:t})=>{if((0,l.Wi)(t)||(0,l.Wi)(e))return;const i=(0,b.WG)(e,new Ee.Z);this._applyPointUpdate(t,{endPoint:i})}),c.Z_),(0,c.YP)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((e,t)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:s}=e;if(i===t.stagedDimension&&s===t.firstGrabbedManipulator){for(const i of[n,t.selectedComputation])if((0,l.pC)(i)){const t=this._computationManipulators.get(i);this._updateManipulators(i,t,e)}}else for(const[t,i]of this._computationManipulators)this._updateManipulators(t,i,e)}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{this._updateManipulatorStyle(e)}),c.nn),(0,c.YP)((()=>this.view.state.camera),(()=>{(0,l.pC)(this._stagedComputation)&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.YP)((()=>(0,l.yw)(this._stagedComputation,(e=>{const t=e.elevationAlignedStartPoint,i=(0,w.c)();return(0,l.pC)(t)&&this.view.renderCoordsHelper.toRenderCoords(t,i)?i:null}))),(e=>{(0,l.pC)(e)?(this._stagedStartIndicator.vertices=[e],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles)}destroy(){this._snappingOperation=(0,l.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}get updating(){return this.updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if((0,l.pC)(this._stagedComputation))return this._stagedComputation;const{selectedComputation:e}=this.analysisViewData;return this.hasGrabbedManipulators&&(0,l.pC)(e)?e:null}get _stagedComputation(){const e=this._stagedDimension,t=this.analysisViewData.computations.at(-1);return(0,l.Wi)(e)||(0,l.Wi)(t)||t.dimension!==e?null:t}get _constraintHandles(){return[(0,c.gx)((()=>this.analysisViewData.selectedComputation),(e=>{e.previousConstraint=it(e,this.view)}),{...c.tX,equals:et.fS}),(0,c.YP)((()=>{const e=this._activeComputation;if((0,l.Wi)(e))return null;const{measureType:t,orientation:i}=e.dimension;return{measureType:t,orientation:i,computation:e}}),((e,t)=>{if((0,l.pC)(e)&&(0,l.Wi)(t)){const{measureType:t,orientation:i,computation:n}=e;switch(n.previousConstraint){case Je.Horizontal:n.preConstraintProperties={measureType:p.n.Horizontal,orientation:0};break;case Je.Vertical:n.preConstraintProperties={measureType:p.n.Vertical,orientation:0};break;case Je.Direct:n.preConstraintProperties={measureType:p.n.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:t,orientation:i}}}(0,l.Wi)(e)&&(0,l.pC)(t)&&(t.computation.preConstraintProperties=null)}),c.Z_)]}get _snappingIndicatorHandles(){const e="snapping-indicator-event-handles";return[(0,c.YP)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(({stagedComputation:t,activeComputation:i})=>{const n=this._constraintSnappingIndicator;if(this.removeHandles(e),(0,l.Wi)(i))n.attached=!1;else if(i===t)n.attached=!0;else{const{start:t,end:s}=this._computationManipulators.get(i),r=()=>{n.attached=t.grabbing||s.grabbing};r(),this.addHandles([t.events.on("grab-changed",r),s.events.on("grab-changed",r)],e)}})),(0,c.YP)((()=>{const e=this._activeComputation;return(0,l.pC)(e)?{geometry:e.geometry,constraint:e.previousConstraint}:{}}),(({geometry:e,constraint:t})=>{const i=this._constraintSnappingIndicator;(0,l.pC)(e)&&(0,l.pC)(t)&&t!==Je.Direct?(i.visible=!0,i.setGeometryFromSegment(e.directSegment)):i.visible=!1}))]}removeStaged(){return!!(0,l.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(e){const{_stagedDimension:t}=this;if((0,l.Wi)(t)){const t=this._onUnstagedClick(e);return this.analysis.dimensions.add(t),null}return this._onStagedClick(e),t}onPointerMove({mapPoint:e,pointerType:t}){if("touch"===t)return;const i=this._snappingContext(t);this.updatingHandles.addPromise((0,tt.R8)(this._snappingOperation.snap({point:e},this._snappingManager,i)))}onManipulatorSelectionChanged(){(0,l.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick({mapPoint:e,pointerType:t}){let i=e;if("mouse"===t){const n=this._snappingContext(t);i=this._snappingManager.update({point:e,context:n})}const n=new Ke.Z({startPoint:(0,b.WG)(i,new Ee.Z),endPoint:null,measureType:p.n.Horizontal});return this._stagedDimension=n,this._resetSnappingState(),n}_onStagedClick({mapPoint:e,pointerType:t}){const i=this._stagedComputation;if((0,l.Wi)(i))return;let n=e;if("mouse"===t){const i=this._snappingContext(t);n=this._snappingManager.update({point:e,context:i})}const s=(0,b.WG)(n,new Ee.Z);this._applyPointUpdate(i,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_addComputation(e){if(this._computationManipulators.has(e))return;const t=this._setupPointManipulator(e,{isStart:!0}),i=this._setupPointManipulator(e,{isStart:!1}),n=this._setupOffsetManipulator(e),s=this._setupHeadingManipulator(e),r=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,p.n.Direct),a=this._setupMeasureTypeManipulator(e,p.n.Horizontal),l=this._setupMeasureTypeManipulator(e,p.n.Vertical),c=new De({start:t,end:i,offset:n,heading:s,rotation:r,direct:o,horizontal:a,vertical:l});this._setupComputationToManipulatorsSync(e,c),this._computationManipulators.set(e,c),this.manipulators.addMany(c.values())}_removeComputation(e){const t=this._computationManipulators.get(e);if(!(0,l.Wi)(t)){this._computationHandles.remove(e),this._computationManipulators.delete(e);for(const e of t.values())this.manipulators.remove(e)}}_setupComputationToManipulatorsSync(e,t){this._computationHandles.add([(0,c.YP)((()=>e.geometry),(()=>this._updateManipulators(e,t)),{...c.tX,equals:et.fS})],e)}_setupPointManipulator(e,t){const{view:i}=this,{dimension:n}=e,s=function(e,t){const i=(0,we.aD)(e,oe.Z.toUnitRGB(ve.pointManipulators.color),ve.pointManipulators.opacity,Xe);return i.available=!1,i.grabCursor="crosshair",i.radius=ve.pointManipulators.radius,i.metadata=t.metadata,i.collisionPriority=1,i}(i,{metadata:n}),r=function(e,{isStart:t,createSnappingPipelineStep:i,dimension:n,onUpdate:s,snappingPipeline:r,view:o}){const a=t?"startPoint":"endPoint",l=(0,be.Xd)(e,((e,t,l,c)=>{const d=(0,Ce.J4)(e);l=l.next(d).next((0,be.di)(n,[a,"measureType","orientation"])),t.next(d).next((0,Ce.gv)(o)).next(i(l,c),r.next).next((e=>{const t=(0,b.WG)(e.mapEnd,new Ee.Z);s("startPoint"===a?{startPoint:t}:{endPoint:t})}))}));return[l]}(s,{isStart:t.isStart,createSnappingPipelineStep:(e,t)=>this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:this._snappingContext(t),snappingManager:this._snappingManager,updatingHandles:this.updatingHandles,cancel:e}),dimension:n,onUpdate:t=>{this._applyPointUpdate(e,t)},snappingPipeline:this._snappingPipeline,view:i});return this._computationHandles.add(r,e),s}_setupOffsetManipulator(e){const{view:t}=this,i=function(e,t){const i=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],{lengthFraction:n}=ve.offsetManipulator,s=(0,xe.rh)(i.map((e=>(0,S.g)((0,w.c)(),e,n))));return new Se.Z({view:e,renderObjects:[{geometry:s,material:t.unfocusedMaterial,stateMask:Me.Q9.Unfocused|Me.Q9.Selected|Xe},{geometry:s,material:t.focusedMaterial,stateMask:Me.Q9.Focused|Xe}],collisionType:{type:"line",paths:[i]},radius:Ye(t.lineSizePt)/2,metadata:t.metadata,available:!1,...we.X9})}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,be.Xd)(e,((e,n,s)=>{if(!ie(t)||!e.selected)return;const{geometry:r,dimension:o}=t,a=(0,Ce.J4)(e);n.next(a).next(He(i,o,r.dimensionSegment,r.primaryOffsetAxis)),s.next(a).next((0,be.di)(o,["offset"]))}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupHeadingManipulator(e){const{view:t}=this,i=Te(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=function(e,{computation:t,view:i}){return[(0,be.Xd)(e,((e,n,s)=>{Le({cancel:s,computation:t,settingHeading:!0,steps:n,view:i})}))]}(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupRotationManipulator(e){const{view:t}=this,i=Te(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),n=Re(i,{computation:e,view:t});return this._computationHandles.add(n,e),i}_setupMeasureTypeManipulator(e,t){const{view:i}=this,n=function(e,t){const i=[(0,w.f)(-.5,0,0),(0,w.f)(.5,0,0)],{lengthFraction:n}=ve.offsetManipulator,s=(0,xe.rh)(i),r=(0,xe.rh)(i.map((e=>(0,S.g)((0,w.c)(),e,n))));return new Se.Z({view:e,renderObjects:[{geometry:r,material:t.unfocusedMaterial,stateMask:Me.Q9.Unfocused|Xe},{geometry:r,material:t.focusedMaterial,stateMask:Me.Q9.Focused|Xe},{geometry:s,material:t.thinOffsetManipulatorMaterial,stateMask:Xe}],collisionType:{type:"line",paths:[i]},radius:Ye(t.lineSizePt)/2,available:!1,metadata:t.metadata,...we.X9})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),s=ze(n,{computation:e,manipulatorMeasureType:t,view:i});return this._computationHandles.add(s,e),n}_updateManipulators(e,t,i={stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator}){const{stagedDimension:n,selectedComputation:s,firstGrabbedManipulator:r}=i,{start:o,end:a,offset:c,heading:d,rotation:h}=t,u=s===e,f=ie(e),{dimension:g}=e;for(const e of t.values()){const t=f&&(0,l.Wi)(n)&&((0,l.Wi)(r)||e===r);e===c?(e.available=t,e.selected=u):e.available=t&&u}if(!f)return;(0,l.pC)(it(e,this.view))?t.forEachMeasureTypeManipulator((e=>e.available=!1)):t.manipulatorForMeasureType(g.measureType).available=!1;for(const e of[d,h])g.measureType===p.n.Direct&&0!==g.offset||(e.available=!1);q(e)?h.available=!1:d.available=!1;const{geometry:m}=e;o.renderLocation=m.directSegment.startRenderSpace,a.renderLocation=m.directSegment.endRenderSpace;const{renderCoordsHelper:_}=this.view;ke(c,m,_),d.available&&function(e,t,i){Ve(e,t,i,{forHeading:!0})}(d,e,_),h.available&&function(e,t,i){Ve(e,t,i,{forHeading:!1})}(h,e,_),t.forEachMeasureTypeManipulator(((t,i)=>{t.available&&function(e,t,i,n){const{geometry:s}=t,r=W(Qe,i,t,n),o=Y(qe,{measureType:i,directSegment:s.directSegment,renderCoordsHelper:n}),a=(0,S.y)(Ue,r.endRenderSpace,r.startRenderSpace),l=(0,we.Aq)(a,o,w.Z,Be),c=(0,S.l)(a);(0,y.k)(l,l,(0,S.s)(Ue,c,c,c)),e.modelTransform=l,e.renderLocation=r.eval(.5,Ue)}(t,e,i,_)}))}_updateManipulatorStyle(e){const t=function(e){return(0,le.F2)(e)+ve.offsetManipulator.linePaddingPx}(e),i=Ye(e),n={lineSizePt:e,material:this._orientationManipulatorMaterial};for(const{offset:e,heading:t,rotation:s}of this._computationManipulators.values())e.radius=i/2,Oe(t,n),Oe(s,n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:t}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_snappingContext(e){return new Dn({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new xi.c(new Pi.XE("point",(0,Ci.Y6)(!0,!1,this.view.spatialReference))),visualizer:new jt})}_applyPointUpdate(e,t){const{view:i}=this,n=k(e);"startPoint"in t&&(n.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(n.elevationAlignedEndPoint=t.endPoint);const s=V(n,i.renderCoordsHelper);if((0,l.Wi)(s))return;const r=it({...n,geometry:s},i);(function(e,t,i){const{constraint:n,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,unconstrainedGeometry:o,view:a}=i,{dimension:c,previousConstraint:d,preConstraintProperties:h}=e;if((0,l.Wi)(s)||(0,l.Wi)(r))return;const u=()=>{"startPoint"in t?c.startPoint=t.startPoint:"endPoint"in t&&(c.endPoint=t.endPoint)};if((0,l.Wi)(n))u(),(0,l.pC)(d)&&(0,l.pC)(h)&&(c.measureType=h.measureType,c.orientation=h.orientation);else switch(c.measureType=p.n.Direct,n){case Je.Horizontal:if(n!==d&&(c.orientation=0),"startPoint"in t){const e=t.startPoint;(0,l.pC)(e)&&(e.z=r.z),c.startPoint=e}else if("endPoint"in t){const e=t.endPoint;(0,l.pC)(e)&&(e.z=s.z),c.endPoint=e}break;case Je.Vertical:if(n!==d&&(c.orientation=Ze(o,a)),"startPoint"in t){const e=t.startPoint;(0,l.pC)(e)&&(e.x=r.x,e.y=r.y),c.startPoint=e}else if("endPoint"in t){const e=t.endPoint;(0,l.pC)(e)&&(e.x=s.x,e.y=s.y),c.endPoint=e}break;case Je.Direct:n!==d&&(0,l.pC)(h)&&(c.orientation=h.orientation),u()}e.previousConstraint=n})(e,t,{...n,constraint:r,unconstrainedGeometry:s,view:i}),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}_updateStagedDimensionOffset(e){if((0,l.Wi)(e.geometry))return;e.geometry.directSegment.eval(.5,Hn);const t=this.view.state.camera.computeRenderPixelSizeAt(Hn);e.dimension.offset=ve.initialOffsetPx*t}get testInfo(){const e=e=>this.analysisViewData.computations.find((t=>t.dimension===e));return{getManipulatorsForDimension:t=>this._computationManipulators.get(e(t)),getComputationForDimension:t=>e(t),getConstraintForDimension:t=>{const i=e(t);return(0,l.pC)(i)?it(i,this.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};function zn(){const{color:e,opacity:t}=ve.offsetManipulator;return new ft.U({color:[...oe.Z.toUnitRGB(e),t],width:1,renderOccluded:ut.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,s._)([(0,d.Cb)({constructOnly:!0})],Ln.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Ln.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Ln.prototype,"manipulators",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Ln.prototype,"parentTool",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],Ln.prototype,"view",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Ln.prototype,"updating",null),(0,s._)([(0,d.Cb)()],Ln.prototype,"firstGrabbedManipulator",null),(0,s._)([(0,d.Cb)()],Ln.prototype,"hasGrabbedManipulators",null),(0,s._)([(0,d.Cb)()],Ln.prototype,"_stagedDimension",void 0),(0,s._)([(0,d.Cb)()],Ln.prototype,"_activeComputation",null),(0,s._)([(0,d.Cb)()],Ln.prototype,"_stagedComputation",null),Ln=(0,s._)([(0,h.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],Ln);const Hn=(0,w.c)();var Zn=i(8927),kn=i(20757),Vn=i(53203);const In={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};var Gn,Wn=i(38114);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Gn||(Gn={}));let Fn=class extends Vn.f{constructor(e){super(e),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=ve.pointerMoveTimeoutMs,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,Zn.Z8)(this.view.state.viewingMode),this._intersector.options.store=kn.eC.MIN,this._lengthDimensionSubTool=new Ln({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,re.ed)(this._lengthDimensionSubTool),(0,re.kB)((()=>this._clearPointerMoveTimeout())),(0,c.YP)((()=>this.state),(e=>{e===Gn.Created&&this.finishToolCreation()}),c.tX),(0,c.gx)((()=>this.firstGrabbedManipulator),(e=>{this.selectedDimension=e.metadata}),c.tX),(0,c.YP)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.tX)])}get state(){return this.analysis.dimensions.some((e=>"length"===e.type))?(0,l.pC)(this._activeSubTool)?Gn.Creating:Gn.Created:Gn.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(e){this.analysisViewData.selectedDimension=e}onInputEvent(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(In.cancel===e.key){if((0,l.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else In.delete.includes(e.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){(0,l.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(e){if(this.hasFocusedManipulators)return void e.stopPropagation();if((0,l.Wi)(this._activeSubTool))return;const t=this._intersectScreen(e);(0,l.Wi)(t)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}_doubleClickHandler(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}_pointerMoveHandler(e){if(this._resetPointerMoveTimeout(),(0,l.Wi)(this._activeSubTool))return;if(this.hasFocusedManipulators)return;const t=this._intersectScreen(e);(0,l.Wi)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}_deleteKeyHandler(){(0,l.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(e){const t=(0,Wn.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);const i=this._intersector.results.min,n=P.WM.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,this.view.spatialReference):null}_removeSelected(){(0,l.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.hw)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((e=>{e.manipulator.state|=Xe})),this._prevPointerMoveTimeout=se.m.setTimeout((()=>{this.manipulators.forEach((e=>{e.manipulator.state&=~Xe}))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:e=>{this._pointerMoveTimerMs=e,this._resetPointerMoveTimeout()}}}};(0,s._)([(0,d.Cb)({constructOnly:!0})],Fn.prototype,"view",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0})],Fn.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],Fn.prototype,"state",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Fn.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],Fn.prototype,"cursor",null),(0,s._)([(0,d.Cb)({constructOnly:!0})],Fn.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)()],Fn.prototype,"selectedDimension",null),(0,s._)([(0,d.Cb)()],Fn.prototype,"automaticManipulatorSelection",void 0),(0,s._)([(0,d.Cb)()],Fn.prototype,"_activeSubTool",void 0),(0,s._)([(0,d.Cb)()],Fn.prototype,"_lengthDimensionSubTool",void 0),Fn=(0,s._)([(0,h.j)("esri.views.3d.analysis.Dimension.DimensionTool")],Fn);i(87090);var Nn=i(10145),jn=i(6941),Yn=i(24370),Xn=i(84982);class qn extends ht._{constructor(e,t){super(e),this._hasExternalMaterial=!1,this._renderOccluded=ut.yD.OccludeAndTransparent,this._width=1,this._color=(0,rt.f)(1,0,1,1),this._placement="end",this._textureId=null,this._material=t,this._hasExternalMaterial=(0,l.pC)(t),this.applyProps(e)}setGeometryFromSegment(e,t){const i=e.endRenderSpace;this.transform=(0,y.f)(Un,i),this._normal=t;const{points:n}=e.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return(0,l.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(e){this._renderOccluded=e,(0,l.pC)(this._material)&&this._material.setParameters({renderOccluded:e})}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get normal(){return this._normal}set normal(e){this._normal=e,this.recreateGeometry()}get width(){return(0,l.pC)(this._material)?this._material.parameters.width:this._width}set width(e){this._width=e,(0,l.pC)(this._material)&&this._material.setParameters({width:e})}get color(){return(0,l.pC)(this._material)?this._material.parameters.color:this._color}set color(e){this._color=(0,rt.a)(e),(0,l.pC)(this._material)&&this._material.setParameters({color:this._color})}get placement(){return(0,l.pC)(this._material)?this._material.parameters.placement:this._placement}set placement(e){this._placement=e,(0,l.pC)(this._material)&&this._material.setParameters({placement:this._placement})}get textureId(){return(0,l.pC)(this._material)?this._material.parameters.textureId:this._textureId}set textureId(e){this._textureId=e,(0,l.pC)(this._material)&&this._material.setParameters({textureId:e})}createExternalResources(){this._hasExternalMaterial||(this._material=new Xn.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(e){for(const t of(0,Yn.c0)(this.geometry,this.normal)){const i=(0,Yn.YU)(t);e.addGeometry(i,(0,l.Wg)(this._material))}}forEachExternalMaterial(e){this._hasExternalMaterial||e((0,l.Wg)(this._material))}}const Un=(0,v.c)();class Bn{constructor(e){this.destroyed=!1,this._handles=new f.Z,this._messages=null,this._labelSegment=new M.y;const{analysis:t,computation:i,view:n,messages:s}=e;this.analysis=t,this.computation=i,this.view=n,this._messages=s;const r=e.visible,o={view:n,attached:r},{fontSize:a,textColor:d,textBackgroundColor:h}=t.style;this._visualElements=new $n({marker:new qn(o,e.markerMaterial),dimension:new Xt.r(o,e.dimensionLineMaterial),startOffset:new Xt.r(o,e.offsetLineMaterial),endOffset:new Xt.r(o,e.offsetLineMaterial),dimensionSmall:new Xt.r(o,e.smallDimensionLineMaterial),startOffsetSmall:new Xt.r(o,e.smallOffsetLineMaterial),endOffsetSmall:new Xt.r(o,e.smallOffsetLineMaterial),label:new jn.Kc({view:n,attached:r,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,le.F2)(a),textColor:d.clone(),backgroundColor:h.clone()})}),this._handles.add([(0,c.YP)((()=>i.geometry),(e=>{this.updateCameraDependentElements(n.state.camera,e,t.style),(0,l.pC)(i.geometry)&&this._updateLines(i.geometry)}),{...c.nn,equals:et.fS}),(0,c.YP)((()=>i.length),(e=>this._updateLabelContent(e)),c.nn)])}set visible(e){for(const t of this._visualElements.values())t.attached=e}destroy(){this.destroyed=!0,this._handles=(0,l.SC)(this._handles);for(const e of this._visualElements.values())e.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(e){const t=I(Qn,G.Start,e.directSegment,e.dimensionSegment),i=I(Jn,G.End,e.directSegment,e.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),n.dimension.setGeometryFromSegment(e.dimensionSegment),n.startOffset.setGeometryFromSegment(t),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(t),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(e,t,i){const n=this._visualElements;if((0,l.Wi)(t)){for(const e of n.values())e.visible=!1;return}const s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Kn)),r=function(e,t){return(0,S.p)(J($,e))/t**2}(t,s),o=r<((0,le.F2)(i.lineSize)*ve.smallScreenLengthLineSizeFactor)**2,a=!o;n.marker.visible=a,n.dimension.visible=a,n.startOffset.visible=a,n.endOffset.visible=a,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const c=(0,le.F2)(i.fontSize)*ve.labels.minScreenLengthFontSizeFactor,{label:d}=n;if(r<c**2)return void(d.visible=!1);d.visible=!0;const{dimensionSegment:h,primaryOffsetAxis:u}=t,{offset:p}=this.computation.dimension,f=(Math.sign(p)>=0?1:-1)*function(e){return 1.5*(0,le.F2)(e.fontSize)+ve.labels.marginPx+(0,le.F2)(e.lineSize/2)}(i)*s;(function(e,t,i,n){(0,S.z)(e.startRenderSpace,t.startRenderSpace,i,n),(0,S.z)(e.endRenderSpace,t.endRenderSpace,i,n)})(this._labelSegment,h,u,f),d.updateLabelPosition()}updateLabelStyle(e){const{label:t}=this._visualElements;t.fontSize=(0,le.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}updateUnitsMessages(e){this._messages=e;const{length:t}=this.computation;this._updateLabelContent(t)}_updateLabelContent(e){const{label:t}=this._visualElements;(0,l.Wi)(e)||(0,l.Wi)(this._messages)?t.text="":t.text=(0,Nn.VG)(this._messages,e,e.unit)}}const Qn=new M.y,Jn=new M.y,Kn=(0,w.c)();class $n{constructor(e){this.marker=e.marker,this.dimension=e.dimension,this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.dimensionSmall=e.dimensionSmall,this.startOffsetSmall=e.startOffsetSmall,this.endOffsetSmall=e.endOffsetSmall,this.label=e.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var es=i(39530);class ts{constructor(e,t){this._textures=e,this._textureRepository=t,this._texturesByPrimitive=new Map}acquire(e){if(!this._texturesByPrimitive.has(e)){const t=(0,Pe.uM)(this._textures,e),i=new es.T(this._textureRepository,t.texture.id);return this._texturesByPrimitive.set(e,{result:t,reference:i}),t.texture}return this._texturesByPrimitive.get(e).result.texture}destroy(){this._texturesByPrimitive.forEach((({result:e,reference:t})=>{t.dispose(),e.release()})),this._texturesByPrimitive.clear()}}var is=i(60997),ns=i(8108),ss=i(60720);let rs=class extends r.Z{constructor(e){super(e),this.loadingMessages=!1,this._messages=null,this._dimensionVisualizations=new Map,this._markerMaterial=new Xn.X({width:1,anchor:is.i5.Tip,color:Ut.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:ut.yD.OccludeAndTransparent}),this._dimensionLineMaterial=new ft.U({width:1,color:Ut.Z,renderOccluded:ut.yD.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters}),this._offsetLineMaterial=new ft.U({width:1,color:Ut.Z,renderOccluded:ut.yD.OccludeAndTransparent,stipplePattern:(0,Bt.z5)(5),stippleScaleWithLineWidth:!0}),this._smallDimensionLineMaterial=new ft.U({width:1,color:Ut.Z,renderOccluded:ut.yD.OccludeAndTransparent}),this._smallOffsetLineMaterial=new ft.U({width:1,color:Ut.Z,renderOccluded:ut.yD.OccludeAndTransparent,stipplePattern:(0,Bt.z5)(5),stippleScaleWithLineWidth:!0})}get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}initialize(){const{textures:e}=this.view.sharedSymbolResources;if((0,l.pC)(e)){const{textureRepository:t}=this.view._stage.renderView,i=new ts(e,t),n=i.acquire("triangle");this.addHandles((0,re.kB)((()=>i.destroy()))),this._markerMaterial.setParameters({textureId:n.id})}for(const e of this._lineMaterials())this.view._stage.add(e),this.addHandles((0,re.kB)((()=>{this.view._stage.remove(e),e.dispose()})));const{computations:t}=this.analysisViewData;for(const e of t)this._addComputation(e);this.addHandles([t.on("change",(({added:e,removed:t})=>{for(const e of t)this._removeComputation(e);for(const t of e)this._addComputation(t)})),(0,c.YP)((()=>oe.Z.toUnitRGBA(this.analysis.style.color)),(e=>{for(const t of this._lineMaterials())t.setParameters({color:e})}),c.tX),(0,c.YP)((()=>this.analysis.style.lineSize),(e=>{const t=(0,le.F2)(e);this._markerMaterial.setParameters({width:t*ve.markers.lineSizeFraction}),this._dimensionLineMaterial.setParameters({width:t,markerParameters:this._markerMaterial.parameters});const i=Math.max(t*ve.offsetLine.lineSizeFraction,1);this._offsetLineMaterial.setParameters({width:i})}),c.tX),(0,c.YP)((()=>({camera:this.view.state.camera,style:os(this.analysis)})),(({camera:e,style:t})=>{for(const[i,n]of this._dimensionVisualizations)n.updateCameraDependentElements(e,i.geometry,t),n.updateLabelStyle(t)})),(0,c.YP)((()=>this.visible),(e=>{for(const t of this._dimensionVisualizations.values())t.visible=e}))]),this.addHandles([(0,ns.qe)((()=>this._updateMessageBundle())),(0,c.gx)((()=>!this.loadingMessages),(()=>{for(const e of this._dimensionVisualizations.values())e.updateUnitsMessages(this._messages)}),c.Z_)]),this._updateMessageBundle()}destroy(){this._dimensionVisualizations.forEach((e=>{e.destroy()})),this._dimensionVisualizations.clear()}get testInfo(){return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:()=>{for(const e of this._lineMaterials())e.setParameters({renderOccluded:ut.yD.Occlude})}}}_addComputation(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new Bn({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}_removeComputation(e){const t=this._dimensionVisualizations.get(e);(0,l.Wi)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,ss.ME)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function os(e){const{fontSize:t,lineSize:i,textColor:n,textBackgroundColor:s}=e.style;return{fontSize:t,lineSize:i,textBackgroundColor:s.clone(),textColor:n.clone()}}(0,s._)([(0,d.Cb)({constructOnly:!0})],rs.prototype,"analysisViewData",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],rs.prototype,"view",void 0),(0,s._)([(0,d.Cb)()],rs.prototype,"analysis",null),(0,s._)([(0,d.Cb)()],rs.prototype,"visible",null),(0,s._)([(0,d.Cb)()],rs.prototype,"loadingMessages",void 0),rs=(0,s._)([(0,h.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],rs);let as=class extends r.Z{constructor(e){super(e),this.dimension=null,this.length=null}};(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],as.prototype,"dimension",void 0),(0,s._)([(0,d.Cb)()],as.prototype,"length",void 0),as=(0,s._)([(0,h.j)("esri.views.3d.analysis.LengthDimensionResult")],as);const ls=as;let cs=class extends r.Z{constructor(e){super(e),this.geometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(e){const{dimension:t,...i}=e;return{result:new ls({dimension:t}),...i}}initialize(){this.addHandles([(0,c.YP)((()=>this.dimension.startPoint),(e=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(e)),c.tX),(0,c.YP)((()=>this.dimension.endPoint),(e=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(e)),c.tX)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],cs.prototype,"result",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],cs.prototype,"projectAndAlignPoint",void 0),(0,s._)([(0,d.Cb)()],cs.prototype,"dimension",null),(0,s._)([(0,d.Cb)()],cs.prototype,"length",null),(0,s._)([(0,d.Cb)()],cs.prototype,"geometry",void 0),(0,s._)([(0,d.Cb)()],cs.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,d.Cb)()],cs.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,d.Cb)()],cs.prototype,"preConstraintProperties",void 0),(0,s._)([(0,d.Cb)()],cs.prototype,"previousConstraint",void 0),cs=(0,s._)([(0,h.j)("esri.views.3d.analysis.LengthDimensionComputation")],cs);var ds=i(28376),hs=i(76497);const us=e=>{let t=class extends e{constructor(...e){super(...e),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new o.Z}createLengthDimensions(e){throw new Error("Method not implemented.")}};return(0,s._)([(0,d.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,s._)([(0,d.Cb)()],t.prototype,"tool",void 0),(0,s._)([(0,d.Cb)({readOnly:!0})],t.prototype,"results",null),(0,s._)([(0,d.Cb)()],t.prototype,"selectedDimension",void 0),(0,s._)([(0,d.Cb)()],t.prototype,"interactive",void 0),(0,s._)([(0,d.Cb)()],t.prototype,"visible",void 0),t=(0,s._)([(0,h.j)("esri.views.analysis.DimensionAnalysisView")],t),t};let ps=class extends(us((0,u.p)(r.Z))){constructor(e){super(e),this.type="dimension-view-3d",this.tool=null,this.computations=new o.Z,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=e=>{if((0,l.Wi)(e))return null;const{spatialReference:t,elevationProvider:i}=this.view,n=(0,ds.G)(e,t,i);return(0,l.Wi)(n)&&(0,ds.e)(this.analysis,e.spatialReference,a.Z.getLogger(this.declaredClass)),n},this.addHandles([(0,hs.Lp)(this,Fn),(0,c.on)((()=>this.analysis.dimensions),"after-add",(e=>this._onDimensionAdd(e.item)),{onListenerAdd:e=>{for(const t of e)this._onDimensionAdd(t)},onListenerRemove:()=>{this._onDimensionsClear()}}),(0,c.on)((()=>this.analysis.dimensions),"after-remove",(e=>this._onDimensionRemove(e.item)))]),this._analysisVisualization=new rs({analysisViewData:this,view:this.view}),this._analysisController=new ne({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.IM)(this._placementTask),this._analysisVisualization=(0,l.SC)(this._analysisVisualization),(0,hs.Yq)(this)}get updating(){return this._analysisVisualization?.loadingMessages??!1}get results(){return this.analysis.dimensions.map((e=>this._dimensionsToComputations.get(e).result))}get selectedComputation(){const{selectedDimension:e}=this;return(0,l.Wi)(e)?null:this._dimensionsToComputations.get(e)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(e){return this.selectedDimension=null,this._placementTask=(0,l.IM)(this._placementTask),this._placementTask=(0,hs.Er)(this,e),this._placementTask.promise}_onDimensionAdd(e){const{computations:t,_dimensionsToComputations:i}=this;if(i.has(e))return;const n=new cs({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});t.add(n),i.set(e,n)}_onDimensionRemove(e){const{computations:t,_dimensionsToComputations:i}=this,n=t.findIndex((t=>t.dimension===e)),s=t.getItemAt(n);s.dimension===this.selectedDimension&&(this.selectedDimension=null),t.removeAt(n),i.delete(e),(0,l.SC)(s)}_onDimensionsClear(){this.computations.drain((e=>e.destroy())),this._dimensionsToComputations.clear()}};(0,s._)([(0,d.Cb)({readOnly:!0})],ps.prototype,"type",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"tool",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"updating",null),(0,s._)([(0,d.Cb)({readOnly:!0})],ps.prototype,"results",null),(0,s._)([(0,d.Cb)({readOnly:!0})],ps.prototype,"computations",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"selectedDimension",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"selectedComputation",null),(0,s._)([(0,d.Cb)()],ps.prototype,"_analysisVisualization",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"_analysisController",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"_dimensionsToComputations",void 0),(0,s._)([(0,d.Cb)()],ps.prototype,"_placementTask",void 0),ps=(0,s._)([(0,h.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],ps);const fs=ps},28401:(e,t,i)=>{i.d(t,{O:()=>a,s:()=>l});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACtVBMVEUAAAD/AAD/gAD/VQD/gAD/gAD/bQD/gAD/cQD/gAD/dAD/gAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/fAD/gAD/gAD/fAD/gAD/fQD/fQD/gAD/fQD/egD/fQD/gAD/egD/fQD/gAD/ewD/gAD/ewD/gAD/ewD/fQD/fQD/gAD/ewD/fQD/gAD/fAD/gAD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/fQD/fQD/fgD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/gAL/fgD/gAb/gAT/gwr/hAz/hxH/hQ//iBX/iBP/ixn/iRf/jBr/jR7/jyP/jyL/kif/kCX/kyr/lS7/lCz/ljH/li//mTX/nDr/mjn/nTz/oEL/okf/o0r/pU3/pU7/qFL/plH/qFX/q1j/q1r/rl7/sGL/rmH/s2v/tW//tW7/t3L/uHL/unb/unf/vHv/vX3/v4D/vX7/v4D/wYT/v4L/wYX/x4//x5H/yZX/y5n/zZv/y5n/zJv/zZ3/zp//0aL/z6H/1Kr/1av/06r/1q//17H/2bT/2LP/2rb/27n/3bz/3r7/37//4MH/38D/4ML/4sX/4sb/4sf/48n/5cv/48r/5cz/5s7/6dT/6tb/69j/69n/7Nn/7dv/7dz/7t7/7t3/7+H/7+D/7+H/8eL/8uX/8uX/8ub/8+j/8+f/9On/9er/9Or/9ez/9e3/9ez/9u7/9e3/9+//9+7/+PD/+PH/+fT/+fL/+vb/+vX/+vb/+/f/+vb//Pn/+/j//Pr//Pn//fv//Pr//fv//v3//fz//////v7//v3///8ZYzD6AAAA5nRSTlMAAQIDBAYHCAkKCwwQERITGBkaGyUmKCkqKy0uLzAxMjIzNDQ2Njg4OTs+Pj9AQEJCQ0RERUZHUlJTVFVWWFlfYGFiY2RlZmdoaWprbG1ucHFyc3R1dnd4eXp8f4CAgYGCg4SEhYWGhoeIiYmKiouMjI2Nj5CQkZOUlZaXmJiZmpudnp6io6OkpaanqKmqqqusrK2xs7W2t7e4ubq7u7/AwMLExcXGyMrLzM3NztDR0tPU1NXW29zd3t/g4eLi5OTl5ufo6erq6+zs7e7u7+/w8PHy9PT29vf4+Pn5+vr7+/z9/f7+/pNrFTEAAAO8SURBVHjaldf5W1RVGAfwl4kGxa2yIDPbF82EJhkVUEOiUiDMcJa482XCijStNLLVpoWCbLHFaZUoMSkq2wgtW8mobFcryiiWkffv6J557jh3zj33zvD56f3h3vM873nP+z7nkJ3cPE9JxdX+OgSWX15aMG0CjcnUoiuRSls2byplyH1eDZSqZrkz+d0ThC1/QQ45c521Eo58p5GTSZcirbIpZGtGEBkI5pNaVhEyo3mzSCF7ITJW7CKLYxbDTsPG5qe33QezxdkkySqGndYY615CilI5Cy9sRVjYgVRzKcXJGmzdwsKHkEwnkylB2AsNse5zSIITKWkJnPzCut8gW5IsxRlw9CnrRuohO5MM43xw9D4Lt0JWm2jOOXD2Ogv3w6LQaGA/nL3AwuOwCLpJmIU0nmDheVidQ0IV0niAhQ5YVcfnH2zcCMNtLLwHheOJaB5s7OxuQlx4hHV7oeAhokrYaOeBjkYIv7LuJyhUEU3QYONFZj4YrQfwGeuGQrDSxtM0KK2N7h5koa8V+ICFdVA4SX2Kbt5xmA2j7SHsZGETFOZQqarwhzjhUAuAl1nYDIUFdAVkoe0s/LiLmT9eD91TLDwHhXJaDtmbrPvyEWzg4dfCEB5kYTsUrqIgJK8w8/C2MHDDgWYgromFXVDwkQbDRsRFhpkHWyHcBMO1oyzSgcI1VGdEd8V6o6uA8D7m2BZIDrJuPxTqKGBEnczc33nHFmZ+A7IvWDegTmEF4lb1s3Dk+wH+oxGyj1hYC6saqkDcVk74u6cJsk4W7oXVZVSCuK84aXTP5pBcGeFRWM2nQmMPOw+zyQ9t62DyLAtRWM2mPBgao1+zyVD3wyEkPMTCq7DKo/Gmdo50DbDJd22JbbudhXdgoeUSVcNkTfRbNvnv3U0QGmKs2w2LpUR0MVI1d4+wSW/0egC/i7APFkXKobq+7Wc2+avrHvSK4B/1UKUaWNQ/1nOEk2Kf7GdhNSTLSDgfKhvaDrDsbkhmkuAOQKnhmb2cqkVuBDfFeWDnzo4/2WQrUl2QuB7XwtZ1T+7ho9qRYmUOGc6Gk8hb/xoLvI0Up1KCqxyOVkf3sdADs0soaVIQaUS6Bpm/gUlgMplMR1pron39SNLyKcVcpBduCQMJXpLMx5gsdJEkexHGYJGLLFzFyFhJNilkeTVkxkM28oPIQOAUsjW5DGmVTSQnM3xwVHt6FjnLudAPW4GLMnq7zqyEUvW5x1KGTvAulSqiVRYeR2OSmz+7uKLGpwX8K8oXFJw4zu67/wFaspwc84wT2QAAAABJRU5ErkJggg==";var r=i(44101);const o={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function a(e){return e.fromData(n,(()=>new r.x(n,o)))}function l(e){return e.fromData(s,(()=>new r.x(s,o)))}},81536:(e,t,i)=>{i.d(t,{J4:()=>m,_N:()=>f,gv:()=>_});var n,s=i(61681),r=i(95550),o=(i(6766),i(8909)),a=(i(90472),i(69430)),l=i(97537),c=(i(5700),i(68817)),d=(i(83772),i(40460)),h=i(8927),u=i(20757),p=i(5073);i(34108);function f(e,t){return g(e,(()=>t))}function g(e,t){const i=(0,o.c)(),n=(0,o.c)();let l=!1;return o=>{const h=t(o);if("start"===o.action){const t=(0,r.md)(o.screenStart,(0,r.c$)(c.qW.get())),n=(0,d.u4)(e.state.camera,t,y);(0,s.pC)(n)&&(l=(0,a.BR)(h,n,i))}if(!l)return null;const u=(0,r.md)(o.screenEnd,(0,r.c$)(c.qW.get())),p=(0,d.u4)(e.state.camera,u,y);return(0,s.Wi)(p)?null:(0,a.BR)(h,p,n)?{...o,renderStart:i,renderEnd:n,plane:h,ray:p}:null}}function m(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,s.pC)(t)&&(t.remove(),t=null)}return i}}function _(e,t=null){const i=(0,h.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=u.eC.MIN,i.options.hud=!1;const a=(0,r.s1)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=(0,o.c)(),d=(0,s.Pt)(t,e.spatialReference),f=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(p.cy):l.exclude.delete(p.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,r.md)(t,a),i,l);const s=i.results.min;let o;if(s.getIntersectionPoint(c))o=s.intersector===u.q7.TERRAIN?n.GROUND:n.OTHER;else{if(!i.results.ground.getIntersectionPoint(c))return null;o=n.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(c,d),surfaceType:o}};let g;return e=>{if("start"===e.action){const t=f(e.screenStart);g=(0,s.pC)(t)?t.location:null}if((0,s.Wi)(g))return null;const t=f(e.screenEnd);return(0,s.pC)(t)&&(0,s.pC)(t.location)?{...e,mapStart:g,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(n||(n={}));(0,o.c)(),(0,o.c)();const y=(0,l.Ue)()},83061:(e,t,i)=>{i.d(t,{R:()=>S});var n=i(44584),s=i(61681),r=i(76868),o=i(24455),a=i(39100),l=i(6766),c=i(8909),d=i(88589),h=i(18916),u=i(68817),p=i(10449),f=i(47562),g=i(6087),m=i(7358),_=i(21414),y=i(84891),v=i(65392);class S extends p._{constructor(e){super(e),this._handles=new n.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,c.c)(),this._up=(0,c.c)(),this._right=(0,c.c)(),this._renderOccluded=m.yD.OccludeAndTransparent,this._color=(0,h.f)(1,0,0,1),this._outlineColor=(0,h.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=m.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,d.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,d.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,l.i)(t,e),(0,l.i)(t,i))/3,(0,l.n)(this._up,(0,l.b)(this._up,e,t)),(0,l.n)(this._right,(0,l.b)(this._right,i,t)),(0,l.c)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new y.E(this._quadMaterialParameters),this._outlineMaterial=new v.U(this._outlineMaterialParameters),this._handles.add((0,r.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){(0,l.k)(this._up,c.Z)&&(0,l.k)(this._right,c.Z)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,l.a)(u.WM.get(),this._up,this._right),i=(0,g.rh)([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,o.f)(w,this._position),(0,o.k)(w,w,[n,n,n]),(0,s.pC)(e)&&(e.transformation=w)}_quadGeometryData(e,t){const i=(0,l.a)(u.WM.get(),e,t);return new f.Z([[_.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[_.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}const w=(0,a.c)()},39530:(e,t,i)=>{i.d(t,{T:()=>r});var n=i(61681),s=i(78668);class r{constructor(e,t){this._textureRep=e,this._disposed=!1;const i=this._textureRep.acquire(t);(0,s.y8)(i)?(i.then((e=>{this._disposed?(0,n.RY)(e):this._textureRef=e})),this.loadPromise=i):this._textureRef=i}dispose(){this._textureRef=(0,n.RY)(this._textureRef),this._disposed=!0}get glTexture(){return(0,n.pC)(this._textureRef)?this._textureRef.glTexture:null}}},50639:(e,t,i)=>{i.d(t,{c:()=>d});var n=i(36663),s=i(30936),r=i(82064),o=i(81977),a=i(40266);let l=class extends r.wq{constructor(){super(...arguments),this.enabled=!0}};(0,n._)([(0,o.Cb)({type:Boolean})],l.prototype,"enabled",void 0),l=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],l);let c=class extends r.wq{constructor(e){super(e),this.lineSnapper=new l,this.parallelLineSnapper=new l,this.rightAngleSnapper=new l,this.rightAngleTriangleSnapper=new l,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new s.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"lineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"parallelLineSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleSnapper",void 0),(0,n._)([(0,o.Cb)({type:l,constructOnly:!0,nonNullable:!0,json:{write:!0}})],c.prototype,"rightAngleTriangleSnapper",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"shortLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],c.prototype,"distance",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"intersectionParallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"parallelLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"touchSensitivityMultiplier",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],c.prototype,"pointOnLineThreshold",void 0),(0,n._)([(0,o.Cb)({type:s.Z,nonNullable:!0})],c.prototype,"orange",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthReference",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"lineHintWidthTarget",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"lineHintFadedExtensions",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],c.prototype,"parallelLineHintWidth",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],c.prototype,"parallelLineHintLength",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],c.prototype,"parallelLineHintOffset",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],c.prototype,"rightAngleHintSize",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],c.prototype,"rightAngleHintOutlineSize",void 0),c=(0,n._)([(0,a.j)("esri.views.interactive.snapping.Settings.Defaults")],c);const d=new c},45666:(e,t,i)=>{i.d(t,{Bq:()=>m,Hk:()=>p,M8:()=>C,UL:()=>y,aU:()=>S,jg:()=>w,ku:()=>g});var n=i(61681),s=i(55709),r=i(69666),o=i(6766),a=i(8909),l=i(50639),c=i(22519),d=i(6271),h=i(23440);class u{constructor(e){this.coordinateHelper=e}intersect(e){return function(e,t){let i=[];if(b(e)){const{pointXYZ:n}=e;M(t)?i=(0,d.pk)(t.lineLike,n):E(t)?i=(0,d.l0)(t.centerXYZ,t.radius,n):D(t)?i=(0,d.hm)(t.planeLike,n):A(t)&&(i=x(t,e))}else if(M(e)){const{lineLike:n}=e;b(t)?i=(0,d.pk)(n,t.pointXYZ):M(t)?i=(0,d.Lh)(n,t.lineLike):E(t)?i=(0,d.UG)(n,t.centerXYZ,t.radius):D(t)?i=(0,d.fK)(t.planeLike,n):A(t)&&(i=x(t,e))}else if(E(e)){const{centerXYZ:n,radius:s}=e;M(t)?i=(0,d.UG)(t.lineLike,n,s):b(t)?i=(0,d.l0)(n,s,t.pointXYZ):D(t)?i=(0,d._w)(t.planeLike,n,s):A(t)&&(i=x(t,e))}else if(D(e)){const{planeLike:n,coordinateHelper:s}=e;if(D(t))return(0,d.qi)(n,t.planeLike).map((i=>new _(s,s.fromXYZ(i),e,t)));b(t)?i=(0,d.hm)(n,t.pointXYZ):M(t)?i=(0,d.fK)(n,t.lineLike):E(t)?i=(0,d._w)(n,t.centerXYZ,t.radius):A(t)&&(i=x(t,e))}else A(e)&&(i=x(e,t));return function(e,t,i){const n=t.coordinateHelper;return e.map((e=>new m(n,n.fromXYZ(e),t,i)))}(i,e,t)}(this,e)}}class p extends u{constructor(e,t){super(e),this.point=t,this.pointXYZ=e.toXYZ(t)}equals(e){return b(e)&&(0,c.Xv)(this.point,e.point)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,o.d)(t,this.pointXYZ)<l.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}}class f extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.type=n,this.startXYZ=e.toXYZ(t),this.endXYZ=e.toXYZ(i),this.lineLike={start:this.startXYZ,end:this.endXYZ,type:this.type}}equals(e){return M(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,d.Mm)(this.lineLike,t)<l.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.ZE)(i,this.lineLike);return t.fromXYZ(n)}}class g extends f{constructor(e,t,i){super(e,t,i,h.SP.LINE)}}class m extends u{constructor(e,t,i,n){super(e),this.intersection=t,this.first=i,this.second=n}equals(e){return e instanceof m&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(){return this.coordinateHelper.clone(this.intersection)}}class _ extends u{constructor(e,t,i,n){super(e),this.basePoint=t,this.first=i,this.second=n}equals(e){return e instanceof _&&this.first.equals(e.first)&&this.second.equals(e.second)}check(){return!1}closestTo(e){const t=this.basePoint,i=this.coordinateHelper,n=i.toXYZ(e,T),s=(0,o.s)(O,t[0],t[1],n[2]);return i.fromXYZ(s)}}class y extends u{constructor(e,t,i){super(e),this.center=t,this.radius=i,this.centerXYZ=e.toXYZ(t)}equals(e){return E(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.xO)(i,this.centerXYZ,this.radius);return n[2]=t.getZ(e,this.centerXYZ[2]),t.fromXYZ(n)}}class v extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.type=n,this.planeLike={start:t,end:i,type:n}}equals(e){return D(e)&&this.type===e.type&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)}check(e){const t=this.coordinateHelper.toXYZ(e,T);return(0,d.xb)(t,this.planeLike)<l.c.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper,i=t.toXYZ(e,T),n=(0,d.z9)(i,this.planeLike);return t.fromXYZ(n)}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,s.h)((0,s.a)(R,i,t),(0,s.a)(L,e,t)))>0?i:t}}class S extends v{constructor(e,t,i){super(e,t,i,d.Jk.HALF_PLANE)}}class w extends v{constructor(e,t,i){super(e,t,i,d.Jk.PLANE)}}class C extends u{constructor(e,t,i,n){super(e),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:d.Jk.HALF_PLANE}}equals(e){return A(e)&&(0,c.Xv)(this.start,e.start)&&(0,c.Xv)(this.end,e.end)&&this.getZ===e.getZ}check(e){const t=this.coordinateHelper.toXYZ(e,T),i=P(this,t);return(0,o.d)(t,i)<l.c.pointThreshold}closestTo(e){const t=this.coordinateHelper,i=P(this,t.toXYZ(e,T));return t.fromXYZ(i)}addIfOnTheGround(e,t){for(const i of t){const t=this.getZ(i[0],i[1],i[2]);(0,n.pC)(t)&&Math.abs(i[2]-t)<d.Ho&&(i[2]=t,e.push(i))}}}function P(e,t){const i=(0,d.z9)(t,e.planeLike),s=e.getZ(t[0],t[1],t[2]);return(0,n.pC)(s)&&(i[2]=s),i}function x(e,t){const{planeLike:i,getZ:s}=e,r=[];if(b(t))e.addIfOnTheGround(r,(0,d.hm)(i,t.pointXYZ));else if(M(t))e.addIfOnTheGround(r,(0,d.fK)(i,t.lineLike));else if(E(t))e.addIfOnTheGround(r,(0,d._w)(i,t.centerXYZ,t.radius));else if(D(t)||A(t))for(const[e,o]of(0,d.qi)(i,t.planeLike)){const t=s(e,o,0);(0,n.pC)(t)&&r.push((0,a.f)(e,o,t))}return r}function b(e){return e instanceof p}function M(e){return e instanceof f}function E(e){return e instanceof y}function D(e){return e instanceof v}function A(e){return e instanceof C}const T=(0,a.c)(),O=(0,a.c)(),R=(0,r.a)(),L=(0,r.a)()},20999:(e,t,i)=>{var n;i.d(t,{B:()=>n}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(n||(n={}))},46455:(e,t,i)=>{i.d(t,{L:()=>a});var n=i(45666),s=i(22519),r=i(7062),o=i(65453);class a extends r.a{constructor(e){super({...e,constraint:new n.ku(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(s.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}},7062:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(20999),s=i(72461);class r extends s.j{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:s,elevationInfo:r}){super(e,t,s,r,n.B.FEATURE),this.objectId=i}}},72461:(e,t,i)=>{i.d(t,{j:()=>n});class n{constructor(e,t,i,n,s){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i,this.elevationInfo=n,this.domain=s}}},65453:(e,t,i)=>{i.d(t,{w:()=>o});i(39994),i(13802);var n=i(20999),s=i(22519),r=i(9650);class o extends r.r{constructor(e,t,i,s,r=n.B.ALL,o=!0,a=!0){super(s,r),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof o&&this.type===e.type&&(0,s.Xv)(this.lineStart,e.lineStart)&&(0,s.Xv)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}},82366:(e,t,i)=>{i.d(t,{n:()=>r});var n=i(22519),s=i(9650);class r extends s.r{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&(0,n.Xv)(this.point,e.point)}}},9650:(e,t,i)=>{i.d(t,{r:()=>n});class n{constructor(e,t){this.elevationInfo=e,this.domain=t}}},22519:(e,t,i)=>{i.d(t,{Bb:()=>l,ML:()=>_,Xv:()=>a,Z_:()=>g,_j:()=>m,fG:()=>c,lQ:()=>d,rh:()=>f,ze:()=>p});var n=i(61681),s=i(6766),r=i(8909),o=i(83772);function a(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[2]===t[2]&&e[3]===t[3]}return!1}function l(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function c(e,t){return Math.sqrt(l(e,t))}function d(e,t,i){const n=i.toXYZ(e,h);t.sort(((e,t)=>{const r=i.toXYZ(e.targetPoint,u),o=(0,s.d)(r,n),a=i.toXYZ(t.targetPoint,u);return o-(0,s.d)(a,n)}))}const h=(0,r.c)(),u=(0,r.c)();var p;function f(e,t){return{point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),distance:e.distance,types:e.types,query:(0,n.pC)(t)?t.toJSON():{where:"1=1"}}}function g(e,t,i,s){const{coordinateHelper:r,elevationInfo:a}=i;if(!r.hasZ()||(0,n.Wi)(t)||"3d"!==t.type||(0,n.Wi)(e)||(0,o.BK)(a,s))return e;const l=(0,o.zx)(t,e,r.spatialReference,a,s),c=r.clone(e);return c[2]=l,c}function m(e,t,i,n=o.jG){return{left:g(e.leftVertex.pos,t,i,n),right:g(e.rightVertex.pos,t,i,n)}}function _(e){return e.createQuery()}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(p||(p={}))},6271:(e,t,i)=>{i.d(t,{Ho:()=>b,Jk:()=>n,Lh:()=>S,Mm:()=>y,UG:()=>v,ZE:()=>_,_w:()=>d,fK:()=>h,hm:()=>u,l0:()=>C,pk:()=>w,qi:()=>p,xO:()=>m,xb:()=>g,z9:()=>f});var n,s=i(19431),r=i(55709),o=i(69666),a=i(6766),l=i(8909),c=i(23440);function d({start:e,end:t,type:i},s,o){const a=[],c=s,d=(0,r.a)(M,t,e),h=(0,r.a)(E,e,c),u=(0,r.v)(d),p=2*(0,r.h)(d,h),f=p*p-4*u*((0,r.v)(h)-o*o);if(0===f){const t=-p/(2*u);(i===n.PLANE||t>=0)&&a.push((0,r.w)((0,l.f)(0,0,s[2]),e,d,t))}else if(f>0){const t=Math.sqrt(f),o=(-p+t)/(2*u);(i===n.PLANE||o>=0)&&a.push((0,r.w)((0,l.f)(0,0,s[2]),e,d,o));const c=(-p-t)/(2*u);(i===n.PLANE||c>=0)&&a.push((0,r.w)((0,l.f)(0,0,s[2]),e,d,c))}return a}function h(e,t){const i=e.start,s=e.end,o=(0,r.a)(M,s,i),d=(0,a.s)(E,-o[1],o[0],0),h=t.start,u=t.end,p=(0,a.y)(D,u,h),f=(0,a.e)(p,d),g=(0,a.s)(A,i[0],i[1],0),m=(0,a.y)(T,g,h),_=(0,a.e)(m,d);if(Math.abs(f)<b)return Math.abs(_),[];const y=(0,a.z)(O,h,p,_/f);if(t.type===c.SP.RAY){const e=(0,a.y)(R,y,h);if((0,a.e)(e,p)<-b)return[]}if(e.type===n.HALF_PLANE){const e=(0,r.e)(R,y,i);if((0,r.h)(e,o)<-b)return[]}return[(0,l.a)(y)]}function u(e,t){return w(P(L,t[2],e),t)}function p(e,t){const i=S(P(L,0,e),P(z,0,t)),n=[];for(const e of i)n.push((0,o.d)(e));return n}function f(e,t){return _(e,P(L,e[2],t))}function g(e,t){return y(P(L,e[2],t),e)}function m(e,t,i){const n=(0,a.s)(M,e[0],e[1],t[2]),s=(0,a.b)(E,n,t),r=i/(0,a.l)(s);return(0,a.z)((0,l.c)(),t,s,r)}function _(e,{start:t,end:i,type:n}){const s=(0,a.y)(M,e,t),r=(0,a.y)(E,i,t),o=(0,a.e)(s,r)/(0,a.e)(r,r);return(0,a.z)((0,l.c)(),t,r,n===c.SP.RAY?Math.max(o,0):o)}function y({start:e,end:t,type:i},n){const s=(0,a.y)(M,n,e),r=(0,a.y)(E,t,e);if(i===c.SP.RAY&&(0,a.e)(r,s)<-b)return(0,a.i)(e,n);const o=(0,a.f)(D,r,s);return(0,a.u)(o)/(0,a.u)(r)}function v({start:e,end:t,type:i},n,o){const d=[];if((0,s.W8)(e[2],n[2],b)&&(0,s.W8)(t[2],n[2],b)){const s=e,a=n,h=(0,r.a)(M,t,s),u=(0,r.a)(E,s,a),p=(0,r.v)(h),f=2*(0,r.h)(h,u),g=f*f-4*p*((0,r.v)(u)-o*o);if(0===g){const e=-f/(2*p);(i===c.SP.LINE||e>=0)&&d.push((0,r.w)((0,l.f)(0,0,n[2]),s,h,e))}else if(g>0){const e=Math.sqrt(g),t=(-f+e)/(2*p);(i===c.SP.LINE||t>=0)&&d.push((0,r.w)((0,l.f)(0,0,n[2]),s,h,t));const o=(-f-e)/(2*p);(i===c.SP.LINE||o>=0)&&d.push((0,r.w)((0,l.f)(0,0,n[2]),s,h,o))}}else{const r=(0,a.y)(M,t,e);if((0,s.W8)(r[2],0,b))return d;const l=(n[2]-e[2])/r[2],h=(0,a.z)(E,e,r,l);if(i===c.SP.RAY){const t=(0,a.y)(D,h,e);if((0,a.e)(r,t)<-b)return d}for(const e of C(n,o,h))d.push(e)}return d}function S(e,t){const i=e.start,n=e.end,r=t.start,o=t.end,d=(0,a.y)(M,n,i),h=(0,a.y)(E,o,r),u=(0,a.y)(D,r,i),p=(0,a.f)(A,d,h),f=(0,a.e)(u,p);if(!(0,s.W8)(f,0,b))return[];const g=(0,a.D)(p);if((0,s.W8)(g,0,b))return[];const m=(0,a.f)(T,u,h),_=(0,a.e)(m,p)/g,y=(0,a.z)(O,i,d,_);if(e.type===c.SP.RAY){const e=(0,a.y)(R,y,i);if((0,a.e)(d,e)<-b)return[]}if(t.type===c.SP.RAY){const e=(0,a.y)(R,y,r);if((0,a.e)(h,e)<-b)return[]}return[(0,l.a)(y)]}function w({start:e,end:t,type:i},n){const s=(0,a.y)(M,n,e),r=(0,a.y)(E,t,e),o=(0,a.f)(D,r,s);if((0,a.D)(o)/(0,a.D)(r)<b)switch(i){case c.SP.LINE:return[(0,l.a)(n)];case c.SP.RAY:return(0,a.e)(r,s)<-b?[]:[(0,l.a)(n)]}return[]}function C(e,t,i){return(0,s.W8)(e[2],i[2],b)&&(0,s.W8)((0,a.d)(i,e),t*t,b)?[(0,l.a)(i)]:[]}function P(e,t,{start:i,end:n,type:s}){return(0,a.s)(e.start,i[0],i[1],t),(0,a.s)(e.end,n[0],n[1],t),e.type=x[s],e}!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(n||(n={}));const x={[n.PLANE]:c.SP.LINE,[n.HALF_PLANE]:c.SP.RAY},b=1e-6,M=(0,l.c)(),E=(0,l.c)(),D=(0,l.c)(),A=(0,l.c)(),T=(0,l.c)(),O=(0,l.c)(),R=(0,l.c)(),L={start:(0,l.c)(),end:(0,l.c)(),type:c.SP.LINE},z={start:(0,l.c)(),end:(0,l.c)(),type:c.SP.LINE}}}]);