"use strict";(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[2791],{51027:(e,t,i)=>{i.d(t,{M:()=>u,b:()=>c});var s=i(84614),r=i(63371),n=i(24603),a=i(23410),o=i(3961),l=i(21414);function c(e){const t=new o.kG,{vertex:i,fragment:c}=t;(0,s.Sv)(i,e),i.uniforms.add(new n.p("width",(e=>e.width))),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.NORMAL,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.attributes.add(l.T.AUXPOS1,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),i.code.add(a.H`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),c.uniforms.add([new n.p("outlineSize",(e=>e.outlineSize)),new r.N("outlineColor",(e=>e.outlineColor)),new n.p("stripeLength",(e=>e.stripeLength)),new r.N("stripeEvenColor",(e=>e.stripeEvenColor)),new r.N("stripeOddColor",(e=>e.stripeOddColor))]);const u=1/Math.sqrt(2);return c.code.add(a.H`
    const float INV_SQRT2 = ${a.H.float(u)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),t}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}))},10145:(e,t,i)=>{i.d(t,{N9:()=>p,Pr:()=>v,Rd:()=>l,SP:()=>_,Se:()=>y,Ud:()=>u,VG:()=>a,Wv:()=>c,Zv:()=>d,cy:()=>h,i_:()=>g,ym:()=>m});var s=i(61681),r=i(39405),n=i(90551);function a(e,t,i,s=2,a="abbr"){return(0,n.VG)(e,(0,r.nn)(t,i).value,i,s,a)}function o(e,t,i,s=2,a="abbr"){return(0,n.LO)(e,(0,r.nn)(t,i).value,i,s,a)}function l(e,t,i=2,s="abbr"){return(0,n.Rd)(e,t.value,t.unit,i,s)}function c(e,t,i=2,s="abbr"){return(0,n.Wv)(e,t.value,t.unit,i,s)}function u(e,t,i=2,s="abbr"){return(0,n.Ud)(e,t.value,t.unit,i,s)}function d(e,t,i=2,s="abbr"){return(0,n.Zv)(e,t.value,t.unit,i,s)}function h(e,t,i){return(0,n.L4)(e.value,e.unit,e.rotationType,t,i)}function _(e,t,i){return(0,n._o)(e.value,e.unit,e.rotationType,t,i)}function p(e,t,i,r,n="abbr"){switch(r=(0,s.Pt)(r,2),i){case"imperial":return u(e,t,r,n);case"metric":return l(e,t,r,n);default:return a(e,t,i,r,n)}}function g(e,t,i,s=2,r="abbr"){switch(i){case"imperial":return function(e,t,i=2,s="abbr"){return(0,n.q6)(e,t.value,t.unit,i,s)}(e,t,s,r);case"metric":return function(e,t,i=2,s="abbr"){return(0,n.mg)(e,t.value,t.unit,i,s)}(e,t,s,r);default:return o(e,t,i,s,r)}}function m(e,t,i,s=2,r="abbr"){switch(i){case"imperial":return d(e,t,s,r);case"metric":return c(e,t,s,r);default:return a(e,t,i,s,r)}}function v(e,t,i,s=2,r="abbr"){switch(i){case"imperial":return function(e,t,i=2,s="abbr"){return(0,n.aC)(e,t.value,t.unit,i,s)}(e,t,s,r);case"metric":return function(e,t,i=2,s="abbr"){return(0,n.h9)(e,t.value,t.unit,i,s)}(e,t,s,r);default:return o(e,t,i,s,r)}}function y(e,t,i,s=2,r="abbr"){switch(i){case"imperial":return function(e,t,i=2,s="abbr"){return(0,n.yc)(e,t.value,t.unit,i,s)}(e,t,s,r);case"metric":return function(e,t,i=2,s="abbr"){return(0,n.ld)(e,t.value,t.unit,i,s)}(e,t,s,r);default:return a(e,t,i,s,r)}}},39405:(e,t,i)=>{i.d(t,{EV:()=>n,Fp:()=>u,GJ:()=>l,MQ:()=>_,bA:()=>d,ne:()=>o,nn:()=>c,yG:()=>a,yP:()=>h});var s=i(61681),r=i(17321);function n(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}function a(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}function o(e,t){return{type:(0,r.UF)(t),value:e,unit:t}}function l(e,t,i="arithmetic"){return{type:(0,r.UF)(t),value:e,unit:t,rotationType:i}}function c(e,t){return n((0,r.En)(e.value,e.unit,t),t)}function u(e,t){return(0,s.Wi)(e)?t:(0,s.Wi)(t)||e.value>(0,r.En)(t.value,t.unit,e.unit)?e:t}function d(e,t){return(0,s.Wi)(e)?null:{...e,value:e.value*t}}const h=a(0,"meters"),_=o(0,"square-meters");l(0,"radians")},92121:(e,t,i)=>{i.r(t),i.d(t,{default:()=>We});var s=i(36663),r=i(53443),n=i(61681),a=i(81977),o=(i(7283),i(7753),i(40266)),l=i(71197),c=i(60573),u=i(76545),d=i(44584),h=i(13802),_=i(39405),p=i(76868),g=i(6766),m=i(8909),v=i(17700),y=i(90819),b=i(90472),w=i(61170),f=i(85130),C=i(28376),P=i(56331);const S="esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController",O=h.Z.getLogger(S);let R=class extends r.Z{constructor(e){super(e),this._unitNormalizer=new P.D,this._handles=new d.Z,this._tempStartPosition=(0,m.c)(),this._tempEndPosition=(0,m.c)(),this._tempCornerPosition=(0,m.c)()}initialize(){const e=this.view.spatialReference,t=(0,w.rS)(e),i=t===w.GG?w.wY:t;this._sphericalPCPF=i;const s=(0,b.Up)(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([(0,p.YP)((()=>({viewData:this.viewData,startPoint:this.analysis.startPoint})),(({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({viewData:this.viewData,endPoint:this.analysis.endPoint})),(({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)}),p.tX),(0,p.YP)((()=>({result:this._computedResult,viewData:this.viewData})),(({result:e,viewData:t})=>{t.result=e}),p.tX)])}destroy(){this._handles=(0,n.SC)(this._handles)}_applyProjectionAndElevationAlignment(e){if((0,n.Wi)(e))return e;const{spatialReference:t,elevationProvider:i}=this.view,s=(0,C.G)(e,t,i);return(0,n.Wi)(s)?((0,C.e)(this.analysis,e.spatialReference,O),null):s}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if((0,n.Wi)(e)||(0,n.Wi)(t))return null;const s=this._euclideanDistances(e,t),r=this._geodesicDistance(e,t,s.horizontal.value),a=i===u.e.Geodesic||i===u.e.Auto&&s.horizontal.value>1e5?"geodesic":"euclidean";return{mode:a,distance:"euclidean"===a?s.direct:r,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:r}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,r=this._tempEndPosition,n=this._tempCornerPosition,a=this.view.spatialReference,o=this._sphericalPCPF,l=(0,b.Up)(a,o)?o:a;(0,b.KC)(e,s,l),(0,b.KC)(t,r,l),(0,b.KC)(i,n,l);const c=(0,g.i)(s,r),u=(0,g.i)(n,r),d=Math.abs(t.z-e.z),h=e=>this._unitNormalizer.normalizeDistance(e),p=h(c),m=h(u),v=h(d);return{direct:(0,_.EV)(p,"meters"),horizontal:(0,_.EV)(m,"meters"),vertical:(0,_.EV)(v,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,r=new y.Z({spatialReference:s});r.addPath([e,t]);const a=s.isGeographic&&(0,f.Gb)(s)?(0,f.Jf)([r],"meters")[0]:s.isWebMercator?(0,v.geodesicLength)(r,"meters"):null,o=(0,n.pC)(a)?a:this._fallbackGeodesicDistance(e,t,i);return(0,_.EV)(o,"meters")}_fallbackGeodesicDistance(e,t,i){if((0,b.UY)(e,L)&&(0,b.UY)(t,M)){const e=new f._q;return(0,f.cA)(e,L,M),e.distance}return i}};(0,s._)([(0,a.Cb)()],R.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],R.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],R.prototype,"viewData",void 0),(0,s._)([(0,a.Cb)()],R.prototype,"_computedResult",null),R=(0,s._)([(0,o.j)(S)],R);const L=(0,m.c)(),M=(0,m.c)();var z,D,A=i(30936),E=(i(87090),i(84572)),G=i(19431),V=i(10145),T=i(95550),x=i(17321),j=i(55709);!function(e){e[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic"}(z||(z={})),function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(D||(D={}));var W=i(19570),U=i(21961),F=i(37926),N=i(39100),H=i(1983),q=i(68817),k=i(10449),I=i(6087),Z=i(7358),B=i(44685),Y=i(35031),Q=i(5079),X=i(46378),K=i(21414),J=i(9969),$=i(52756),ee=i(67197),te=i(5474),ie=i(12045),se=i(95194),re=i(42842),ne=i(86942),ae=i(51027),oe=i(91907),le=i(17346);class ce extends $.A{constructor(e,t,i){super(e,t,i)}initializeProgram(e){return new se.$(e.rctx,ce.shader.get().build(this.configuration),te.i)}_setPipelineState(e){const t=e===re.A.NONE,i=this.configuration;return(0,le.sm)({blending:i.transparent?t?ie.wu:(0,ie.j7)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled?{factor:0,units:-4}:null,depthTest:{func:oe.wb.LESS},depthWrite:le.LZ,colorWrite:le.BK})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return oe.MX.TRIANGLE_STRIP}}ce.shader=new J.J(ae.M,(()=>i.e(827).then(i.bind(i,20827))));class ue extends ne.W{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=re.A.NONE}}(0,s._)([(0,ee.o)()],ue.prototype,"polygonOffsetEnabled",void 0),(0,s._)([(0,ee.o)()],ue.prototype,"transparent",void 0),(0,s._)([(0,ee.o)({count:re.A.COUNT})],ue.prototype,"transparencyPassType",void 0);class de extends Z.F5{constructor(e){super(e,new _e),this._configuration=new ue}getConfiguration(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration}dispose(){}intersect(){}requiresSlot(e,t){return t===Y.H.Color&&e===X.r.OPAQUE_MATERIAL}createGLMaterial(e){return new he(e)}createBufferWriter(){return new we}}class he extends Q.Z{beginSlot(e){return this.ensureTechnique(ce,e)}}class _e extends Z.Mt{constructor(){super(...arguments),this.width=32,this.outlineSize=.2,this.outlineColor=(0,H.f)(1,.5,0,1),this.stripeEvenColor=(0,H.f)(1,1,1,1),this.stripeOddColor=(0,H.f)(1,.5,0,1),this.stripeLength=1,this.polygonOffset=!1}}const pe=(0,B.U$)().vec3f(K.T.POSITION).vec3f(K.T.NORMAL).vec2f(K.T.UV0).f32(K.T.AUXPOS1),ge=(0,m.c)(),me=(0,m.c)(),ve=(0,m.c)(),ye=(0,m.c)(),be=(0,m.c)();class we{constructor(){this.vertexBufferLayout=pe}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 2*(e.indices.get(K.T.POSITION).length/2+1)}write(e,t,i,s,r){const n=i.vertexAttributes.get(K.T.POSITION).data,a=i.vertexAttributes.get(K.T.NORMAL).data,o=n.length/3,l=i&&i.indices&&i.indices.get(K.T.POSITION);l&&l.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");const c=ge,u=me,d=ve,h=ye,_=be,p=s.position,m=s.normal,v=s.uv0;let y=0;for(let i=0;i<o;++i){const s=3*i;if((0,g.s)(c,n[s],n[s+1],n[s+2]),i<o-1){const e=3*(i+1);(0,g.s)(u,n[e],n[e+1],n[e+2]),(0,g.s)(_,a[e],a[e+1],a[e+2]),(0,g.n)(_,_),(0,g.b)(d,u,c),(0,g.n)(d,d),(0,g.f)(h,_,d),(0,g.n)(h,h)}const l=(0,g.i)(c,u);e&&t&&((0,g.m)(c,c,e),(0,g.m)(u,u,e),(0,g.m)(h,h,t));const b=r+2*i,w=b+1;p.setVec(b,c),p.setVec(w,c),m.setVec(b,h),m.setVec(w,h),v.set(b,0,y),v.set(b,1,-1),v.set(w,0,y),v.set(w,1,1),i<o-1&&(y+=l)}const b=s.auxpos1;for(let e=0;e<2*o;++e)b.set(r+e,y)}}class fe extends k._{constructor(e){super(e),this._parameters={arrowWidth:16,arrowOutlineColor:A.Z.toUnitRGBA((0,E.e9)()),arrowStripeEvenColor:A.Z.toUnitRGBA((0,E.RN)()),arrowStripeOddColor:A.Z.toUnitRGBA((0,E.e9)()),arrowSubdivisions:128},this._origin=(0,m.c)(),this._originTransform=(0,N.c)(),this._arrowCenter=(0,m.c)(),this._renderOccluded=Z.yD.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(e){if(this._stripesEnabled=e,this.attached){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i}=this._parameters,s=(0,G.H)(Ce,this._stripesEnabled?t:i,e);this._arrowMaterial.setParameters({stripeEvenColor:s})}}get opacity(){return this._opacity}set opacity(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:e,arrowStripeOddColor:t,arrowOutlineColor:i}=this._parameters,s=this._stripesEnabled?e:t;this._arrowMaterial=new de({outlineColor:i,stripeEvenColor:s,stripeOddColor:t,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new d.Z,this._handles.add((0,p.YP)((()=>this.view.state.camera),(()=>{this._viewChanged()})))}destroyExternalResources(){this._arrowMaterial=null,this._handles=(0,n.SC)(this._handles)}forEachExternalMaterial(e){e(this._arrowMaterial)}createGeometries(e){if((0,n.Wi)(this._geometry)||(0,n.Wi)(this._geometry.startRenderSpace)||(0,n.Wi)(this._geometry.endRenderSpace))return;const t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.transformation=this._originTransform,e.addGeometry(t),this._viewChanged()}_createArrowGeometry(e,t,i,s){const r=this.view.renderCoordsHelper,n=[],a=[],o=(e,t)=>{const s=q.WM.get();(0,g.b)(s,e,i),n.push(s),a.push(t)};if("euclidean"===s.type){s.eval(.5,this._arrowCenter);const i=q.WM.get();r.worldUpAtPosition(this._arrowCenter,i),o(e,i),o(t,i)}else{s.eval(.5,this._arrowCenter);const e=this._parameters.arrowSubdivisions+1&-2;for(let t=0;t<e;++t){const i=t/(e-1),n=q.WM.get(),a=q.WM.get();s.eval(i,n),r.worldUpAtPosition(n,a),o(n,a)}}return(0,I.rh)(this._arrowMaterial,n,a)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&(0,n.pC)(this._geometry)){const e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}_updateArrowOpacity(){const e=this.opacity,{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,r=(0,G.H)(Ce,this._stripesEnabled?t:i,e),n=(0,G.H)(Pe,s,e),a=(0,G.H)(Se,i,e);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:n,stripeOddColor:a})}}const Ce=(0,H.c)(),Pe=(0,H.c)(),Se=(0,H.c)();var Oe=i(83061),Re=i(60033),Le=i(66962),Me=i(8108),ze=i(60720);let De=class extends r.Z{get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if((0,n.Wi)(e)||(0,n.Wi)(t)||e.equals(t))return z.None;const i=this.analysisView.result;if((0,n.Wi)(i))return z.Direct;if("geodesic"===i.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?z.ProjectedGeodesic:z.Direct;const{verticalDistance:s,horizontalDistance:r}=i,a=s.value,o=r.value;return Math.min(a/o,o/a)<this.triangleCollapseRatioThreshold?z.Direct:z.Triangle}get actualVisualizedMeasurement(){if((0,n.Wi)(this.analysisView.result))switch(this.analysisView.measurementMode){case u.e.Auto:case u.e.Euclidean:default:return"euclidean";case u.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return(0,n.Wi)(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){(0,n.Wi)(this._triangleOrientationOverride)!==e&&((0,n.Wi)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}constructor(e){super(e),this._params={triangleColor:A.Z.toUnitRGBA((0,E.e9)(.75)),triangleLineWidth:3,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:A.Z.toUnitRGBA((0,E.e9)(.75)),guideLineWidth:2,guideStippleLengthPixels:6,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},this._handles=new d.Z,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=(0,m.c)(),this._endPosition=(0,m.c)(),this._cornerPosition=(0,m.c)(),this._startPositionAtSeaLevel=(0,m.c)(),this._endPositionAtSeaLevel=(0,m.c)(),this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=D.Auto,this.triangleCollapseRatioThreshold=.03}initialize(){const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new fe({...t,geometry:null,renderOccluded:Z.yD.OccludeAndTransparent}),this._triangleVisualElement=new F.r({...t,width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:Z.yD.OccludeAndTransparent}),this._rightAngleQuad=new Oe.R({...t,color:A.Z.toUnitRGBA((0,E.e9)(.75)),renderOccluded:Z.yD.OccludeAndTransparent});const i={...t,polygonOffset:!0,renderOccluded:Z.yD.OccludeAndTransparent};this._projectedGeodesicLine=new F.r({...i,width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)}),this._geodesicStartHint=new F.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)}),this._geodesicEndHint=new F.r({...i,width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:(0,Le.z5)(e.guideStippleLengthPixels)});const s={...t,backgroundColor:(0,E.hU)(.6),textColor:(0,E.uu)()};this._segmentLabel=new U.Kc({...s,fontSize:e.direcLabelFontSize}),this._verticalLabel=new U.Kc({...s,fontSize:e.verticalLabelFontSize}),this._horizontalLabel=new U.Kc({...s,fontSize:e.horizontalLabelFontSize}),this._handles.add([(0,p.YP)((()=>{const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView,i=this.view;return{view:i,camera:i.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}}),(e=>this._updateGeometryAndViewMode(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateVisualElementVisibility(e)),p.tX),(0,p.YP)((()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement})),(e=>this._updateLabelText(e)),p.tX),(0,p.YP)((()=>({visible:this.visible,viewMode:this.viewMode})),(e=>this._updateLabelVisibility(e)),p.tX),(0,p.YP)((()=>this._measurementArrowStripeLength),(e=>this._updateSegmentStripeLength(e)),p.tX),(0,Me.qe)((async()=>this._updateMessageBundle()))]),this._updateMessageBundle()}destroy(){this._handles=(0,n.SC)(this._handles),this._segmentVisualElement=(0,n.SC)(this._segmentVisualElement),this._triangleVisualElement=(0,n.SC)(this._triangleVisualElement),this._rightAngleQuad=(0,n.SC)(this._rightAngleQuad),this._projectedGeodesicLine=(0,n.SC)(this._projectedGeodesicLine),this._geodesicStartHint=(0,n.SC)(this._geodesicStartHint),this._geodesicEndHint=(0,n.SC)(this._geodesicEndHint),this._segmentLabel=(0,n.SC)(this._segmentLabel),this._verticalLabel=(0,n.SC)(this._verticalLabel),this._horizontalLabel=(0,n.SC)(this._horizontalLabel),this.set("view",null)}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case z.None:break;case z.Direct:this._segmentVisualElement.visible=!0;break;case z.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case z.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:r,orientation:a,visualizedMeasurement:o,stripeLength:l}){const c=e.renderCoordsHelper;if((0,n.Wi)(c)||(0,n.Wi)(s)||(0,n.Wi)(r)||s.equals(r))return;let u=this._startPosition,d=this._endPosition;c.toRenderCoords(s,u),c.toRenderCoords(r,d);const h=a===D.AboveSegment?1:-1,_=h*(c.getAltitude(d)-c.getAltitude(u));_<0&&(u=this._endPosition,d=this._startPosition);const p="geodesic"===o?new Re.u(this._startPosition,this._endPosition,c.spatialReference):new Re.y(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=p,this._updateSegmentStripeLength(l),i){case z.Direct:this._updateSegment(p,a);break;case z.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:p,orientation:a,startPosition:u,endPosition:d,deltaSign:h,altitudeDelta:_});break;case z.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:a,startPosition:u,endPosition:d})}}_updateSegment(e,t){this._segmentLabel.anchor=t===D.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:r,endPosition:n,deltaSign:a,altitudeDelta:o}){const l=this._cornerPosition;e.worldUpAtPosition(r,l),(0,g.g)(l,l,a*Math.abs(o)),(0,g.a)(l,l,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:r,center:l,next:n};const c=new Re.y(r,l),u=new Re.y(l,n),d=function(e,t,i,s,r){const n=Ee,a=Ge;r.projectToRenderScreen(i,n),r.projectToRenderScreen(t,a);const o={segment:"bottom",horizontal:"top",vertical:n[0]<a[0]?"left":"right"};{const s=Ve,n=Te;if((0,W.c)(e,i,s,r),(0,W.c)(e,t,n,r),(0,j.h)(s,n)>=Ae){const e=Math.sign(s[1])===Math.sign(n[1]);o.segment=e?(0,U.jB)(o.vertical):o.vertical}else{const e=xe;(0,W.c)(i,t,e,r),(0,j.h)(e,n)>=Ae&&(o.segment=Math.sign(e[0])===Math.sign(n[0])?(0,U.jB)(o.horizontal):o.horizontal)}}if(s===D.BelowSegment){const e=e=>"top"===e?"bottom":"top";o.segment=e(o.segment),o.horizontal=e(o.horizontal),o.vertical=e(o.vertical)}return o}(r,n,l,s,t);this._segmentLabel.anchor=d.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._verticalLabel.anchor=d.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=d.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const r=new Re.u(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new Re.y(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new Re.y(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=t===D.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){(0,n.pC)(e)?(this._segmentLabel.text="euclidean"===t?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({visible:e,viewMode:t}){const i=this._segmentLabel,s=this._horizontalLabel,r=this._verticalLabel;if(i.visible=!1,s.visible=!1,r.visible=!1,e)switch(t){case z.Direct:i.visible=!0;break;case z.Triangle:i.visible=!0,s.visible=!0,r.visible=!0;break;case z.ProjectedGeodesic:i.visible=!0;case z.None:}}get _labelsText(){if(this.destroyed)return null;const e=this.messages,t=this.analysisView.result;if((0,n.Wi)(t)||(0,n.Wi)(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:r,geodesicDistance:a}=t,o=this.analysisView.unit,l=e=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...e});switch(o){case"metric":return l({euclideanDistance:i&&(0,V.Rd)(e,i),geodesicDistance:a&&(0,V.Rd)(e,a),horizontalDistance:s&&(0,V.Rd)(e,s),verticalDistance:r&&(0,V.Wv)(e,r)});case"imperial":return l({euclideanDistance:i&&(0,V.Ud)(e,i),geodesicDistance:a&&(0,V.Ud)(e,a),horizontalDistance:s&&(0,V.Ud)(e,s),verticalDistance:r&&(0,V.Zv)(e,r)});default:return l({euclideanDistance:i&&(0,V.VG)(e,i,o),geodesicDistance:a&&(0,V.VG)(e,a,o),horizontalDistance:s&&(0,V.VG)(e,s,o),verticalDistance:r&&(0,V.VG)(e,r,o)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;(0,n.pC)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if((0,n.pC)(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===D.Auto?this.view.state.camera.aboveGround?D.AboveSegment:D.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(!t?.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,r=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/r>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if((0,n.Wi)(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&(0,_.nn)(s,"meters");break;case"imperial":i=s&&(0,_.nn)(s,(0,x.FN)(s.value,s.unit));break;default:i=s&&(0,_.nn)(s,t)}return(0,n.Wi)(i)?null:(0,G.sk)(i.value/30)*(0,x.En)(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,(0,ze.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})).finally((()=>{this.loadingMessages=!1}))}get testData(){return{labels:this.labels,stripeLength:this._segmentVisualElement?.stripeLength}}};(0,s._)([(0,a.Cb)()],De.prototype,"_triangleOrientationOverride",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"messages",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"view",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"analysisView",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"loadingMessages",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"visible",null),(0,s._)([(0,a.Cb)()],De.prototype,"viewMode",null),(0,s._)([(0,a.Cb)()],De.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],De.prototype,"visualElementOrientation",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"triangleCollapseRatioThreshold",void 0),(0,s._)([(0,a.Cb)()],De.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],De.prototype,"labels",null),(0,s._)([(0,a.Cb)()],De.prototype,"_labelsText",null),(0,s._)([(0,a.Cb)()],De.prototype,"_actualVisualElementsOrientation",null),(0,s._)([(0,a.Cb)()],De.prototype,"_measurementArrowStripeLength",null),De=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],De);const Ae=Math.cos((0,G.Vl)(12)),Ee=(0,T.J$)(),Ge=(0,T.J$)(),Ve=(0,T.gX)(),Te=(0,T.gX)(),xe=(0,T.gX)();let je=class extends((0,c.p)(r.Z)){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.analysis=null,this.result=null,this.measurementMode=u.e.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new De({view:e,analysis:t,analysisView:this}),this._analysisController=new R({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=(0,n.SC)(this._analysisController),this._analysisVisualization=(0,n.SC)(this._analysisVisualization)}get updating(){return!!this._analysisVisualization?.loadingMessages}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct?.text??""}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal?.text??""}get verticalLabelText(){return this._analysisVisualization.labels.vertical?.text??""}get unit(){return(0,n.Pt)(this.analysis.unit,this._defaultUnit)}get testData(){return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:{...this._analysisVisualization?.testData,visualization:this._analysisVisualization,controller:this._analysisController}}};(0,s._)([(0,a.Cb)()],je.prototype,"updating",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"type",void 0),(0,s._)([(0,a.Cb)({constructOnly:!0,nonNullable:!0})],je.prototype,"analysis",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"result",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"measurementMode",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"elevationAlignedStartPoint",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"elevationAlignedEndPoint",void 0),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"viewMode",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"actualVisualizedMeasurement",null),(0,s._)([(0,a.Cb)()],je.prototype,"visualElementOrientation",null),(0,s._)([(0,a.Cb)()],je.prototype,"allowVisualElementsOrientationChange",null),(0,s._)([(0,a.Cb)()],je.prototype,"triangleCollapseRatioThreshold",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"directLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"horizontalLabelText",null),(0,s._)([(0,a.Cb)({readOnly:!0})],je.prototype,"verticalLabelText",null),(0,s._)([(0,a.Cb)()],je.prototype,"_analysisVisualization",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"_analysisController",void 0),(0,s._)([(0,a.Cb)()],je.prototype,"unit",null),(0,s._)([(0,a.Cb)(l.Y)],je.prototype,"_defaultUnit",void 0),je=(0,s._)([(0,o.j)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],je);const We=je},17444:(e,t,i)=>{i.d(t,{i:()=>m});var s=i(36663),r=i(53443),n=i(86618),a=i(61681),o=i(81977),l=(i(7283),i(7753),i(40266)),c=i(43977),u=i(79341),d=i(53448);class h{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=c.eZ.Outline}destroy(){this._destroyResources()}get resources(){return(0,a.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=(0,a.WG)(this._resources)?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,a.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,a.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new _({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new _({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,a.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,a.Wi)(this._resources)||(0,a.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,u.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,a.Wi)(this._resources)||(0,a.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,u.T.UPDATE),this._resources.geometriesAdded=!0)}}let _=class extends((0,n.IG)(r.Z)){constructor(e){super(e),this.drapeSourceType=c.Lw.Features,this.updatePolicy=d.j.SYNC,this.renderGroup=c.eZ.Outline}};(0,s._)([(0,o.Cb)({constructOnly:!0})],_.prototype,"view",void 0),(0,s._)([(0,o.Cb)({readOnly:!0})],_.prototype,"drapeSourceType",void 0),(0,s._)([(0,o.Cb)()],_.prototype,"renderGroup",void 0),_=(0,s._)([(0,l.j)("DrapedVisualElementLayerView")],_);var p=i(76169),g=i(7426);class m extends p.l{constructor({view:e,isDraped:t}){super(e),this._isDraped=!1,this.object3dResources=new g.O(this.createObject3DResourceFactory(e)),this.drapedResources=new h(this.createDrapedResourceFactory(e)),this.isDraped=t??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},83061:(e,t,i)=>{i.d(t,{R:()=>P});var s=i(61681),r=i(76868),n=i(24455),a=i(39100),o=i(6766),l=i(8909),c=i(88589),u=i(1983),d=i(68817),h=i(48358),_=i(17444),p=i(99608),g=i(85799),m=i(45467),v=i(6087),y=i(7358),b=i(13304),w=i(21414),f=i(84891),C=i(65392);class P extends _.i{constructor(e){super(e),this._maxSize=0,this._position=(0,l.c)(),this._up=(0,l.c)(),this._right=(0,l.c)(),this._renderOccluded=y.yD.OccludeAndTransparent,this._color=(0,u.f)(1,0,0,1),this._outlineColor=(0,u.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=y.yD.Opaque,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,c.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,c.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min((0,o.i)(t,e),(0,o.i)(t,i))/3,(0,o.n)(this._up,(0,o.b)(this._up,e,t)),(0,o.n)(this._right,(0,o.b)(this._right,i,t)),(0,o.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new f.E(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new C.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_destroyObject3DResources(e){e.quadMaterial.dispose(),e.outlineMaterial?.dispose()}_createObject3DGeometries(e,t,i){if((0,o.k)(this._up,l.Z)&&(0,o.k)(this._right,l.Z))return;const s=this._createGeometries(t,i);for(const t of s)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new f.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new C.U(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new b.z(e,{boundingInfo:e.boundingInfo})));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,r.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.outlineMaterial?.dispose(),e.quadMaterial.dispose()}_createGeometries(e,t){const{up:i,right:s,corner:r}=this._getVertices(),n=this._quadGeometryData(i,s,r,e);return t?[n,(0,v.rh)(t,[i,r,s])]:[n]}_getVertices(){let e=this._up,t=this._right;const i=(0,o.a)(d.WM.get(),e,t);return this.isDraped&&(e=(0,o.c)(d.WM.get(),e),t=(0,o.c)(d.WM.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=(0,s.WG)(this.object3dResources.object)){if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);(0,n.f)(S,this._position),(0,n.k)(S,S,[r,r,r]),e.transformation=S}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:r,_size:a}=this,l=(0,o.c)(d.WM.get(),r);l[2]=p.Rn;const c=O;c.spatialReference=(0,s.Wg)(t.renderer.spatialReference),c.x=l[0],c.y=l[1];const u=a*(t.overlayPixelSizeInMapUnits(c)*i),h=Math.min(this._maxSize,u);(0,n.f)(S,l),(0,n.k)(S,S,[h,h,1]);for(const t of e)t.updateTransformation((e=>{(0,n.c)(e,S)}))}_quadGeometryData(e,t,i,s){return new m.Z(s,[[w.T.POSITION,new g.a([0,0,0,...t,...e,...i],3,!0)]],[[w.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){(0,s.WG)(this.object3dResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters),(0,s.WG)(this.drapedResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){(0,s.WG)(this.object3dResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters),(0,s.WG)(this.drapedResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const S=(0,a.c)(),O=(0,h.Tx)(0,0,void 0,null)},7426:(e,t,i)=>{i.d(t,{O:()=>u});var s=i(61681),r=i(76868),n=i(95399),a=i(49394),o=i(44101),l=i(53448),c=i(26982);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,s.pC)(this._resources)?this._resources.object:null}get resources(){return(0,s.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if((0,s.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==n.U.Mesh&&t.type!==n.U.Line&&t.type!==n.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==n.U.Mesh&&t.type!==n.U.Line&&t.type!==n.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const s=new c.F({pickable:!1,updatePolicy:l.j.SYNC});i.add(s);const n=new a.T({castShadow:!1}),u=e.createResources(n,s);u.forEach((e=>{i.add(e),e instanceof o.x&&i.loadImmediate(e)})),i.add(n),s.add(n);const d=e.cameraChanged,h=d?(0,r.YP)((()=>t.state.camera),(e=>d(e)),r.nn):null;this._resources={layer:s,object:n,external:u,cameraHandle:h},this._syncVisible()}_destroyResources(){if((0,s.Wi)(this._resources))return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this._resources.external.forEach((t=>e.remove(t)))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){(0,s.Wi)(this._resources)||(this._resources.object.visible=this._visible)}}}}]);