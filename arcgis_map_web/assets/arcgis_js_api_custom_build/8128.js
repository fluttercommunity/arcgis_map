(self.webpackChunkarcgis_webpack01=self.webpackChunkarcgis_webpack01||[]).push([[8128],{28128:(e,t,s)=>{"use strict";s.d(t,{bA:()=>Le,Mz:()=>Ae});var r=s(95830),n=s(32656),i=s(7830);const o="20210504",a="dd3facdbe427ec0c95b4e9f84052dd3e6809dc9d";var l=s(59472),h=s(10180),c=s(23838),u=s(56140),d=s(36544),_=(s(68055),s(79881)),g=s(87566),p=s(10923),E=(s(57002),s(86035),s(79832)),m=s(62698),f=s(79152),b=s(80621),k=s(97873);let v=class extends f.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,u._)([(0,_.Cb)()],v.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,u._)([(0,_.Cb)()],v.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),v=(0,u._)([(0,g.j)("esri.views.support.DebugFlags")],v);const I=new v,T=d.Z.getLogger("esri.views.support.Scheduler");var w,y;(y=w||(w={})).REMOTE_CLIENT="worker messages",y.SLIDE="slide",y.STAGE="stage",y.STREAM_DATA_LOADER="stream loader",y.ELEVATION_QUERY="elevation query",y.TERRAIN_SURFACE="terrain",y.SURFACE_GEOMETRY_UPDATES="surface geometry updates",y.GRAPHICS_CORE="Graphics3D",y.I3S_CONTROLLER="I3S",y.POINT_CLOUD_LAYER="point cloud",y.FEATURE_TILE_FETCHER="feature fetcher",y.LABELER="labeler",y.GRAPHICS_DECONFLICTOR="graphics deconflictor",y.FILTER_VISIBILITY="Graphics3D filter visibility",y.FEATURE_QUERY_ENGINE="feature query",y.SCALE_VISIBILITY="Graphics3D scale visibility",y.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",y.POINT_OF_INTEREST_FREQUENT="POI frequent",y.POINT_OF_INTEREST_INFREQUENT="POI infrequent",y.FEATURE_TILE_TREE="feature tile tree",y.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",y.ELEVATION_ALIGNMENT="elevation alignment",y.TEXT_TEXTURE_ATLAS="text texture atlas",y.TEXTURE_UNLOAD="texture unload",y.OVERLAY_MANAGER="overlay manager",y.LINE_OF_SIGHT_TOOL="line of sight tool",y.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",y.ELEVATION_PROFILE="elevation profile",y.SNAPPING="snapping",y[y.TEST_PRIO=1]="TEST_PRIO";const S={[w.REMOTE_CLIENT]:0,[w.SLIDE]:0,[w.STREAM_DATA_LOADER]:0,[w.ELEVATION_QUERY]:0,[w.STAGE]:1,[w.TERRAIN_SURFACE]:1,[w.SURFACE_GEOMETRY_UPDATES]:1,[w.GRAPHICS_CORE]:2,[w.I3S_CONTROLLER]:2,[w.POINT_CLOUD_LAYER]:2,[w.FEATURE_TILE_FETCHER]:2,[w.LABELER]:8,[w.GRAPHICS_DECONFLICTOR]:4,[w.FILTER_VISIBILITY]:4,[w.FEATURE_QUERY_ENGINE]:8,[w.SCALE_VISIBILITY]:4,[w.FRUSTUM_VISIBILITY]:4,[w.POINT_OF_INTEREST_FREQUENT]:6,[w.POINT_OF_INTEREST_INFREQUENT]:30,[w.FEATURE_TILE_TREE]:16,[w.FEATURE_TILE_TREE_ACTIVE]:0,[w.ELEVATION_ALIGNMENT]:12,[w.TEXT_TEXTURE_ATLAS]:12,[w.TEXTURE_UNLOAD]:12,[w.OVERLAY_MANAGER]:12,[w.LINE_OF_SIGHT_TOOL]:16,[w.LINE_OF_SIGHT_TOOL_INTERACTIVE]:0,[w.SNAPPING]:0};function P(e){return e in S?S[e]:"number"==typeof e?e:1}const R=1e3/30;var O,A;!function(e){let t=class extends f.Z{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new E.Z("total"),tasks:new Array},this._budget=null,this._state=1,this._tasks=new m.Z,this._runQueue=new m.Z,this._load=0,this._idleStateCallbacks=new m.Z,this._idleUpdatesStartFired=!1,this._maxReschedule=C,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,b.S1)(I,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new r(e.nowFunc),U.length=0;for(const e in w)M.set(w[e],this.performanceInfo.tasks.length),this.performanceInfo.tasks.push(new E.Z(w[e])),U.push(0);let t;const s=this;this._test={get state(){return(0,l.Wi)(t)?s._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:6.5,INTERACTING_BUDGET:R,IDLE_BUDGET:100,get budget(){return s._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t,r){const n=P(e),i=new s(this,e,t,r,n);return this._tasks.push(i),i}registerIdleStateCallbacks(e,t){const s={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(s),2===this.state&&this._idleUpdatesStartFired&&s.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(s),set idleBegin(e){r._idleUpdatesStartFired&&(s.idleEnd(),2===r._state&&e()),s.idleBegin=e},set idleEnd(e){s.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return(0,l.Wi)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=6.5,s=e.frameDuration,r=1;switch(this.state){case 2:t=0,s=Math.max(100,e.frameDuration),r=30;break;case 1:s=Math.max(R,e.frameDuration)}return s-=e.elapsedFrameTime+t,2!==this.state&&s<1&&!this._forceTask?(this._forceTask=!0,!1):(s=Math.max(s,r),this._budget.reset(s,this.state),this._maxReschedule=C,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return A.SCHEDULED;let t=A.IDLE;return this._tasks.forAll((s=>{s.name===e&&s.needsUpdate&&(s.schedulePriority<=1?t=A.READY:t!==A.READY&&(t=A.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((s=>{s.name===e&&(t+=s.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,s)=>{t+=e>1?` ${e}x ${s}`:` ${s}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.priority,!1))),this._tasks.forAll((e=>{0===e.priority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((s=>{if(s.needsUpdate&&0!==s.schedulePriority&&0!==s.priority)switch(e=!0,t=Math.max(t,s.priority),s.schedulePriority){case 1:s.schedulePriority=0,this._runQueue.push(s);break;default:--s.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===C&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();for(let e=0;e<U.length;++e)U[e]=0;do{for(;this._runQueue.length>0;){const t=this._budget.now(),s=this._runQueue.pop();this._budget.resetProgress();try{s.update(this._budget)}catch(e){T.error(`Exception in task "${s.name}"`,e)}s.schedulePriority=s.priority;const r=this._budget.now()-t;if(s.runtime+=r,U[M.get(s.task)]+=r,this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",s.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(U,this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(U,this._budget.now()-e)}_recordFrameTaskTimes(e,t){for(let t=0;t<e.length;++t)this.performanceInfo.tasks[t].record(e[t]);this.performanceInfo.total.record(t)}get test(){return this._test}};(0,u._)([(0,_.Cb)()],t.prototype,"updating",void 0),(0,u._)([(0,_.Cb)()],t.prototype,"nowFunc",void 0),t=(0,u._)([(0,g.j)("esri.views.support.Scheduler")],t),e.Scheduler=t;let s=class extends f.Z{constructor(e,t,s,r,n){super({}),this._scheduler=e,this.name=t,this.update=s,this._needsUpdateCB=r,this._priority=n,this.runtime=0,this._queue=new k.Z,this.updating=!1,this.schedulePriority=this._priority}normalizeCtorArgs(){return{}}remove(){this.processQueue(N),this._scheduler.removeTask(this),this.schedule=L.schedule,this.reschedule=L.reschedule}get priority(){return this._priority}setPriority(e){this.name=e;const t=P(e);0!==this._priority&&0===this.schedulePriority||(this.schedulePriority=t),this._priority=t}get task(){return this.name}set task(e){this.setPriority(e)}get needsUpdate(){return this.updating||this._needsUpdateCB()}schedule(e,t){return this.updating=!0,this._queue.push(e,t)}reschedule(e,t){return this.updating=!0,this._queue.unshift(e,t)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};(0,u._)([(0,_.Cb)()],s.prototype,"updating",void 0),s=(0,u._)([(0,g.j)("esri.views.support.SchedulerTask")],s);class r{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r}(O||(O={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(A||(A={}));const N=(()=>{const e=new O.Budget((()=>performance.now()));return e.enabled=!1,e})(),L=new class{remove(){}processQueue(){}schedule(e){return(0,i.gx)(e())}reschedule(e){return(0,i.gx)(e())}},C=Number.MAX_SAFE_INTEGER,M=new Map,U=new Array,F={geometryEngineWorker:()=>Promise.all([s.e(5798),s.e(4505)]).then(s.bind(s,62668)),CSVSourceWorker:()=>Promise.all([s.e(8157),s.e(1063),s.e(5162),s.e(3863),s.e(9564),s.e(467)]).then(s.bind(s,61)),EdgeProcessingWorker:()=>Promise.all([s.e(530),s.e(9433)]).then(s.bind(s,39433)),ElevationSamplerWorker:()=>s.e(3688).then(s.bind(s,73688)),GeoJSONSourceWorker:()=>Promise.all([s.e(8157),s.e(1063),s.e(5162),s.e(3863),s.e(9564),s.e(4264),s.e(9150)]).then(s.bind(s,19150)),LercWorker:()=>s.e(8882).then(s.bind(s,98882)),MemorySourceWorker:()=>Promise.all([s.e(8157),s.e(1063),s.e(5162),s.e(3863),s.e(9564),s.e(4264),s.e(4926)]).then(s.bind(s,69308)),PBFDecoderWorker:()=>Promise.all([s.e(3863),s.e(6419)]).then(s.bind(s,96419)),Pipeline:()=>Promise.all([s.e(8157),s.e(1063),s.e(5162),s.e(899),s.e(3863),s.e(9564),s.e(6677),s.e(748)]).then(s.bind(s,21800)),PointCloudWorker:()=>Promise.all([s.e(8157),s.e(5162),s.e(4943)]).then(s.bind(s,74199)),RasterWorker:()=>Promise.all([s.e(6399),s.e(172)]).then(s.bind(s,80172)),SceneLayerWorker:()=>s.e(3838).then(s.bind(s,75743)),WorkerTileHandler:()=>Promise.all([s.e(3938),s.e(6017),s.e(820)]).then(s.bind(s,59156)),FeatureServiceSnappingSourceWorker:()=>Promise.all([s.e(8157),s.e(1063),s.e(5162),s.e(899),s.e(3863),s.e(9564),s.e(6573)]).then(s.bind(s,77037))};var D;!function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"}(D||(D={}));let H=0;function j(){return H++}function Z(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function W(e,t,s,r){if(t.type===D.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==D.INVOKE&&t.type!==D.RESPONSE)return void e.postMessage(t);let n;!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(s)?(n=G(r),t.data=s):(n=G(s.transferList),t.data=s.result),n?e.postMessage(t,n):e.postMessage(t)}function J(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function G(e){if(!e||!e.length)return null;if((0,r.Z)("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)));return t.length?t:null}const{CLOSE:B,ABORT:x,INVOKE:Q,RESPONSE:V,OPEN_PORT:Y,ON:$}=D;class q{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===D.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class K{constructor(e,t){this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new q((e=>this._onInvokeMessage(e))),this._messageQueue=new Array,this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,(0,l.pC)(t.scheduler)&&(this._frameTask=t.scheduler.registerTask(w.REMOTE_CLIENT,(e=>this._update(e)),(()=>this._messageQueue.length>0))),this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const t=new MessageChannel;let s;s="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const r=new K(t.port1,{channel:t,client:s});return"object"==typeof s&&"remoteClient"in s&&(s.remoteClient=r),K.clients.set(r,s),t.port2}static loadWorker(e){const t=F[e];return t?t():Promise.resolve(null)}close(){this._post({type:B}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,s){const r=s&&s.signal,o=s&&s.transferList;if(!this._port)return Promise.reject(new n.Z("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const a=j();return new Promise(((s,n)=>{const l=(0,i.$F)(r,(()=>{var e;const t=this._outJobs.get(a);t&&(this._outJobs.delete(a),null==(e=t.abortHandle)||e.remove(),this._post({type:x,jobId:a}),n((0,i.zE)()))})),h={resolve:s,reject:n,abortHandle:l,debugInfo:e};this._outJobs.set(a,h),this._post({type:Q,jobId:a,methodName:e,abortable:null!=r},t,o)}))}on(e,t){const s=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:D.ON,eventType:e,port:s.port2},[s.port2]),s.port1.addEventListener("message",r),s.port1.start(),{remove(){s.port1.postMessage({type:D.CLOSE}),s.port1.close(),s.port1.removeEventListener("message",r)}}}openPort(){const e=new MessageChannel;return this._post({type:Y,port:e.port2}),e.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{var t;null==(t=e.abortHandle)||t.remove(),e.reject((0,i.zE)(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=null,this._frameTask=(0,l.hw)(this._frameTask)}_onMessage(e){(0,l.pC)(this._frameTask)?this._messageQueue.push(e):this._processMessage(e)}_processMessage(e){const t=J(e);if(t)switch(t.type){case V:this._onResponseMessage(t);break;case Q:this._invokeQueue.push(t);break;case x:this._onAbortMessage(t);break;case B:this._onCloseMessage();break;case Y:this._onOpenPortMessage(t);break;case $:this._onOnMessage(t)}}_onAbortMessage(e){const t=this._inJobs,s=e.jobId,r=t.get(s);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(s))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&K.clients.get(this)===e&&e.destroy(),K.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:s,data:r,abortable:n}=e,o=n?(0,i.yi)():null,a=this._inJobs;let l,h=this._client,c=h[t];try{if(!c&&t&&-1!==t.indexOf(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)h=h[e[t]],c=h[e[t+1]]}if("function"!=typeof c)throw new TypeError(`${t} is not a function`);l=c.call(h,r,{client:this,signal:o?o.signal:null})}catch(e){return void this._post({type:V,jobId:s,error:Z(e)})}(0,i.y8)(l)?(a.set(s,{controller:o,promise:l}),l.then((e=>{a.has(s)&&(a.delete(s),this._post({type:V,jobId:s},e))}),(e=>{a.has(s)&&(a.delete(s),(0,i.D_)(e)||this._post({type:V,jobId:s,error:Z(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:V,jobId:s},l)}_onOpenPortMessage(e){new K(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,s=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=(0,h.on)(e.port,"message",(e=>{J(e).type===D.CLOSE&&(r.remove(),s.remove(),t.close())}))}_onResponseMessage(e){var t;const{jobId:s,error:r,data:i}=e,o=this._outJobs;if(!o.has(s))return;const a=o.get(s);o.delete(s),null==(t=a.abortHandle)||t.remove(),r?a.reject(n.Z.fromJSON(JSON.parse(r))):a.resolve(i)}_update(e){for(;!e.done&&this._messageQueue.length>0;)this._processMessage(this._messageQueue.shift()),e.madeProgress()}_post(e,t,s){return W(this._port,e,t,s)}}K.kernelInfo={revision:a,version:c.i8,buildDate:o},K.clients=new Map;const z=K;var X=s(5632);const ee=d.Z.getLogger("esri.core.workers.Connection");var te=s(34926),se=s(3766),re=s(12973);s(89771);const ne={};var ie=s(7584);class oe{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...s)=>e[t](...s)}))}}const ae=ie.Z.MutationObserver||ie.Z.WebKitMutationObserver,le=function(){let e;if(ie.Z.process&&ie.Z.process.nextTick)e=e=>{ie.Z.process.nextTick(e)};else if(ie.Z.Promise)e=e=>{ie.Z.Promise.resolve().then(e)};else if(ae){const t=[],s=document.createElement("div");new ae((()=>{for(;t.length>0;)t.shift()()})).observe(s,{attributes:!0}),e=e=>{t.push(e),s.setAttribute("queueStatus","1")}}return e}(),he=(()=>{const e=ie.Z.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:s,bubbles:r=!1,cancelable:n=!1}=t,i=document.createEvent("Event");return i.initEvent(e,r,n),i.data=s,i}}return(t,s)=>new e(t,s)})(),ce=class{constructor(){this._dispatcher=new oe,this._workerPostMessage({type:D.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){le((()=>{this._workerMessageHandler(he("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,s){this._dispatcher.addEventListener(e,t,s)}removeEventListener(e,t,s){this._dispatcher.removeEventListener(e,t,s)}_workerPostMessage(e){le((()=>{this.dispatchEvent(he("message",{data:e}))}))}async _workerMessageHandler(e){const t=J(e);if(t&&t.type===D.OPEN){const{modulePath:e,jobId:s}=t;let r=await z.loadWorker(e);r||(r=await import(e));const n=z.connect(r);this._workerPostMessage({type:D.OPENED,jobId:s,data:n})}}},ue=d.Z.getLogger("esri.core.workers");r.Z.add("esri-workers-arraybuffer-transfer",!(0,r.Z)("safari")||(0,r.Z)("safari")>=12);const{HANDSHAKE:de}=D;let _e,ge;const pe="Failed to create Worker. Fallback to execute module in main thread";async function Ee(){if(!(0,r.Z)("esri-workers"))return me(new ce);if(!_e&&!ge)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.replace('"{CONFIGURATION}"',`'${function(){let e;if(null!=te.Z.default){const t={...te.Z};delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(te.Z));e.assetsPath=(0,p.hF)(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=(0,se.Kd)(),e.has={"csp-restrictions":(0,r.Z)("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,r.Z)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":(0,r.Z)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":(0,r.Z)("featurelayer-pbf"),"featurelayer-snapshot-point-threshold":(0,r.Z)("featurelayer-snapshot-point-threshold"),"esri-atomics":(0,r.Z)("esri-atomics"),"esri-shared-array-buffer":(0,r.Z)("esri-shared-array-buffer"),"esri-tiles-debug":(0,r.Z)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,r.Z)("esri-workers-arraybuffer-transfer"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=(0,p.hF)(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=(0,p.hF)(e.workers.workerPath):e.workers.workerPath=(0,p.hF)((0,re.V)("esri/core/workers/RemoteClient.js"));const t=te.Z.workers.loaderConfig,s=function(e){var t;const s={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(s.async=!0),e.hasOwnProperty("isDebug")||(s.isDebug=!1),e.baseUrl||(s.baseUrl=ne.baseUrl),null==(t=ne.packages)||t.forEach((e=>{!function(e,t){for(const s of e)if(s.name===t.name)return;e.push(t)}(s.packages,e)})),s}({baseUrl:null==t?void 0:t.baseUrl,locale:(0,se.Kd)(),has:{"csp-restrictions":(0,r.Z)("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1,...null==t?void 0:t.has},map:{...null==t?void 0:t.map},paths:{...null==t?void 0:t.paths},packages:(null==t?void 0:t.packages)||[]}),n={version:c.i8,buildDate:o,revision:a};return JSON.stringify({esriConfig:e,loaderConfig:s,kernelInfo:n})}()}'`);_e=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){ge=e||{}}let e;if(_e)try{e=new Worker(_e,{name:"esri-worker-"+fe++})}catch(t){ue.warn(pe,ge),e=new ce}else ue.warn(pe,ge),e=new ce;return me(e)}async function me(e){return new Promise((t=>{function s(n){const i=J(n);i&&i.type===de&&(e.removeEventListener("message",s),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",s),e.removeEventListener("error",r),ue.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new ce).addEventListener("message",s),e.addEventListener("error",r)}e.addEventListener("message",s),e.addEventListener("error",r)}))}let fe=0;const be=d.Z.getLogger("esri.core.workers"),{ABORT:ke,INVOKE:ve,OPEN:Ie,OPENED:Te,RESPONSE:we}=D;class ye{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),be.error(e)}))}static async create(e){const t=await Ee();return new ye(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:s}=t,r=j();return new Promise(((t,n)=>{const o={resolve:t,reject:n,abortHandle:(0,i.$F)(s,(()=>{this._outJobs.delete(r),this._post({type:ke,jobId:r})}))};this._outJobs.set(r,o),this._post({type:Ie,jobId:r,modulePath:e})}))}_onMessage(e){const t=J(e);if(t)switch(t.type){case Te:this._onOpenedMessage(t);break;case we:this._onResponseMessage(t);break;case ke:this._onAbortMessage(t);break;case ve:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,s=e.jobId,r=t.get(s);r&&(r.controller&&r.controller.abort(),t.delete(s))}_onInvokeMessage(e){const{methodName:t,jobId:s,data:r,abortable:n}=e,o=n?(0,i.yi)():null,a=this._inJobs,l=c.Nv[t];let h;try{if("function"!=typeof l)throw new TypeError(`${t} is not a function`);h=l.call(null,r,{signal:o?o.signal:null})}catch(e){return void this._post({type:we,jobId:s,error:Z(e)})}(0,i.y8)(h)?(a.set(s,{controller:o,promise:h}),h.then((e=>{a.has(s)&&(a.delete(s),this._post({type:we,jobId:s},e))}),(e=>{a.has(s)&&(a.delete(s),e||(e={message:"Error encountered at method"+t}),(0,i.D_)(e)||this._post({type:we,jobId:s,error:Z(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:we,jobId:s},h)}_onOpenedMessage(e){var t;const{jobId:s,data:r}=e,n=this._outJobs.get(s);n&&(this._outJobs.delete(s),null==(t=n.abortHandle)||t.remove(),n.resolve(r))}_onResponseMessage(e){var t;const{jobId:s,error:r,data:i}=e,o=this._outJobs.get(s);o&&(this._outJobs.delete(s),null==(t=o.abortHandle)||t.remove(),r?o.reject(n.Z.fromJSON(JSON.parse(r))):o.resolve(i))}_post(e,t,s){return W(this.worker,e,t,s)}}const Se=ye;let Pe=(0,r.Z)("esri-workers-debug")?1:(0,r.Z)("host-browser")?navigator.hardwareConcurrency-1:0;Pe||(Pe=(0,r.Z)("safari")&&(0,r.Z)("mac")||(0,r.Z)("trident")?7:2);let Re=0;const Oe=[];function Ae(e,t){return Ne(e,{client:t})}async function Ne(e,t){const s=new class{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((s,r)=>{let n=!0;const o=e=>{(0,i.k_)(t.signal),n&&(n=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let n=0;n<e.length;++n){const a=e[n];(0,i.y8)(a)?this._clientPromises[n]=a.then((e=>(this._clients[n]=new z(e,t),o(s),this._clients[n])),(()=>(o(r),null))):(this._clients[n]=new z(a,t),this._clientPromises[n]=Promise.resolve(this._clients[n]),o(s))}}))}broadcast(e,t,s){const r=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const i=this._clientPromises[n];r[n]=i.then((r=>r.invoke(e,t,s)))}return r}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let t=0;t<this._clients.length;++t){const s=this._clients[t];if(s){if(!s.isBusy())return Promise.resolve(s)}else e=e||[],e.push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,t,s){let r=null;return Array.isArray(s)?(ee.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),r={transferList:s}):r=s,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((s=>s.invoke(e,t,r)))}on(e,t){return Promise.all(this._clientPromises).then((()=>(0,X.AL)(this._clients.map((s=>s.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let s=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((n=>{t[r]=n.openPort(),0==--s&&e(t)}))}))}get test(){return{numClients:this._clients.length}}};return await s.open(e,t),s}async function Le(e,t={}){if("string"!=typeof e)throw new n.Z("workers:undefined-module","modulePath is missing");let s=t.strategy||"distributed";if((0,r.Z)("host-webworker")&&!(0,r.Z)("esri-workers")&&(s="local"),"local"===s){let s=await z.loadWorker(e);s||(s=await import(e)),(0,i.k_)(t.signal);const r=t.client||s;return Ne([z.connect(s)],{...t,client:r})}if(await async function(){if(Me)return Me;Ce=(0,i.yi)();const e=[];for(let t=0;t<Pe;t++){const s=Se.create(t).then((e=>(Oe[t]=e,e)));e.push(s)}return Me=Promise.all(e),Me}(),(0,i.k_)(t.signal),"dedicated"===s){const s=Re++%Pe;return Ne([await Oe[s].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const s=Math.min(t.maxNumWorkers,Pe);if(s<Pe){const r=new Array(s);for(let n=0;n<s;++n){const s=Re++%Pe;r[n]=Oe[s].open(e,t)}return Ne(r,t)}}return Ne(Oe.map((s=>s.open(e,t))),t)}let Ce,Me=null},97873:(e,t,s)=>{"use strict";s.d(t,{Z:()=>i});var r=s(7830);class n{constructor(e,t,s,r){this.resolve=e,this.reject=t,this.callback=s,this.signal=r}}const i=class{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,t){return new Promise(((s,r)=>this._tasks.push(new n(s,r,e,t))))}unshift(e,t){return new Promise(((s,r)=>this._tasks.unshift(new n(s,r,e,t))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{(0,r.k_)(e.signal);const t=e.callback();t&&"object"==typeof t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0}cancelAll(){const e=(0,r.zE)();for(const t of this._tasks)t.reject(e);this._tasks.length=0}}}}]);